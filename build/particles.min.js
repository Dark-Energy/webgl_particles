function init(){function a(){f.loop()}var b,c={};c.start=function(){this.renderer=new THREE.WebGLRenderer({premultipliedAlpha:!0,alpha:!0}),this.renderer.setSize(800,600),this.renderer.setClearColor(16777215),this.set_viewport(800,600),b=document.getElementById("screen"),b.appendChild(this.renderer.domElement),this.dom_screen=b};var d,e;c.create_main_scene=function(){this.main_scene=new THREE.Scene,this.main_camera=new THREE.PerspectiveCamera(80,800/600,.1,1e3),this.main_scene.add(this.main_camera),this.main_camera.position.z=0,this.main_camera.position.y=0,this.main_camera.position.x=0,e=this.main_camera,d=this.main_scene},c.render=function(a){this.renderer.setClearColor(255,1),this.renderer.autoClear=!0,this.renderer.render(d,e)},c.update=function(a){this.update_all(a)},c.load_resources=function(a){this.resource_list=["textures/particle2.png","textures/particle1.png","textures/particle0.jpg"],json_list=["json/cone_particles1.json","json/cone_particles2.json","json/star_dust.json"],My_Lib.Texture_Manager.load_list_textures(this.resource_list,function(){My_Lib.Texture_Manager.load_list_json(json_list,function(){a()})})},c.create_sun=function(){function a(a){var b=My_Lib.Particle_System.prototype.fromJSON(a,function(){},g.main_scene);g.main_scene.add(b.node),g.add_animated_object(b)}var b=new THREE.PointLight(16776960);b.position.set(10,300,200),this.main_scene.add(b);var c=new THREE.SphereGeometry(7,20,20),d=new THREE.MeshBasicMaterial({color:16750848}),e=new THREE.Mesh(c,d);e.name="sun",e.position.z=-100,this.main_scene.add(e),this.main_camera.lookAt(e.position),this.main_camera.position.z=10;var f=new My_Lib.Euler_Controller(e,0,60,0);this.add_animated_object(f);var g=this,h=new THREE.Object3D;h.position.set(0,0,0),this.main_scene.add(h);var g=this;a(My_Lib.Texture_Manager.get("json/cone_particles1.json")),a(My_Lib.Texture_Manager.get("json/cone_particles2.json")),a(My_Lib.Texture_Manager.get("json/star_dust.json"))};var f=My_Lib.extend_application(c);f.start(),f.create_main_scene(),f.load_resources(function(){f.create_sun(),a()})}var My_Lib={};My_Lib.Viewport={},THREE.Vector3.prototype.applyMatrix4_rotation=function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this},My_Lib.Object_Animation=function(a,b){this.object=a,this.animation=b},My_Lib.Object_Animation.prototype.update=function(a){this.animation(this.object,a)},My_Lib.create_text_image=function(a,b,c,d,e){var f=document.createElement("canvas");f.width=a,f.height=b;var g=f.getContext("2d");e&&(g.fillStyle=e,g.fillRect(0,0,f.width,f.height)),g.font="Bold 40px Arial",g.fillStyle="rgba(0,255,0,0.95)",g.fillText("Hello, world!",0,50);var h=new THREE.Texture(f);return d&&(h.wrapS=h.wrapT=THREE.TextureWrapping.ClampToEdgeWrapping,h.minFilter=THREE.LinearFilter),h.needsUpdate=!0,h},My_Lib.Grid=function(a,b,c,d,e,f){this.xsegments=c,this.ysegments=d;var g=a/c,h=b/d,i=a/-2+g/2,j=b/-2+h/2,k=f;f||(k=new THREE.MeshBasicMaterial({opacity:1,transparent:!0,depthWrite:!0,depthTest:!1,map:e})),this.material=k;var l;this.segments=new Array,this.root=new THREE.Object3D;for(var n=new Array(8),o=1/c,p=1/d,q=0;q<d;q++)for(var r=0;r<c;r++){l=new THREE.PlaneBufferGeometry(g,h),m=new THREE.Mesh(l,k),m.position.x=i+r*g,m.position.y=j+q*h,m._row=r,m._col=q,this.segments.push(m),this.root.add(m),m._pos=new THREE.Vector3(m.position);var s=1-p*q-p;n[0]=o*r,n[1]=s,n[2]=o*r+o,n[3]=s,n[4]=o*r,n[5]=s+p,n[6]=o*r+o,n[7]=s+p,l.attributes.uv.array=new Float32Array(n)}},My_Lib.Grid.prototype.update=function(a){this.animation&&this.animation_live&&this.update_animation(a)},My_Lib.Grid.prototype.start_animation=function(){if(!this.animation)return void console.log("Grid Error! Trying start animaton, but animation undefined!");if(!this.animation_live){for(var a=0;a<this.segments.length;a++)this.animation.start(this.segments[a]);this.animation_live=!0}},My_Lib.Grid.prototype.update_animation=function(a){for(var b=!1,c=0;c<this.segments.length;c++){var d=this.segments[c];d._wait>0?(d._wait-=a,b=!0):(this.animation.run(a,d),b||(b=d._is_live))}this.animation_live=b,this.animation_live||this.animation.done()},My_Lib.Rotate_Animation=function(a,b){this.wait=a,this.animation_speed=b,this.rotation_axis=[0,0,1],this.end_rotation_value=2*Math.PI},My_Lib.Rotate_Animation.prototype.done=function(){this.onAnimationEnding&&this.onAnimationEnding()},My_Lib.Rotate_Animation.prototype.start=function(a){a._wait=Math.random()*this.wait,this.col_waiting&&(a._wait+=this.col_waiting*a._col),this.row_waiting&&(a._wait+=this.row_waiting*a._row),a._is_live=!0,a._mrotate=0,this.swap_dir?a._dir=100*Math.random()-50>0?1:-1:a._dir=1,this.live=!0},My_Lib.Rotate_Animation.prototype.run=function(a,b){b._is_live&&(b._mrotate+=this.animation_speed*a*b._dir,Math.abs(b._mrotate)>=this.end_rotation_value&&(b._mrotate=this.end_rotation_value,b._is_live=!1)),b.rotation.x=b._mrotate*this.rotation_axis[0],b.rotation.y=b._mrotate*this.rotation_axis[1],b.rotation.z=b._mrotate*this.rotation_axis[2]},My_Lib.Create_Quad=function(a,b,c,d){var e=new THREE.PlaneBufferGeometry(a,b),f=new THREE.ShaderMaterial({vertexShader:c,fragmentShader:d}),g=new THREE.Mesh(e,f);return g.rotation.y=Math.PI,g},My_Lib.Render_Target=function(a,b){this.target=new THREE.WebGLRenderTarget(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat}),this.camera=new THREE.PerspectiveCamera(80,a/b,.1,1e3)},My_Lib.Render_Target.prototype.render=function(a,b){b.render(a,this.camera,this.target,!0)},My_Lib.create_overlay_camera=function(a,b){var c=new THREE.OrthographicCamera(a/-2,a/2,b/2,b/-2,-1e4,1e4);return c},My_Lib.Overlay=function(a,b){this.camera=My_Lib.create_overlay_camera(a,b)},My_Lib.Overlay.prototype.render=function(a){this.scene&&(a.autoClear=!1,a.render(this.scene,this.camera),a.autoClear=!0)},My_Lib.mouse_coords_to_vector=function(a,b){var c=a.getBoundingClientRect(),d=a.clientWidth,e=a.clientHeight,f=(b.clientX-c.left)/d*2-1,g=-((b.clientY-c.top)/e*2-1),h=new THREE.Vector3(f,g,1);return h},My_Lib.mouse_coords_to_ray=function(a,b,c){var d=a.getBoundingClientRect(),e=a.clientWidth,f=a.clientHeight,g=(b.clientX-d.left)/e*2-1,h=-((b.clientY-d.top)/f*2-1),i=new THREE.Vector3(g,h,1);i.unproject(c);var j=new THREE.Raycaster(c.position,i.sub(c.position).normalize());return j},My_Lib.find_intersection_with_mouse_vector=function(a,b,c){a.unproject(b);var d=new THREE.Raycaster(b.position,a.sub(b.position).normalize()),e=d.intersectObjects([c],!0);return e},My_Lib.Mouse_Controller=function(a,b,c,d){this.root=a,this.over=b,this.click=!!c,this.callback=d},My_Lib.copy_object=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])},My_Lib.create_clone_object=function(a){var b={};return My_Lib.copy_object(b,a),b},My_Lib.copy_field_list=function(a,b,c){for(var d,e=0;e<c.length;e++)d=c[e],b[d]=a[d]},My_Lib.create_clone_field_list=function(a,b){for(var c,d={},e=0;e<b.length;e++)c=b[e],d[c]=a[c];return d},My_Lib.clone_field_list_one_level_recursion=function(a,b,c){for(var d,e=0;e<c.length;e++)d=c[e],"object"==typeof d?b[d]=My_Lib.create_clone_object(a[d]):b[d]=a[d]},My_Lib.extend_application=function(a){var b=Object.create(My_Lib.Application.prototype);return My_Lib.copy_object(b,a),My_Lib.Application.call(b),b},My_Lib.extend_proto=function(a,b){var c=Object.create(a);return My_Lib.copy_object(c,b),My_Lib.Application.call(app),app},My_Lib.Application=function(){this.clock=new THREE.Clock,this.delta_time=0,this.animated_objects=[];var a=window.requestAnimationFrame,b=this;this.run=function(){a(function(){b.loop()})},this.mouse_controllers=[]},My_Lib.Application.prototype.loop=function(){var a=this.clock.getDelta();a>.1&&(a=.1),this.delta_time=a,this.update(a),this.render(a),this.run()},My_Lib.Application.prototype.add_animated_object=function(a){this.animated_objects.push(a)},My_Lib.Application.prototype.update_all=function(a){for(var b,c=0,d=this.animated_objects.length;c<d;c++)b=this.animated_objects[c],b.update&&b.update(a)},My_Lib.Application.prototype.create_mouse_move_listener=function(){function a(a){var c=My_Lib.mouse_coords_to_vector(b.dom_screen,a);b.find_mouse_over_intersections(c)}if(!this.mouse_move_listener){var b=this;this.mouse_move_listener=!0,document.addEventListener("mousemove",a)}},My_Lib.Application.prototype.find_mouse_over_intersections=function(a){a.unproject(this.main_camera);for(var b,c=new THREE.Raycaster(this.main_camera.position,a.sub(this.main_camera.position).normalize()),d=0,e=this.mouse_controllers.length;d<e;d++)if(b=this.mouse_controllers[d],b.over){var f=c.intersectObjects([b.root],!0);b.callback(f)}},My_Lib.Application.prototype.add_mouse_controller=function(a,b,c,d){var e=new My_Lib.Mouse_Controller(a,b,c,d);return this.mouse_controllers.push(e),b&&this.create_mouse_move_listener(),e},My_Lib.Application.prototype.set_viewport=function(a,b){My_Lib.Viewport.width=a,My_Lib.Viewport.height=b},My_Lib.Euler_Controller=function(a,b,c,d){this.obj=a,this.xspeed=b*Math.PI/180,this.yspeed=c*Math.PI/180,this.zspeed=d*Math.PI/180},My_Lib.Euler_Controller.prototype.update=function(a){this.obj.rotation.x+=this.xspeed*a,this.obj.rotation.y+=this.yspeed*a,this.obj.rotation.z+=this.zspeed*a},My_Lib.Registered_Classes={},My_Lib.Register_Class=function(a,b){My_Lib.Registered_Classes[a]&&console.log("Register Class ERROR! Class with this name already exists!",a),My_Lib.Registered_Classes[a]=b},My_Lib.Get_Class=function(a){return My_Lib.Registered_Classes[a]},console.log(THREE.WebGLState),Particle_Forces={},Particle_Forces.Force=function(){},My_Lib.copy_object(Particle_Forces.Force.prototype,{calc:function(a,b,c){},toJSON:function(a){return{}},parse:function(a){}}),Particle_Forces.Constant_Force=function(a){"undefined"!=typeof a?this.force=a:this.force={x:0,y:0,z:0}},Particle_Forces.Constant_Force.prototype=Object.create(Particle_Forces.Force.prototype),My_Lib.copy_object(Particle_Forces.Constant_Force.prototype,{constructor:Particle_Forces.Constant_Force,calc:function(a,b,c){c.x+=this.force.x,c.y+=this.force.y,c.z+=this.force.z},toJSON:function(a){var b={};return b.name="Constant_Force",b.force=My_Lib.create_clone_object(this.force),b},parse:function(a){a.force&&My_Lib.copy_object(this.force,a.force)}}),My_Lib.Register_Class("Constant_Force",Particle_Forces.Constant_Force),Point_Generators={},Point_Generators.Random_Direction=function(){},Point_Generators.Random_Direction.prototype.get_direction=function(a){a.x=Math.random(),a.y=Math.random(),a.z=Math.random()},Point_Generators.Sphere=function(a){this.radius=a},Point_Generators.Sphere.prototype.get_inner_point=function(a){var b=Math.random()*Math.PI*2,c=Math.random()*Math.PI;a.x=Math.cos(b)*Math.sin(c),a.y=Math.cos(c),a.z=Math.sin(b)*Math.sin(c)},Point_Generators.Sphere.prototype.get_normal=function(a){a.x=2*Math.random()-1,a.y=2*Math.random()-1,a.z=2*Math.random()-1,a.normalize()},Point_Generators.Sphere.prototype.get_point=function(a){this.get_normal(a),a.multiplyScalar(this.radius)},My_Lib.Loading_Manager=function(){this.resources={},this.texture_loader=new THREE.TextureLoader},My_Lib.Loading_Manager.prototype={constructor:My_Lib.Loading_Manager,get:function(a){return this.resources[a]},get_async:function(a,b){var c=this.get(a);if(c)return b&&b(c),c;return c=this.texture_loader.load(url,function(a){b&&b(a)}),this.resources[a]=c,c},load_list:function(a,b,c,d){function e(d){j++,j<a.length?(i.on_resource_loaded&&i.on_resource_loaded(d),c(a[j],f,h,g)):b&&b()}function f(b){i.resources[a[j]]=b,e(b)}function g(b){console.log("ERROR loading texture",b,a[j]),e()}function h(){d&&d()}var i=this,j=0;c(a[0],f,h,g)},load_list_textures:function(a,b){var c=this;this.load_list(a,b,function(a,b,d,e){c.texture_loader.load(a,b,d,e)})},load_list_json:function(a,b,c){var d=new THREE.XHRLoader;this.load_list(a,b,function(a,b,c,e){d.load(a,b,c,e)},c)},free:function(){this.resources={}}},My_Lib.Texture_Manager=new My_Lib.Loading_Manager,My_Lib.Particle_Affector=function(){},My_Lib.Particle_Affector.prototype.affect=function(a,b,c,d){return!0},My_Lib.Particle_Affector.prototype.toJSON=function(a){if(a)return{};var b={name:"Particle_Affector",params:{}};return b},My_Lib.Particle_Affector.prototype.parse=function(a){},My_Lib.Force_Affector=function(){this.forces=new Array},My_Lib.Force_Affector.prototype=Object.create(My_Lib.Particle_Affector.prototype),My_Lib.copy_object(My_Lib.Force_Affector.prototype,{constructor:My_Lib.Force_Affector,add_force:function(a){this.forces.push(a)},apply_forces:function(a,b,c,d){for(var e={x:0,y:0,z:0},f=0;f<this.forces.length;f++)this.forces[f].calc(a,b,e);b.velocity.x+=e.x*a,b.velocity.y+=e.y*a,b.velocity.z+=e.z*a},affect:function(a,b,c,d){return this.apply_forces(a,b,c,d),!0},toJSON:function(a){var b={};if(b.name="Force_Affector",b.params=My_Lib.Particle_Affector.prototype.toJSON.call(this,this),this.forces.length>0){b.params.forces=new Array;for(var c=0;c<this.forces.length;c++)b.params.forces.push(this.forces[c].toJSON())}return b},parse:function(a){var b,c;if(a.forces)for(var d=0;d<a.forces.length;d++)c=a.forces[d],b=My_Lib.Get_Class(c.name),b&&(b=new b,b.parse(c),this.add_force(b))}}),My_Lib.Register_Class("Force_Affector",My_Lib.Force_Affector),My_Lib.Particle_Emitter=function(a){this.emit_delta=0,this.emit_count=0,this.emit_per_second=a||10,this.lifetime={min:0,max:1}},My_Lib.Particle_Emitter.prototype.emit_life=function(){return this.lifetime.min+Math.random()*(this.lifetime.max-this.lifetime.min)},My_Lib.Particle_Emitter.prototype.calc_emitted_particles=function(a){this.emit_delta+=this.emit_per_second*a;var b=Math.floor(this.emit_delta);return b>0&&(this.emit_delta-=b),b},My_Lib.Particle_Emitter.prototype.set_parent_object=function(a,b){"string"==typeof a?b&&(this.parent=b.getObjectByName(a)):this.parent=a},My_Lib.Particle_Emitter.prototype.emit=function(a){},My_Lib.Particle_Emitter.prototype.toJSON=function(a){var b={emit_per_second:this.emit_per_second,lifetime:{min:this.lifetime.min,max:this.lifetime.max}};if(this.parent&&("string"==typeof this.parent?b.parent=this.parent:b.parent=this.parent.name),a)return b;var c={};return c.name="Particle_Emitter",c.params=b,c},My_Lib.Particle_Emitter.prototype.parse=function(a){this.emit_per_second=a.emit_per_second,My_Lib.copy_object(this.lifetime,a.lifetime)},My_Lib.Register_Class("Particle_Emitter",My_Lib.Particle_Emitter),My_Lib.Particle_System=function(a){this.emitter=a.emitter,this.emitter||(this.emitter=new My_Lib.Particle_Emitter(1)),this.affector=a.affector,this.affector||(this.affector=new My_Lib.Particle_Affector),this.particle_lifetime=a.particle_lifetime||3,this.params=a,this.texture=a.texture,this.no_fade_color=!!a.no_fade_color,a.color||(a.color={r:1,g:1,b:1}),this.dynamic_color=a.end_color||a.random_color,this.point_size=a.size||1;var b=a.count||100;this.node=new THREE.Points(this.create_particle_geometry(b),this.create_particle_material())};var PSystem=My_Lib.Particle_System;My_Lib.Particle_System.prototype.create=function(a,b){},My_Lib.Particle_System.prototype.create_particle_geometry=function(a){this.particle_data=new Array(a);var b=new Float32Array(3*a),c=new Float32Array(3*a),d=new Float32Array(a);this.particle_data=new Array(a);for(var e,f=0;f<a;f++)e={},e.position=new THREE.Vector3(0,0,0),e.velocity=new THREE.Vector3(0,0,0),this.particle_data[f]=e,e.lifetime=0,b[3*f]=0,b[3*f+1]=0,b[3*f+2]=0,d[f]=0,c[3*f]=this.params.color.r,c[3*f+1]=this.params.color.g,c[3*f+2]=this.params.color.b;this.geometry={},this.geometry.vertices=new THREE.BufferAttribute(b,3).setDynamic(!0),this.geometry.colors=new THREE.BufferAttribute(c,3),this.dynamic_color&&this.geometry.colors.setDynamic(!0),this.geometry.params=new THREE.BufferAttribute(d,1).setDynamic(!0);var g=new THREE.BufferGeometry;return this.geometry.buffer=g,g.addAttribute("position",this.geometry.vertices),g.addAttribute("color",this.geometry.colors),g.addAttribute("params",this.geometry.params),g};var vertex_shader=["//attribute vec4 position;","attribute vec4 color;","attribute float params;","varying vec4 vcolor;","uniform float lifetime;","uniform float point_size;","uniform vec2 screen_size;","void main () {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vcolor.rgb = color.rgb;","#ifdef NO_FADE_COLOR","vcolor.a = 1.0;","#else","vcolor.a = params / (lifetime);","#endif","float t =  screen_size.y* projectionMatrix[1][1] / gl_Position.w;","t = t * point_size;","if (params > 0.0) {","gl_PointSize = t;","}","else {","gl_PointSize = 0.0;","}","}"],fragment_shader=["varying vec4 vcolor;","#ifdef PARTICLE_TEXTURE","uniform sampler2D sprite;","#endif","void main() {","#ifdef PARTICLE_TEXTURE","vec4 tex = texture2D( sprite, gl_PointCoord );","#else","vec4 tex = vec4(1,1,1,1);","#endif","float alpha = tex.a;","#ifndef NO_FADE_COLOR","alpha *= vcolor.a;","#endif","#ifdef TEXTURE_ONLY_ALPHA","gl_FragColor = vec4( vcolor.rgb * tex.a, tex.a *alpha);","#else","vec3 fragment = tex.rgb * vcolor.rgb;","#ifdef PREMULTIPLIED_ALPHA","fragment.rgb *= tex.a;","#endif","gl_FragColor = vec4(fragment.rgb, alpha);","#endif","}"];My_Lib.Particle_System.prototype.generate_material_name=function(){var a="MY_PARTICLE_MATERIAL";return this.texture&&(a+="_WITH_TEXTURE"),this.no_fade_color&&(a+="_NO_FADE_COLOR"),a},My_Lib.Particle_System.prototype.blending_mode={additive:{blendSrc:THREE.OneFactor,blendDst:THREE.OneFactor},alpha:{blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor},one_alpha:{blendSrc:THREE.OneFactor,blendDst:THREE.OneMinusSrcAlphaFactor},alpha_one:{blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor}},My_Lib.Particle_System.prototype.create_particle_material=function(){"string"==typeof this.texture&&(this.texture=My_Lib.Texture_Manager.get(this.texture));var a=THREE.CustomBlending,b=this.blending_mode.one_alpha,c=this.params.blending;c&&("no"===c?a=THREE.NoBlending:this.blending_mode[c]&&(b=this.blending_mode[c])),"undefined"==typeof this.params.pre_alpha&&(this.params.pre_alpha=!0),"undefined"==typeof this.params.depth_test&&(this.params.depth_test=!0),"undefined"==typeof this.params.depth_write&&(this.params.depth_write=!1);var d=new THREE.ShaderMaterial({transparent:!0,depthWrite:this.params.depth_write,depthTest:this.params.depth_test,premultipliedAlpha:!!this.params.pre_alpha,blending:a,blendSrc:b.blendSrc,blendDst:b.blendDst,defines:{PARTICLE_TEXTURE:!!this.texture,NO_FADE_COLOR:!!this.no_fade_color},uniforms:{sprite:{value:this.texture},lifetime:{value:this.particle_lifetime},point_size:{value:this.point_size},screen_size:{value:new THREE.Vector2(My_Lib.Viewport.width,My_Lib.Viewport.height)}},vertexShader:vertex_shader.join("\n"),fragmentShader:fragment_shader.join("\n")});return d},My_Lib.Particle_System.prototype.emit_particles=function(a,b){for(var c,d=this.geometry.vertices.array,e=this.geometry.params.array,f=0;f<this.particle_data.length&&b>0;f++)e[f]>0||(c=this.particle_data[f],this.emitter.emit(c),c.lifetime=this.particle_lifetime,d[3*f]=c.position.x,d[3*f+1]=c.position.y,d[3*f+2]=c.position.z,e[f]=c.lifetime,b--)},My_Lib.Particle_System.prototype.update_particle_geometry=function(a){for(var b,c=this.geometry.vertices.array,d=this.geometry.params.array,e=new THREE.Vector3(0,0,0),f={r:1,b:1,g:1},g=0;g<this.particle_data.length;g++)d[g]>0&&(b=this.particle_data[g],b.position.x+=b.velocity.x*a,b.position.y+=b.velocity.y*a,b.position.z+=b.velocity.z*a,b.lifetime-=a,(b.lifetime<=0||!this.affector.affect(a,b,e,f))&&(b.lifetime=0),d[g]=b.lifetime,c[3*g]=b.position.x,c[3*g+1]=b.position.y,c[3*g+2]=b.position.z);var h=this.emitter.calc_emitted_particles(a);this.emit_particles(a,h),this.geometry.vertices.needsUpdate=!0,this.geometry.params.needsUpdate=!0},My_Lib.Particle_System.prototype.update=function(a){this.update_particle_geometry(a)},My_Lib.Particle_System.prototype.toJSON=function(){var a={};return a.name="test",a.params={},this.params&&My_Lib.copy_object(a.params,this.params),a.params.emitter=this.emitter.toJSON(),a.params.affector=this.affector.toJSON(),a},My_Lib.Particle_System.prototype.fromJSON=function(a,b,c){var d=JSON.parse(a);if(d.params.emitter){var e=My_Lib.Get_Class(d.params.emitter.name);e=e?new e:new My_Lib.Particle_Emitter,e.parse(d.params.emitter.params),d.params.emitter.params.parent&&e.set_parent_object(d.params.emitter.params.parent,c),d.params.emitter=e}if(d.params.affector){var f=My_Lib.Get_Class(d.params.affector.name);f=f?new f:new My_Lib.Particle_Affector,f.parse(d.params.affector.params),d.params.affector=f}var g=new My_Lib.Particle_System(d.params);return My_Lib.Texture_Manager.get_async(d.params.texture,b),b&&b(g),g};var Cone_Emitter=function(){My_Lib.Particle_Emitter.apply(this,arguments),this.generator=new Point_Generators.Random_Direction,this.origin=new THREE.Vector3(1,1,0),this.velocity=new THREE.Vector3(0,1,0),this.dispersion={min:5,max:10},this.dispersion.delta=5,this.speed={min:5,max:10,delta:5},this.color=new THREE.Color(1,1,1)};Cone_Emitter.prototype=Object.create(My_Lib.Particle_Emitter.prototype),Cone_Emitter.prototype.constructor=Cone_Emitter,My_Lib.Register_Class("Cone_Emitter",Cone_Emitter),Cone_Emitter.prototype.toJSON=function(){var a={};return a.name="Cone_Emitter",a.params=My_Lib.Particle_Emitter.prototype.toJSON.call(this,this),My_Lib.clone_field_list_one_level_recursion(this,a.params,["origin","velocity","dispersion","speed"]),a},Cone_Emitter.prototype.parse=function(a){My_Lib.Particle_Emitter.prototype.parse.call(this,a),this.origin.copy(a.origin),this.velocity.copy(a.velocity),this.set_dispersion(a.dispersion.min,a.dispersion.max),this.set_speed(a.speed.min,a.speed.max)},Cone_Emitter.prototype.set_speed=function(a,b){this.speed.min=a,this.speed.max=b,this.speed.delta=b-a},Cone_Emitter.prototype.set_dispersion=function(a,b){this.dispersion.min=a,this.dispersion.max=b,this.dispersion.delta=b-a},Cone_Emitter.prototype.emit=function(a,b){a.position.copy(this.origin),this.generator.get_direction(a.velocity),a.velocity.multiplyScalar(Math.random()*this.dispersion.delta+this.dispersion.min),a.velocity.add(this.velocity).normalize(),this.parent&&(this.parent.localToWorld(a.position),a.velocity.applyMatrix4_rotation(this.parent.matrixWorld)),a.velocity.multiplyScalar(Math.random()*this.speed.delta+this.speed.min),b&&this.emit_color(b)},Cone_Emitter.prototype.emit_color=function(a){a.copy(this.color)},Sphere_Emitter=function(a){My_Lib.Particle_Emitter.call(this),this.radius=a,this.generator=new Point_Generators.Sphere(a)},Sphere_Emitter.prototype=Object.create(My_Lib.Particle_Emitter.prototype),Sphere_Emitter.prototype.constructor=My_Lib.Sphere_Emitter,Sphere_Emitter.prototype.emit=function(a){this.generator.get_point(a.position),this.generator.get_normal(a.velocity),a.velocity.multiplyScalar(10)},Star_Dust_Emitter=function(){My_Lib.Particle_Emitter.apply(this,arguments),this.start_position=new THREE.Vector3(0,0,0),this.end_position=new THREE.Vector3(1,1,1),this.delta=new THREE.Vector3(1,1,1),this.velocity=new THREE.Vector3(0,0,1)},Star_Dust_Emitter.prototype=Object.create(My_Lib.Particle_Emitter.prototype),Star_Dust_Emitter.prototype.constructor=Star_Dust_Emitter,My_Lib.copy_object(Star_Dust_Emitter.prototype,{set_velocity:function(a,b,c){this.velocity.set(a,b,c)},set_position_range:function(a,b){this.start_position.copy(a),this.end_position.copy(b),this.delta.set(b.x-a.x,b.y-a.y,b.z-a.z)},get_position:function(a){a.x=Math.random()*this.delta.x+this.start_position.x,a.y=Math.random()*this.delta.y+this.start_position.y,a.z=Math.random()*this.delta.z+this.start_position.z},get_velocity:function(a){a.x=this.velocity.x,a.y=this.velocity.y,a.z=this.velocity.z},emit:function(a){this.get_position(a.position),this.parent&&this.parent.localToWorld(a.position),this.get_velocity(a.velocity)},toJSON:function(){var a=My_Lib.Particle_Emitter.prototype.toJSON.call(this,this);My_Lib.clone_field_list_one_level_recursion(this,a,["velocity","start_position","end_position"]);var b={name:"Star_Dust_Emitter",params:a};return b},parse:function(a){My_Lib.Particle_Emitter.prototype.parse.call(this,a),this.set_position_range(a.start_position,a.end_position),this.velocity.copy(a.velocity)}}),My_Lib.Register_Class("Star_Dust_Emitter",Star_Dust_Emitter),Star_Dust_Affector=function(a){this.end=a||0},Star_Dust_Affector.prototype=Object.create(My_Lib.Particle_Affector.prototype),Star_Dust_Affector.prototype.constructor=Star_Dust_Affector,My_Lib.copy_object(Star_Dust_Affector.prototype,{affect:function(a,b,c){return!(b.position.z>this.end)},toJSON:function(){var a=My_Lib.Particle_Affector.prototype.toJSON.call(this,this);a.end=this.end;var b={name:"Star_Dust_Affector",params:a};return b},parse:function(a){My_Lib.Particle_Affector.prototype.parse(this,a),this.end=a.end}}),My_Lib.Register_Class("Star_Dust_Affector",Star_Dust_Affector),init();