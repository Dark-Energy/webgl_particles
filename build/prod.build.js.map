{"version":3,"sources":["webpack:///prod.build.js","webpack:///webpack/bootstrap 6ee2c1139edd4bf34766","webpack:///./src/base/my_lib.js","webpack:///./src/particles/particle_affector.js","webpack:///./src/particles/particle_emitter.js","webpack:///./src/particles/particles_points.js","webpack:///./src/base/event_hub.js","webpack:///./src/base/mouse_intersector.js","webpack:///./src/particles/color_domain.js","webpack:///./src/particles/particle_shaders.js","webpack:///./src/particles/particles.js","webpack:///./src/particles/particles_manager.js","webpack:///./src/particles/point_generators.js","webpack:///./src/app/application.js","webpack:///./src/base/animations.js","webpack:///./src/base/loading_manager.js","webpack:///./src/base/package_manager.js","webpack:///./src/base/scene_serializer.js","webpack:///./src/base/threejs_mixins.js","webpack:///./src/particles/custom_affector.js","webpack:///./src/particles/custom_emitter.js","webpack:///./src/particles/forces.js","webpack:///./src/particles/test_emitters.js"],"names":["Engine","modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","My_Lib","Viewport","Object_Animation","animation","this","update","dt","create_text_image","width","height","text","npot","background","canvas","document","createElement","context","getContext","fillStyle","fillRect","font","fillText","texture","THREE","Texture","wrapS","wrapT","TextureWrapping","ClampToEdgeWrapping","minFilter","LinearFilter","needsUpdate","Create_Quad","vertex_shader","fragment_shader","plane","PlaneBufferGeometry","material","ShaderMaterial","vertexShader","fragmentShader","quad","Mesh","rotation","y","Math","PI","Render_Target","target","WebGLRenderTarget","magFilter","NearestFilter","format","RGBFormat","camera","PerspectiveCamera","render","scene","renderer","create_overlay_camera","OrthographicCamera","Overlay","autoClear","Mouse_Controller","root","over","click","callback","event_hub","Event_Hub","events","add_event_listener","func","obj","push","on","emit","listeners","length","t","run_function","window","setTimeout","create_run_function","app","run","loop","Euler_Controller","x","z","xspeed","yspeed","zspeed","Registered_Classes","Register_Class","console","log","Get_Class","create_class","parent","child","props","create","_","copy_object","contructor","Abstract_Fabric","data","constructor","type","parse","undefined","Print_Classes","key","Particle_Affector","__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__","id","generateUUID","affect","pdata","vert","color","toJSON","params","json","Force_Affector","forces","Array","add_force","force","apply_forces","particle","acceleration","calc","velocity","uuid","f","item","Particle_Emitter","emit_per_second","emit_delta","emit_count","lifetime","min","max","emit_life","random","calc_emitted_particles","need_emit","floor","matrix","position","set","applyMatrix4","applyMatrix4_rotation","Particles_Points","geometry","Points","boundingSphere","Sphere","radius","meta","mat","geom","Object3D","raycast","raycaster","intersects","sphere","copy","matrixWorld","r","ray","intersectsSphere","shit","Vector3","tr","Ray","tmp","sub","distance","sqrt","dot","point","main_event_hub","Mouse_Intersector","get_normalized_screen_coords","offset","getBoundingClientRect","clientWidth","clientHeight","left","top","vector","mouse_coords_to_vector","event","clientX","clientY","unproject","mouse_coords_to_ray","normalize","find_intersection_with_mouse_vector","Raycaster","intersectObjects","find_intersection_with_bounding_sphere","fakecaster","recursive","level","children","updateMatrixWorld","inter","find_intersected_object","Color_Domain","Table_Color","g","b","Color","fill","table","copy_table","default_table","index","ceil","src","Particle_Shaders","vertex","join","fragment","Particle_System","__WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__","__WEBPACK_IMPORTED_MODULE_2__particle_affector_js__","__WEBPACK_IMPORTED_MODULE_3__particles_points_js__","__WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__","__WEBPACK_IMPORTED_MODULE_5__color_domain_js__","config_params","emitter","affector","particle_lifetime","dynamic_color","count","create_particle_material","node","create_particle_geometry","bounding_radius","no_fade_color","pre_alpha","depth_test","depth_write","blending","size","discrete_emission","apply_world_matrix_on_emit","set_name","suicide","remove","create_particle_data","particle_data","vertices","Float32Array","colors","color_domain","BufferAttribute","setDynamic","BufferGeometry","buffer","addAttribute","discrete_emit","emit_particles","verts","array","old_need_emit","update_particle_geometry","dummy_color","generate_material_name","my_name","blending_mode","additive","blendSrc","OneFactor","blendDst","alpha","SrcAlphaFactor","OneMinusSrcAlphaFactor","one_alpha","alpha_one","convert_blending_mode","three_blending","factors","NoBlending","CustomBlending","set_texture","Texture_Manager","error","uniforms","sprite","recreate_material","create_uniforms","point_size","screen_size","Vector2","calc_defines","defines","select_texture","blend_obj","transparent","depthWrite","depthTest","set_pre_alpha","set_point_size","set_blending","set_emitter","set_particle_life_length","val","set_emission_per_second","set_particle_count","set_color","set_bounding_sphere_radius","Particle_Manager","__WEBPACK_IMPORTED_MODULE_4__particles_js__","particles","particles_array","add","ps","remove_particles","indexOf","splice","get_particle_names","names","create_by_params","arr","emitter_fabric","affector_fabric","fromJSON","JSON","e","getObjectByName","load_particles","getObjectByProperty","replace_object_with_this","create_name","number","begin_name","testing","create_new","particle_manager","Particles_Config","box_size","Point_Generators","Random_Direction","get_direction","get_inner_point","beta","cos","sin","get_normal","get_point","multiplyScalar","Application","__WEBPACK_IMPORTED_MODULE_1__base_event_hub_js__","__WEBPACK_IMPORTED_MODULE_2__base_mouse_intersector_js__","config","_lifecycle_event","_init_timer","_create_loop_function","mouse_controllers","remove_animated_object","start","_set_configuration","clock","Clock","delta_time","animated_objects","self","get_default_configuration","dom_element","render_params","premultipliedAlpha","viewport","clear_color","main_camera","fov","near","far","aspect_ratio","_create_render","dom_screen","alert","getElementById","WebGLRenderer","appendChild","domElement","setSize","set_viewport","setClearColor","_create_main_scene","prevent","main_scene","Scene","aspect","updateProjectionMatrix","apply_configuration","configuration","load_configuration","url","xhr","XHRLoader","configuration_is_applied","onload","progress","status","load","default_config","extend","methods","child_func","Child","apply","arguments","extend_proto","proto","delta","getDelta","do_update","add_animated_object","update_all","len","pre_update","before_update","create_mouse_move_listener","mouse_move_listener","find_mouse_over_intersections","addEventListener","add_mouse_controller","Base_Animation","Euler_Animation","Scale_Animation","__WEBPACK_IMPORTED_MODULE_0__my_lib_js__","time","time_scale","stopped","scaled_dt","calc_animation","stop","reset","param","xscale","yscale","zscale","scale","Loading_Manager","Chain_Loader","list","stop_by_error","next","resource","item_loaded","finished","do_error","onerror","do_progress","onprogress","load_func","test_chain_loader","cl","resources","texture_loader","TextureLoader","get_async","load_list","resource_list","on_load","on_progress","on_resource_loaded","load_list_textures","load_list_json","loader","free","Package_Manager","state","defaults","parse_package_description","pack","load_resources","loaded","textures","data_loaded","Scene_Serializer","__WEBPACK_IMPORTED_MODULE_1__particles_particles_manager_js__","animation_library","anims","collect_animations","create_animations","animations","anim","bind_animations","animdata","bindings","copy_animations","bind","anim_uuid","add_animation","load_from_json","ObjectLoader","myanimations","scene_loaded","Mix_It","elements","Object3D_Animation_Mixin","remove_animation","old_toJson","Object3D_Serialization_Mixin","standard_serialization","stringify","userData","castShadow","receiveShadow","visible","toArray","materials","geometries","collect_materials","collect_geometry","toJSON1","extractFromCache","cache","values","metadata","isRootObject","output","images","version","generator","collect_animations_recursive","source","up","quaternion","matrixAutoUpdate","matrixWorldNeedsUpdate","frustumCulled","renderOrder","Custom_Affector","__WEBPACK_IMPORTED_MODULE_1__particle_affector_js__","custom_func","dummy","test_func","set_affect_function","Function","source_code","set_affect_func","Custom_Emitter","set_emit_function","test","Particle_Forces","Force","Constant_Force","create_clone_object","Cone_Emitter","Star_Dust_Emitter","Sphere_Emitter","Star_Dust_Affector","__WEBPACK_IMPORTED_MODULE_1__point_generators_js__","__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__","__WEBPACK_IMPORTED_MODULE_3__particle_affector_js__","origin","dispersion","speed","clone_field_list_one_level_recursion","set_dispersion","set_speed","emit_color","from_center","start_position","end_position","set_velocity","set_position_range","end","get_position","get_velocity","localToWorld","__WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__","__WEBPACK_IMPORTED_MODULE_1__base_my_lib_js__","__WEBPACK_IMPORTED_MODULE_2__base_animations_js__","__WEBPACK_IMPORTED_MODULE_3__base_mouse_intersector_js__","__WEBPACK_IMPORTED_MODULE_4__base_loading_manager_js__","__WEBPACK_IMPORTED_MODULE_5__base_package_manager_js__","__WEBPACK_IMPORTED_MODULE_6__particles_particles_points_js__","__WEBPACK_IMPORTED_MODULE_7__particles_particle_emitter_js__","__WEBPACK_IMPORTED_MODULE_8__particles_forces_js__","__WEBPACK_IMPORTED_MODULE_9__particles_particle_affector_js__","__WEBPACK_IMPORTED_MODULE_10__particles_point_generators_js__","__WEBPACK_IMPORTED_MODULE_11__particles_custom_emitter_js__","__WEBPACK_IMPORTED_MODULE_12__particles_custom_affector_js__","__WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__","__WEBPACK_IMPORTED_MODULE_14__particles_particle_shaders_js__","__WEBPACK_IMPORTED_MODULE_15__particles_particles_js__","__WEBPACK_IMPORTED_MODULE_16__particles_particles_manager_js__","__WEBPACK_IMPORTED_MODULE_17__base_scene_serializer_js__","__WEBPACK_IMPORTED_MODULE_18__base_threejs_mixins_js__","__WEBPACK_IMPORTED_MODULE_19__app_application_js__","__WEBPACK_IMPORTED_MODULE_20__particles_color_domain_js__"],"mappings":"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","file":"prod.build.js","sourcesContent":["var Engine =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 21);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return My_Lib; });\n/*\r\n*/\n\nvar My_Lib = {};\n\nMy_Lib.Viewport = {};\n\nMy_Lib.Object_Animation = function (object, animation) {\n\tthis.object = object;\n\tthis.animation = animation;\n};\n\nMy_Lib.Object_Animation.prototype.update = function (dt) {\n\tthis.animation(this.object, dt);\n};\n\nMy_Lib.create_text_image = function (width, height, text, npot, background) {\n\t// create a canvas element\n\tvar canvas = document.createElement('canvas');\n\tcanvas.width = width;\n\tcanvas.height = height;\n\tvar context = canvas.getContext('2d');\n\tif (background) {\n\t\tcontext.fillStyle = background;\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\n\t}\n\tcontext.font = \"Bold 40px Arial\";\n\tcontext.fillStyle = \"rgba(0,255,0,0.95)\";\n\tcontext.fillText('Hello, world!', 0, 50);\n\n\t// canvas contents will be used for a texture\n\tvar texture = new THREE.Texture(canvas);\n\tif (npot) {\n\t\ttexture.wrapS = texture.wrapT = THREE.TextureWrapping.ClampToEdgeWrapping;\n\t\ttexture.minFilter = THREE.LinearFilter;\n\t}\n\ttexture.needsUpdate = true;\n\treturn texture;\n};\n\nMy_Lib.Create_Quad = function (width, height, vertex_shader, fragment_shader) {\n\t//plane created turn away from camera\n\tvar plane = new THREE.PlaneBufferGeometry(width, height);\n\n\tvar material = new THREE.ShaderMaterial({\n\t\tvertexShader: vertex_shader,\n\t\tfragmentShader: fragment_shader\n\t});\n\n\tvar quad = new THREE.Mesh(plane, material);\n\tquad.rotation.y = Math.PI;\n\treturn quad;\n};\n\nMy_Lib.Render_Target = function (width, height) {\n\tthis.target = new THREE.WebGLRenderTarget(width, height, {\n\t\tminFilter: THREE.LinearFilter,\n\t\tmagFilter: THREE.NearestFilter,\n\t\tformat: THREE.RGBFormat\n\t});\n\n\tthis.camera = new THREE.PerspectiveCamera(80, width / height, 0.1, 1000);\n};\n\nMy_Lib.Render_Target.prototype.render = function (scene, renderer) {\n\trenderer.render(scene, this.camera, this.target, true //forceClear\n\t);\n};\n\nMy_Lib.create_overlay_camera = function (width, height) {\n\tvar camera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, -10000, 10000);\n\treturn camera;\n};\n\nMy_Lib.Overlay = function (width, height) {\n\tthis.camera = My_Lib.create_overlay_camera(width, height);\n};\n\nMy_Lib.Overlay.prototype.render = function (renderer) {\n\tif (!this.scene) {\n\t\treturn;\n\t}\n\n\trenderer.autoClear = false;\n\trenderer.render(this.scene, this.camera);\n\trenderer.autoClear = true;\n};\n\nMy_Lib.Mouse_Controller = function (root, over, click, callback) {\n\tthis.root = root;\n\tthis.over = over;\n\tthis.click = !!click;\n\tthis.callback = callback;\n};\n\n/*\r\nugly hack\r\n*/\n\nMy_Lib.event_hub = new Event_Hub();\n\nfunction Event_Hub() {\n\tthis.events = {};\n}\n\nEvent_Hub.prototype.add_event_listener = function (name, func, obj) {\n\tif (!this.events[name]) {\n\t\tthis.events[name] = [];\n\t}\n\tthis.events[name].push({ name: name, func: func, obj: obj });\n};\n\nEvent_Hub.prototype.on = Event_Hub.prototype.add_event_listener;\n\nEvent_Hub.prototype.emit = function (name, obj) {\n\tvar listeners = this.events[name];\n\tif (listeners) {\n\t\tfor (var i = 0; i < listeners.length; i++) {\n\t\t\tvar t = listeners[i];\n\t\t\tt.func.call(t.obj, obj);\n\t\t}\n\t}\n};\n\nvar run_function = //window.requestAnimationFrame;\nfunction (callback) {\n\twindow.setTimeout(callback, 1000 / 60);\n};\n\nMy_Lib.create_run_function = function (app) {\n\tMy_Lib.run = function () {\n\t\trun_function(function () {\n\t\t\tapp.loop();\n\t\t});\n\t};\n};\n\nMy_Lib.Euler_Controller = function (obj, x, y, z) {\n\tthis.obj = obj;\n\tthis.xspeed = x * Math.PI / 180;;\n\tthis.yspeed = y * Math.PI / 180;;\n\tthis.zspeed = z * Math.PI / 180;;\n};\n\nMy_Lib.Euler_Controller.prototype.update = function (dt) {\n\tthis.obj.rotation.x += this.xspeed * dt;\n\tthis.obj.rotation.y += this.yspeed * dt;\n\tthis.obj.rotation.z += this.zspeed * dt;\n};\n\n//Class Library\nMy_Lib.Registered_Classes = {};\n\nMy_Lib.Register_Class = function (name, func) {\n\tif (My_Lib.Registered_Classes[name]) {\n\t\tconsole.log(\"Register Class ERROR! Class with this name already exists!\", name);\n\t}\n\tMy_Lib.Registered_Classes[name] = func;\n};\n\nMy_Lib.Get_Class = function (name) {\n\treturn My_Lib.Registered_Classes[name];\n};\n\nMy_Lib.create_class = function (parent, child, props, name) {\n\tif (parent) {\n\t\tchild.prototype = Object.create(parent.prototype);\n\t}\n\t_.copy_object(child.prototype, props);\n\tchild.prototype.contructor = child;\n\tMy_Lib.Register_Class(child, name);\n};\n\nMy_Lib.Abstract_Fabric = function (data) {\n\tvar constructor = My_Lib.Get_Class(data.type);\n\tif (constructor) {\n\t\tvar object = new constructor();\n\t\tobject.parse(data);\n\t\treturn object;\n\t}\n\treturn undefined;\n};\n\nMy_Lib.Print_Classes = function () {\n\tfor (var key in this.Registered_Classes) {\n\t\tconsole.log(\"class registered :\", key, this.Registered_Classes[key]);\n\t}\n};\n\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Affector; });\n/* unused harmony export Force_Affector */\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\n//base class for particle affector\nfunction Particle_Affector() {\n\tthis.id = _.generateUUID();\n}\n\nParticle_Affector.prototype.affect = function (dt, pdata, vert, color) {\n\treturn true;\n};\n\nParticle_Affector.prototype.toJSON = function (child) {\n\tif (child) {\n\t\treturn {};\n\t}\n\tvar data = {\n\t\tid: this.id,\n\t\t\"name\": \"Particle_Affector\",\n\t\tparams: {}\n\t};\n\tif (child) {\n\t\treturn params;\n\t}\n\treturn data;\n};\n\nParticle_Affector.prototype.parse = function (json) {};\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Particle_Affector\", Particle_Affector);\n\nfunction Force_Affector() {\n\tParticle_Affector.call(this);\n\tthis.forces = new Array();\n}\n\nForce_Affector.prototype = Object.create(Particle_Affector.prototype);\n\n_.copy_object(Force_Affector.prototype, {\n\tconstructor: Force_Affector,\n\tadd_force: function (force) {\n\t\tthis.forces.push(force);\n\t},\n\tapply_forces: function (dt, particle, vert, color) {\n\t\tvar acceleration = { x: 0, y: 0, z: 0 };\n\t\tfor (var i = 0; i < this.forces.length; i++) {\n\t\t\tthis.forces[i].calc(dt, particle, acceleration);\n\t\t}\n\t\t//integrate\n\t\tparticle.velocity.x += acceleration.x * dt;\n\t\tparticle.velocity.y += acceleration.y * dt;\n\t\tparticle.velocity.z += acceleration.z * dt;\n\t},\n\taffect: function (dt, particle, vert, color) {\n\t\tthis.apply_forces(dt, particle, vert, color);\n\t\treturn true;\n\t},\n\ttoJSON: function (child) {\n\t\tvar data = {};\n\t\tdata.name = \"Force_Affector\";\n\t\tdata.uuid = this.uuid;\n\t\tdata.params = Particle_Affector.prototype.toJSON.call(this, this);\n\t\tif (this.forces.length > 0) {\n\t\t\tdata.params.forces = new Array();\n\t\t\tfor (var i = 0; i < this.forces.length; i++) {\n\t\t\t\tdata.params.forces.push(this.forces[i].toJSON());\n\t\t\t}\n\t\t}\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\tvar f, item;\n\t\tif (json.forces) {\n\n\t\t\tfor (var i = 0; i < json.forces.length; i++) {\n\t\t\t\titem = json.forces[i];\n\t\t\t\tf = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Get_Class(item.name);\n\t\t\t\tif (f) {\n\t\t\t\t\tf = new f();\n\t\t\t\t\tf.parse(item);\n\t\t\t\t\tthis.add_force(f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Force_Affector\", Force_Affector);\n\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Emitter; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\n//Base class for Particle Emitters\nfunction Particle_Emitter(emit_per_second) {\n\tthis.uuid = _.generateUUID();\n\tthis.name = '';\n\tthis.emit_delta = 0;\n\tthis.emit_count = 0;\n\tthis.emit_per_second = emit_per_second || 5;\n\t//linear interpolation = min + random * (max-min)\t\n\tthis.lifetime = { \"min\": 0, \"max\": 2.0 };\n}\n\nParticle_Emitter.prototype.emit_life = function () {\n\treturn this.lifetime.min + Math.random() * (this.lifetime.max - this.lifetime.min);\n};\n\nParticle_Emitter.prototype.calc_emitted_particles = function (dt) {\n\t//count particles need emit\n\tthis.emit_delta += this.emit_per_second * dt;\n\tvar need_emit = Math.floor(this.emit_delta);\n\tif (need_emit > 0) {\n\t\tthis.emit_delta -= need_emit;\n\t\t//this.emit_count += need_emit;\n\t\t//need_emit = this.emit_count;\n\t}\n\treturn need_emit;\n};\n\nParticle_Emitter.prototype.emit = function (p, c, matrix) {\n\tp.position.set(0, 0, 0);\n\tp.velocity.set(0, 1, 0);\n\n\tif (matrix) {\n\t\tp.position.applyMatrix4(matrix);\n\t\tp.velocity.applyMatrix4_rotation(matrix);\n\t}\n};\n\nParticle_Emitter.prototype.toJSON = function (child) {\n\tvar params = {\n\t\t\"uuid\": this.uuid,\n\t\t\"emit_per_second\": this.emit_per_second,\n\t\t\"lifetime\": {\n\t\t\t\"min\": this.lifetime.min,\n\t\t\t\"max\": this.lifetime.max\n\t\t}\n\t};\n\tif (this.name) {\n\t\tparams.name = this.name;\n\t}\n\tif (child) {\n\t\treturn params;\n\t}\n\tvar data = {};\n\tdata.name = \"Particle_Emitter\";\n\tdata.params = params;\n\treturn data;\n};\n\nParticle_Emitter.prototype.parse = function (data) {\n\tthis.emit_per_second = data.emit_per_second;\n\tthis.name = data.name;\n\tthis.uuid = data.uuid || _.generateUUID();\n\t_.copy_object(this.lifetime, data.lifetime);\n};\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Particle_Emitter\", Particle_Emitter);\n\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particles_Points; });\n\nfunction Particles_Points(geometry, material) {\n    THREE.Points.call(this, geometry, material);\n    this.type = 'particles_points';\n\n    this.boundingSphere = new THREE.Sphere();\n    this.boundingSphere.radius = 10.0;\n}\n\nParticles_Points.prototype = Object.create(THREE.Points.prototype);\n\nParticles_Points.prototype.constructor = Particles_Points;\n\nParticles_Points.prototype.toJSON = function (meta) {\n    var mat = this.material;\n    var geom = this.geometry;\n    this.material = undefined;\n    this.geometry = undefined;\n    var object = THREE.Object3D.prototype.toJSON.call(this, meta);\n    this.material = mat;\n    this.geometry = geom;\n    return object;\n};\n\nParticles_Points.prototype.raycast = function (raycaster, intersects) {\n    var sphere = new THREE.Sphere();\n    sphere.copy(this.boundingSphere);\n    sphere.applyMatrix4(this.matrixWorld);\n    var r = raycaster.ray.intersectsSphere(sphere);\n    if (r === false) return;\n    console.log(\"INTERSECTION1\", this.name, sphere);\n    return;\n\n    var shit = new THREE.Vector3();\n    shit.copy(this.position);\n    var tr = new THREE.Ray(new THREE.Vector3(0, 0, 20), shit);\n    console.log(\"test \", tr.intersectsSphere(sphere), sphere);\n    console.log(\"hit sphere \" + this.name, sphere, raycaster.ray);\n    return raycaster.ray.intersectsSphere(sphere);\n\n    console.log(\"hit sphere \" + this.type, \"shpere is \", sphere, \"ray is \", r);\n    if (r) {\n        var tmp = new THREE.Vector3(this.position);\n        tmp.sub(r);\n        intersects.push({\n            distance: Math.sqrt(tmp.dot(tmp)),\n            point: this.position,\n            object: this\n        });\n    }\n};\n\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return main_event_hub; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Event_Hub; });\nfunction Event_Hub() {\n    this.events = {};\n}\n\nEvent_Hub.prototype.add_event_listener = function (name, func, obj) {\n    if (!this.events[name]) {\n        this.events[name] = [];\n    }\n    this.events[name].push({ name: name, func: func, obj: obj });\n};\n\nEvent_Hub.prototype.on = Event_Hub.prototype.add_event_listener;\n\nEvent_Hub.prototype.emit = function (name, obj) {\n    var listeners = this.events[name];\n    if (listeners) {\n        for (var i = 0; i < listeners.length; i++) {\n            var t = listeners[i];\n            t.func.call(t.obj, obj);\n        }\n    }\n};\n\nvar main_event_hub = new Event_Hub();\n\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Mouse_Intersector; });\nvar Mouse_Intersector = {};\n\nMouse_Intersector.get_normalized_screen_coords = function (canvas, x, y) {\n    var offset = canvas.getBoundingClientRect();\n    var width = canvas.clientWidth;\n    var height = canvas.clientHeight;\n    //normalize coordinates\n    var x = (x - offset.left) / width;\n    var y = (y - offset.top) / height;\n    var x = x * 2 - 1;\n    var y = -(y * 2 - 1);\n    var vector = new THREE.Vector3(x, y, 1);\n    return vector;\n};\n\nMouse_Intersector.mouse_coords_to_vector = function (canvas, event) {\n    return this.get_normalized_screen_coords(canvas, event.clientX, event.clientY);\n};\n\nMouse_Intersector.unproject = function (vector, camera) {\n    var r = new THREE.Vector3();\n    r.copy(vector);\n    r.z = 1;\n    r.unproject(camera);\n    //console.log(camera.matrixWorldInverse);\n    //r.applyMatrix4(camera.matrixWorldInverse);    \n    return r;\n};\n\nMouse_Intersector.mouse_coords_to_ray = function (canvas, event, camera) {\n    var vector = this.mouse_coords_to_vector(canvas, event);\n    vector = this.unproject(vector, camera);\n    var ray = new THREE.Ray(camera.position, vector.sub(camera.position).normalize());\n    return ray;\n};\n\nMouse_Intersector.find_intersection_with_mouse_vector = function (vector, camera, scene) {\n    vector.unproject(camera);\n    var ray = new THREE.Raycaster(camera.position, vector.sub(camera.position).normalize());\n    // create an array containing all objects in the scene with which the ray intersects\n    //var intersects = ray.intersectObjects( [grid_text.root], true ); \n    //console.log(fake_plane.root.children[0].geometry);\n    var intersects = ray.intersectObjects([scene], true);\n    return intersects;\n};\n\n//this function return objects, which bounding sphere intersects with ray\nMouse_Intersector.find_intersection_with_bounding_sphere = function (object, fakecaster, intersects, recursive, level) {\n\n    //if ( object.visible === false ) return;\n\n\n    object.raycast(fakecaster, intersects);\n    //console.log(\"object intersects\", intersects);\n\n    if (!recursive) return;\n\n    //hmm we use different check for top level object and their children\n    //that is not gud\n    //if object has children, and it children has geometry with boundingSphere,\n    //these get right check to intersection\n    //then after recursive call, it same object will be check by 'object.raycast' method\n    //which, i supposed, sucks\n\n    var children = object.children;\n    //console.log(\"children instersects\");\n    var sphere = new THREE.Sphere();\n    for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n        //for some reason, to be sure what matrixWorld contain truth, but is not identity \n        child.updateMatrixWorld(true);\n        if (child.geometry) {\n            //copy sphere from object geometry and transform it with object. matrixWorld\n            sphere.copy(child.geometry.boundingSphere);\n            sphere.applyMatrix4(child.matrixWorld);\n            //find intersection\n            var inter = fakecaster.ray.intersectsSphere(sphere);\n            //console.log(\"inter with sphere, level\", level, inter, sphere.center, raycaster.ray);\n            if (inter) {\n                intersects.push(child);\n            }\n        } else {\n            this.find_intersection_with_bounding_sphere(children[i], fakecaster, intersects, true, level + 1);\n        }\n    }\n    if (level === 1) {\n        return intersects;\n    }\n};\n\nMouse_Intersector.find_intersected_object = function (scene, ray) {\n    var intersects = [];\n    var fakecaster = { ray: ray };\n    Mouse_Intersector.find_intersection_with_bounding_sphere(scene, fakecaster, intersects, true);\n    return intersects;\n};\n\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Color_Domain; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Table_Color; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\nfunction Color_Domain(r, g, b) {\n    this.color = new THREE.Color(r, g, b);\n    this.uuid = _.generateUUID();\n    this.name = '';\n    this.type = \"Color_Domain\";\n}\n\n_.copy_object(Color_Domain.prototype, {\n    toJSON: function (child) {\n        var data = {};\n        data.uuid = this.uuid;\n        if (this.name !== '') {\n            data.name = this.name;\n        }\n        data.type = this.type;\n        data.color = { r: this.color.r, g: this.color.g, b: this.color.b };\n        return;\n    },\n    parse: function (json) {\n        this.uuid = json.uuid;\n        if (json.name !== undefined) {\n            this.name = json.name;\n        }\n        if (json.color !== undefined) {\n            this.color.set(json.color.r, json.color.g, json.color.b);\n        }\n    },\n    emit: function (color) {\n        color.r = this.color.r;\n        color.g = this.color.g;\n        color.b = this.color.b;\n    },\n    fill: function (color, offset) {\n        color[offset + 0] = this.color.r;\n        color[offset + 1] = this.color.g;\n        color[offset + 2] = this.color.b;\n    }\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class('Color_Domain', Color_Domain);\n\nfunction Table_Color(table) {\n    if (table !== undefined) {\n        this.copy_table(table);\n    } else {\n        this.default_table();\n    }\n}\n\nTable_Color.prototype = Object.create(Color_Domain);\n\n_.copy_object(Table_Color.prototype, {\n    constructor: Table_Color,\n    copy_table: function (table) {\n        this.table = new Array(table.length);\n        for (var i = 0; i < table.length; i++) {\n            this.table = new THREE.Color(table[i]);\n        }\n    },\n    emit: function (color) {\n        var index = Math.ceil(Math.random() * this.table.length) % this.table.length;\n        var src = this.table[index];\n        color.r = src.r;\n        color.g = src.g;\n        color.b = src.b;\n    },\n    fill: function (color, offset) {\n        var index = Math.ceil(Math.random() * this.table.length) % this.table.length;\n        var src = this.table[index];\n        color[offset] = src.r;\n        color[offset + 1] = src.g;\n        color[offset + 2] = src.b;\n    },\n    default_table: function () {\n        this.table = new Array(8);\n        this.table[0] = new THREE.Color(1, 0, 0);\n        this.table[1] = new THREE.Color(0, 1, 0);\n        this.table[2] = new THREE.Color(0, 0, 1);\n        this.table[3] = new THREE.Color(1, 0, 1);\n        this.table[4] = new THREE.Color(1, 1, 0);\n        this.table[5] = new THREE.Color(1, 0.4, 0.4);\n        this.table[6] = new THREE.Color(0.5, 0.7, 0.98);\n        this.table[7] = new THREE.Color(0.9, 0.4, 0.4);\n    },\n    get: function () {\n        var r = { r: 0, g: 0, b: 0 };\n        this.emit(r);\n        return r;\n    }\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Table_Color\", Table_Color);\n\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Shaders; });\nvar Particle_Shaders = {};\n\n(function () {\n\n\t//particle attributes:\n\t//position\n\t//color\n\t//left, size\n\tvar vertex_shader = [\n\t//'attribute vec4 position;',\n\t'attribute vec4 color;', 'attribute float params;', 'varying vec4 vcolor;', 'uniform float lifetime;', 'uniform float point_size;', 'uniform vec2 screen_size;', '#ifndef DYNAMIC_COLORS', 'uniform vec3 particle_color;', '#endif', 'void main () {', 'gl_Position = projectionMatrix * viewMatrix * vec4( position, 1.0 );', '#ifdef DYNAMIC_COLORS', 'vcolor.rgb = color.rgb;', '#else', 'vcolor.rgb = particle_color.rgb;', '#endif', '#ifdef NO_FADE_COLOR', 'vcolor.a = 1.0;', '#else',\n\t//params contains life length which decreased by time\n\t'float tmp = params / lifetime;', 'tmp = min(tmp, 1.0);', 'vcolor.a = tmp;', '#endif', 'float t =  screen_size.y* projectionMatrix[1][1] / gl_Position.w;', 't = t * point_size;', 'if (params > 0.0) {', 'gl_PointSize = t;', '}', 'else {',\n\t//'vcolor.a = 0.0;',\n\t'gl_PointSize = 0.0;', 'gl_Position.z = -1000.0;', '}', '}'];\n\n\tvar fragment_shader = ['varying vec4 vcolor;', '#ifdef PARTICLE_TEXTURE', 'uniform sampler2D sprite;', '#endif', 'void main() {', '#ifdef PARTICLE_TEXTURE', 'vec4 tex = texture2D( sprite, gl_PointCoord );', 'vec3 fragment_color = tex.rgb;', 'fragment_color.rgb *= vcolor.rgb;', 'float alpha = tex.a;', '#else', 'vec3 fragment_color = vcolor.rgb;', 'float alpha = 1.0;', '#endif', '#ifdef PRE_ALPHA', 'fragment_color.rgb *= alpha;', '#endif', '#ifndef NO_FADE_COLOR', 'float fragment_alpha = alpha * vcolor.a;', '#else', 'float fragment_alpha = alpha;', '#endif', 'gl_FragColor = vec4(fragment_color.rgb, fragment_alpha);', '}'];\n\n\tParticle_Shaders.vertex = vertex_shader.join('\\n');\n\tParticle_Shaders.fragment = fragment_shader.join('\\n');\n})();\n\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_System; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__particles_points_js__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__ = __webpack_require__(7);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__color_domain_js__ = __webpack_require__(6);\n\n\n\n\n\n\n\nfunction Particle_System(data) {\n    this.uuid = _.generateUUID();\n\n    this.params = this.config_params(data);\n\n    this.emitter = this.params.emitter;\n    this.affector = this.params.affector;\n    this.particle_lifetime = this.params.particle_lifetime;\n    this.texture = this.params.texture;\n\n    this.dynamic_color = false;\n\n    var count = this.params.count;\n\n    this.material = this.create_particle_material();\n    this.node = new __WEBPACK_IMPORTED_MODULE_3__particles_points_js__[\"a\" /* Particles_Points */](this.create_particle_geometry(count), this.material);\n    this.node.name = this.name;\n    this.node.boundingSphere.radius = this.params.bounding_radius;\n}\n\nParticle_System.prototype.config_params = function (data) {\n    var params = {};\n    //default\n    params.particle_lifetime = 3.0;\n    params.no_fade_color = false;\n    params.pre_alpha = true;\n    params.depth_test = true;\n    params.depth_write = false;\n    params.color = { \"r\": 1, \"g\": 1, \"b\": 1 };\n    params.blending = \"one_alpha\";\n    params.size = 1;\n    params.count = 100;\n    params.name = '';\n    params.bounding_radius = 2.0;\n    params.discrete_emission = false;\n    params.apply_world_matrix_on_emit = true;\n\n    for (var key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n            if (data[key] !== undefined) {\n                params[key] = data[key];\n            }\n        }\n    }\n\n    params.emitter = data.emitter || new __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */](1);\n    params.affector = data.affector || new __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__[\"a\" /* Particle_Affector */]();\n\n    return params;\n};\n\nParticle_System.prototype.set_name = function (name) {\n    this.name = name;\n    this.node.name = name;\n};\n\nParticle_System.prototype.suicide = function () {\n    this.node.parent.remove(this.node);\n    main_event_hub.emit(\"kill_me\", this);\n};\n\nParticle_System.prototype.create_particle_data = function (count) {\n    var particle_data = new Array(count);\n    var p;\n    for (var i = 0; i < count; i++) {\n        p = {};\n        p.position = new THREE.Vector3(0, 0, 0);\n        p.velocity = new THREE.Vector3(0, 0, 0);\n        p.lifetime = 0;\n        particle_data[i] = p;\n    }\n    this.particle_data = particle_data;\n};\n\nParticle_System.prototype.create_particle_geometry = function (count) {\n    this.create_particle_data(count);\n\n    var vertices = new Float32Array(count * 3); // position\n    var colors = new Float32Array(count * 3);\n    var params = new Float32Array(count);\n\n    for (var i = 0; i < count; i++) {\n        //create particle\n        vertices[i * 3] = 0;\n        vertices[i * 3 + 1] = 0;\n        vertices[i * 3 + 2] = 0;\n\n        params[i] = 0.0;\n\n        if (this.params.color_domain) {\n            this.params.color_domain.fill(colors, i * 3);\n        } else {\n            colors[i * 3] = this.params.color.r;\n            colors[i * 3 + 1] = this.params.color.g;\n            colors[i * 3 + 2] = this.params.color.b;\n        }\n    }\n\n    this.geometry = {};\n    this.geometry.vertices = new THREE.BufferAttribute(vertices, 3).setDynamic(true);\n    this.geometry.colors = new THREE.BufferAttribute(colors, 3);\n    if (this.dynamic_color) {\n        this.geometry.colors.setDynamic(true);\n    }\n    this.geometry.params = new THREE.BufferAttribute(params, 1).setDynamic(true);\n    var geom = new THREE.BufferGeometry();\n    this.geometry.buffer = geom;\n    geom.addAttribute('position', this.geometry.vertices);\n    geom.addAttribute('color', this.geometry.colors);\n    geom.addAttribute('params', this.geometry.params);\n\n    return geom;\n};\n\nParticle_System.prototype.discrete_emit = function (count) {\n    this.emit_particles(0, count);\n    this.geometry.vertices.needsUpdate = true;\n    this.geometry.params.needsUpdate = true;\n    this.geometry.colors.needsUpdate = true;\n};\n\nParticle_System.prototype.emit_particles = function (dt, need_emit) {\n    //emit particles\n    var p;\n    var verts = this.geometry.vertices.array;\n    var params = this.geometry.params.array;\n\n    var old_need_emit = need_emit;\n    this.node.updateMatrixWorld(true);\n    var matrix = this.node.matrixWorld;\n    for (var i = 0; i < this.particle_data.length && need_emit > 0; i++) {\n        if (!(params[i] > 0)) {\n\n            p = this.particle_data[i];\n            this.emitter.emit(p, null, matrix);\n            p.lifetime = this.particle_lifetime;\n\n            verts[i * 3] = p.position.x;\n            verts[i * 3 + 1] = p.position.y;\n            verts[i * 3 + 2] = p.position.z;\n            params[i] = p.lifetime;\n            need_emit--;\n            //colors[i*3] = this.params.color.r\n            //colors[i*3+1] = this.params.color.g;\n            //colors[i*3+2] = this.params.color.b;\n        }\n    }\n    //console.log(\"created new particles \", old_need_emit - need_emit);\n};\n\nParticle_System.prototype.update_particle_geometry = function (dt) {\n    var verts = this.geometry.vertices.array;\n    var params = this.geometry.params.array;\n    var p;\n    var vert = new THREE.Vector3(0, 0, 0);\n    var dummy_color = { \"r\": 1, \"b\": 1, \"g\": 1 };\n    for (var i = 0; i < this.particle_data.length; i++) {\n\n        if (params[i] > 0) {\n            p = this.particle_data[i];\n\n            //integrate\n            p.position.x += p.velocity.x * dt;\n            p.position.y += p.velocity.y * dt;\n            p.position.z += p.velocity.z * dt;\n            p.lifetime -= dt;\n\n            if (p.lifetime <= 0 || !this.affector.affect(dt, p, vert, dummy_color)) {\n                p.lifetime = 0;\n            }\n            params[i] = p.lifetime;\n            verts[i * 3] = p.position.x;\n            verts[i * 3 + 1] = p.position.y;\n            verts[i * 3 + 2] = p.position.z;\n        }\n    }\n\n    if (!this.params.discrete_emission) {\n        var need_emit = this.emitter.calc_emitted_particles(dt);\n        this.emit_particles(dt, need_emit);\n    }\n\n    this.geometry.vertices.needsUpdate = true;\n    this.geometry.params.needsUpdate = true;\n    this.geometry.colors.needsUpdate = true;\n};\n\nParticle_System.prototype.update = function (dt) {\n    this.update_particle_geometry(dt);\n};\n\nParticle_System.prototype.generate_material_name = function () {\n    var my_name = \"MY_PARTICLE_MATERIAL\";\n    if (!!this.texture) {\n        my_name += \"_WITH_TEXTURE\";\n    }\n    if (this.params.no_fade_color) {\n        my_name += \"_NO_FADE_COLOR\";\n    }\n    return my_name;\n};\n\nParticle_System.prototype.blending_mode = {\n    \"additive\": {\n        \"blendSrc\": THREE.OneFactor,\n        \"blendDst\": THREE.OneFactor\n    },\n    \"alpha\": {\n        \"blendSrc\": THREE.SrcAlphaFactor,\n        \"blendDst\": THREE.OneMinusSrcAlphaFactor\n    },\n    \"one_alpha\": {\n        \"blendSrc\": THREE.OneFactor,\n        \"blendDst\": THREE.OneMinusSrcAlphaFactor\n    },\n    \"alpha_one\": {\n        \"blendSrc\": THREE.SrcAlphaFactor,\n        \"blendDst\": THREE.OneFactor\n    }\n};\n\nParticle_System.prototype.convert_blending_mode = function (blending) {\n    var three_blending;\n    var factors = this.blending_mode[\"one_alpha\"];\n    if (blending === 'no') {\n        three_blending = THREE.NoBlending;\n    } else {\n        three_blending = THREE.CustomBlending;\n        if (this.blending_mode[blending]) {\n            factors = this.blending_mode[blending];\n        }\n    }\n    return { \"blending\": three_blending, \"factors\": factors };\n};\n\nParticle_System.prototype.set_texture = function (texture) {\n    if (typeof texture === 'string') {\n        if (this.params.texture === texture) {\n            return;\n        }\n        this.params.texture = texture;\n        this.texture = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.get(texture);\n    } else {\n        console.error(\"Oh Shit! texture in set_texture is not string! it's object or undefined!\", texture);\n    }\n\n    if (this.material.uniforms.sprite) {\n        this.material.uniforms.sprite.value = this.texture;\n    } else {\n        //this.material.uniforms.sprite = {value: texture};\n        this.recreate_material();\n        console.error(\"Oh Shit! Our shader has not texture! Need create shader with texture!\");\n    }\n};\n\nParticle_System.prototype.create_uniforms = function () {\n    var uniforms = {\n        \"lifetime\": {\n            value: this.particle_lifetime\n        },\n        \"point_size\": {\n            value: this.params.size\n        },\n        \"screen_size\": {\n            value: new THREE.Vector2(__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.width, __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.height)\n        }\n    };\n    if (!!this.texture) {\n        uniforms[\"sprite\"] = {\n            value: this.texture\n        };\n    };\n    if (!this.dynamic_color) {\n        uniforms[\"particle_color\"] = { value: this.params.color };\n    }\n    return uniforms;\n};\n\nParticle_System.prototype.calc_defines = function () {\n    var defines = {};\n    if (this.params.pre_alpha) {\n        defines[\"PRE_ALPHA\"] = true;\n    }\n    if (!!this.texture) {\n        defines[\"PARTICLE_TEXTURE\"] = true;\n    }\n    if (this.params.no_fade_color) {\n        defines[\"NO_FADE_COLOR\"] = true;\n    }\n    if (this.params.color_domain) {\n        defines[\"DYNAMIC_COLORS\"] = true;\n    }\n    return defines;\n};\n\nParticle_System.prototype.select_texture = function (texture) {\n    if (typeof this.texture === 'string') {\n        this.texture = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.get(this.texture);\n        if (!this.texture) {\n            console.error(\"Oh, not found texture <\" + this.params.texture + \"> in create particle material! Instead get \" + this.texture);\n        }\n    }\n};\n\nParticle_System.prototype.create_particle_material = function () {\n\n    this.select_texture(this.texture);\n\n    var blend_obj = this.convert_blending_mode(this.params.blending);\n\n    var uniforms = this.create_uniforms();\n    var defines = this.calc_defines();\n\n    var mat = new THREE.ShaderMaterial({\n        transparent: true,\n        depthWrite: this.params.depth_write,\n        depthTest: this.params.depth_test,\n        blending: blend_obj.blending,\n        blendSrc: blend_obj.factors.blendSrc,\n        blendDst: blend_obj.factors.blendDst,\n        defines: defines,\n        uniforms: uniforms,\n        vertexShader: __WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__[\"a\" /* Particle_Shaders */].vertex,\n        fragmentShader: __WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__[\"a\" /* Particle_Shaders */].fragment\n    });\n    return mat;\n};\n\nParticle_System.prototype.recreate_material = function () {\n    this.node.material = this.material = this.create_particle_material();\n};\n\nParticle_System.prototype.set_pre_alpha = function (pre_alpha) {\n    if (this.params.pre_alpha !== !!pre_alpha) {\n        this.params.pre_alpha = pre_alpha;\n        this.recreate_material();\n    }\n};\n\nParticle_System.prototype.set_point_size = function (size) {\n    if (this.params.size != size) {\n        this.params.size = size;\n        this.node.material.uniforms[\"point_size\"].value = size;\n    }\n};\n\nParticle_System.prototype.set_blending = function (blending) {\n    this.params.blending = blending;\n    var b = this.convert_blending_mode(blending);\n    this.material.blending = b.blending;\n    this.material.blendSrc = b.factors.blendSrc;\n    this.material.blendDst = b.factors.blendDst;\n};\n\nParticle_System.prototype.toJSON = function () {\n    var data = {};\n    data.uuid = this.uuid;\n    data.node = this.node.uuid;\n    if (this.name || this.node.name) {\n        data.name = this.name || this.node.name;\n    }\n    data.params = {};\n    if (this.params) {\n        _.copy_object(data.params, this.params);\n    }\n    data.params.emitter = this.emitter.toJSON();\n    data.params.affector = this.affector.toJSON();\n    return data;\n};\n\nParticle_System.prototype.set_emitter = function (emitter) {\n    this.emitter = this.params.emitter = emitter;\n};\n\nParticle_System.prototype.set_particle_life_length = function (val) {\n    if (val !== this.params.particle_lifetime) {\n        this.params.particle_lifetime = this.particle_lifetime = val;\n        this.material.uniforms['lifetime'].value = val;\n    }\n};\n\nParticle_System.prototype.set_emission_per_second = function (val) {\n    this.emitter.emit_per_second = val;\n};\n\nParticle_System.prototype.set_particle_count = function (count) {\n    if (count !== this.particle_data.length) {\n        this.params.count = count;\n        this.node.geometry = this.create_particle_geometry(count);\n    }\n};\n\nParticle_System.prototype.set_color = function (color) {\n    this.params.color.r = color.r;\n    this.params.color.g = color.g;\n    this.params.color.b = color.b;\n};\n\nParticle_System.prototype.set_bounding_sphere_radius = function (radius) {\n    this.node.boundingSphere.radius = radius;\n};\n\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Manager; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__particles_points_js__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__particles_js__ = __webpack_require__(8);\n\n\n\n\n\n\nfunction Particle_Manager() {\n    this.particles = {};\n    this.particles_array = [];\n}\n\n_.copy_object(Particle_Manager.prototype, {\n    constructor: Particle_Manager,\n    add: function (ps, name) {\n        if (!this.particles[name]) {\n            this.particles[name] = ps;\n            this.particles_array.push(ps);\n        }\n    },\n    remove_particles: function (name) {\n        var ps = this.particles[name];\n        var i = this.particles_array.indexOf(ps);\n        if (i >= 0) {\n            this.particles_array.splice(i, 1);\n        }\n        if (ps) {\n            ps.suicide();\n            delete this.particles[name];\n        }\n    },\n    get_particle_names: function () {\n        var names = [];\n        for (var key in this.particles) {\n            names.push(key);\n        }\n        return names;\n    },\n\n    update: function (dt) {\n        for (var i = 0; i < this.particles_array.length; i++) {\n            this.particles_array[i].update(dt);\n        }\n    },\n\n    create_by_params: function (params) {\n        var ps = new __WEBPACK_IMPORTED_MODULE_4__particles_js__[\"a\" /* Particle_System */](params);\n        this.add(ps);\n        return ps;\n    },\n\n    toJSON: function () {\n        var arr = [];\n\n        var data;\n        var p;\n        for (var key in this.particles) {\n            p = this.particles[key];\n            if (p.uuid) {\n                data = p.toJSON();\n                arr.push(data);\n            }\n        }\n\n        return arr;\n    },\n\n    emitter_fabric: function (params) {\n        if (params.emitter) {\n            var emitter = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Get_Class(params.emitter.name);\n            if (emitter) {\n                emitter = new emitter();\n            } else {\n                emitter = new __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */]();\n            }\n            emitter.parse(params.emitter.params);\n            return emitter;\n        }\n        return undefined;\n    },\n\n    affector_fabric: function (params) {\n        if (params.affector) {\n            var affector = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Get_Class(params.affector.name);\n            if (affector) {\n                affector = new affector();\n            } else {\n                affector = new __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__[\"a\" /* Particle_Affector */]();\n            }\n            affector.parse(params.affector.params);\n            return affector;\n        }\n        return undefined;\n    },\n\n    fromJSON: function (json, callback, root, name) {\n        if (this.particles[name]) {\n            console.log(\"WARNING Particle Manager! Particle System with this name already exists\", name);\n        }\n\n        try {\n            var data = JSON.parse(json);\n        } catch (e) {\n            console.log(\"error parsing json on \", name, json);\n            throw e;\n        }\n\n        return this.parse(data, root, name);\n    },\n\n    parse: function (data, root, name) {\n        var emitter = this.emitter_fabric(data.params);\n        var affector = this.affector_fabric(data.params);\n        data.params.emitter = emitter;\n        data.params.affector = affector;\n\n        var ps = new __WEBPACK_IMPORTED_MODULE_4__particles_js__[\"a\" /* Particle_System */](data.params);\n        ps.set_name(data.name);\n\n        //add to scene graph\n        if (data.params.parent) {\n            var parent = root.getObjectByName(data.params.parent);\n            //console.log(data.params.parent, \"parent particles\", name, root);\n            parent.add(ps.node);\n        } else {\n            root.add(ps.node);\n        }\n\n        //ugly fucking hack\n        //copy node properties\n        this.add(ps, name);\n        return ps;\n    },\n\n    load_particles: function (json, root) {\n        var particles = json.particles;\n        for (var i = 0; i < particles.length; i++) {\n            var p = particles[i];\n            var ps = this.parse(p, root, p.name);\n            ps.node.uuid = p.node;\n            ps.node.name = p.name;\n            var obj = root.getObjectByProperty(\"uuid\", p.node);\n            if (obj) {\n                ps.node.replace_object_with_this(obj);\n            }\n        }\n    },\n\n    create_name: function () {\n        var number = this.particles_array.length + 1;\n        var begin_name = 'Particle_System_';\n        var testing = true;\n        while (testing) {\n            name = begin_name + number;\n            if (this.particles[name] !== undefined) {\n                number++;\n            } else {\n                return name;\n            }\n        }\n    },\n\n    create_new: function () {\n        var name = this.create_name();\n\n        var params = {};\n        var ps = new __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_System(params);\n        ps.set_name(name);\n        this.add(ps, name);\n        return ps;\n    }\n});\n\nif (__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].particle_manager === undefined) {\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].particle_manager = new Particle_Manager();\n}\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particles_Config = {\n    \"box_size\": 10\n};\n\n\n\n/***/ }),\n/* 10 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Point_Generators; });\nvar Point_Generators = {};\n\nPoint_Generators.Random_Direction = function () {};\n\nPoint_Generators.Random_Direction.prototype.get_direction = function (vector) {\n\tvector.x = Math.random();\n\tvector.y = Math.random();\n\tvector.z = Math.random();\n};\n\nPoint_Generators.Sphere = function (radius) {\n\tthis.radius = radius;\n};\n\nPoint_Generators.Sphere.prototype.get_inner_point = function (vector) {\n\tvar alpha = Math.random() * Math.PI * 2;\n\tvar beta = Math.random() * Math.PI;\n\tvector.x = Math.cos(alpha) * Math.sin(beta);\n\tvector.y = Math.cos(beta);\n\tvector.z = Math.sin(alpha) * Math.sin(beta);\n};\n\nPoint_Generators.Sphere.prototype.get_normal = function (vector) {\n\tvector.x = Math.random() * 2 - 1;\n\tvector.y = Math.random() * 2 - 1;\n\tvector.z = Math.random() * 2 - 1;\n\tvector.normalize();\n};\n\nPoint_Generators.Sphere.prototype.get_point = function (vector) {\n\tthis.get_normal(vector);\n\tvector.multiplyScalar(this.radius);\n};\n\n\n\n/***/ }),\n/* 11 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Application; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__base_event_hub_js__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__base_mouse_intersector_js__ = __webpack_require__(5);\n/*\r\nmain class\r\nthis has abstract virtual methods\r\nstart - which create renderer and conduct start initializations\r\nupdate - updated scene objects, animations, phisics\r\nrender - control scene rendering\r\nthis methods must rewrite on derived classes\r\nneed set \r\nPROPERTIES\r\nmain_camera - camera which point of view render whole scene and user interacts\r\ndom_screen - dom element which contain canvas and display scene\r\nrenderer - three.js renderer\r\ncanvas - is created by three.js renderer, it have to append to dom_screen children, fuck it\r\ncanvas width and height defining on creating it by renderer, fuck it\r\n\r\n\r\n\r\n*/\n\n\n\n\n\nfunction Application(config) {\n\n    this._lifecycle_event(\"before_created\");\n\n    this._init_timer();\n    this._create_loop_function();\n\n    this.mouse_controllers = [];\n\n    __WEBPACK_IMPORTED_MODULE_1__base_event_hub_js__[\"a\" /* main_event_hub */].add_event_listener(\"kill_me\", function (obj) {\n        this.remove_animated_object(obj);\n    }, this);\n}\n\nApplication.prototype.start = function (config) {\n    console.log(\"start application...\");\n    this._set_configuration(config);\n};\n\nApplication.prototype._lifecycle_event = function (name, event) {\n    if (this[name]) {\n        return this[name](event);\n    }\n    return false;\n};\n\nApplication.prototype._init_timer = function () {\n    this.clock = new THREE.Clock();\n    this.delta_time = 0;\n    this.animated_objects = [];\n};\n\nvar run_function = //window.requestAnimationFrame;\nfunction (callback) {\n    window.setTimeout(callback, 1000 / 60);\n};\n\nApplication.prototype._create_loop_function = function () {\n    var self = this;\n    this.run = function () {\n        run_function(function () {\n            self.loop();\n            //main_event_hub.emit(\"new_frame\");\n        });\n    };\n\n    //My_Lib.create_run_function(this);\n\n    //main_even_hub.add_event_listener(\"new_frame\", this.loop, this);    \n};\n\nApplication.prototype.get_default_configuration = function () {\n    return {\n        \"dom_element\": \"screen\",\n        \"render_params\": {\n            \"premultipliedAlpha\": true,\n            \"alpha\": true\n        },\n        \"viewport\": {\n            \"width\": 800,\n            \"height\": 600\n        },\n        \"clear_color\": 0x0000FF,\n        \"main_camera\": {\n            \"fov\": 80,\n            \"near\": 0.1,\n            \"far\": 1000,\n            \"aspect_ratio\": 1.3333333333333333,\n            \"position\": {\n                \"x\": 0,\n                \"y\": 0,\n                \"z\": 0\n            }\n        }\n    };\n};\n\nApplication.prototype._create_render = function (json) {\n    if (this.dom_screen || this.renderer) {\n        alert(\"Create render alert! Something strange happenes!\");\n    }\n    if (!this.dom_screen) {\n        this.dom_screen = document.getElementById(json.dom_element);\n    }\n    if (!this.renderer) {\n        this.renderer = new THREE.WebGLRenderer(json.render_params);\n    }\n    if (!!!this.dom_screen || typeof this.dom_screen === 'undefined') {\n        console.error(\"Some terrorous happens! dom element for screen not found! element id is \" + json.dom_element);\n    }\n    //console.log(\"found dome element \" + json.dom_element);\n    this.dom_screen.appendChild(this.renderer.domElement);\n    this.canvas = this.renderer.domElement;\n\n    this.renderer.setSize(json.viewport.width, json.viewport.height);\n    this.set_viewport(json.viewport.width, json.viewport.height);\n    this.renderer.setClearColor(json.clear_color);\n\n    this._lifecycle_event(\"render_created\");\n};\n\nApplication.prototype._create_main_scene = function (json) {\n    var event = { prevent: false };\n    this._lifecycle_event(\"before_create_main_scene\", event);\n    /*\r\n    if (event.prevent) {\r\n        return;\r\n    }\r\n    */\n    if (!this.main_scene) {\n        this.main_scene = new THREE.Scene();\n    }\n\n    var camera = json.main_camera;\n    if (!this.main_camera) {\n        this.main_camera = new THREE.PerspectiveCamera(camera.fov, camera.aspect_ratio, camera.near, camera.far);\n        this.main_scene.add(this.main_camera);\n        this.main_camera.name = \"main_camera\";\n    } else {\n        this.main_camera.fov = camera.fov;\n        this.main_camera.near = camera.near;\n        this.main_camera.far = camera.far;\n        this.main_camera.aspect = camera.aspect_ratio;\n        this.main_camera.updateProjectionMatrix();\n    }\n\n    this.main_camera.position.set(camera.position.x, camera.position.y, camera.position.z);\n};\n\nApplication.prototype.apply_configuration = function (json) {\n    this.configuration = json;\n    this._create_render(json);\n    this._create_main_scene(json);\n    this._lifecycle_event(\"created\");\n};\n\nApplication.prototype.load_configuration = function (url) {\n    var xhr = new THREE.XHRLoader();\n\n    var self = this;\n\n    var config = self.get_default_configuration();\n\n    var configuration_is_applied = false;\n\n    function onload(data) {\n        console.log(\"configuration loaded from url <<\" + url + \">>\");\n        var obj = JSON.parse(data);\n        //user config append to default config and may rewrite them, \n        //though user naven't to rewrite ALL config to change some params\n        _.copy_object(config, obj);\n        self.apply_configuration(config);\n        console.log(configuration_is_applied, \"onload\");\n        configuration_is_applied = true;\n    }\n    function progress() {}\n    function error(event) {\n        console.error(\"Error on loading config!\", event.target.status);\n        console.log(\"Setting default configuration\");\n        console.log(configuration_is_applied, \"error\");\n        configuration_is_applied = true;\n        self.apply_configuration(config);\n    }\n    xhr.load(url, onload, progress, error);\n};\n\nApplication.prototype._set_configuration = function (config) {\n    var default_config = this.get_default_configuration();\n\n    //this is url of configuration file\n    if (typeof config === 'string') {\n        console.log(\"get configuration from url >> \" + config);\n        this.load_configuration(config);\n\n        //this is object filled with data\n    } else if (typeof config === 'object') {\n        console.log(\"get configuration from user object\");\n        _.copy_object(default_config, config);\n        this.apply_configuration(default_config);\n        //configuration not given, use default\n    } else {\n        console.log(\"_set_configuration: set default configration\");\n        this.apply_configuration(default_config);\n    }\n};\n\nApplication.extend = function (methods, child_func) {\n\n    var Child;\n    if (typeof child_func === 'undefined') {\n        Child = function () {\n            Application.apply(this, arguments);\n        };\n    } else {\n        Child = child_func;\n    }\n\n    //create new object and set prototype chain\n    Child.prototype = Object.create(Application.prototype);\n    //copy methods to new object\n    _.copy_object(Child.prototype, methods);\n    Child.prototype.constructor = Child;\n\n    return Child;\n};\n\nApplication.extend_proto = function (proto, methods) {\n    var obj = Object.create(proto);\n    _.copy_object(obj, methods);\n    Application.call(obj);\n    return obj;\n};\n\nApplication.prototype.loop = function () {\n    var delta = this.clock.getDelta();\n    //fix this - add options to control min frame rate\n    if (delta > 0.1) {\n        delta = 0.1;\n    }\n    this.delta_time = delta;\n    this.do_update(delta);\n    this.update(delta);\n    this.render(delta);\n    this.run();\n    //My_Lib.run();\n};\n\nApplication.prototype.add_animated_object = function (obj) {\n    //fix probably duplicates\n    this.animated_objects.push(obj);\n};\n\nApplication.prototype.remove_animated_object = function (obj) {\n    for (var i = 0; i < this.animated_objects.length; i++) {\n        if (this.animated_objects[i] === obj) {\n            this.animated_objects.splice(i, 1);\n            break;\n        }\n    }\n};\n\nApplication.prototype.update_all = function (delta) {\n    var obj;\n    for (var i = 0, len = this.animated_objects.length; i < len; i++) {\n        obj = this.animated_objects[i];\n        if (obj[\"update\"]) {\n            obj.update(delta);\n        }\n    }\n};\n\nApplication.prototype.pre_update = function (delta) {\n    this.update_all(delta);\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].particle_manager.update(delta);\n    //event\n    if (this.before_update !== undefined) {\n        this.before_update(delta);\n    }\n};\n\nApplication.prototype.do_update = function (dt) {\n    this.pre_update(dt);\n    this.update(dt);\n};\n\nApplication.prototype.update = function (delta) {};\n\nApplication.prototype.create_mouse_move_listener = function () {\n    if (this[\"mouse_move_listener\"]) {\n        return;\n    }\n    var self = this;\n    this.mouse_move_listener = true;\n    function mouse_move_listener(event) {\n        var vector = __WEBPACK_IMPORTED_MODULE_2__base_mouse_intersector_js__[\"a\" /* Mouse_Intersector */].mouse_coords_to_vector(self.dom_screen, event);\n        self.find_mouse_over_intersections(vector);\n    };\n    document.addEventListener(\"mousemove\", mouse_move_listener);\n};\n\nApplication.prototype.find_mouse_over_intersections = function (vector) {\n    vector.unproject(this.main_camera);\n    var ray = new THREE.Raycaster(this.main_camera.position, vector.sub(this.main_camera.position).normalize());\n    var obj;\n    for (var i = 0, len = this.mouse_controllers.length; i < len; i++) {\n        obj = this.mouse_controllers[i];\n        if (obj.over) {\n            // create an array containing all objects in the scene with which the ray intersects\n            //var intersects = ray.intersectObjects( [grid_text.root], true ); \n            //console.log(fake_plane.root.children[0].geometry);\n            var intersects = ray.intersectObjects([obj.root], true);\n            obj.callback(intersects);\n        }\n    }\n};\n\nApplication.prototype.add_mouse_controller = function (root, over, click, callback) {\n    var tmp = new __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Mouse_Controller(root, over, click, callback);\n    this.mouse_controllers.push(tmp);\n    if (over) {\n        this.create_mouse_move_listener();\n    }\n    return tmp;\n};\n\nApplication.prototype.set_viewport = function (width, height) {\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.width = width;\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.height = height;\n};\n\nApplication.prototype.render = function (delta) {\n    this.renderer.setClearColor(this.configuration.clear_color);\n    this.renderer.autoClear = true;\n    this.renderer.render(this.main_scene, this.main_camera);\n};\n\n\n\n/***/ }),\n/* 12 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Base_Animation; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Euler_Animation; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"c\", function() { return Scale_Animation; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n\n\n//length - simple length of animations\n//-1 - infinite\n//0 - stop\n//> 0 - length of animation, \n//if time > length, animation stop\n//need rewrite this crap to safe floating point mannere\n//and append more controle on animation \nfunction Base_Animation() {\n    this.time = 0;\n    this.time_scale = 1.0;\n    this.type = \"Base_Animation\";\n    this.uuid = _.generateUUID();\n    this.length = -1;\n    this.stopped = false;\n}\n\nBase_Animation.prototype.update = function (dt) {\n    var scaled_dt = dt * this.time_scale;\n    this.time += scaled_dt;\n    if (this.length < 0 || this.time < this.length) {\n        this.calc_animation(dt);\n    }\n};\n\nBase_Animation.prototype.stop = function () {\n    this.stopped = true;\n};\n\nBase_Animation.prototype.start = function () {\n    this.stopped = false;\n};\n\nBase_Animation.prototype.reset = function () {\n    this.time = 0;\n};\n\nBase_Animation.prototype.calc_animation = function (dt) {};\n\nBase_Animation.prototype.apply = function (obj) {};\n\nBase_Animation.prototype.toJSON = function (data) {\n    var data = {};\n    data.uuid = this.uuid;\n    data.type = this.type;\n    if (this.name !== '') {\n        data.name = this.name;\n    }\n    data.time_scale = this.time_scale;\n    data.length = this.length;\n    return data;\n};\n\nBase_Animation.prototype.parse = function (param) {\n    this.type = param.type;\n    this.uuid = param.uuid;\n    this.name = param.name ? param.name : '';\n    this.time_scale = param.time_scale === undefined ? 1.0 : param.time_scale;\n    this.length = param.length === undefined ? 0 : param.length;\n};\n\nfunction Euler_Animation(x, y, z) {\n    Base_Animation.call(this);\n    this.type = \"Euler_Animation\";\n    this.xspeed = x;\n    this.yspeed = y;\n    this.zspeed = z;\n    this.x = 0;\n    this.y = 0;\n    this.z = 0;\n    this.name = '';\n}\n\nEuler_Animation.prototype = Object.create(Base_Animation.prototype);\n\nEuler_Animation.prototype.constructor = Euler_Animation;\n\nEuler_Animation.prototype.calc_animation = function (dt) {\n    dt *= this.time_scale;\n    this.x += this.xspeed * dt;\n    this.y += this.yspeed * dt;\n    this.z += this.zspeed * dt;\n};\n\nEuler_Animation.prototype.apply = function (obj) {\n    obj.rotation.x = this.x;\n    obj.rotation.y = this.y;\n    obj.rotation.z = this.z;\n};\n\nEuler_Animation.prototype.toJSON = function (json) {\n    var data = Base_Animation.prototype.toJSON.call(this);\n    data.xspeed = this.xspeed;\n    data.yspeed = this.yspeed;\n    data.zspeed = this.zspeed;\n    return data;\n};\n\nEuler_Animation.prototype.parse = function (param) {\n    Base_Animation.prototype.parse.call(this, param);\n    this.xspeed = param.xspeed;\n    this.yspeed = param.yspeed;\n    this.zspeed = param.zspeed;\n    this.x = this.y = this.z = 0;\n};\n\nfunction Scale_Animation(x, y, z) {\n    Base_Animation.call(this);\n    //speed of scale\n    this.xscale = x;\n    this.yscale = y;\n    this.zscale = z;\n    this.x = 1.0;\n    this.y = 1.0;\n    this.z = 1.0;\n}\n\nScale_Animation.prototype = Object.create(Base_Animation.prototype);\n\n_.copy_object(Scale_Animation.prototype, {\n    constructor: Scale_Animation,\n    calc_animation: function (dt) {\n        dt = dt * this.time_scale;\n        this.x += this.xscale * dt;\n        this.y += this.yscale * dt;\n        this.z += this.zscale * dt;\n    },\n    apply: function (obj) {\n        obj.scale.set(this.x, this.y, this.z);\n    },\n    reset: function () {\n        this.x = 1.0;\n        this.y = 1.0;\n        this.z = 1.0;\n        this.time = 0;\n    }\n});\n\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Base_Animation\", Base_Animation);\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Euler_Animation\", Euler_Animation);\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Scale_Animation\", Scale_Animation);\n\n\n\n/***/ }),\n/* 13 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Loading_Manager; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n\n\n//events: \n//item_loaded\n//onerror\n//onprogress\n//finished\nfunction Chain_Loader() {}\n\nChain_Loader.prototype = {\n\tconstructor: Chain_Loader,\n\tstart: function (list) {\n\t\tthis.list = list;\n\t\tthis.index = 0;\n\t\tthis.load(this.list[0]);\n\t\tthis.stop_by_error = false;\n\t},\n\n\tnext: function (resource) {\n\t\tif (this.item_loaded && resource) {\n\t\t\tthis.item_loaded(resource, this.list[this.index]);\n\t\t}\n\t\tthis.index++;\n\t\tif (this.index < this.list.length) {\n\t\t\tthis.load(this.list[this.index]);\n\t\t} else {\n\t\t\tif (this.finished) {\n\t\t\t\tthis.finished();\n\t\t\t}\n\t\t}\n\t},\n\n\tdo_error: function (error) {\n\t\tif (this.onerror) {\n\t\t\tthis.onerror(error);\n\t\t} else {\n\t\t\tconsole.error(\"Chain Loader Error!\", error);\n\t\t}\n\t\tif (!this.stop_by_error) {\n\t\t\tthis.next();\n\t\t}\n\t},\n\n\tdo_progress: function () {\n\t\tif (this.onprogress) {\n\t\t\tthis.onprogress.apply(this, arguments);\n\t\t}\n\t},\n\n\tload: function (item) {\n\t\tvar self = this;\n\t\tif (this.load_func) {\n\t\t\tthis.load_func(item, function (item) {\n\t\t\t\tself.next.apply(self, arguments);\n\t\t\t}, function (item) {\n\t\t\t\tself.do_error.apply(self, arguments);\n\t\t\t}, function (item) {\n\t\t\t\tself.do_progress.apply(self, arguments);\n\t\t\t});\n\t\t}\n\t}\n};\n\nfunction test_chain_loader() {\n\tvar cl = new Chain_Loader();\n\tcl.item_loaded = function (item) {\n\t\tconsole.log(\"load item \", item);\n\t};\n\tcl.finished = function (item) {\n\t\tconsole.log(\"loader manager - job done\");\n\t};\n\tcl.load_func = function (item, next, error, progress) {\n\t\tif (item) {\n\t\t\tnext(item);\n\t\t} else {\n\t\t\terror(item);\n\t\t}\n\t};\n\tcl.start([\"first\", \"second\", null, \"tree\"]);\n}\n//test_chain_loader();\n\n\nfunction Loading_Manager() {\n\tthis.resources = {};\n\tthis.texture_loader = new THREE.TextureLoader();\n}\n\nLoading_Manager.prototype = {\n\tconstructor: Loading_Manager,\n\tget: function (name) {\n\t\treturn this.resources[name];\n\t},\n\n\tget_async: function (name, callback) {\n\t\t//already loaded?\n\t\tvar texture = this.get(name);\n\t\tif (texture) {\n\t\t\tif (callback) {\n\t\t\t\tcallback(texture);\n\t\t\t}\n\t\t\treturn texture;\n\t\t}\n\n\t\t//if not load this async\n\t\tvar self = this;\n\t\ttexture = this.texture_loader.load(name, function (texture) {\n\t\t\tif (callback) {\n\t\t\t\tcallback(texture);\n\t\t\t}\n\t\t});\n\t\tthis.resources[name] = texture;\n\t\treturn texture;\n\t},\n\n\tload_list: function (resource_list, on_load, load_func, on_progress) {\n\t\tvar self = this;\n\n\t\tvar cl = new Chain_Loader();\n\t\tvar self = this;\n\t\tcl.onerror = function (error) {\n\t\t\tconsole.error(\"ERROR loading texture\", error, cl.list[cl.index]);\n\t\t};\n\t\tcl.item_loaded = function (resource, name) {\n\t\t\tself.resources[name] = resource;\n\t\t\tif (self.on_resource_loaded) {\n\t\t\t\tself.on_resource_loaded(resource);\n\t\t\t}\n\t\t};\n\t\tcl.on_progress = function () {\n\t\t\tif (on_progress) {\n\t\t\t\ton_progress();\n\t\t\t}\n\t\t};\n\t\tcl.load_func = function () {\n\t\t\tload_func.apply(this, arguments);\n\t\t};\n\t\tcl.finished = function () {\n\t\t\tif (on_load) {\n\t\t\t\ton_load();\n\t\t\t}\n\t\t};\n\t\tcl.start(resource_list);\n\t},\n\n\tload_list_textures: function (resource_list, on_load) {\n\t\tvar self = this;\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress) {\n\t\t\tvar texture = self.texture_loader.load(url, next, progress, error);\n\t\t});\n\t},\n\n\tload_list_json: function (resource_list, on_load, progress) {\n\t\tvar self = this;\n\t\tvar loader = new THREE.XHRLoader();\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress) {\n\t\t\tvar texture = loader.load(url, next, progress, error);\n\t\t}, progress);\n\t},\n\n\tfree: function () {\n\t\tthis.resources = {};\n\t}\n};\n\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Texture_Manager = new Loading_Manager();\n\n\n\n/***/ }),\n/* 14 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Package_Manager; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n//TODO: remove this ugly crap and replace something reasonable\n\n\n\n//this ugly class loading texture list in json format, parse it, and loading textures\n//then it call event data_loaded, when give texture list in json format\n\nfunction Package_Manager() {\n    this.state = {};\n}\n\n//load json file with descriptions of package: texture list, particles list, scene objects list\nPackage_Manager.prototype.load = function (url, defaults) {\n    this.defaults = defaults;\n    var self = this;\n    this.state = {\n        \"type\": \"start\"\n    };\n\n    var self = this;\n    function onload(data) {\n        self.state[\"type\"] = \"done\";\n        self.state[\"data\"] = data;\n\n        self.parse_package_description(data);\n    }\n    function error(event) {\n        self.state[\"type\"] = \"error\";\n        self.state[\"error\"] = event;\n        console.error(\"ERror! Failed loading resources with url \" + url, event.target);\n        if (self.error) {\n            self.error(event.target);\n        }\n        self.pack = self.defaults;\n        self.load_resources(self.defaults);\n    }\n    function progress() {}\n    var xhr = new THREE.XHRLoader();\n    xhr.load(url, onload, progress, error);\n};\n\n//parse loaded json file \nPackage_Manager.prototype.parse_package_description = function (data) {\n    console.log(\"packaged description loaded, begin parsing...\");\n    try {\n        var pack = JSON.parse(data);\n        this.pack = pack;\n        if (this.loaded) {\n            this.loaded(pack);\n        }\n    } catch (e) {\n        console.error(\"error parsing resources \", e);\n        if (this.error) {\n            this.error(event);\n        }\n        return;\n    }\n    this.load_resources(pack);\n};\n\nPackage_Manager.prototype.load_resources = function (pack) {\n    var self = this;\n    //load textures\n    console.log(\"Package Manager: begin loading textures...\");\n    __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.load_list_textures(pack.textures, function () {\n        //load json descriptions files\n        if (self.data_loaded) {\n            self.data_loaded(pack);\n        }\n    });\n};\n\n\n\n/***/ }),\n/* 15 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Scene_Serializer; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particles_particles_manager_js__ = __webpack_require__(9);\n\n\n\nfunction Scene_Serializer(root) {\n    this.animation_library = {};\n}\n\nScene_Serializer.prototype.toJSON = function (root) {\n    this.json = root.toJSON();\n    console.log(\"my lib particle manager\", __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].particle_manager);\n    this.json[\"particles\"] = __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].particle_manager.toJSON();\n    var anims = root.collect_animations(root);\n    if (anims.count > 0) {\n        this.json[\"myanimations\"] = anims;\n    }\n\n    return this.json;\n};\n\nScene_Serializer.prototype.create_animations = function (animations) {\n    for (var key in animations) {\n        if (this.animation_library[key] === undefined && Object.prototype.hasOwnProperty.call(animations, key)) {\n            var data = animations[key];\n            //console.log(\"create animations \", data.uuid);            \n            var anim = __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Abstract_Fabric(data);\n            if (anim) {\n                this.animation_library[key] = anim;\n            }\n        }\n    }\n};\n\nScene_Serializer.prototype.bind_animations = function (animdata) {\n    if (!animdata) return;\n\n    var bindings = animdata.bindings;\n\n    var self = this;\n    function copy_animations(obj, bind) {\n        for (var i = 0; i < bind.animations.length; i++) {\n            var anim_uuid = bind.animations[i];\n            obj.add_animation(self.animation_library[anim_uuid]);\n        }\n    }\n\n    for (var i = 0; i < bindings.length; i++) {\n        var bind = bindings[i];\n        var uuid = bind.uuid;\n        var obj = this.root.getObjectByProperty(\"uuid\", uuid);\n        if (obj) {\n            copy_animations(obj, bind);\n        }\n    }\n};\n\nScene_Serializer.prototype.load_from_json = function (url) {\n    var self = this;\n    function onload(json) {\n        try {\n            var data = JSON.parse(json);\n        } catch (e) {\n            console.error(\"Failed to parse scene \", e);\n            throw e;\n        }\n        if (data === undefined) {\n            console.error(\"Something fucking happened, failed to load scene \", url);\n            return;\n        }\n        self.load(data);\n    }\n    function progress() {}\n    function error(e) {\n        console.error(e.target);\n        throw e;\n    }\n    var xhr = new THREE.XHRLoader();\n    xhr.load(url, onload, progress, error);\n};\n\nScene_Serializer.prototype.load = function (json) {\n    this.animation_library = {};\n    var o = new THREE.ObjectLoader();\n    if (json !== undefined) {\n        this.json = json;\n    }\n    var root = o.parse(this.json, function () {\n        console.log(\"onload\");\n    });\n    this.root = root;\n\n    __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].particle_manager.load_particles(this.json, root);\n\n    this.create_animations(this.json.myanimations.animations);\n    this.bind_animations(this.json.myanimations);\n    this.main_camera = root.getObjectByName(\"main_camera\");\n\n    if (this.scene_loaded) {\n        this.scene_loaded(root);\n    }\n    return root;\n};\n\n\n\n/***/ }),\n/* 16 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export Mix_It */\nfunction Mix_It() {\n\n    //FIX\n    THREE.Vector3.prototype.applyMatrix4_rotation = function (m) {\n        // input: THREE.Matrix4 affine matrix\n\n        var x = this.x,\n            y = this.y,\n            z = this.z;\n        var e = m.elements;\n\n        this.x = e[0] * x + e[4] * y + e[8] * z;\n        this.y = e[1] * x + e[5] * y + e[9] * z;\n        this.z = e[2] * x + e[6] * y + e[10] * z;\n\n        return this;\n    };\n\n    var Object3D_Animation_Mixin = {\n\n        add_animation: function (anim) {\n            if (!this.animations) {\n                this.animations = [];\n            }\n            if (this.animations.indexOf(anim) < 0) {\n                this.animations.push(anim);\n            }\n        },\n\n        remove_animation: function (anim) {\n            if (this.animations) {\n                var i = this.animations.indexOf(anim);\n                if (i > -1) {\n                    this.animations.splice(i, 1);\n                }\n            }\n        },\n\n        update: function (dt) {\n            if (this.animations !== undefined) {\n                for (var i = 0; i < this.animations.length; i++) {\n                    var anim = this.animations[i];\n                    anim.update(dt);\n                    anim.apply(this);\n                }\n            }\n\n            for (var i = 0; i < this.children.length; i++) {\n                var obj = this.children[i];\n                if (obj.update) {\n                    obj.update(dt);\n                }\n            }\n        }\n\n    };\n    _.copy_object(THREE.Object3D.prototype, Object3D_Animation_Mixin);\n\n    THREE.Object3D.prototype.old_toJson = THREE.Object3D.toJSON;\n\n    var Object3D_Serialization_Mixin = {\n        standard_serialization: function (meta) {\n            // standard Object3D serialization\n            var object = {};\n\n            object.uuid = this.uuid;\n            object.type = this.type;\n            if (this.name !== '') object.name = this.name;\n            if (JSON.stringify(this.userData) !== '{}') object.userData = this.userData;\n            if (this.castShadow === true) object.castShadow = true;\n            if (this.receiveShadow === true) object.receiveShadow = true;\n            if (this.visible === false) object.visible = false;\n\n            object.matrix = this.matrix.toArray();\n\n            if (this.type !== \"particles_points\") {\n                if (this.geometry !== undefined) {\n                    object.geometry = this.geometry.uuid;\n                }\n                if (this.material !== undefined) {\n                    object.material = this.material.uuid;\n                }\n\n                if (this.material !== undefined && meta.materials[this.material.uuid] === undefined) {\n                    meta.materials[this.material.uuid] = this.material.toJSON(meta);\n                }\n\n                if (this.geometry !== undefined && meta.geometries[this.geometry.uuid] === undefined) {\n                    meta.geometries[this.geometry.uuid] = this.geometry.toJSON(meta);\n                }\n            }\n\n            if (this.animations) {\n                object.animations = [];\n                for (var i = 0; i < this.animations.length; i++) {\n                    object.animations.push(this.animations[i].uuid);\n                }\n            }\n\n            if (this.children.length > 0) {\n                object.children = [];\n                for (var i = 0; i < this.children.length; i++) {\n                    var child = this.children[i];\n                    //object.children.push( child.standard_serialization( meta ) );\n                    object.children.push(child.toJSON(meta));\n                }\n            }\n            return object;\n        },\n\n        collect_materials: function (meta) {\n            if (this.material !== undefined && meta.materials[this.material.uuid] === undefined) {\n                meta.materials[this.material.uuid] = this.material.toJSON(meta);\n            }\n\n            for (var i = 0; i < this.children.length; i++) {\n                this.children[i].collect_materials(meta);\n            }\n        },\n\n        collect_geometry: function (meta) {\n            if (this.geometry !== undefined && meta.geometries[this.geometry.uuid] === undefined) {\n                meta.geometries[this.geometry.uuid] = this.geometry.toJSON(meta);\n            }\n\n            for (var i = 0; i < this.children.length; i++) {\n                this.children[i].collect_geometry(meta);\n            }\n        },\n\n        toJSON1: function (meta) {\n\n            // extract data from the cache hash\n            // remove metadata on each item\n            // and return as array\n            function extractFromCache(cache, t) {\n                var values = [];\n                for (var key in cache) {\n                    var data = cache[key];\n                    delete data.metadata;\n                    values.push(data);\n                }\n                return values;\n            }\n\n            this.updateMatrixWorld(true);\n\n            // meta is '' when called from JSON.stringify\n            var isRootObject = meta === undefined || meta === '';\n\n            var output = {};\n\n            if (isRootObject) {\n\n                meta = {\n                    geometries: {},\n                    materials: {},\n                    textures: {},\n                    images: {}\n                };\n\n                //this.collect_materials(meta);\n                //this.collect_geometry(meta);\n                var object = this.standard_serialization(meta);\n\n                output.metadata = {\n                    version: 4.4,\n                    type: 'Object',\n                    generator: 'Object3D.toJSON'\n                };\n\n                var geometries = extractFromCache(meta.geometries, \"geoim\");\n                var materials = extractFromCache(meta.materials, \"materials\");\n                var textures = extractFromCache(meta.textures, \"textures\");\n                var images = extractFromCache(meta.images, \"images\");\n\n                if (geometries.length > 0) output.geometries = geometries;\n                if (materials.length > 0) output.materials = materials;\n                if (textures.length > 0) output.textures = textures;\n                if (images.length > 0) output.images = images;\n\n                var anims = this.collect_animations(this);\n                if (anims.count > 0) {\n                    output[\"myanimations\"] = anims;\n                }\n\n                output.object = object;\n            } else {\n                output.object = this.standard_serialization(meta);\n                output.type = this.type;\n                if (output.object === undefined) {\n                    console.log(\"i am undefined\", this);\n                }\n            }\n\n            return output;\n        },\n\n        collect_animations: function (scene) {\n            var data = {\n                animations: {},\n                bindings: [],\n                count: 0\n            };\n\n            function collect_animations_recursive(root) {\n                if (root.animations) {\n                    for (var i = 0; i < root.animations.length; i++) {\n                        var anim = root.animations[i];\n                        if (data.animations[anim.uuid] === undefined) {\n                            data.animations[anim.uuid] = anim.toJSON();\n                            data.count++;\n                        }\n                    }\n\n                    var bind = {};\n                    bind.uuid = root.uuid;\n                    bind.animations = [];\n                    for (var i = 0; i < root.animations.length; i++) {\n                        bind.animations.push(root.animations[i].uuid);\n                    }\n                    data.bindings.push(bind);\n                }\n\n                if (root.children) {\n                    for (var i = 0; i < root.children.length; i++) {\n                        collect_animations_recursive(root.children[i]);\n                    }\n                }\n            }\n            collect_animations_recursive(scene);\n            return data;\n        }\n\n    };\n\n    _.copy_object(THREE.Object3D.prototype, Object3D_Serialization_Mixin);\n\n    //replace source with this\n    THREE.Object3D.prototype.replace_object_with_this = function (source) {\n\n        this.uuid = source.uuid;\n        this.name = source.name;\n\n        this.up.copy(source.up);\n        this.position.copy(source.position);\n        this.quaternion.copy(source.quaternion);\n        this.scale.copy(source.scale);\n\n        this.matrix.copy(source.matrix);\n        this.matrixWorld.copy(source.matrixWorld);\n\n        this.matrixAutoUpdate = source.matrixAutoUpdate;\n        this.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\n\n        this.visible = source.visible;\n\n        this.castShadow = source.castShadow;\n        this.receiveShadow = source.receiveShadow;\n\n        this.frustumCulled = source.frustumCulled;\n        this.renderOrder = source.renderOrder;\n\n        this.userData = JSON.parse(JSON.stringify(source.userData));\n\n        //copy array of children, not clone\n        for (var i = 0; i < source.children.length; i++) {\n            this.add(source.children[i]);\n        }\n        source.parent.add(this);\n        source.parent.remove(source);\n\n        this.animations = source.animations;\n    };\n}\n\nMix_It();\n\n\n\n/***/ }),\n/* 17 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Custom_Affector; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_affector_js__ = __webpack_require__(1);\n\n\n\nfunction Custom_Affector() {\n    __WEBPACK_IMPORTED_MODULE_1__particle_affector_js__[\"a\" /* Particle_Affector */].apply(this, arguments);\n    this.custom_func = function dummy() {\n        return true;\n    };\n}\n\nCustom_Affector.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_1__particle_affector_js__[\"a\" /* Particle_Affector */].prototype);\n\n_.copy_object(Custom_Affector.prototype, {\n    constructor: Custom_Affector,\n    affect: function (dt, pdata, vert) {\n        return this.custom_func(dt, p, vert);\n    },\n    test_func: function () {\n        var p = {\n            position: { x: 0, y: 0, z: 0 },\n            velocity: { x: 0, y: 0, z: 0 }\n        };\n        var color = { r: 0, g: 0, b: 0 };\n        this.custom_func(p, color);\n    },\n    set_affect_function: function (source) {\n        if (typeof source === 'function') {\n            this.custom_func = source;\n        } else if (typeof source === 'string') {\n            try {\n                this.custom_func = new Function('dt,p,vert', source);\n                this.test_func();\n            } catch (e) {\n                alert(e);\n                this.custom_func = undefined;\n            }\n            this.source_code = source;\n        }\n    },\n\n    toJSON: function () {\n        var data = {\n            name: \"Custom_Affector\"\n        };\n        data.params = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Affector.prototype.toJSON.call(this, this);\n        params[\"source_code\"] = this.source_code;\n        return data;\n    },\n    parse: function (json) {\n        __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Affector.prototype.parse(this, json);\n        this.set_affect_func(json.source_code);\n    }\n\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Custom_Affector\", Custom_Affector);\n\n\n\n/***/ }),\n/* 18 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Custom_Emitter; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__ = __webpack_require__(2);\n\n\n\nfunction Custom_Emitter() {\n    __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */].apply(this, arguments);\n}\n\nCustom_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\n\nvar methods = {\n    emit: function (p, color) {\n        if (this.custom_func) {\n            this.custom_func(p, color);\n        }\n    },\n    test_func: function () {\n        var p = {\n            position: { x: 0, y: 0, z: 0 },\n            velocity: { x: 0, y: 0, z: 0 }\n        };\n        var color = { r: 0, g: 0, b: 0 };\n        this.custom_func(p, color);\n    },\n    set_emit_function: function (source) {\n        if (typeof source === 'function') {\n            this.custom_func = source;\n        } else if (typeof source === 'string') {\n            try {\n                this.custom_func = new Function('p', 'color', source);\n                this.test_func();\n            } catch (e) {\n                alert(e);\n                this.custom_func = undefined;\n            }\n            this.source_code = source;\n        }\n    },\n    toJSON: function () {\n        var data = {};\n        data.name = \"Custom_Emitter\";\n        data.params = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Emitter.prototype.toJSON.call(this, this);\n        if (this.source_code) {\n            data.params.source_code = this.source_code;\n        }\n        return data;\n    },\n    parse: function (data) {\n        __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Emitter.prototype.parse.call(this, data);\n        this.set_emit_function(data.source_code);\n    },\n    constructor: Custom_Emitter\n};\n\n_.copy_object(Custom_Emitter.prototype, methods);\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Custom_Emitter\", Custom_Emitter);\n\nfunction test() {\n    var t = new Custom_Emitter();\n    var source = 'p.position.z = -100; p.velocity.y = 100;';\n    t.set_emit_function(source);\n    var p = {\n        velocity: { x: 0, y: 0, z: 0 },\n        position: { x: 0, y: 0, z: 0 }\n    };\n    t.custom_func(p);\n    console.log(p);\n    var json = t.toJSON();\n    console.log(json);\n\n    t = new Custom_Emitter();\n    t.parse(json.params);\n    //console.log(t.custom_func);    \n}\n\n//test();\n\n/*\r\nCustom_Emitter.prototype = Object.create(My_Lib.Particle_Emitter.prototype);\r\nCustom_Emitter.prototype.constructor = Cone_Emitter;\r\nMy_Lib.Register_Class(\"Custom_Emitter\", Cone_Emitter);\r\n*/\n\n\n\n/***/ }),\n/* 19 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Forces; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\nvar Particle_Forces = {};\n\n//base class\nParticle_Forces.Force = function () {};\n\n_.copy_object(Particle_Forces.Force.prototype, {\n\tcalc: function (dt, particle, acceleration) {},\n\ttoJSON: function (child) {\n\t\treturn {};\n\t},\n\tparse: function (json) {}\n});\n\n//constant force\nParticle_Forces.Constant_Force = function (force) {\n\tif (typeof force !== 'undefined') {\n\t\tthis.force = force;\n\t} else {\n\t\tthis.force = { x: 0, y: 0, z: 0 };\n\t}\n};\n\nParticle_Forces.Constant_Force.prototype = Object.create(Particle_Forces.Force.prototype);\n_.copy_object(Particle_Forces.Constant_Force.prototype, {\n\tconstructor: Particle_Forces.Constant_Force,\n\tcalc: function (dt, p, acceleration) {\n\t\tacceleration.x += this.force.x;\n\t\tacceleration.y += this.force.y;\n\t\tacceleration.z += this.force.z;\n\t},\n\ttoJSON: function (child) {\n\t\tvar data = {};\n\t\tdata.name = \"Constant_Force\";\n\t\tdata.force = _.create_clone_object(this.force);\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\tif (json.force) {\n\t\t\t_.copy_object(this.force, json.force);\n\t\t}\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Constant_Force\", Particle_Forces.Constant_Force);\n\n\n\n/***/ }),\n/* 20 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Cone_Emitter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Star_Dust_Emitter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"c\", function() { return Sphere_Emitter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"d\", function() { return Star_Dust_Affector; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__point_generators_js__ = __webpack_require__(10);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__particle_affector_js__ = __webpack_require__(1);\n\n\n\n\n\nfunction Cone_Emitter() {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].apply(this, arguments);\n\tthis.generator = new __WEBPACK_IMPORTED_MODULE_1__point_generators_js__[\"a\" /* Point_Generators */].Random_Direction();\n\tthis.origin = new THREE.Vector3(1, 1, 0);\n\tthis.velocity = new THREE.Vector3(0, 1, 0);\n\tthis.dispersion = { \"min\": 5, \"max\": 10 };\n\tthis.dispersion.delta = 5;\n\tthis.speed = { min: 5, max: 10, delta: 5 };\n\tthis.color = new THREE.Color(1, 1, 1);\n}\n\nCone_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\nCone_Emitter.prototype.constructor = Cone_Emitter;\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Cone_Emitter\", Cone_Emitter);\n\nCone_Emitter.prototype.toJSON = function () {\n\tvar data = {};\n\tdata.name = \"Cone_Emitter\";\n\tdata.params = __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.toJSON.call(this, this);\n\t_.clone_field_list_one_level_recursion(this, data.params, [\"origin\", \"velocity\", \"dispersion\", \"speed\"]);\n\n\treturn data;\n};\n\nCone_Emitter.prototype.parse = function (data) {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.parse.call(this, data);\n\tthis.origin.copy(data.origin);\n\tthis.velocity.copy(data.velocity);\n\tthis.set_dispersion(data.dispersion.min, data.dispersion.max);\n\tthis.set_speed(data.speed.min, data.speed.max);\n};\n\nCone_Emitter.prototype.set_speed = function (min, max) {\n\tthis.speed.min = min;\n\tthis.speed.max = max;\n\tthis.speed.delta = max - min;\n};\n\nCone_Emitter.prototype.set_dispersion = function (min, max) {\n\tthis.dispersion.min = min;\n\tthis.dispersion.max = max;\n\tthis.dispersion.delta = max - min;\n};\n\nCone_Emitter.prototype.emit = function (p, color, matrix) {\n\tp.position.copy(this.origin);\n\n\tthis.generator.get_direction(p.velocity);\n\tp.velocity.multiplyScalar(Math.random() * this.dispersion.delta + this.dispersion.min);\n\tp.velocity.add(this.velocity).normalize();\n\n\tif (matrix) {\n\t\tp.position.applyMatrix4(matrix);\n\t\tp.velocity.applyMatrix4_rotation(matrix);\n\t}\n\n\tp.velocity.multiplyScalar(Math.random() * this.speed.delta + this.speed.min);\n\n\tif (color) {\n\t\tthis.emit_color(color);\n\t}\n};\n\nCone_Emitter.prototype.emit_color = function (color) {\n\tcolor.copy(this.color);\n};\n\nfunction Sphere_Emitter(radius, speed) {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].call(this);\n\tthis.radius = radius || 1;\n\tthis.speed = speed || 1;\n\tthis.generator = new __WEBPACK_IMPORTED_MODULE_1__point_generators_js__[\"a\" /* Point_Generators */].Sphere(radius);\n\tthis.from_center = true;\n\tObject.defineProperty(this, 'radius', {\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tset: function (value) {\n\t\t\tradius = value;generator.radius = value;\n\t\t}\n\t});\n}\n\nSphere_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\n\n_.copy_object(Sphere_Emitter.prototype, {\n\tconstructor: Sphere_Emitter,\n\temit: function (p, color, matrix) {\n\t\tif (this.from_center) {\n\t\t\tp.position.set(0, 0, 0);\n\t\t} else {\n\t\t\tthis.generator.get_point(p.position);\n\t\t}\n\t\tthis.generator.get_normal(p.velocity);\n\t\tif (matrix) {\n\t\t\tp.position.applyMatrix4(matrix);\n\t\t\tp.velocity.applyMatrix4_rotation(matrix);\n\t\t}\n\t\tp.velocity.multiplyScalar(this.speed);\n\t},\n\ttoJSON: function (json) {\n\t\tvar params = __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.toJSON.call(this, this);\n\t\tparams.radius = this.radius;\n\t\tparams.speed = this.speed;\n\t\t//params.generator.radius = this.radius;\n\t},\n\tparse: function (json) {\n\t\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.parse.call(this, json);\n\t\tthis.radius = json.radius;\n\t\tthis.speed = json.speed;\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Sphere_Emitter\", Sphere_Emitter);\n\nfunction Star_Dust_Emitter() {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].apply(this, arguments);\n\tthis.start_position = new THREE.Vector3(0, 0, 0);\n\tthis.end_position = new THREE.Vector3(1, 1, 1);\n\tthis.delta = new THREE.Vector3(1, 1, 1);\n\tthis.velocity = new THREE.Vector3(0, 0, 1);\n}\n\nStar_Dust_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\nStar_Dust_Emitter.prototype.constructor = Star_Dust_Emitter;\n_.copy_object(Star_Dust_Emitter.prototype, {\n\tset_velocity: function (x, y, z) {\n\t\tthis.velocity.set(x, y, z);\n\t},\n\tset_position_range: function (start, end) {\n\t\tthis.start_position.copy(start);\n\t\tthis.end_position.copy(end);\n\t\tthis.delta.set(end.x - start.x, end.y - start.y, end.z - start.z);\n\t},\n\tget_position: function (vector) {\n\t\tvector.x = Math.random() * this.delta.x + this.start_position.x;\n\t\tvector.y = Math.random() * this.delta.y + this.start_position.y;\n\t\tvector.z = Math.random() * this.delta.z + this.start_position.z;\n\t},\n\tget_velocity: function (vector) {\n\t\tvector.x = this.velocity.x;\n\t\tvector.y = this.velocity.y;\n\t\tvector.z = this.velocity.z;\n\t},\n\temit: function (p) {\n\t\tthis.get_position(p.position);\n\t\tif (this.parent) {\n\t\t\tthis.parent.localToWorld(p.position);\n\t\t}\n\t\tthis.get_velocity(p.velocity);\n\t},\n\ttoJSON: function () {\n\t\tvar params = __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.toJSON.call(this, this);\n\t\t_.clone_field_list_one_level_recursion(this, params, [\"velocity\", \"start_position\", \"end_position\"]);\n\t\tvar data = {\n\t\t\t\"name\": \"Star_Dust_Emitter\",\n\t\t\t\"params\": params\n\t\t};\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.parse.call(this, json);\n\t\tthis.set_position_range(json.start_position, json.end_position);\n\t\tthis.velocity.copy(json.velocity);\n\t}\n\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Star_Dust_Emitter\", Star_Dust_Emitter);\n\nfunction Star_Dust_Affector(end) {\n\tthis.end = end || 0;\n}\n\nStar_Dust_Affector.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_3__particle_affector_js__[\"a\" /* Particle_Affector */].prototype);\nStar_Dust_Affector.prototype.constructor = Star_Dust_Affector;\n\n_.copy_object(Star_Dust_Affector.prototype, {\n\taffect: function (dt, pdata, vert) {\n\t\tif (pdata.position.z > this.end) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\ttoJSON: function () {\n\t\tvar params = __WEBPACK_IMPORTED_MODULE_3__particle_affector_js__[\"a\" /* Particle_Affector */].prototype.toJSON.call(this, this);\n\t\tparams[\"end\"] = this.end;\n\t\tvar data = {\n\t\t\t\"name\": \"Star_Dust_Affector\",\n\t\t\t\"params\": params\n\n\t\t};\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\t__WEBPACK_IMPORTED_MODULE_3__particle_affector_js__[\"a\" /* Particle_Affector */].prototype.parse(this, json);\n\t\tthis.end = json.end;\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Star_Dust_Affector\", Star_Dust_Affector);\n\n\n\n/***/ }),\n/* 21 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__ = __webpack_require__(4);\n/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, \"main_event_hub\", function() { return __WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__[\"a\"]; });\n/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, \"Event_Hub\", function() { return __WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__[\"b\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__base_my_lib_js__ = __webpack_require__(0);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"My_Lib\", function() { return __WEBPACK_IMPORTED_MODULE_1__base_my_lib_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__base_animations_js__ = __webpack_require__(12);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Base_Animation\", function() { return __WEBPACK_IMPORTED_MODULE_2__base_animations_js__[\"a\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Euler_Animation\", function() { return __WEBPACK_IMPORTED_MODULE_2__base_animations_js__[\"b\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Scale_Animation\", function() { return __WEBPACK_IMPORTED_MODULE_2__base_animations_js__[\"c\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__base_mouse_intersector_js__ = __webpack_require__(5);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Mouse_Intersector\", function() { return __WEBPACK_IMPORTED_MODULE_3__base_mouse_intersector_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__base_loading_manager_js__ = __webpack_require__(13);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Loading_Manager\", function() { return __WEBPACK_IMPORTED_MODULE_4__base_loading_manager_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__base_package_manager_js__ = __webpack_require__(14);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Package_Manager\", function() { return __WEBPACK_IMPORTED_MODULE_5__base_package_manager_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__particles_particles_points_js__ = __webpack_require__(3);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particles_Points\", function() { return __WEBPACK_IMPORTED_MODULE_6__particles_particles_points_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__particles_particle_emitter_js__ = __webpack_require__(2);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_7__particles_particle_emitter_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__particles_forces_js__ = __webpack_require__(19);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Forces\", function() { return __WEBPACK_IMPORTED_MODULE_8__particles_forces_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__particles_particle_affector_js__ = __webpack_require__(1);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Affector\", function() { return __WEBPACK_IMPORTED_MODULE_9__particles_particle_affector_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__particles_point_generators_js__ = __webpack_require__(10);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Point_Generators\", function() { return __WEBPACK_IMPORTED_MODULE_10__particles_point_generators_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__particles_custom_emitter_js__ = __webpack_require__(18);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Custom_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_11__particles_custom_emitter_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__particles_custom_affector_js__ = __webpack_require__(17);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Custom_Affector\", function() { return __WEBPACK_IMPORTED_MODULE_12__particles_custom_affector_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__ = __webpack_require__(20);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Cone_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"a\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Star_Dust_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"b\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Sphere_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"c\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Star_Dust_Affector\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"d\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_14__particles_particle_shaders_js__ = __webpack_require__(7);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Shaders\", function() { return __WEBPACK_IMPORTED_MODULE_14__particles_particle_shaders_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15__particles_particles_js__ = __webpack_require__(8);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_System\", function() { return __WEBPACK_IMPORTED_MODULE_15__particles_particles_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_16__particles_particles_manager_js__ = __webpack_require__(9);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Manager\", function() { return __WEBPACK_IMPORTED_MODULE_16__particles_particles_manager_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_17__base_scene_serializer_js__ = __webpack_require__(15);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Scene_Serializer\", function() { return __WEBPACK_IMPORTED_MODULE_17__base_scene_serializer_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_18__base_threejs_mixins_js__ = __webpack_require__(16);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_19__app_application_js__ = __webpack_require__(11);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Application\", function() { return __WEBPACK_IMPORTED_MODULE_19__app_application_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_20__particles_color_domain_js__ = __webpack_require__(6);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Color_Domain\", function() { return __WEBPACK_IMPORTED_MODULE_20__particles_color_domain_js__[\"a\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Table_Color\", function() { return __WEBPACK_IMPORTED_MODULE_20__particles_color_domain_js__[\"b\"]; });\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// prod.build.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 21);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6ee2c1139edd4bf34766","/*\r\n*/\r\n\r\n\r\nvar My_Lib = {};\r\n\r\nMy_Lib.Viewport = {};\r\n\r\n\r\nMy_Lib.Object_Animation = function (object, animation)\r\n{\r\n\tthis.object = object;\r\n\tthis.animation = animation;\r\n}\r\n\r\nMy_Lib.Object_Animation.prototype.update = function (dt)\r\n{\r\n\tthis.animation(this.object, dt);\r\n}\r\n\r\nMy_Lib.create_text_image = function (width, height, text, npot, background) \r\n{\r\n\t// create a canvas element\r\n\tvar canvas = document.createElement('canvas');\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tvar context = canvas.getContext('2d');\r\n\tif (background) \r\n\t{\r\n\t\tcontext.fillStyle = background;\r\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\r\n\t}\r\n\tcontext.font = \"Bold 40px Arial\";\r\n\tcontext.fillStyle = \"rgba(0,255,0,0.95)\";\r\n    context.fillText('Hello, world!', 0, 50);\r\n    \r\n\t// canvas contents will be used for a texture\r\n\tvar texture = new THREE.Texture(canvas) \r\n\tif (npot) {\r\n\t\ttexture.wrapS = texture.wrapT = THREE.TextureWrapping.ClampToEdgeWrapping;\r\n\t\ttexture.minFilter = THREE.LinearFilter;\r\n\t}\r\n\ttexture.needsUpdate = true; \t\r\n\treturn texture;\r\n}\r\n\r\n\r\nMy_Lib.Create_Quad = function (width, height, vertex_shader, fragment_shader)\r\n{\r\n\t//plane created turn away from camera\r\n\tvar plane = new THREE.PlaneBufferGeometry( width, height);\r\n\t\r\n\tvar material = new THREE.ShaderMaterial( {\r\n\t\tvertexShader: vertex_shader,\r\n\t\tfragmentShader: fragment_shader\r\n\t} ); \r\n\r\n\tvar quad = new THREE.Mesh( plane, material );\r\n\tquad.rotation.y = Math.PI;\r\n\treturn quad;\r\n}\r\n\r\n\r\nMy_Lib.Render_Target = function (width, height)\r\n{\r\n\tthis.target = new THREE.WebGLRenderTarget( \r\n\twidth, \r\n\theight, \r\n\t{ \r\n\t\tminFilter: THREE.LinearFilter, \r\n\t\tmagFilter: THREE.NearestFilter, \r\n\t\tformat: THREE.RGBFormat \r\n\t} ); \r\n\t\r\n\tthis.camera = new THREE.PerspectiveCamera(80, width/height, 0.1, 1000);\r\n}\r\n\r\nMy_Lib.Render_Target.prototype.render = function (scene, renderer)\r\n{\r\n\trenderer.render( scene, \r\n\t\tthis.camera, \r\n\t\tthis.target, \r\n\t\ttrue  //forceClear\r\n\t\t);\r\n}\r\n\r\n\r\nMy_Lib.create_overlay_camera = function (width, height)\r\n{\r\n\tvar camera =  new THREE.OrthographicCamera( \r\n\t\twidth / - 2, \r\n\t\twidth / 2, \r\n\t\theight / 2, \r\n\t\theight /- 2, -10000, 10000 );\r\n\treturn camera;\r\n}\r\n\r\nMy_Lib.Overlay = function (width, height)\r\n{\r\n\tthis.camera = My_Lib.create_overlay_camera(width, height);\r\n}\r\n\r\nMy_Lib.Overlay.prototype.render = function (renderer)\r\n{\r\n\tif (!this.scene) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\trenderer.autoClear = false;\r\n\trenderer.render(this.scene, this.camera);\r\n\trenderer.autoClear = true;\r\n}\r\n\r\n\r\nMy_Lib.Mouse_Controller = function (root, over, click, callback)\r\n{\r\n\tthis.root = root;\r\n\tthis.over = over;\r\n\tthis.click = !!click;\r\n\tthis.callback = callback;\r\n}\r\n\r\n\r\n\r\n/*\r\nugly hack\r\n*/\r\n\r\nMy_Lib.event_hub = new Event_Hub();\r\n\r\nfunction Event_Hub() {\r\n    this.events = {};\r\n}\r\n\r\n\r\n\r\nEvent_Hub.prototype.add_event_listener = function (name, func, obj)\r\n{\r\n    if (!this.events[name]) {\r\n        this.events[name] = [];\r\n    }\r\n    this.events[name].push( {name: name, func: func, obj: obj} );\r\n}\r\n\r\nEvent_Hub.prototype.on  = Event_Hub.prototype.add_event_listener;\r\n\r\nEvent_Hub.prototype.emit = function(name, obj)\r\n{\r\n    var listeners = this.events[name];\r\n    if (listeners) {\r\n        for(var i = 0; i < listeners.length; i++) {\r\n            var t = listeners[i];\r\n            t.func.call(t.obj, obj);            \r\n        }\r\n    }\r\n}\r\n\r\n\r\nvar run_function = //window.requestAnimationFrame;\r\n\tfunction(callback){\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t}\r\n\r\n\r\nMy_Lib.create_run_function = function (app) \r\n{\r\n    My_Lib.run = function () { run_function( function () { app.loop(); }); }\r\n}\r\n\r\n\r\n\r\n\r\nMy_Lib.Euler_Controller = function (obj, x, y, z)\r\n{\r\n\tthis.obj = obj;\r\n\tthis.xspeed = x * Math.PI / 180;;\r\n\tthis.yspeed = y * Math.PI / 180;;\r\n\tthis.zspeed = z * Math.PI / 180;;\r\n}\r\n\r\nMy_Lib.Euler_Controller.prototype.update = function (dt)\r\n{\r\n\tthis.obj.rotation.x += this.xspeed * dt;\r\n\tthis.obj.rotation.y += this.yspeed * dt;\r\n\tthis.obj.rotation.z += this.zspeed * dt;\r\n}\r\n\r\n//Class Library\r\nMy_Lib.Registered_Classes = {};\r\n\r\nMy_Lib.Register_Class = function (name, func)\r\n{\r\n\tif (My_Lib.Registered_Classes[name]){\r\n\t\tconsole.log(\"Register Class ERROR! Class with this name already exists!\", name);\r\n\t}\r\n\tMy_Lib.Registered_Classes[name] = func;\r\n}\r\n\r\nMy_Lib.Get_Class = function (name)\r\n{\r\n\treturn My_Lib.Registered_Classes[name];\r\n}\r\n\r\n\r\nMy_Lib.create_class = function(parent, child, props, name)\r\n{\r\n    if (parent) {\r\n        child.prototype = Object.create(parent.prototype);\r\n    } \r\n    _.copy_object(child.prototype, props);\r\n    child.prototype.contructor = child;                \r\n    My_Lib.Register_Class(child, name);\r\n}\r\n\r\nMy_Lib.Abstract_Fabric = function (data)\r\n{\r\n    var constructor = My_Lib.Get_Class(data.type);\r\n    if (constructor) {\r\n        var object = new constructor();\r\n        object.parse(data);\r\n        return object;\r\n    }\r\n    return undefined;\r\n}\r\n\r\nMy_Lib.Print_Classes = function ()\r\n{\r\n    for(var key in this.Registered_Classes) {\r\n        console.log(\"class registered :\", key, this.Registered_Classes[key]);\r\n    }\r\n}\r\n\r\n\r\nexport { My_Lib };\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/base/my_lib.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\n//base class for particle affector\r\nfunction Particle_Affector()\r\n{\r\n    this.id = _.generateUUID();\r\n}\r\n\r\n\r\nParticle_Affector.prototype.affect = function (dt, pdata, vert, color)\r\n{\r\n\treturn true;\r\n}\r\n\r\nParticle_Affector.prototype.toJSON = function (child)\r\n{\r\n\tif (child) {\r\n\t\treturn {};\r\n\t}\r\n\tvar data = {\r\n        id: this.id,\r\n\t\t\"name\": \"Particle_Affector\",\r\n\t\tparams : {}\r\n\t};\r\n    if (child) {\r\n        return params;\r\n    }\r\n\treturn data;\r\n}\r\n\r\nParticle_Affector.prototype.parse = function (json)\r\n{\r\n}\r\n\r\nMy_Lib.Register_Class(\"Particle_Affector\", Particle_Affector);\r\n\r\nfunction Force_Affector()\r\n{\r\n    Particle_Affector.call(this);\r\n\tthis.forces = new Array();\r\n}\r\n\r\nForce_Affector.prototype = Object.create(Particle_Affector.prototype);\r\n\r\n_.copy_object(Force_Affector.prototype, {\r\n\tconstructor: Force_Affector,\r\n\tadd_force: function (force)\r\n\t{\r\n\t\tthis.forces.push(force);\r\n\t},\r\n\tapply_forces: function (dt, particle, vert, color)\r\n\t{\r\n\t\tvar acceleration = {x:0, y:0, z:0};\r\n\t\tfor(var i = 0; i < this.forces.length; i++) {\r\n\t\t\tthis.forces[i].calc(dt, particle, acceleration);\r\n\t\t}\r\n\t\t//integrate\r\n\t\tparticle.velocity.x += acceleration.x * dt;\r\n\t\tparticle.velocity.y += acceleration.y * dt;\r\n\t\tparticle.velocity.z += acceleration.z * dt;\r\n\t},\r\n\taffect: function (dt, particle, vert, color)\r\n\t{\r\n\t\tthis.apply_forces(dt, particle, vert, color);\r\n\t\treturn true;\r\n\t},\r\n\ttoJSON: function (child)\r\n\t{\r\n\t\tvar data = {};\r\n\t\tdata.name = \"Force_Affector\";\t\t\r\n        data.uuid = this.uuid;\r\n\t\tdata.params = Particle_Affector.prototype.toJSON.call(this, this);\r\n\t\tif (this.forces.length > 0) {\r\n\t\t\tdata.params.forces = new Array();\r\n\t\t\tfor(var i = 0; i < this.forces.length; i++) {\r\n\t\t\t\tdata.params.forces.push( this.forces[i].toJSON() );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tvar f, item;\r\n\t\tif (json.forces) {\r\n\t\t\t\t\r\n\t\t\tfor(var i =0; i < json.forces.length; i++) {\r\n\t\t\t\titem = json.forces[i];\r\n\t\t\t\tf = My_Lib.Get_Class(item.name);\r\n\t\t\t\tif (f) {\r\n\t\t\t\t\tf = new f();\r\n\t\t\t\t\tf.parse(item);\r\n\t\t\t\t\tthis.add_force(f);\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nMy_Lib.Register_Class(\"Force_Affector\", Force_Affector);\r\n\r\nexport { Particle_Affector, Force_Affector };\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particle_affector.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\n//Base class for Particle Emitters\r\nfunction Particle_Emitter(emit_per_second)\r\n{\r\n    this.uuid = _.generateUUID();\r\n    this.name = '';\r\n\tthis.emit_delta = 0;\r\n\tthis.emit_count = 0;\r\n\tthis.emit_per_second = emit_per_second || 5;\r\n\t//linear interpolation = min + random * (max-min)\t\r\n\tthis.lifetime = {\"min\": 0, \"max\":2.0};\r\n}\r\n\r\nParticle_Emitter.prototype.emit_life = function ()\r\n{\r\n\treturn this.lifetime.min + Math.random() * (this.lifetime.max - this.lifetime.min);\r\n}\r\n\r\nParticle_Emitter.prototype.calc_emitted_particles = function (dt)\r\n{\r\n\t//count particles need emit\r\n\tthis.emit_delta += this.emit_per_second*dt;\r\n\tvar need_emit = Math.floor(this.emit_delta);\r\n\tif (need_emit > 0) {\r\n\t\tthis.emit_delta -= need_emit;\r\n\t\t//this.emit_count += need_emit;\r\n\t\t//need_emit = this.emit_count;\r\n\t}\r\n\treturn need_emit;\r\n}\r\n\r\n\r\nParticle_Emitter.prototype.emit = function (p, c, matrix)\r\n{\r\n    p.position.set(0, 0, 0);\r\n    p.velocity.set(0, 1, 0);\r\n    \r\n    if (matrix) {\r\n        p.position.applyMatrix4(matrix);\r\n        p.velocity.applyMatrix4_rotation(matrix);\r\n    }\r\n}\r\n\r\n\r\nParticle_Emitter.prototype.toJSON = function (child)\r\n{\r\n\tvar params = {\r\n        \"uuid\": this.uuid,\r\n\t\t\"emit_per_second\": this.emit_per_second,\r\n\t\t\"lifetime\": {\r\n\t\t\t\"min\": this.lifetime.min,\r\n\t\t\t\"max\": this.lifetime.max\r\n\t\t},\r\n\t};\r\n    if (this.name) {\r\n        params.name = this.name;\r\n    }\r\n\tif (child) {\r\n\t\treturn params;\r\n\t}\r\n\tvar data = {};\r\n\tdata.name = \"Particle_Emitter\";\r\n\tdata.params = params;\t\r\n\treturn data;\r\n}\r\n\r\nParticle_Emitter.prototype.parse = function (data)\r\n{\r\n\tthis.emit_per_second = data.emit_per_second;\r\n    this.name = data.name;\r\n    this.uuid = data.uuid || _.generateUUID();\r\n\t_.copy_object(this.lifetime, data.lifetime);\r\n}\r\n\r\nMy_Lib.Register_Class(\"Particle_Emitter\", Particle_Emitter);\r\n\r\nexport { Particle_Emitter };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particle_emitter.js","    \r\nfunction Particles_Points (geometry, material)\r\n{\r\n    THREE.Points.call(this, geometry, material);\r\n    this.type = 'particles_points';\r\n    \r\n    this.boundingSphere = new THREE.Sphere();\r\n    this.boundingSphere.radius = 10.0;\r\n}\r\n\r\nParticles_Points.prototype = Object.create( THREE.Points.prototype )\r\n\r\nParticles_Points.prototype.constructor = Particles_Points;\r\n\r\nParticles_Points.prototype.toJSON = function (meta)\r\n{\r\n    var mat = this.material;\r\n    var geom = this.geometry;\r\n    this.material = undefined;\r\n    this.geometry = undefined;\r\n    var object =  THREE.Object3D.prototype.toJSON.call(this, meta);\r\n    this.material = mat;\r\n    this.geometry = geom;\r\n    return object;\r\n}\r\n\r\nParticles_Points.prototype.raycast = function (raycaster, intersects)\r\n{\r\n    var sphere = new THREE.Sphere()\r\n    sphere.copy( this.boundingSphere );\r\n    sphere.applyMatrix4( this.matrixWorld ); \r\n    var r = raycaster.ray.intersectsSphere( sphere );\r\n    if ( r === false ) return;\r\n    console.log(\"INTERSECTION1\", this.name, sphere);\r\n    return;\r\n    \r\n    var shit  = new THREE.Vector3();\r\n    shit.copy(this.position);\r\n    var tr = new THREE.Ray( new THREE.Vector3(0, 0, 20), shit);\r\n    console.log(\"test \", tr.intersectsSphere(sphere), sphere);\r\n    console.log(\"hit sphere \"  + this.name, sphere, raycaster.ray);\r\n    return raycaster.ray.intersectsSphere( sphere );\r\n    \r\n    \r\n    console.log(\"hit sphere \" + this.type, \"shpere is \", sphere, \"ray is \", r);\r\n    if (r) {\r\n            var tmp = new THREE.Vector3(this.position);\r\n            tmp.sub(r);\r\n   \t\t\tintersects.push( {\r\n\t\t\t\tdistance: Math.sqrt( tmp.dot(tmp) ),\r\n\t\t\t\tpoint: this.position,\r\n\t\t\t\tobject: this\r\n\t\t\t} ); \r\n    }\r\n}\r\n\r\n\r\nexport {Particles_Points};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particles_points.js","function Event_Hub() {\r\n    this.events = {};\r\n}\r\n\r\n\r\n\r\nEvent_Hub.prototype.add_event_listener = function (name, func, obj)\r\n{\r\n    if (!this.events[name]) {\r\n        this.events[name] = [];\r\n    }\r\n    this.events[name].push( {name: name, func: func, obj: obj} );\r\n}\r\n\r\nEvent_Hub.prototype.on  = Event_Hub.prototype.add_event_listener;\r\n\r\nEvent_Hub.prototype.emit = function(name, obj)\r\n{\r\n    var listeners = this.events[name];\r\n    if (listeners) {\r\n        for(var i = 0; i < listeners.length; i++) {\r\n            var t = listeners[i];\r\n            t.func.call(t.obj, obj);            \r\n        }\r\n    }\r\n}\r\n\r\nvar main_event_hub = new Event_Hub();\r\n\r\nexport {main_event_hub, Event_Hub};\n\n\n// WEBPACK FOOTER //\n// ./src/base/event_hub.js","var Mouse_Intersector = {};\r\n\r\n\r\nMouse_Intersector.get_normalized_screen_coords = function (canvas, x, y)\r\n{\r\n\tvar offset = canvas.getBoundingClientRect();\r\n\tvar width = canvas.clientWidth;\r\n\tvar height = canvas.clientHeight;\r\n    //normalize coordinates\r\n    var x = (x - offset.left) / width;\r\n    var y = (y - offset.top) / height;\r\n\tvar x = x * 2 - 1;\r\n\tvar y = -(y * 2 - 1);\r\n\tvar vector = new THREE.Vector3( x, y, 1 );\r\n\treturn vector;\r\n}\r\n\r\nMouse_Intersector.mouse_coords_to_vector = function (canvas, event) \r\n{\r\n    return this.get_normalized_screen_coords(canvas, event.clientX, event.clientY);\r\n}\r\n\r\n\r\nMouse_Intersector.unproject = function(vector, camera)\r\n{\r\n    var r = new THREE.Vector3();\r\n    r.copy(vector);\r\n    r.z = 1;\r\n\tr.unproject(camera);\r\n    //console.log(camera.matrixWorldInverse);\r\n    //r.applyMatrix4(camera.matrixWorldInverse);    \r\n    return r;\r\n}\r\n\r\nMouse_Intersector.mouse_coords_to_ray = function (canvas, event, camera) \r\n{\r\n    var vector = this.mouse_coords_to_vector(canvas, event);\r\n    vector = this.unproject(vector, camera);\r\n\tvar ray = new THREE.Ray( camera.position, vector.sub( camera.position ).normalize() );\r\n\treturn ray;\r\n}\r\n\r\n\r\n\r\nMouse_Intersector.find_intersection_with_mouse_vector = function(vector, camera, scene)\r\n{\r\n\tvector.unproject(camera);\r\n\tvar ray = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );\r\n\t// create an array containing all objects in the scene with which the ray intersects\r\n\t//var intersects = ray.intersectObjects( [grid_text.root], true ); \r\n\t//console.log(fake_plane.root.children[0].geometry);\r\n\tvar intersects = ray.intersectObjects( [scene], true ); \r\n\treturn intersects;\r\n}\r\n\r\n\r\n//this function return objects, which bounding sphere intersects with ray\r\nMouse_Intersector.find_intersection_with_bounding_sphere = function(object, fakecaster, intersects,recursive, level ) {\r\n\r\n    //if ( object.visible === false ) return;\r\n    \r\n\r\n\tobject.raycast( fakecaster, intersects );\r\n    //console.log(\"object intersects\", intersects);\r\n\r\n\tif ( !recursive) return;\r\n    \r\n    //hmm we use different check for top level object and their children\r\n    //that is not gud\r\n    //if object has children, and it children has geometry with boundingSphere,\r\n    //these get right check to intersection\r\n    //then after recursive call, it same object will be check by 'object.raycast' method\r\n    //which, i supposed, sucks\r\n    \r\n    var children = object.children;\r\n    //console.log(\"children instersects\");\r\n    var sphere = new THREE.Sphere();\r\n    for ( var i = 0; i < children.length; i ++ ) {\r\n        var child = children[i];\r\n        //for some reason, to be sure what matrixWorld contain truth, but is not identity \r\n        child.updateMatrixWorld(true);\r\n        if (child.geometry)  {\r\n            //copy sphere from object geometry and transform it with object. matrixWorld\r\n            sphere.copy( child.geometry.boundingSphere );\r\n            sphere.applyMatrix4( child.matrixWorld );\r\n            //find intersection\r\n            var inter = fakecaster.ray.intersectsSphere( sphere );\r\n            //console.log(\"inter with sphere, level\", level, inter, sphere.center, raycaster.ray);\r\n            if (inter) {\r\n                intersects.push(child);\r\n            }\r\n        } else {\r\n            this.find_intersection_with_bounding_sphere( children[ i ], fakecaster, intersects, true, level+1 );\r\n        }\r\n    }\r\n    if (level === 1) {\r\n        return intersects;\r\n    }\r\n}\r\n\r\nMouse_Intersector.find_intersected_object = function (scene, ray)\r\n{\r\n    var intersects = [];\r\n    var fakecaster = {ray: ray};\r\n    Mouse_Intersector.find_intersection_with_bounding_sphere( scene, fakecaster, intersects, true ); \r\n    return intersects;\r\n}\r\n\r\n\r\nexport { Mouse_Intersector };\n\n\n// WEBPACK FOOTER //\n// ./src/base/mouse_intersector.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\nfunction Color_Domain(r,g,b)\r\n{\r\n    this.color = new THREE.Color(r,g,b);\r\n    this.uuid = _.generateUUID();\r\n    this.name = '';\r\n    this.type = \"Color_Domain\";\r\n}\r\n\r\n_.copy_object(Color_Domain.prototype, {\r\n    toJSON: function (child)\r\n    {\r\n        var data = {};\r\n        data.uuid = this.uuid;\r\n        if (this.name !== '') {\r\n            data.name = this.name;\r\n        }\r\n        data.type = this.type;\r\n        data.color = {r: this.color.r, g: this.color.g, b: this.color.b};\r\n        return ;\r\n    },\r\n    parse: function (json)\r\n    {\r\n        this.uuid = json.uuid;\r\n        if (json.name !== undefined) {\r\n            this.name = json.name;\r\n        }\r\n        if (json.color !== undefined) {\r\n            this.color.set(json.color.r, json.color.g, json.color.b);\r\n        }\r\n    },\r\n    emit: function (color)\r\n    {\r\n        color.r = this.color.r;\r\n        color.g = this.color.g;\r\n        color.b = this.color.b;\r\n    },\r\n    fill: function (color, offset) \r\n    {\r\n        color[offset+0] = this.color.r;\r\n        color[offset+1] = this.color.g;\r\n        color[offset+2] = this.color.b;\r\n    }\r\n});\r\n\r\nMy_Lib.Register_Class('Color_Domain', Color_Domain);\r\n\r\nfunction Table_Color(table)\r\n{\r\n    if (table !== undefined) {\r\n        this.copy_table(table);        \r\n    } else {\r\n        this.default_table();\r\n    }\r\n}\r\n\r\nTable_Color.prototype = Object.create(Color_Domain);\r\n\r\n_.copy_object(Table_Color.prototype, {\r\n    constructor: Table_Color,\r\n    copy_table: function (table)\r\n    {\r\n        this.table = new Array(table.length);\r\n        for(var i = 0; i < table.length; i++) {\r\n            this.table = new THREE.Color(table[i]);\r\n        }\r\n    },\r\n    emit: function (color)\r\n    {\r\n        var index = Math.ceil(Math.random() * this.table.length) % this.table.length;\r\n        var src = this.table[index];\r\n        color.r = src.r;\r\n        color.g = src.g;\r\n        color.b = src.b;\r\n    },\r\n    fill: function (color, offset) \r\n    {\r\n        var index = Math.ceil(Math.random() * this.table.length) % this.table.length;\r\n        var src = this.table[index];\r\n        color[offset] = src.r;\r\n        color[offset+1] = src.g;\r\n        color[offset+2] = src.b;\r\n    },\r\n    default_table: function ()\r\n    {\r\n        this.table = new Array(8);\r\n        this.table[0] = new THREE.Color(1, 0, 0);\r\n        this.table[1] = new THREE.Color(0, 1, 0);\r\n        this.table[2] = new THREE.Color(0, 0, 1);\r\n        this.table[3] = new THREE.Color(1, 0, 1);\r\n        this.table[4] = new THREE.Color(1, 1, 0);\r\n        this.table[5] = new THREE.Color(1, 0.4, 0.4);\r\n        this.table[6] = new THREE.Color(0.5, 0.7, 0.98);\r\n        this.table[7] = new THREE.Color(0.9, 0.4, 0.4);\r\n    },\r\n    get: function ()\r\n    {\r\n        var r = {r: 0, g: 0, b: 0};\r\n        this.emit(r);\r\n        return r;\r\n    }\r\n});\r\n\r\nMy_Lib.Register_Class(\"Table_Color\", Table_Color);\r\n\r\nexport {Color_Domain, Table_Color};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/color_domain.js","var Particle_Shaders = {};\r\n\r\n(function () \r\n{\r\n\r\n//particle attributes:\r\n//position\r\n//color\r\n//left, size\r\nvar vertex_shader = [\r\n//'attribute vec4 position;',\r\n'attribute vec4 color;',\r\n'attribute float params;',\r\n'varying vec4 vcolor;',\r\n'uniform float lifetime;',\r\n'uniform float point_size;',\r\n'uniform vec2 screen_size;',\r\n'#ifndef DYNAMIC_COLORS',\r\n    'uniform vec3 particle_color;',\r\n'#endif',\r\n'void main () {',\r\n\t'gl_Position = projectionMatrix * viewMatrix * vec4( position, 1.0 );',\r\n'#ifdef DYNAMIC_COLORS',\r\n\t'vcolor.rgb = color.rgb;',\r\n'#else',\r\n    'vcolor.rgb = particle_color.rgb;',\r\n'#endif',\r\n'#ifdef NO_FADE_COLOR',\r\n\t'vcolor.a = 1.0;',\r\n'#else',\r\n\t//params contains life length which decreased by time\r\n\t'float tmp = params / lifetime;',\r\n\t'tmp = min(tmp, 1.0);',\t\r\n\t'vcolor.a = tmp;',\r\n'#endif',\r\n\t'float t =  screen_size.y* projectionMatrix[1][1] / gl_Position.w;',\r\n\t't = t * point_size;',\r\n\t'if (params > 0.0) {',\r\n\t\t'gl_PointSize = t;',\r\n\t'}',\r\n\t'else {',\r\n\t\t//'vcolor.a = 0.0;',\r\n\t\t'gl_PointSize = 0.0;',\r\n        'gl_Position.z = -1000.0;',\r\n\t'}',\r\n'}'\r\n];\r\n\r\nvar fragment_shader = [\r\n\t'varying vec4 vcolor;',\r\n\t'#ifdef PARTICLE_TEXTURE',\r\n\t\t'uniform sampler2D sprite;',\r\n\t'#endif',\r\n\t'void main() {',\r\n\t'#ifdef PARTICLE_TEXTURE',\r\n\t\t'vec4 tex = texture2D( sprite, gl_PointCoord );',\r\n\t\t'vec3 fragment_color = tex.rgb;',\r\n\t\t'fragment_color.rgb *= vcolor.rgb;',\r\n\t\t'float alpha = tex.a;',\t\r\n\t'#else',\r\n\t\t'vec3 fragment_color = vcolor.rgb;',\r\n\t\t'float alpha = 1.0;',\r\n\t'#endif',\r\n\t'#ifdef PRE_ALPHA',\r\n\t\t'fragment_color.rgb *= alpha;',\r\n\t'#endif',\r\n\t'#ifndef NO_FADE_COLOR',\r\n\t\t'float fragment_alpha = alpha * vcolor.a;',\r\n\t'#else',\r\n\t\t'float fragment_alpha = alpha;',\r\n\t'#endif',\r\n\t\t'gl_FragColor = vec4(fragment_color.rgb, fragment_alpha);',\r\n\t'}',\r\n];\r\n\r\nParticle_Shaders.vertex = vertex_shader.join( '\\n' );\r\nParticle_Shaders.fragment = fragment_shader.join( '\\n' );\r\n})();\r\n\r\nexport {Particle_Shaders};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particle_shaders.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\nimport {Particles_Points} from './particles_points.js';\r\nimport {Particle_Shaders} from './particle_shaders.js';\r\nimport {Color_Domain} from './color_domain.js';\r\n\r\n\r\nfunction Particle_System(data)\r\n{\r\n    this.uuid = _.generateUUID();    \r\n    \r\n    this.params = this.config_params(data);\r\n\r\n  \r\n\tthis.emitter = this.params.emitter;\r\n\tthis.affector = this.params.affector;    \r\n    this.particle_lifetime = this.params.particle_lifetime;\r\n    this.texture = this.params.texture;\r\n\t\r\n\tthis.dynamic_color = false;\r\n\r\n\tvar count = this.params.count;\r\n\t\r\n\tthis.material = this.create_particle_material();\r\n\tthis.node = new Particles_Points(this.create_particle_geometry(count), this.material);\r\n    this.node.name = this.name;\r\n    this.node.boundingSphere.radius = this.params.bounding_radius;\r\n\r\n}\r\n\r\n\r\nParticle_System.prototype.config_params = function (data)\r\n{\r\n    var params = \r\n    {\r\n    };\r\n    //default\r\n    params.particle_lifetime = 3.0;\r\n    params.no_fade_color = false;\r\n    params.pre_alpha = true;\r\n    params.depth_test = true;\r\n    params.depth_write = false;\r\n    params.color  = {\"r\":1, \"g\":1, \"b\":1};\r\n\tparams.blending = \"one_alpha\";\r\n    params.size = 1;\r\n    params.count = 100;\r\n    params.name = '';\r\n    params.bounding_radius = 2.0;\r\n    params.discrete_emission = false;\r\n    params.apply_world_matrix_on_emit = true;\r\n    \r\n    for(var key in data) {\r\n        if (Object.prototype.hasOwnProperty.call(data, key)){\r\n            if (data[key] !== undefined) {\r\n                params[key] = data[key];\r\n            }\r\n        }\r\n    }\r\n    \r\n\tparams.emitter = data.emitter || new Particle_Emitter(1);\r\n\tparams.affector = data.affector || new Particle_Affector();\r\n    \r\n    return params;\r\n}\r\n\r\nParticle_System.prototype.set_name = function (name)\r\n{\r\n    this.name = name;\r\n    this.node.name = name;\r\n}\r\n\r\nParticle_System.prototype.suicide = function ()\r\n{\r\n\tthis.node.parent.remove(this.node);\r\n    main_event_hub.emit(\"kill_me\", this);\r\n}\r\n\r\n\r\nParticle_System.prototype.create_particle_data = function (count)\r\n{\r\n    var particle_data = new Array(count);\r\n    var p;\r\n    for(var i =0;i < count; i++) {\r\n\t\tp = {};\r\n\t\tp.position = new THREE.Vector3(0,0,0);\r\n\t\tp.velocity = new THREE.Vector3(0,0,0);\r\n\t\tp.lifetime = 0;        \r\n\t\tparticle_data[i] = p;\r\n    }\r\n    this.particle_data = particle_data;\r\n}\r\n\r\nParticle_System.prototype.create_particle_geometry = function(count)\r\n{\r\n    this.create_particle_data(count);\r\n    \r\n\tvar vertices = new Float32Array(count * 3); // position\r\n\tvar colors = new Float32Array(count * 3);\r\n\tvar params = new Float32Array(count);\r\n\t\r\n    for (var i = 0; i < count; i++) {\r\n\t\t//create particle\r\n\t\tvertices[i*3] = 0;\r\n\t\tvertices[i*3+1] = 0;\r\n\t\tvertices[i*3+2] = 0;\r\n\r\n\t\tparams[i] = 0.0;\r\n        \r\n        if (this.params.color_domain) {\r\n            this.params.color_domain.fill(colors, i*3);\r\n        } else {\r\n            colors[i*3] = this.params.color.r;\r\n            colors[i*3+1] = this.params.color.g;\r\n            colors[i*3+2] = this.params.color.b;\r\n       }\r\n\t}\r\n\r\n\tthis.geometry = {};\r\n\tthis.geometry.vertices = new THREE.BufferAttribute(vertices, 3).setDynamic(true);\r\n\tthis.geometry.colors = new THREE.BufferAttribute(colors, 3)\r\n\tif (this.dynamic_color) {\r\n\t\tthis.geometry.colors.setDynamic(true);\r\n\t}\r\n\tthis.geometry.params = new THREE.BufferAttribute(params, 1).setDynamic(true);\r\n\tvar geom = new THREE.BufferGeometry(); \t\r\n\tthis.geometry.buffer = geom;\t\r\n\tgeom.addAttribute('position', this.geometry.vertices);\r\n\tgeom.addAttribute('color', this.geometry.colors);\r\n\tgeom.addAttribute('params', this.geometry.params);\t\r\n\r\n    return geom;\r\n}\r\n\r\n\r\nParticle_System.prototype.discrete_emit = function (count)\r\n{\r\n    this.emit_particles(0, count);\r\n\tthis.geometry.vertices.needsUpdate = true;\r\n\tthis.geometry.params.needsUpdate = true;\r\n\tthis.geometry.colors.needsUpdate = true;\r\n}\r\n\r\n\r\nParticle_System.prototype.emit_particles = function (dt, need_emit)\r\n{\r\n\t//emit particles\r\n\tvar p;\r\n\tvar verts = this.geometry.vertices.array;\r\n\tvar params = this.geometry.params.array;\r\n\t\r\n    var old_need_emit = need_emit;\r\n    this.node.updateMatrixWorld(true);\r\n    var matrix = this.node.matrixWorld;\r\n\tfor(var i =0; i < this.particle_data.length && need_emit > 0; i++) {\r\n\t\tif (!(params[i] > 0)) {\r\n        \r\n\t\t\tp = this.particle_data[i];\r\n\t\t\tthis.emitter.emit(p, null, matrix);\r\n\t\t\tp.lifetime = this.particle_lifetime;\r\n            \r\n\t\t\tverts[i*3] = p.position.x;\r\n\t\t\tverts[i*3+1] = p.position.y;\r\n\t\t\tverts[i*3+2] = p.position.z;\r\n\t\t\tparams[i] = p.lifetime;\r\n\t\t\tneed_emit--;\r\n\t\t\t//colors[i*3] = this.params.color.r\r\n\t\t\t//colors[i*3+1] = this.params.color.g;\r\n\t\t\t//colors[i*3+2] = this.params.color.b;\r\n\t\t}\r\n\t}\r\n    //console.log(\"created new particles \", old_need_emit - need_emit);\r\n}\r\n\r\nParticle_System.prototype.update_particle_geometry = function (dt)\r\n{\r\n\tvar verts = this.geometry.vertices.array;\r\n\tvar params = this.geometry.params.array;\r\n\tvar p;\r\n\tvar vert = new THREE.Vector3(0,0,0);\r\n\tvar dummy_color = {\"r\":1, \"b\":1, \"g\":1};\r\n\tfor(var i = 0; i < this.particle_data.length; i++) {\r\n\t\r\n\t\tif (params[i] > 0) {\r\n\t\t\tp = this.particle_data[i];\r\n\t\t\t\r\n\t\t\t//integrate\r\n\t\t\tp.position.x += p.velocity.x * dt;\r\n\t\t\tp.position.y += p.velocity.y * dt;\r\n\t\t\tp.position.z += p.velocity.z * dt;\r\n\t\t\tp.lifetime -= dt;\r\n\t\t\t\r\n\t\t\tif (p.lifetime <= 0 || !this.affector.affect(dt, p, vert, dummy_color)) {\r\n\t\t\t\tp.lifetime = 0;\r\n\t\t\t}\r\n\t\t\tparams[i] = p.lifetime;\t\t\t\r\n\t\t\tverts[i*3] = p.position.x;\r\n\t\t\tverts[i*3+1] = p.position.y;\r\n\t\t\tverts[i*3+2] = p.position.z;\r\n\t\t}\r\n\t}\r\n\r\n    if (!this.params.discrete_emission) {\r\n        var need_emit = this.emitter.calc_emitted_particles(dt);\r\n        this.emit_particles(dt, need_emit);\r\n    }\r\n\t\r\n\tthis.geometry.vertices.needsUpdate = true;\r\n\tthis.geometry.params.needsUpdate = true;\r\n\tthis.geometry.colors.needsUpdate = true;\r\n}\r\n\r\n\r\n\r\n\r\nParticle_System.prototype.update = function (dt)\r\n{\r\n\tthis.update_particle_geometry(dt);\r\n}\r\n\r\n\r\nParticle_System.prototype.generate_material_name = function ()\r\n{\r\n\tvar my_name = \"MY_PARTICLE_MATERIAL\";\r\n\tif (!!this.texture) {\r\n\t\tmy_name +=  \"_WITH_TEXTURE\";\r\n\t}\r\n\tif (this.params.no_fade_color) {\r\n\t\tmy_name += \"_NO_FADE_COLOR\";\r\n\t}\r\n\treturn my_name;\r\n}\r\n\r\nParticle_System.prototype.blending_mode = \r\n{\r\n\t\"additive\": {\r\n\t\t\"blendSrc\": THREE.OneFactor,\r\n\t\t\"blendDst\": THREE.OneFactor\r\n\t},\r\n\t\"alpha\": {\r\n\t\t\"blendSrc\": THREE.SrcAlphaFactor,\r\n\t\t\"blendDst\": THREE.OneMinusSrcAlphaFactor\r\n\t},\r\n\t\"one_alpha\": {\r\n\t\t\"blendSrc\": THREE.OneFactor,\r\n\t\t\"blendDst\": THREE.OneMinusSrcAlphaFactor\r\n\t},\r\n\t\"alpha_one\": {\r\n\t\t\"blendSrc\": THREE.SrcAlphaFactor,\r\n\t\t\"blendDst\": THREE.OneFactor\r\n\t}\r\n};\r\n\r\nParticle_System.prototype.convert_blending_mode = function (blending)\r\n{\r\n    var three_blending;\r\n\tvar factors = this.blending_mode[\"one_alpha\"];\r\n    if (blending === 'no') {\r\n        three_blending = THREE.NoBlending;\r\n    } else {\r\n        three_blending = THREE.CustomBlending;    \r\n        if (this.blending_mode[blending]) {\r\n            factors = this.blending_mode[blending];\r\n        }\r\n    }\r\n    return {\"blending\": three_blending, \"factors\":factors};\r\n}\r\n\r\nParticle_System.prototype.set_texture = function (texture)\r\n{\r\n\tif (typeof texture === 'string') {\r\n        if (this.params.texture === texture) {\r\n            return;\r\n        }\r\n        this.params.texture = texture;\r\n\t\tthis.texture = My_Lib.Texture_Manager.get(texture);\r\n\t} else {\r\n        console.error(\"Oh Shit! texture in set_texture is not string! it's object or undefined!\", texture);\r\n    }\r\n\r\n    if (this.material.uniforms.sprite) {\r\n        this.material.uniforms.sprite.value = this.texture;\r\n    } else {\r\n        //this.material.uniforms.sprite = {value: texture};\r\n        this.recreate_material();\r\n        console.error(\"Oh Shit! Our shader has not texture! Need create shader with texture!\");\r\n    }\r\n}\r\n\r\n\r\nParticle_System.prototype.create_uniforms = function ()\r\n{\r\n    var uniforms = \r\n    {\r\n        \"lifetime\": {\r\n            value: this.particle_lifetime\r\n        },\r\n        \"point_size\": {\r\n            value: this.params.size\r\n        },\r\n        \"screen_size\": {\r\n            value: new THREE.Vector2(My_Lib.Viewport.width, My_Lib.Viewport.height)\r\n        }\r\n    };\r\n    if (!!this.texture) {\r\n        uniforms[\"sprite\"] = {\r\n            value: this.texture\r\n        }\r\n    };\r\n    if (!this.dynamic_color) {\r\n        uniforms[\"particle_color\"] = {value: this.params.color};\r\n    }\r\n    return uniforms;\r\n}\r\n\r\nParticle_System.prototype.calc_defines = function ()\r\n{\r\n    var defines = {};\r\n    if (this.params.pre_alpha) {\r\n        defines[\"PRE_ALPHA\"] = true;\r\n    }\r\n\tif (!!this.texture) {\r\n        defines[\"PARTICLE_TEXTURE\"] = true;\r\n    }\r\n    if (this.params.no_fade_color) {\r\n        defines[\"NO_FADE_COLOR\"] = true;\r\n    }\r\n    if (this.params.color_domain) {\r\n        defines[\"DYNAMIC_COLORS\"] = true;\r\n    }\r\n    return defines;\r\n}\r\n\r\n\r\nParticle_System.prototype.select_texture = function (texture)\r\n{\r\n\tif (typeof this.texture === 'string') {\r\n\t\tthis.texture = My_Lib.Texture_Manager.get(this.texture);\r\n        if (!this.texture) {\r\n            console.error(\"Oh, not found texture <\" + this.params.texture + \"> in create particle material! Instead get \"+this.texture);\r\n        }\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.create_particle_material = function()\r\n{\r\n\t\r\n    this.select_texture(this.texture);\r\n    \r\n    var blend_obj = this.convert_blending_mode(this.params.blending);\r\n    \r\n    \r\n    var uniforms = this.create_uniforms();\r\n    var defines = this.calc_defines();\r\n    \r\n\tvar mat = new THREE.ShaderMaterial({\r\n\t\ttransparent: true,\r\n\t\tdepthWrite: this.params.depth_write,\r\n\t\tdepthTest: this.params.depth_test,\r\n        blending: blend_obj.blending,\r\n        blendSrc: blend_obj.factors.blendSrc,\r\n        blendDst: blend_obj.factors.blendDst,\r\n\t\tdefines: defines,\r\n\t\tuniforms: uniforms,\r\n\t\tvertexShader: Particle_Shaders.vertex,\r\n\t\tfragmentShader: Particle_Shaders.fragment\r\n\t});\r\n\treturn mat;\r\n}\r\n\r\nParticle_System.prototype.recreate_material = function ()\r\n{\r\n    this.node.material = this.material = this.create_particle_material();\r\n}\r\n\r\n\r\nParticle_System.prototype.set_pre_alpha = function (pre_alpha)\r\n{\r\n    if (this.params.pre_alpha !== !!pre_alpha) {\r\n        this.params.pre_alpha = pre_alpha;\r\n        this.recreate_material();\r\n    }\r\n}\r\n\r\nParticle_System.prototype.set_point_size = function (size)\r\n{\r\n    if (this.params.size != size) {\r\n        this.params.size = size;\r\n        this.node.material.uniforms[\"point_size\"].value = size;\r\n    }\r\n}\r\n\r\nParticle_System.prototype.set_blending = function (blending)\r\n{\r\n    this.params.blending = blending;\r\n    var b = this.convert_blending_mode(blending);\r\n    this.material.blending = b.blending;\r\n    this.material.blendSrc = b.factors.blendSrc;\r\n    this.material.blendDst = b.factors.blendDst;\r\n}\r\n\r\n\r\n\r\n\r\nParticle_System.prototype.toJSON = function ()\r\n{\r\n\tvar data = {};\r\n    data.uuid = this.uuid;\r\n    data.node = this.node.uuid;\r\n    if (this.name || this.node.name) {\r\n        data.name = this.name || this.node.name;\r\n    }\r\n\tdata.params = {};\r\n\tif (this.params) {\r\n\t\t_.copy_object(data.params, this.params);\r\n\t}\r\n\tdata.params.emitter = this.emitter.toJSON();\r\n\tdata.params.affector = this.affector.toJSON();\r\n\treturn data;\r\n}\r\n\r\n\r\nParticle_System.prototype.set_emitter = function (emitter)\r\n{\r\n    this.emitter = this.params.emitter = emitter;\r\n}\r\n\r\nParticle_System.prototype.set_particle_life_length = function (val)\r\n{\r\n\tif (val !== this.params.particle_lifetime) {\r\n\t\tthis.params.particle_lifetime = this.particle_lifetime = val;\r\n\t\tthis.material.uniforms['lifetime'].value = val;\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.set_emission_per_second = function (val)\r\n{\r\n\tthis.emitter.emit_per_second = val;\r\n}\r\n\r\nParticle_System.prototype.set_particle_count = function (count)\r\n{\r\n\tif (count !== this.particle_data.length) {\r\n\t\tthis.params.count = count;\r\n\t\tthis.node.geometry = this.create_particle_geometry(count);\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.set_color = function (color)\r\n{\r\n    this.params.color.r = color.r;\r\n    this.params.color.g = color.g;\r\n    this.params.color.b = color.b;\r\n}\r\n\r\nParticle_System.prototype.set_bounding_sphere_radius = function (radius)\r\n{\r\n    this.node.boundingSphere.radius = radius;\r\n}\r\n\r\nexport {Particle_System};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particles.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\nimport {Particles_Points} from './particles_points.js';\r\nimport {Particle_System} from './particles.js';\r\n\r\n\r\n function Particle_Manager ()\r\n{\r\n\tthis.particles = {};\r\n    this.particles_array = [];\r\n}\r\n\r\n_.copy_object(Particle_Manager.prototype, \r\n    {\r\n    constructor: Particle_Manager,\r\n    add:  function (ps,name)\r\n    {\r\n        if (!this.particles[name]) {\r\n            this.particles[name] = ps;\r\n            this.particles_array.push(ps);\r\n        }\r\n    },\r\n    remove_particles:  function (name)\r\n    {\r\n        var ps = this.particles[name];\r\n        var i = this.particles_array.indexOf(ps);\r\n        if (i >= 0) {\r\n            this.particles_array.splice(i, 1);\r\n        }\r\n        if (ps) {\r\n            ps.suicide();\r\n            delete this.particles[name];\r\n        }\r\n    },\r\n    get_particle_names:  function ()\r\n    {\r\n        var names = [];\r\n        for(var key in this.particles) {\r\n            names.push(key);\r\n        }\r\n        return names;\r\n    },\r\n\r\n    update : function (dt)\r\n    {\r\n        for(var i = 0; i < this.particles_array.length; i++) {\r\n            this.particles_array[i].update(dt);\r\n        }\r\n    },\r\n    \r\n    create_by_params: function (params)\r\n    {\r\n        var ps = new Particle_System(params);\r\n        this.add(ps);\r\n        return ps;\r\n    },\r\n\r\n\r\n    toJSON : function ()\r\n    {\r\n        var arr = []\r\n        \r\n        var data;\r\n        var p;\r\n        for(var key in this.particles){\r\n            p = this.particles[key];\r\n            if (p.uuid) {\r\n                data = p.toJSON();\r\n                arr.push(data);\r\n            }\r\n        }\r\n\r\n        return arr;\r\n    },\r\n\r\n    emitter_fabric:  function (params)\r\n    {\r\n        if (params.emitter) {\r\n            var emitter = My_Lib.Get_Class(params.emitter.name);\r\n            if (emitter) {\r\n                emitter = new emitter();\r\n            } else {\r\n                emitter = new Particle_Emitter();\r\n            }\r\n            emitter.parse(params.emitter.params);\r\n            return emitter;        \r\n        } \r\n        return undefined;\r\n    },\r\n\r\n    affector_fabric:  function (params)\r\n    {\r\n        if (params.affector) {\r\n            var affector = My_Lib.Get_Class(params.affector.name);\r\n            if (affector) {\r\n                affector = new affector();\r\n            } else {\r\n                affector = new Particle_Affector();\r\n            }\r\n            affector.parse(params.affector.params);\r\n            return affector;\r\n        }\r\n        return undefined;\r\n    },\r\n\r\n    fromJSON: function (json, callback, root, name)\r\n    {\r\n        if (this.particles[name]) {\r\n            console.log(\"WARNING Particle Manager! Particle System with this name already exists\", name);\r\n        }\r\n        \r\n        try\r\n        {\r\n            var data = JSON.parse(json);\r\n        }\r\n        catch (e)\r\n        {\r\n            console.log(\"error parsing json on \", name, json);\r\n            throw e;\r\n        }\r\n        \r\n        return this.parse(data, root, name);\r\n    },\r\n\r\n\r\n    parse: function (data, root, name)\r\n    {\r\n        var emitter = this.emitter_fabric(data.params);\r\n        var affector = this.affector_fabric(data.params);\r\n        data.params.emitter = emitter;\r\n        data.params.affector = affector;\r\n        \r\n        var ps = new Particle_System(data.params);\r\n        ps.set_name(data.name);\r\n\r\n            //add to scene graph\r\n        if (data.params.parent) {\r\n            var parent = root.getObjectByName(data.params.parent);\r\n            //console.log(data.params.parent, \"parent particles\", name, root);\r\n            parent.add(ps.node);\r\n        } else {\r\n           root.add(ps.node);\r\n        }\r\n\r\n        //ugly fucking hack\r\n        //copy node properties\r\n        this.add(ps, name);    \r\n        return ps;\r\n    },\r\n\r\n    load_particles:  function (json, root)\r\n    {\r\n        var particles = json.particles;\r\n        for(var i =0; i < particles.length; i++)\r\n        {\r\n            var p = particles[i];\r\n            var ps = this.parse(p, root, p.name);\r\n            ps.node.uuid = p.node;\r\n            ps.node.name = p.name;\r\n            var obj = root.getObjectByProperty(\"uuid\", p.node);\r\n            if (obj) {\r\n                ps.node.replace_object_with_this(obj);\r\n            }\r\n        }\r\n    },\r\n\r\n    create_name:  function ()\r\n    {\r\n        var number = this.particles_array.length + 1;\r\n        var begin_name = 'Particle_System_';\r\n        var testing = true;\r\n        while (testing) {\r\n            name = begin_name + number;\r\n            if (this.particles[name] !== undefined) {\r\n                number ++;\r\n            } else {\r\n                return name;\r\n            }\r\n        }\r\n    },\r\n\r\n    create_new : function ()\r\n    {\r\n        var name = this.create_name();\r\n        \r\n        var params = {};\r\n        var ps = new My_Lib.Particle_System(params);\r\n        ps.set_name(name);\r\n        this.add(ps, name);\r\n        return ps;\r\n    }\r\n});\r\n\r\n\r\nif (My_Lib.particle_manager === undefined) \r\n{\r\n    My_Lib.particle_manager = new Particle_Manager();\r\n}\r\n\r\nMy_Lib.Particles_Config = {\r\n\"box_size\": 10\r\n};\r\n\r\n\r\nexport {Particle_Manager};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particles_manager.js","var Point_Generators = {};\r\n\r\n\r\nPoint_Generators.Random_Direction = function ()\r\n{\r\n}\r\n\r\nPoint_Generators.Random_Direction.prototype.get_direction = function (vector)\r\n{\r\n\tvector.x = Math.random(); \r\n\tvector.y = Math.random(); \r\n\tvector.z = Math.random();\r\n}\r\n\r\nPoint_Generators.Sphere = function (radius)\r\n{\r\n\tthis.radius = radius;\r\n}\r\n\r\nPoint_Generators.Sphere.prototype.get_inner_point = function (vector)\r\n{\r\n\tvar alpha = Math.random() * Math.PI * 2;\r\n\tvar beta = Math.random() * Math.PI;\r\n\tvector.x = Math.cos(alpha) * Math.sin(beta);\r\n\tvector.y = Math.cos(beta);\r\n\tvector.z = Math.sin(alpha) * Math.sin(beta);\r\n}\r\n\r\nPoint_Generators.Sphere.prototype.get_normal = function (vector)\r\n{\r\n\tvector.x = Math.random() * 2 - 1;\r\n\tvector.y = Math.random() * 2 - 1;\r\n\tvector.z = Math.random() * 2 - 1;\r\n\tvector.normalize();\r\n}\r\n\r\nPoint_Generators.Sphere.prototype.get_point = function (vector) \r\n{\r\n\tthis.get_normal(vector);\r\n\tvector.multiplyScalar(this.radius);\r\n}\r\n\r\n\r\nexport {Point_Generators};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/point_generators.js","/*\r\nmain class\r\nthis has abstract virtual methods\r\nstart - which create renderer and conduct start initializations\r\nupdate - updated scene objects, animations, phisics\r\nrender - control scene rendering\r\nthis methods must rewrite on derived classes\r\nneed set \r\nPROPERTIES\r\nmain_camera - camera which point of view render whole scene and user interacts\r\ndom_screen - dom element which contain canvas and display scene\r\nrenderer - three.js renderer\r\ncanvas - is created by three.js renderer, it have to append to dom_screen children, fuck it\r\ncanvas width and height defining on creating it by renderer, fuck it\r\n\r\n\r\n\r\n*/\r\n\r\nimport {My_Lib} from '../base/my_lib.js';\r\nimport {main_event_hub, Event_Hub} from '../base/event_hub.js';\r\nimport {Mouse_Intersector} from '../base/mouse_intersector.js';\r\n\r\n\r\nfunction Application (config)\r\n{\r\n\r\n    this._lifecycle_event(\"before_created\");\r\n   \r\n    this._init_timer();\r\n    this._create_loop_function();\r\n    \r\n\tthis.mouse_controllers = [];\r\n    \r\n    main_event_hub.add_event_listener(\"kill_me\", function (obj) {\r\n        this.remove_animated_object(obj);\r\n    }, this);\r\n}\r\n\r\nApplication.prototype.start = function (config)\r\n{\r\n    console.log(\"start application...\");\r\n   this._set_configuration(config);\r\n}\r\n\r\nApplication.prototype._lifecycle_event = function (name, event)\r\n{\r\n    if (this[name]) {\r\n        return this[name](event);\r\n    }\r\n    return false;\r\n}\r\n\r\n\r\nApplication.prototype._init_timer = function ()\r\n{\r\n\tthis.clock = new THREE.Clock();\t\r\n\tthis.delta_time = 0;\r\n\tthis.animated_objects = [];\r\n}\r\n\r\n\r\nvar run_function = //window.requestAnimationFrame;\r\n\tfunction(callback){\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t}\r\n\t\r\n\r\n\r\nApplication.prototype._create_loop_function = function ()\r\n{\r\n    var self = this;\r\n\tthis.run = function ()\r\n\t{\r\n\t\trun_function(function () \r\n\t\t{ \r\n\t\t\tself.loop();\r\n            //main_event_hub.emit(\"new_frame\");\r\n\t\t});\r\n\t}\r\n\t\r\n    //My_Lib.create_run_function(this);\r\n    \r\n    //main_even_hub.add_event_listener(\"new_frame\", this.loop, this);    \r\n}\r\n\r\n\r\nApplication.prototype.get_default_configuration = function ()\r\n{\r\n    return {\r\n        \"dom_element\": \"screen\",\r\n        \"render_params\": {\r\n            \"premultipliedAlpha\": true,\r\n            \"alpha\": true\r\n        },\r\n        \"viewport\": {\r\n            \"width\": 800,\r\n            \"height\": 600\r\n         },\r\n         \"clear_color\": 0x0000FF,\r\n        \"main_camera\": {\r\n            \"fov\": 80,\r\n            \"near\": 0.1,\r\n            \"far\": 1000,\r\n            \"aspect_ratio\": 1.3333333333333333,\r\n            \"position\": {\r\n                \"x\": 0,\r\n                \"y\": 0,\r\n                \"z\": 0\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\nApplication.prototype._create_render = function (json)\r\n{\r\n    if (this.dom_screen || this.renderer) {\r\n        alert(\"Create render alert! Something strange happenes!\");\r\n    }\r\n    if (!this.dom_screen) {\r\n        this.dom_screen = document.getElementById(json.dom_element);\r\n    }\r\n    if (!this.renderer) {\r\n        this.renderer = new THREE.WebGLRenderer(json.render_params);\r\n    }\r\n    if (!!!this.dom_screen || typeof this.dom_screen === 'undefined') {\r\n        console.error(\"Some terrorous happens! dom element for screen not found! element id is \" + json.dom_element);\r\n    }\r\n    //console.log(\"found dome element \" + json.dom_element);\r\n    this.dom_screen.appendChild(this.renderer.domElement);\r\n    this.canvas = this.renderer.domElement;\r\n    \r\n    \r\n    this.renderer.setSize(json.viewport.width, json.viewport.height);\r\n    this.set_viewport(json.viewport.width, json.viewport.height);\r\n    this.renderer.setClearColor(json.clear_color);\r\n    \r\n    this._lifecycle_event(\"render_created\");\r\n}\r\n\r\nApplication.prototype._create_main_scene = function (json)\r\n{\r\n    var event = {prevent: false};\r\n    this._lifecycle_event(\"before_create_main_scene\", event);\r\n    /*\r\n    if (event.prevent) {\r\n        return;\r\n    }\r\n    */\r\n    if (!this.main_scene) {\r\n        this.main_scene = new THREE.Scene();\r\n    }\r\n    \r\n    var camera = json.main_camera;    \r\n    if (!this.main_camera) {\r\n        this.main_camera = new THREE.PerspectiveCamera(camera.fov, camera.aspect_ratio, camera.near, camera.far);\r\n        this.main_scene.add(this.main_camera);\r\n        this.main_camera.name = \"main_camera\";\r\n    } else {\r\n        this.main_camera.fov = camera.fov;\r\n        this.main_camera.near = camera.near;\r\n        this.main_camera.far = camera.far;\r\n        this.main_camera.aspect = camera.aspect_ratio;\r\n        this.main_camera.updateProjectionMatrix();\r\n    }\r\n    \r\n    this.main_camera.position.set(camera.position.x, camera.position.y, camera.position.z);\r\n}\r\n\r\nApplication.prototype.apply_configuration = function (json)\r\n{\r\n    this.configuration = json;\r\n    this._create_render(json);\r\n    this._create_main_scene(json);\r\n    this._lifecycle_event(\"created\");\r\n}\r\n\r\nApplication.prototype.load_configuration = function (url)\r\n{\r\n    var xhr = new THREE.XHRLoader();\r\n    \r\n    var self = this;\r\n    \r\n    var config = self.get_default_configuration();\r\n    \r\n    var configuration_is_applied = false;\r\n    \r\n    function onload (data) {\r\n        console.log(\"configuration loaded from url <<\" + url + \">>\");\r\n        var obj = JSON.parse(data);\r\n        //user config append to default config and may rewrite them, \r\n        //though user naven't to rewrite ALL config to change some params\r\n        _.copy_object(config, obj);\r\n        self.apply_configuration(config);\r\n        console.log(configuration_is_applied, \"onload\");        \r\n        configuration_is_applied = true;\r\n    }\r\n    function progress() {}\r\n    function error(event) {\r\n        console.error(\"Error on loading config!\", event.target.status);\r\n        console.log(\"Setting default configuration\");\r\n        console.log(configuration_is_applied, \"error\");        \r\n        configuration_is_applied = true;        \r\n        self.apply_configuration(config);\r\n    }\r\n    xhr.load(url, onload, progress, error);\r\n}\r\n\r\n\r\nApplication.prototype._set_configuration = function (config)\r\n{\r\n    var default_config = this.get_default_configuration();\r\n    \r\n    //this is url of configuration file\r\n    if (typeof config === 'string') {\r\n        console.log(\"get configuration from url >> \" + config);\r\n        this.load_configuration(config);\r\n        \r\n        //this is object filled with data\r\n    } else if (typeof config === 'object') {\r\n        console.log(\"get configuration from user object\");\r\n        _.copy_object(default_config,config);\r\n        this.apply_configuration(default_config);\r\n    //configuration not given, use default\r\n    } else {\r\n        console.log(\"_set_configuration: set default configration\");\r\n       this.apply_configuration(default_config);\r\n    }\r\n}\r\n\r\nApplication.extend = function (methods, child_func)\r\n{\r\n\r\n    var Child;\r\n    if (typeof child_func === 'undefined') {\r\n        Child = function ()\r\n        {\r\n            Application.apply(this, arguments);\r\n        }\r\n    } else {\r\n        Child = child_func;\r\n    }\r\n\r\n    //create new object and set prototype chain\r\n\tChild.prototype = Object.create(Application.prototype);\r\n    //copy methods to new object\r\n\t_.copy_object(Child.prototype, methods);\r\n    Child.prototype.constructor = Child;\r\n   \r\n    return Child;\r\n}\r\n\r\nApplication.extend_proto = function (proto, methods)\r\n{\r\n\tvar obj = Object.create(proto);\r\n\t_.copy_object(obj, methods);\r\n\tApplication.call(obj);\r\n\treturn obj;\r\n}\r\n\r\n\r\nApplication.prototype.loop = function () \r\n{\r\n\tvar delta = this.clock.getDelta();\r\n\t//fix this - add options to control min frame rate\r\n\tif (delta > 0.1) {\r\n\t\tdelta = 0.1;\r\n\t}\r\n\tthis.delta_time = delta;\r\n    this.do_update(delta);\r\n\tthis.update(delta);\r\n\tthis.render(delta);\r\n\tthis.run();\r\n    //My_Lib.run();\r\n}\r\n\r\n\r\n\r\nApplication.prototype.add_animated_object = function (obj)\r\n{\r\n\t//fix probably duplicates\r\n\tthis.animated_objects.push(obj);\r\n}\r\n\r\nApplication.prototype.remove_animated_object = function (obj)\r\n{\r\n\tfor(var i = 0; i < this.animated_objects.length; i++) {\r\n\t\tif (this.animated_objects[i] === obj) {\r\n\t\t\tthis.animated_objects.splice(i, 1);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\nApplication.prototype.update_all = function (delta)\r\n{\r\n\tvar obj;\r\n\tfor(var i = 0, len = this.animated_objects.length; i < len; i++) {\r\n\t\tobj = this.animated_objects[i];\r\n\t\tif (obj[\"update\"]) {\r\n\t\t\tobj.update(delta);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nApplication.prototype.pre_update = function (delta)\r\n{\r\n\tthis.update_all(delta);\r\n    My_Lib.particle_manager.update(delta);\r\n    //event\r\n    if (this.before_update !== undefined) {\r\n        this.before_update(delta);\r\n    }\r\n}\r\n\r\n\r\nApplication.prototype.do_update = function (dt)\r\n{\r\n    this.pre_update(dt);\r\n    this.update(dt);\r\n}\r\n\r\nApplication.prototype.update = function (delta)\r\n{\r\n}\r\n\r\n\r\nApplication.prototype.create_mouse_move_listener = function ()\r\n{\r\n\tif (this[\"mouse_move_listener\"]) {\r\n\t\treturn;\r\n\t}\r\n\tvar self = this;\r\n\tthis.mouse_move_listener = true;\r\n\tfunction mouse_move_listener(event) {\r\n\t\tvar vector = Mouse_Intersector.mouse_coords_to_vector(self.dom_screen, event);\t\t\r\n\t\tself.find_mouse_over_intersections(vector);\r\n\t};\r\n\tdocument.addEventListener(\"mousemove\", mouse_move_listener);\r\n}\r\n\r\nApplication.prototype.find_mouse_over_intersections = function(vector)\r\n{\r\n\tvector.unproject(this.main_camera);\r\n\tvar ray = new THREE.Raycaster( this.main_camera.position, vector.sub( this.main_camera.position ).normalize() );\r\n\tvar obj;\r\n\tfor(var i =0, len = this.mouse_controllers.length; i < len; i++){\r\n\t\tobj = this.mouse_controllers[i];\r\n\t\tif (obj.over) {\r\n\t\t\t// create an array containing all objects in the scene with which the ray intersects\r\n\t\t\t//var intersects = ray.intersectObjects( [grid_text.root], true ); \r\n\t\t\t//console.log(fake_plane.root.children[0].geometry);\r\n\t\t\tvar intersects = ray.intersectObjects( [obj.root], true ); \r\n\t\t\tobj.callback(intersects);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nApplication.prototype.add_mouse_controller = function (root, over, click, callback)\r\n{\r\n\tvar tmp = new My_Lib.Mouse_Controller(root, over, click, callback)\r\n\tthis.mouse_controllers.push( tmp );\r\n\tif (over) {\r\n\t\tthis.create_mouse_move_listener();\r\n\t}\r\n\treturn tmp;\r\n}\r\n\r\n\r\n\r\nApplication.prototype.set_viewport = function (width, height)\r\n{\r\n\tMy_Lib.Viewport.width = width;\r\n\tMy_Lib.Viewport.height = height;\r\n}\r\n\r\nApplication.prototype.render = function (delta) \r\n{\r\n\tthis.renderer.setClearColor(this.configuration.clear_color);\r\n\tthis.renderer.autoClear = true;\r\n\tthis.renderer.render(this.main_scene, this.main_camera);\r\n}\r\n\r\n\r\n\r\nexport {Application};\n\n\n// WEBPACK FOOTER //\n// ./src/app/application.js","import {My_Lib} from './my_lib.js';\r\n\r\n//length - simple length of animations\r\n//-1 - infinite\r\n//0 - stop\r\n//> 0 - length of animation, \r\n//if time > length, animation stop\r\n//need rewrite this crap to safe floating point mannere\r\n//and append more controle on animation \r\n    function Base_Animation ()\r\n    {\r\n        this.time = 0;\r\n        this.time_scale = 1.0;\r\n        this.type = \"Base_Animation\";\r\n        this.uuid = _.generateUUID();\r\n        this.length = -1;\r\n        this.stopped = false;\r\n    }\r\n    \r\n    Base_Animation.prototype.update = function (dt)\r\n    {\r\n        var scaled_dt = dt * this.time_scale;\r\n        this.time += scaled_dt;\r\n        if (this.length < 0 || this.time < this.length) {\r\n            this.calc_animation(dt);\r\n        }\r\n    }\r\n    \r\n    Base_Animation.prototype.stop = function ()\r\n    {\r\n        this.stopped = true;\r\n    }\r\n    \r\n    Base_Animation.prototype.start = function ()\r\n    {\r\n        this.stopped = false;\r\n    }\r\n    \r\n    Base_Animation.prototype.reset = function ()\r\n    {\r\n        this.time = 0;\r\n    }\r\n    \r\n    Base_Animation.prototype.calc_animation = function (dt)\r\n    {\r\n        \r\n    }\r\n    \r\n    Base_Animation.prototype.apply = function(obj)\r\n    {\r\n    }\r\n    \r\n    Base_Animation.prototype.toJSON = function (data)\r\n    {\r\n        var data = {};\r\n        data.uuid = this.uuid;\r\n        data.type = this.type;\r\n        if (this.name !== '') {\r\n            data.name = this.name;\r\n        }\r\n        data.time_scale = this.time_scale;\r\n        data.length = this.length;\r\n        return data;\r\n    }\r\n    \r\n    Base_Animation.prototype.parse = function (param)\r\n    {\r\n        this.type = param.type;\r\n        this.uuid = param.uuid;\r\n        this.name = param.name ? param.name : '';\r\n        this.time_scale = (param.time_scale === undefined) ? 1.0 : param.time_scale;\r\n        this.length = param.length === undefined ? 0 : param.length;\r\n    }\r\n    \r\n\r\n    \r\n    \r\n        \r\nfunction Euler_Animation (x, y, z)\r\n{\r\n    Base_Animation.call(this);\r\n    this.type = \"Euler_Animation\";\r\n\tthis.xspeed = x;\r\n\tthis.yspeed = y;\r\n\tthis.zspeed = z;\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.z = 0;\r\n    this.name = '';\r\n}\r\n\r\nEuler_Animation.prototype = Object.create(Base_Animation.prototype);\r\n\r\n\r\nEuler_Animation.prototype.constructor = Euler_Animation;\r\n\r\nEuler_Animation.prototype.calc_animation = function (dt)\r\n{\r\n    dt *= this.time_scale;\r\n\tthis.x += this.xspeed * dt;\r\n\tthis.y += this.yspeed * dt;\r\n\tthis.z += this.zspeed * dt;\r\n}\r\n    \r\nEuler_Animation.prototype.apply = function (obj)\r\n{\r\n    obj.rotation.x = this.x;\r\n    obj.rotation.y = this.y;\r\n    obj.rotation.z = this.z;\r\n}\r\n\r\nEuler_Animation.prototype.toJSON = function (json)\r\n{\r\n   var data = Base_Animation.prototype.toJSON.call(this);\r\n   data.xspeed = this.xspeed;\r\n   data.yspeed = this.yspeed;\r\n   data.zspeed = this.zspeed;\r\n   return data;\r\n}\r\n\r\nEuler_Animation.prototype.parse = function (param)\r\n{\r\n    Base_Animation.prototype.parse.call(this, param);\r\n    this.xspeed = param.xspeed;\r\n    this.yspeed = param.yspeed;\r\n    this.zspeed = param.zspeed;\r\n    this.x = this.y = this.z = 0;    \r\n}\r\n\r\n\r\nfunction Scale_Animation(x, y, z)\r\n{\r\n    Base_Animation.call(this);\r\n    //speed of scale\r\n    this.xscale = x;\r\n    this.yscale = y;\r\n    this.zscale = z;\r\n    this.x = 1.0;\r\n    this.y = 1.0;\r\n    this.z = 1.0;\r\n}\r\n\r\nScale_Animation.prototype = Object.create(Base_Animation.prototype);\r\n\r\n_.copy_object(Scale_Animation.prototype, {\r\n    constructor: Scale_Animation,\r\n    calc_animation: function (dt) \r\n    {\r\n        dt = dt * this.time_scale;\r\n        this.x += this.xscale * dt;\r\n        this.y += this.yscale * dt;\r\n        this.z += this.zscale * dt;\r\n    },\r\n    apply:function (obj) {\r\n        obj.scale.set(this.x, this.y, this.z);\r\n    },\r\n    reset: function () {\r\n        this.x = 1.0;\r\n        this.y = 1.0;\r\n        this.z = 1.0;\r\n        this.time = 0;\r\n    }\r\n});\r\n\r\n\r\nMy_Lib.Register_Class(\"Base_Animation\", Base_Animation);\r\nMy_Lib.Register_Class(\"Euler_Animation\", Euler_Animation);\r\nMy_Lib.Register_Class(\"Scale_Animation\", Scale_Animation);\r\n\r\n\r\nexport { Base_Animation, Euler_Animation, Scale_Animation };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/base/animations.js","import {My_Lib} from './my_lib.js';\r\n\r\n//events: \r\n//item_loaded\r\n//onerror\r\n//onprogress\r\n//finished\r\nfunction Chain_Loader()\r\n{\r\n}\r\n\r\nChain_Loader.prototype = {\r\n\tconstructor: Chain_Loader,\r\n\tstart: function (list) \r\n\t{\r\n\t\tthis.list = list;\r\n\t\tthis.index = 0;\r\n\t\tthis.load(this.list[0]);\r\n\t\tthis.stop_by_error = false;\r\n\t},\r\n\t\r\n\tnext: function(resource)\r\n\t{\r\n\t\tif (this.item_loaded && resource) {\r\n\t\t\tthis.item_loaded(resource,this.list[this.index]);\r\n\t\t}\r\n\t\tthis.index++;\r\n\t\tif (this.index < this.list.length) {\r\n\t\t\tthis.load(this.list[this.index]);\r\n\t\t} else {\r\n\t\t\tif (this.finished) {\r\n\t\t\t\tthis.finished();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdo_error: function (error)\r\n\t{\r\n\t\tif (this.onerror) {\r\n\t\t\tthis.onerror(error);\r\n\t\t} else {\r\n\t\t\tconsole.error(\"Chain Loader Error!\", error);\r\n\t\t}\r\n\t\tif (!this.stop_by_error) {\r\n\t\t\tthis.next();\r\n\t\t}\r\n\t},\r\n\t\r\n\tdo_progress: function ()\r\n\t{\r\n\t\tif (this.onprogress) {\r\n\t\t\tthis.onprogress.apply(this, arguments);\r\n\t\t}\r\n\t},\r\n\t\t\r\n\tload: function (item)\r\n\t{\r\n\t\tvar self = this;\r\n\t\tif (this.load_func) {\r\n\t\t\tthis.load_func(item, \r\n\t\t\tfunction (item) { self.next.apply(self, arguments); },\r\n\t\t\tfunction (item) { self.do_error.apply(self, arguments); },\r\n\t\t\tfunction (item) { self.do_progress.apply(self, arguments); });\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\nfunction test_chain_loader() \r\n{\r\n\tvar cl = new Chain_Loader();\r\n\tcl.item_loaded = function (item) {console.log(\"load item \", item);}\r\n\tcl.finished = function (item) {console.log(\"loader manager - job done\");}\r\n\tcl.load_func = function (item, next, error, progress) { \r\n\t\tif (item) {\r\n\t\t\tnext(item);\r\n\t\t} else {\r\n\t\t\terror(item);\r\n\t\t}\r\n\t}\r\n\tcl.start([\"first\", \"second\", null, \"tree\"]);\r\n}\r\n//test_chain_loader();\r\n\r\n\r\n\r\n\r\nfunction Loading_Manager ()\r\n{\r\n\tthis.resources = {};\r\n\tthis.texture_loader = new THREE.TextureLoader();\r\n}\r\n\r\nLoading_Manager.prototype = {\r\n\tconstructor: Loading_Manager,\r\n\tget: function (name)\r\n\t{\r\n\t\treturn this.resources[name];\r\n\t},\r\n\t\r\n\tget_async: function (name, callback)\r\n\t{\r\n\t\t//already loaded?\r\n\t\tvar texture = this.get(name);\r\n\t\tif (texture) {\r\n\t\t\tif (callback) {\r\n\t\t\t\tcallback(texture);\r\n\t\t\t}\r\n\t\t\treturn texture;\r\n\t\t}\r\n\r\n\t\t//if not load this async\r\n\t\tvar self = this;\r\n\t\ttexture = this.texture_loader.load(name, function (texture)\r\n\t\t{\r\n\t\t\tif (callback) {\r\n\t\t\t\tcallback(texture);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.resources[name] = texture;\t\r\n\t\treturn texture;\r\n\t},\r\n\t\r\n\r\n\tload_list: function (resource_list, on_load, load_func, on_progress)\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar cl = new Chain_Loader();\r\n\t\tvar self = this;\r\n\t\tcl.onerror = function (error) {\r\n\t\t\tconsole.error(\"ERROR loading texture\", error, cl.list[cl.index]);\t\r\n\t\t}\r\n\t\tcl.item_loaded = function (resource, name) {\r\n\t\t\tself.resources[name] = resource;\r\n\t\t\tif (self.on_resource_loaded) {\r\n\t\t\t\tself.on_resource_loaded(resource);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcl.on_progress = function () {\r\n\t\t\tif (on_progress) {\r\n\t\t\t\ton_progress();\r\n\t\t\t}\r\n\t\t}\r\n\t\tcl.load_func = function () {\r\n\t\t\tload_func.apply(this, arguments);\r\n\t\t}\r\n\t\tcl.finished = function ()\r\n\t\t{\r\n\t\t\tif (on_load) {\r\n\t\t\t\ton_load();\r\n\t\t\t}\r\n\t\t}\r\n\t\tcl.start(resource_list);\r\n\t\t\r\n\t},\r\n\r\n\tload_list_textures: function (resource_list, on_load)\r\n\t{\r\n\t\tvar self = this;\r\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress ) \r\n\t\t{\r\n\t\t\tvar texture = self.texture_loader.load(url, next, progress, error);\r\n\t\t});\r\n\t},\r\n\r\n\tload_list_json: function (resource_list, on_load, progress)\r\n\t{\r\n\t\tvar self = this;\r\n\t\tvar loader = new THREE.XHRLoader();\t\r\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress) \r\n\t\t{\r\n\t\t\tvar texture = loader.load(url, next, progress, error);\r\n\t\t}, progress);\r\n\t},\r\n\t\r\n\tfree: function ()\r\n\t{\r\n\t\tthis.resources = {};\r\n\t}\r\n};\r\n\r\n\r\nMy_Lib.Texture_Manager = new Loading_Manager();\t\r\n\r\nexport { Loading_Manager };\n\n\n// WEBPACK FOOTER //\n// ./src/base/loading_manager.js","//TODO: remove this ugly crap and replace something reasonable\r\n\r\nimport {My_Lib} from './my_lib.js';\r\n\r\n//this ugly class loading texture list in json format, parse it, and loading textures\r\n//then it call event data_loaded, when give texture list in json format\r\n\r\nfunction Package_Manager()\r\n{\r\n    this.state = {};\r\n}\r\n\r\n//load json file with descriptions of package: texture list, particles list, scene objects list\r\nPackage_Manager.prototype.load = function (url, defaults)\r\n{\r\n    this.defaults = defaults;\r\n    var self = this;\r\n    this.state = {\r\n        \"type\": \"start\"\r\n    };\r\n    \r\n    var self = this;\r\n    function onload (data) {\r\n        self.state[\"type\"] = \"done\";\r\n        self.state[\"data\"] = data;\r\n        \r\n        self.parse_package_description(data);        \r\n    }    \r\n    function error(event) {\r\n        self.state[\"type\"] = \"error\";\r\n        self.state[\"error\"] = event;\r\n        console.error(\"ERror! Failed loading resources with url \"+url, event.target);        \r\n        if (self.error){\r\n            self.error(event.target);\r\n        }\r\n        self.pack = self.defaults\r\n        self.load_resources(self.defaults);\r\n\r\n    }\r\n    function progress()\r\n    {\r\n    }\r\n    var xhr = new THREE.XHRLoader();\r\n    xhr.load(url, onload, progress, error);\r\n}\r\n\r\n//parse loaded json file \r\nPackage_Manager.prototype.parse_package_description = function (data)\r\n{\r\n    console.log(\"packaged description loaded, begin parsing...\");\r\n  try {\r\n        var pack = JSON.parse(data);\r\n        this.pack = pack;\r\n        if (this.loaded) {\r\n            this.loaded(pack);\r\n        }\r\n        \r\n   } \r\n   catch(e) {\r\n        console.error(\"error parsing resources \", e);\r\n        if (this.error){\r\n            this.error(event);\r\n        }\r\n        return;        \r\n   }\r\n   this.load_resources(pack);\r\n}\r\n\r\n\r\nPackage_Manager.prototype.load_resources = function (pack)\r\n{\r\n    var self = this;\r\n    //load textures\r\n   console.log(\"Package Manager: begin loading textures...\");    \r\n    My_Lib.Texture_Manager.load_list_textures(pack.textures, function (){\r\n        //load json descriptions files\r\n                if (self.data_loaded) {\r\n                    self.data_loaded(pack);\r\n                }\r\n    })\r\n}\r\n\r\n\r\nexport { Package_Manager };\n\n\n// WEBPACK FOOTER //\n// ./src/base/package_manager.js","import {My_Lib} from './my_lib.js';\r\nimport {Particle_Manager} from '../particles/particles_manager.js'\r\n\r\nfunction Scene_Serializer(root)\r\n{\r\n    this.animation_library = {};\r\n}\r\n\r\nScene_Serializer.prototype.toJSON = function (root)\r\n{\r\n    this.json = root.toJSON();\r\n    console.log(\"my lib particle manager\", My_Lib.particle_manager);\r\n    this.json[\"particles\"] = My_Lib.particle_manager.toJSON();\r\n    var anims = root.collect_animations(root);\r\n    if (anims.count > 0) {\r\n        this.json[\"myanimations\"] = anims;\r\n    }\r\n    \r\n    return this.json;\r\n}\r\n\r\n\r\n\r\nScene_Serializer.prototype.create_animations = function (animations) {\r\n    for(var key in animations) {\r\n        if ( this.animation_library[key] === undefined && Object.prototype.hasOwnProperty.call(animations, key)) {\r\n            var data = animations[key];\r\n            //console.log(\"create animations \", data.uuid);            \r\n            var anim =  My_Lib.Abstract_Fabric(data);\r\n            if (anim) {\r\n                this.animation_library[key] = anim;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nScene_Serializer.prototype.bind_animations = function (animdata)\r\n{\r\n    if (!animdata) return;\r\n    \r\n    var bindings = animdata.bindings;\r\n    \r\n    \r\n    var self = this;\r\n    function copy_animations(obj, bind)\r\n    {\r\n        for(var i = 0; i < bind.animations.length; i++){\r\n            var anim_uuid = bind.animations[i];\r\n            obj.add_animation( self.animation_library[anim_uuid] );\r\n        }\r\n    }\r\n    \r\n     for(var i =0; i < bindings.length; i++) {\r\n        var bind = bindings[i];\r\n        var uuid = bind.uuid;\r\n        var obj = this.root.getObjectByProperty(\"uuid\", uuid);\r\n        if (obj) {\r\n            copy_animations(obj, bind);\r\n        }\r\n    }\r\n}\r\n\r\n\r\nScene_Serializer.prototype.load_from_json = function (url)\r\n{\r\n    var self = this;\r\n    function onload(json)\r\n    {\r\n        try {\r\n            var data = JSON.parse(json);\r\n        }\r\n        catch(e) {\r\n            console.error(\"Failed to parse scene \", e);\r\n            throw e;\r\n        }\r\n        if (data === undefined) {\r\n            console.error(\"Something fucking happened, failed to load scene \", url);\r\n            return;\r\n        }\r\n        self.load(data);\r\n    }\r\n    function progress()\r\n    {\r\n    }\r\n    function error(e)\r\n    {\r\n        console.error(e.target);\r\n        throw e;\r\n    }\r\n    var xhr = new THREE.XHRLoader();\r\n    xhr.load(url, onload, progress, error);\r\n}\r\n\r\nScene_Serializer.prototype.load = function (json)\r\n{\r\n    this.animation_library = {};\r\n    var o = new THREE.ObjectLoader();\r\n    if (json !== undefined) {\r\n        this.json = json;\r\n    }\r\n    var root = o.parse(this.json, function () {console.log(\"onload\")});\r\n    this.root = root;    \r\n\r\n    My_Lib.particle_manager.load_particles(this.json, root);\r\n    \r\n    this.create_animations(this.json.myanimations.animations);\r\n    this.bind_animations(this.json.myanimations);\r\n    this.main_camera = root.getObjectByName(\"main_camera\");\r\n    \r\n    if (this.scene_loaded) {\r\n        this.scene_loaded(root);\r\n    }\r\n    return root;\r\n}\r\n\r\nexport { Scene_Serializer };\n\n\n// WEBPACK FOOTER //\n// ./src/base/scene_serializer.js","function Mix_It()\r\n{\r\n\r\n\t//FIX\r\n\tTHREE.Vector3.prototype.applyMatrix4_rotation = function ( m ) \r\n\t{\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;\r\n\r\n\t\treturn this;\r\n \t}\r\n\r\nvar Object3D_Animation_Mixin = {\r\n    \r\n    add_animation: function (anim)\r\n    {\r\n        if (!this.animations) {\r\n            this.animations = [];\r\n        }\r\n        if (this.animations.indexOf(anim) < 0) {\r\n            this.animations.push(anim);\r\n        }\r\n    },\r\n    \r\n    remove_animation: function (anim)\r\n    {\r\n        if (this.animations) {\r\n            var i = this.animations.indexOf(anim);\r\n            if (i > -1) {\r\n                this.animations.splice(i, 1);\r\n            }\r\n        }\r\n    },\r\n    \r\n    update:  function (dt)\r\n    {\r\n        if (this.animations !== undefined) {\r\n            for(var i =0; i < this.animations.length; i++) {\r\n                var anim = this.animations[i];\r\n                anim.update(dt);\r\n                anim.apply(this);\r\n            }\r\n        }\r\n    \r\n        for(var i = 0; i < this.children.length; i++) {\r\n            var obj = this.children[i];\r\n            if (obj.update) {\r\n                obj.update(dt);\r\n            }\r\n        }\r\n    },\r\n    \r\n    \r\n};\r\n_.copy_object(THREE.Object3D.prototype, Object3D_Animation_Mixin);\r\n\r\n\r\nTHREE.Object3D.prototype.old_toJson = THREE.Object3D.toJSON;\r\n\r\nvar Object3D_Serialization_Mixin = \r\n{\r\n    standard_serialization: function (meta) \r\n    {\r\n\t\t// standard Object3D serialization\r\n\t\tvar object = {};\r\n\r\n\t\tobject.uuid = this.uuid;\r\n\t\tobject.type = this.type;\r\n\t\tif ( this.name !== '' ) object.name = this.name;\r\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) object.userData = this.userData;\r\n\t\tif ( this.castShadow === true ) object.castShadow = true;\r\n\t\tif ( this.receiveShadow === true ) object.receiveShadow = true;\r\n\t\tif ( this.visible === false ) object.visible = false;\r\n\r\n\t\tobject.matrix = this.matrix.toArray();\r\n        \r\n\r\n        if (this.type !== \"particles_points\")\r\n        {\r\n            if (this.geometry !== undefined) {\r\n                object.geometry = this.geometry.uuid;\r\n            }\r\n            if ( this.material !== undefined ) {\r\n                object.material = this.material.uuid;\r\n            }\r\n            \r\n            if ( this.material !== undefined  &&  meta.materials[ this.material.uuid ] === undefined ) {\r\n                    meta.materials[ this.material.uuid ] = this.material.toJSON( meta);\r\n            }\r\n\r\n            if ( this.geometry !== undefined && meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n                    meta.geometries[ this.geometry.uuid ] = this.geometry.toJSON( meta );\r\n            }\r\n        }\r\n        \r\n        if (this.animations) {\r\n            object.animations = [];\r\n            for(var i =0; i < this.animations.length; i++) {\r\n                object.animations.push ( this.animations[i].uuid );\r\n            }\r\n        }\r\n        \r\n\t\tif ( this.children.length > 0 ) {\r\n\t\t\tobject.children = [];\r\n\t\t\tfor ( var i = 0; i < this.children.length; i ++ ) \r\n            {\r\n                var child = this.children[ i ];\r\n\t\t\t\t//object.children.push( child.standard_serialization( meta ) );\r\n                object.children.push( child.toJSON( meta ) );\r\n\t\t\t}\r\n\t\t}\r\n        return object;\r\n    },\r\n    \r\n    collect_materials: function (meta) \r\n    {\r\n\t\tif ( this.material !== undefined  &&  meta.materials[ this.material.uuid ] === undefined ) {\r\n                meta.materials[ this.material.uuid ] = this.material.toJSON( meta);\r\n\t\t}\r\n        \r\n\t\tfor ( var i = 0; i < this.children.length; i ++ ) {\r\n\t\t\tthis.children[ i ].collect_materials(meta);\r\n\t\t}\r\n    },\r\n    \r\n    collect_geometry: function (meta)\r\n    {\r\n\t\tif ( this.geometry !== undefined && meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n\t\t\t\tmeta.geometries[ this.geometry.uuid ] = this.geometry.toJSON( meta );\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < this.children.length; i ++ ) {\r\n\t\t\tthis.children[ i ].collect_geometry(meta);\r\n\t\t}\r\n    },\r\n    \r\n\ttoJSON1: function ( meta ) {\r\n    \r\n\t\t// extract data from the cache hash\r\n\t\t// remove metadata on each item\r\n\t\t// and return as array\r\n\t\tfunction extractFromCache( cache, t ) {\r\n\t\t\tvar values = [];\r\n\t\t\tfor ( var key in cache ) {\r\n\t\t\t\tvar data = cache[ key ];\r\n\t\t\t\tdelete data.metadata;\r\n\t\t\t\tvalues.push( data );\r\n\t\t\t}\r\n\t\t\treturn values;\r\n\t\t}\r\n    \r\n\r\n        this.updateMatrixWorld(true);\r\n        \r\n\t\t// meta is '' when called from JSON.stringify\r\n\t\tvar isRootObject = ( meta === undefined || meta === '' );\r\n\r\n\t\tvar output = {};\r\n\r\n\t\tif ( isRootObject ) {\r\n\r\n            meta = {\r\n\t\t\t\tgeometries: {},\r\n\t\t\t\tmaterials: {},\r\n\t\t\t\ttextures: {},\r\n\t\t\t\timages: {}\r\n\t\t\t};\r\n            \r\n            \r\n            //this.collect_materials(meta);\r\n            //this.collect_geometry(meta);\r\n            var object = this.standard_serialization(meta);\r\n            \r\n            \r\n\t\t\toutput.metadata = {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'Object',\r\n\t\t\t\tgenerator: 'Object3D.toJSON'\r\n\t\t\t};\r\n\r\n\t\t\tvar geometries = extractFromCache( meta.geometries, \"geoim\" );\r\n\t\t\tvar materials = extractFromCache( meta.materials, \"materials\" );\r\n\t\t\tvar textures = extractFromCache( meta.textures, \"textures\" );\r\n\t\t\tvar images = extractFromCache( meta.images, \"images\" );\r\n\r\n\t\t\tif ( geometries.length > 0 ) output.geometries = geometries;\r\n\t\t\tif ( materials.length > 0 ) output.materials = materials;\r\n\t\t\tif ( textures.length > 0 ) output.textures = textures;\r\n\t\t\tif ( images.length > 0 ) output.images = images;\r\n\r\n            var anims = this.collect_animations(this);\r\n            if (anims.count > 0) {\r\n                output[\"myanimations\"] = anims;\r\n            }\r\n           \r\n            output.object = object;\r\n\t\t} else {\r\n            output.object = this.standard_serialization(meta);\r\n            output.type = this.type;\r\n            if (output.object === undefined) {\r\n                console.log(\"i am undefined\", this);\r\n            }\r\n        }\r\n\r\n\t\treturn output;\r\n\r\n\r\n\t},\r\n    \r\n    collect_animations: function (scene)\r\n    {\r\n        var data = {\r\n            animations : {},\r\n            bindings : [],\r\n            count: 0\r\n        };\r\n        \r\n        function collect_animations_recursive(root)\r\n        {\r\n            if (root.animations) {\r\n                for(var i =0; i < root.animations.length; i++) {\r\n                    var anim = root.animations[i];\r\n                    if (data.animations[ anim.uuid ] === undefined) {\r\n                        data.animations[ anim.uuid] = anim.toJSON() ;\r\n                        data.count++;\r\n                    }\r\n                }\r\n                \r\n                var bind = {};\r\n                bind.uuid = root.uuid\r\n                bind.animations = [];\r\n                for(var i =0; i < root.animations.length; i++) {\r\n                    bind.animations.push( root.animations[i].uuid);\r\n                }\r\n                data.bindings.push(bind);\r\n            }\r\n            \r\n            if (root.children) {\r\n                for(var i = 0; i < root.children.length; i++) {\r\n                    collect_animations_recursive( root.children[i] );\r\n                }\r\n            }\r\n        }\r\n        collect_animations_recursive(scene);\r\n        return data;\r\n    },\r\n    \r\n \r\n};\r\n\r\n\r\n  _.copy_object(THREE.Object3D.prototype, Object3D_Serialization_Mixin);\r\n  \r\n    \r\n\r\n//replace source with this\r\nTHREE.Object3D.prototype.replace_object_with_this = function ( source ) {\r\n\r\n    this.uuid = source.uuid;\r\n    this.name = source.name;\r\n\r\n    this.up.copy( source.up );\r\n    this.position.copy( source.position );\r\n    this.quaternion.copy( source.quaternion );\r\n    this.scale.copy( source.scale );\r\n\r\n    this.matrix.copy( source.matrix );\r\n    this.matrixWorld.copy( source.matrixWorld );\r\n\r\n    this.matrixAutoUpdate = source.matrixAutoUpdate;\r\n    this.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\r\n\r\n    this.visible = source.visible;\r\n\r\n    this.castShadow = source.castShadow;\r\n    this.receiveShadow = source.receiveShadow;\r\n\r\n    this.frustumCulled = source.frustumCulled;\r\n    this.renderOrder = source.renderOrder;\r\n\r\n    this.userData = JSON.parse( JSON.stringify( source.userData ) );\r\n\r\n    //copy array of children, not clone\r\n    for ( var i = 0; i < source.children.length; i ++ ) {\r\n        this.add( source.children[ i ] );\r\n    }\r\n    source.parent.add(this);\r\n    source.parent.remove(source);\r\n    \r\n    this.animations = source.animations;\r\n}\r\n\r\n\r\n}\r\n\r\nMix_It();\r\n\r\nexport {Mix_It};\n\n\n// WEBPACK FOOTER //\n// ./src/base/threejs_mixins.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\n\r\nfunction Custom_Affector()\r\n{\r\n\tParticle_Affector.apply(this, arguments);\r\n    this.custom_func = function dummy () {return true;};\r\n}\r\n\r\n\r\nCustom_Affector.prototype = Object.create(Particle_Affector.prototype);\r\n\r\n_.copy_object(Custom_Affector.prototype, \r\n    {\r\n    constructor: Custom_Affector,\r\n   \taffect: function (dt, pdata, vert)\r\n\t{\r\n        return this.custom_func(dt, p, vert);\r\n\t},\r\n    test_func: function () {\r\n        var p = {\r\n            position: {x: 0, y: 0, z: 0},\r\n            velocity: {x: 0, y: 0, z: 0}\r\n        };\r\n        var color = {r: 0, g: 0, b: 0};\r\n        this.custom_func(p, color);\r\n    },\r\n    set_affect_function: function (source) {    \r\n        if (typeof source === 'function') {\r\n            this.custom_func = source;\r\n        } else if (typeof source  === 'string') {\r\n            try {\r\n                this.custom_func = new Function ('dt,p,vert', source);\r\n                this.test_func();\r\n            }\r\n            catch (e) {\r\n                alert(e);\r\n                this.custom_func = undefined;\r\n            }\r\n            this.source_code = source;\r\n        }\r\n    },\r\n    \r\n\ttoJSON: function ()\r\n\t{\r\n        var data = {\r\n            name: \"Custom_Affector\"\r\n        };\r\n\t\tdata.params = My_Lib.Particle_Affector.prototype.toJSON.call(this, this);\r\n\t\tparams[\"source_code\"] = this.source_code;\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tMy_Lib.Particle_Affector.prototype.parse(this, json);\r\n\t\tthis.set_affect_func(json.source_code);\r\n\t}\r\n\r\n});\r\n\r\nMy_Lib.Register_Class(\"Custom_Affector\", Custom_Affector);\r\n\r\nexport {Custom_Affector};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/custom_affector.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\n\r\n\r\nfunction Custom_Emitter()\r\n{\r\n\tParticle_Emitter.apply(this, arguments);\r\n}\r\n\r\n\r\nCustom_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\n\r\nvar methods = {\r\n    emit: function (p, color) {\r\n        if (this.custom_func) {\r\n            this.custom_func(p, color);\r\n        }\r\n    },\r\n    test_func: function () {\r\n        var p = {\r\n            position: {x: 0, y: 0, z: 0},\r\n            velocity: {x: 0, y: 0, z: 0}\r\n        };\r\n        var color = {r: 0, g: 0, b: 0};\r\n        this.custom_func(p, color);\r\n    },\r\n    set_emit_function: function (source) {\r\n        if (typeof source === 'function') {\r\n            this.custom_func = source;\r\n        } else if (typeof source  === 'string') {\r\n            try {\r\n                this.custom_func = new Function ('p', 'color', source);\r\n                this.test_func();\r\n            }\r\n            catch (e) {\r\n                alert(e);\r\n                this.custom_func = undefined;\r\n            }\r\n            this.source_code = source;\r\n        }\r\n    },\r\n    toJSON: function () {\r\n        var data = {};\r\n        data.name = \"Custom_Emitter\";\r\n        data.params = My_Lib.Particle_Emitter.prototype.toJSON.call(this, this);\r\n        if (this.source_code) {\r\n            data.params.source_code = this.source_code;\r\n        }\r\n        return data;\r\n    },\r\n    parse: function (data) {\r\n        My_Lib.Particle_Emitter.prototype.parse.call(this, data);        \r\n        this.set_emit_function (data.source_code);\r\n    },\r\n    constructor: Custom_Emitter,\r\n};\r\n\r\n_.copy_object(Custom_Emitter.prototype, methods);\r\nMy_Lib.Register_Class(\"Custom_Emitter\", Custom_Emitter);\r\n\r\n\r\nfunction test()\r\n{\r\n    var t = new Custom_Emitter();\r\n    var source = 'p.position.z = -100; p.velocity.y = 100;';\r\n    t.set_emit_function(source);\r\n    var p = {\r\n        velocity: {x: 0, y: 0, z: 0},\r\n        position: {x: 0, y: 0, z: 0}\r\n    };\r\n    t.custom_func(p);\r\n    console.log(p);\r\n    var json = t.toJSON();\r\n    console.log(json);\r\n    \r\n    t = new Custom_Emitter();\r\n    t.parse(json.params);\r\n    //console.log(t.custom_func);    \r\n}\r\n\r\n//test();\r\n\r\n/*\r\nCustom_Emitter.prototype = Object.create(My_Lib.Particle_Emitter.prototype);\r\nCustom_Emitter.prototype.constructor = Cone_Emitter;\r\nMy_Lib.Register_Class(\"Custom_Emitter\", Cone_Emitter);\r\n*/\r\n\r\nexport {Custom_Emitter};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/custom_emitter.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\nvar Particle_Forces = {};\r\n\r\n//base class\r\nParticle_Forces.Force = function ()\r\n{\r\n}\r\n\r\n\r\n_.copy_object(Particle_Forces.Force.prototype,{\r\n\t\tcalc: function (dt, particle, acceleration) \r\n\t\t{\r\n\t\t},\r\n\t\ttoJSON: function (child) \r\n\t\t{\r\n\t\t\treturn {};\r\n\t\t},\r\n\t\tparse: function (json) \r\n\t\t{\r\n\t\t},\r\n});\r\n\r\n//constant force\r\nParticle_Forces.Constant_Force = function (force)\r\n{\r\n\tif (typeof force !== 'undefined') {\r\n\t\tthis.force = force;\r\n\t} else {\r\n\t\tthis.force = {x:0, y:0, z:0};\r\n\t}\r\n}\r\n\r\nParticle_Forces.Constant_Force.prototype = Object.create(Particle_Forces.Force.prototype);\r\n_.copy_object(Particle_Forces.Constant_Force.prototype, {\r\n\tconstructor: Particle_Forces.Constant_Force,\r\n\tcalc: function (dt, p, acceleration) \r\n\t{\r\n\t\tacceleration.x += this.force.x;\r\n\t\tacceleration.y += this.force.y;\r\n\t\tacceleration.z += this.force.z;\r\n\t},\r\n\ttoJSON: function (child)\r\n\t{\r\n\t\tvar data = {};\r\n\t\tdata.name = \"Constant_Force\";\r\n\t\tdata.force = _.create_clone_object(this.force);\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\t\r\n\t\tif (json.force) {\r\n\t\t\t_.copy_object(this.force, json.force);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nMy_Lib.Register_Class(\"Constant_Force\", Particle_Forces.Constant_Force);\r\n\r\nexport {Particle_Forces};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/forces.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Point_Generators} from './point_generators.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\n\r\nfunction  Cone_Emitter()\r\n{\r\n\tParticle_Emitter.apply(this, arguments);\r\n\tthis.generator = new Point_Generators.Random_Direction();\r\n\tthis.origin = new THREE.Vector3(1, 1, 0);\r\n\tthis.velocity = new THREE.Vector3(0, 1, 0);\r\n\tthis.dispersion = {\"min\": 5, \"max\": 10};\r\n\tthis.dispersion.delta = 5;\r\n\tthis.speed = {min: 5, max: 10, delta:5};\r\n\tthis.color = new THREE.Color(1, 1, 1);\r\n}\r\n\r\nCone_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\nCone_Emitter.prototype.constructor = Cone_Emitter;\r\nMy_Lib.Register_Class(\"Cone_Emitter\", Cone_Emitter);\r\n\r\nCone_Emitter.prototype.toJSON = function ()\r\n{\r\n\tvar data = {};\r\n\tdata.name = \"Cone_Emitter\";\r\n\tdata.params = Particle_Emitter.prototype.toJSON.call(this, this);\r\n\t_.clone_field_list_one_level_recursion(this, data.params, \r\n\t[\"origin\", \r\n\t\"velocity\", \r\n\t\"dispersion\",\r\n\t\"speed\"]);\r\n\t\r\n\treturn data;\r\n}\r\n\r\nCone_Emitter.prototype.parse = function (data)\r\n{\r\n\tParticle_Emitter.prototype.parse.call(this, data);\r\n\tthis.origin.copy(data.origin);\r\n\tthis.velocity.copy(data.velocity);\r\n\tthis.set_dispersion(data.dispersion.min, data.dispersion.max);\r\n\tthis.set_speed(data.speed.min, data.speed.max);\r\n}\r\n\r\nCone_Emitter.prototype.set_speed = function (min, max)\r\n{\r\n\tthis.speed.min = min;\r\n\tthis.speed.max = max;\r\n\tthis.speed.delta = max - min;\r\n}\r\n\r\n\r\nCone_Emitter.prototype.set_dispersion = function (min, max)\r\n{\r\n\tthis.dispersion.min = min;\r\n\tthis.dispersion.max = max;\r\n\tthis.dispersion.delta = max - min;\r\n}\r\n\r\n\r\n\r\n\r\nCone_Emitter.prototype.emit = function (p, color, matrix)\r\n{\r\n\tp.position.copy(this.origin);\r\n\t\r\n\tthis.generator.get_direction(p.velocity);\r\n\tp.velocity.multiplyScalar(Math.random()*this.dispersion.delta + this.dispersion.min);\t\r\n\tp.velocity.add(this.velocity).normalize();\r\n\t\r\n    if (matrix) {\r\n        p.position.applyMatrix4(matrix);\r\n        p.velocity.applyMatrix4_rotation(matrix);\r\n    }\r\n        \r\n\tp.velocity.multiplyScalar(Math.random()*this.speed.delta + this.speed.min);\t\r\n\t\r\n    \r\n\tif (color) {\r\n\t\tthis.emit_color(color);\r\n\t}\r\n    \r\n}\r\n\r\nCone_Emitter.prototype.emit_color = function (color) \r\n{\r\n\tcolor.copy(this.color);\r\n}\r\n\r\nfunction Sphere_Emitter(radius, speed)\r\n{\r\n\tParticle_Emitter.call(this);\r\n\tthis.radius = radius || 1;\r\n    this.speed = speed || 1;\r\n\tthis.generator = new Point_Generators.Sphere(radius);\r\n    this.from_center = true;\r\n    Object.defineProperty(this, 'radius', {\r\n        configurable: true,\r\n        enumerable: true,\r\n        set: function (value) { radius = value; generator.radius = value;}\r\n    });\r\n}\r\n\r\nSphere_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\n\r\n_.copy_object(Sphere_Emitter.prototype, {\r\n    constructor: Sphere_Emitter,\r\n    emit: function (p, color, matrix)\r\n    {\r\n        if (this.from_center) {\r\n            p.position.set(0,0,0);\r\n        } else {\r\n            this.generator.get_point(p.position);\r\n        }\r\n        this.generator.get_normal(p.velocity);\r\n        if (matrix) {\r\n            p.position.applyMatrix4(matrix);\r\n            p.velocity.applyMatrix4_rotation(matrix);\r\n        }\r\n        p.velocity.multiplyScalar(this.speed);\r\n    },\r\n    toJSON: function (json) {\r\n\t\tvar params = Particle_Emitter.prototype.toJSON.call(this, this);\r\n        params.radius = this.radius;\r\n        params.speed = this.speed;\r\n        //params.generator.radius = this.radius;\r\n    },\r\n    parse: function (json) {\r\n\t\tParticle_Emitter.prototype.parse.call(this, json);\r\n        this.radius = json.radius;\r\n        this.speed = json.speed;\r\n    }\r\n});\r\n\r\nMy_Lib.Register_Class(\"Sphere_Emitter\", Sphere_Emitter);\r\n\r\n\r\nfunction Star_Dust_Emitter ()\r\n{\r\n\tParticle_Emitter.apply(this, arguments);\r\n\tthis.start_position = new THREE.Vector3(0, 0, 0);\r\n\tthis.end_position = new THREE.Vector3(1, 1, 1);\r\n\tthis.delta = new THREE.Vector3(1, 1, 1);\t\r\n\tthis.velocity = new THREE.Vector3(0, 0, 1);\r\n}\r\n\r\nStar_Dust_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\nStar_Dust_Emitter.prototype.constructor = Star_Dust_Emitter;\r\n_.copy_object( Star_Dust_Emitter.prototype,{\r\n\tset_velocity: function (x,y, z) \r\n\t{\r\n\t\tthis.velocity.set(x, y, z);\r\n\t},\r\n\tset_position_range : function (start, end)\r\n\t{\r\n\t\tthis.start_position.copy(start);\r\n\t\tthis.end_position.copy(end);\r\n\t\tthis.delta.set(end.x - start.x, end.y-start.y, end.z-start.z);\r\n\t\t\r\n\t},\r\n\tget_position: function (vector)\r\n\t{\r\n\t\tvector.x = Math.random() * this.delta.x + this.start_position.x;\r\n\t\tvector.y = Math.random() * this.delta.y + this.start_position.y;\r\n\t\tvector.z = Math.random() * this.delta.z + this.start_position.z;\r\n\t},\r\n\tget_velocity: function (vector)\r\n\t{\r\n\t\tvector.x = this.velocity.x;\r\n\t\tvector.y = this.velocity.y;\r\n\t\tvector.z = this.velocity.z;\r\n\t},\r\n\temit: function (p)\r\n\t{\r\n\t\tthis.get_position(p.position);\r\n\t\tif (this.parent) {\r\n\t\t\tthis.parent.localToWorld(p.position);\r\n\t\t}\r\n\t\tthis.get_velocity(p.velocity);\r\n\t},\r\n\ttoJSON: function ()\r\n\t{\r\n\t\tvar params = Particle_Emitter.prototype.toJSON.call(this, this);\r\n\t\t_.clone_field_list_one_level_recursion(this, params, [\"velocity\", \r\n\t\t\"start_position\",\r\n\t\t\"end_position\"])\r\n\t\tvar data = {\r\n\t\t\t\"name\": \"Star_Dust_Emitter\",\r\n\t\t\t\"params\": params,\r\n\t\t};\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tParticle_Emitter.prototype.parse.call(this, json);\r\n\t\tthis.set_position_range(json.start_position, json.end_position);\r\n\t\tthis.velocity.copy(json.velocity);\r\n\t}\r\n\t\r\n});\r\n\r\nMy_Lib.Register_Class(\"Star_Dust_Emitter\", Star_Dust_Emitter);\r\n\r\n\r\nfunction Star_Dust_Affector (end)\r\n{\r\n\tthis.end = end || 0;\r\n}\r\n\r\n\r\nStar_Dust_Affector.prototype = Object.create(Particle_Affector.prototype);\r\nStar_Dust_Affector.prototype.constructor = Star_Dust_Affector;\r\n\r\n_.copy_object(Star_Dust_Affector.prototype,{\r\n\taffect: function (dt, pdata, vert)\r\n\t{\r\n\t\tif (pdata.position.z > this.end) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\ttoJSON: function ()\r\n\t{\r\n\t\tvar params = Particle_Affector.prototype.toJSON.call(this, this);\r\n\t\tparams[\"end\"] = this.end;\r\n\t\tvar data = {\r\n\t\t\t\"name\": \"Star_Dust_Affector\",\r\n\t\t\t\"params\": params,\r\n\r\n\t\t};\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tParticle_Affector.prototype.parse(this, json);\r\n\t\tthis.end = json.end;\r\n\t}\r\n});\r\n\r\nMy_Lib.Register_Class(\"Star_Dust_Affector\", Star_Dust_Affector);\r\n\r\nexport {Cone_Emitter, Star_Dust_Emitter, Sphere_Emitter, Star_Dust_Affector};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/test_emitters.js"],"sourceRoot":""}