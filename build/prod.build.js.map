{"version":3,"sources":["webpack:///prod.build.js","webpack:///webpack/bootstrap f0d2e7d815244ec10fd6","webpack:///./src/base/my_lib.js","webpack:///./src/particles/particle_affector.js","webpack:///./src/particles/particle_emitter.js","webpack:///./src/particles/particles_points.js","webpack:///./src/base/event_hub.js","webpack:///./src/base/mouse_intersector.js","webpack:///./src/particles/particle_shaders.js","webpack:///./src/particles/particles.js","webpack:///./src/particles/particles_manager.js","webpack:///./src/particles/point_generators.js","webpack:///./src/app/application.js","webpack:///./src/base/animations.js","webpack:///./src/base/loading_manager.js","webpack:///./src/base/package_manager.js","webpack:///./src/base/scene_serializer.js","webpack:///./src/base/threejs_mixins.js","webpack:///./src/particles/custom_affector.js","webpack:///./src/particles/custom_emitter.js","webpack:///./src/particles/forces.js","webpack:///./src/particles/test_emitters.js"],"names":["Engine","modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","My_Lib","Viewport","Object_Animation","animation","this","update","dt","create_text_image","width","height","text","npot","background","canvas","document","createElement","context","getContext","fillStyle","fillRect","font","fillText","texture","THREE","Texture","wrapS","wrapT","TextureWrapping","ClampToEdgeWrapping","minFilter","LinearFilter","needsUpdate","Create_Quad","vertex_shader","fragment_shader","plane","PlaneBufferGeometry","material","ShaderMaterial","vertexShader","fragmentShader","quad","Mesh","rotation","y","Math","PI","Render_Target","target","WebGLRenderTarget","magFilter","NearestFilter","format","RGBFormat","camera","PerspectiveCamera","render","scene","renderer","create_overlay_camera","OrthographicCamera","Overlay","autoClear","Mouse_Controller","root","over","click","callback","event_hub","Event_Hub","events","add_event_listener","func","obj","push","on","emit","listeners","length","t","run_function","window","setTimeout","create_run_function","app","run","loop","Euler_Controller","x","z","xspeed","yspeed","zspeed","Registered_Classes","Register_Class","console","log","Get_Class","create_class","parent","child","props","create","_","copy_object","contructor","Abstract_Fabric","data","constructor","type","parse","undefined","Print_Classes","key","Particle_Affector","__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__","id","generateUUID","affect","pdata","vert","color","toJSON","params","json","Force_Affector","forces","Array","add_force","force","apply_forces","particle","acceleration","calc","velocity","uuid","f","item","Particle_Emitter","emit_per_second","emit_delta","emit_count","lifetime","min","max","emit_life","random","calc_emitted_particles","need_emit","floor","matrix","position","set","applyMatrix4","applyMatrix4_rotation","Particles_Points","geometry","Points","boundingSphere","Sphere","radius","meta","mat","geom","Object3D","raycast","raycaster","intersects","sphere","copy","matrixWorld","r","ray","intersectsSphere","shit","Vector3","tr","Ray","tmp","sub","distance","sqrt","dot","point","main_event_hub","Mouse_Intersector","mouse_coords_to_vector","event","offset","getBoundingClientRect","clientWidth","clientHeight","clientX","left","clientY","top","vector","unproject","matrixWorldInverse","mouse_coords_to_ray","Raycaster","normalize","find_intersection_with_mouse_vector","intersectObjects","Particle_Shaders","vertex","join","fragment","Particle_System","__WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__","__WEBPACK_IMPORTED_MODULE_2__particle_affector_js__","__WEBPACK_IMPORTED_MODULE_3__particles_points_js__","__WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__","emitter","affector","no_fade_color","particle_lifetime","pre_alpha","depth_test","depth_write","g","b","blending","size","count","dynamic_color","end_color","random_color","create_particle_material","node","create_particle_geometry","bounding_sphere","set_name","suicide","remove","create_particle_data","particle_data","vertices","Float32Array","colors","BufferAttribute","setDynamic","BufferGeometry","buffer","addAttribute","generate_material_name","my_name","blending_mode","additive","blendSrc","OneFactor","blendDst","alpha","SrcAlphaFactor","OneMinusSrcAlphaFactor","one_alpha","alpha_one","convert_blending_mode","three_blending","factors","NoBlending","CustomBlending","set_texture","Texture_Manager","error","uniforms","sprite","recreate_material","create_uniforms","point_size","screen_size","Vector2","calc_defines","defines","select_texture","resources","blend_obj","transparent","depthWrite","depthTest","set_pre_alpha","set_point_size","set_blending","emit_particles","verts","array","updateMatrixWorld","update_particle_geometry","dummy_color","set_emitter","set_particle_life_length","val","set_emission_per_second","set_particle_count","set_color","set_bounding_sphere_radius","Particle_Manager","__WEBPACK_IMPORTED_MODULE_4__particles_js__","particles","particles_array","add","ps","remove_particles","indexOf","splice","get_particle_names","names","arr","emitter_fabric","affector_fabric","fromJSON","JSON","e","getObjectByName","load_particles","getObjectByProperty","replace_object_with_this","create_name","number","begin_name","testing","create_new","particle_manager","Particles_Config","box_size","Point_Generators","Random_Direction","get_direction","get_inner_point","beta","cos","sin","get_normal","get_point","multiplyScalar","Application","__WEBPACK_IMPORTED_MODULE_1__base_event_hub_js__","__WEBPACK_IMPORTED_MODULE_2__base_mouse_intersector_js__","config","_lifecycle_event","_init_timer","_create_loop_function","mouse_controllers","remove_animated_object","start","_set_configuration","clock","Clock","delta_time","animated_objects","self","get_default_configuration","dom_element","render_params","premultipliedAlpha","viewport","clear_color","main_camera","fov","near","far","aspect_ratio","_create_render","dom_screen","alert","getElementById","WebGLRenderer","appendChild","domElement","setSize","set_viewport","setClearColor","_create_main_scene","prevent","main_scene","Scene","aspect","updateProjectionMatrix","apply_configuration","configuration","load_configuration","url","xhr","XHRLoader","configuration_is_applied","onload","progress","status","load","default_config","extend","methods","child_func","Child","apply","arguments","extend_proto","proto","delta","getDelta","add_animated_object","update_all","len","create_mouse_move_listener","mouse_move_listener","find_mouse_over_intersections","addEventListener","add_mouse_controller","Base_Animation","Euler_Animation","__WEBPACK_IMPORTED_MODULE_0__my_lib_js__","time","time_scale","scaled_dt","calc_animation","param","Loading_Manager","Chain_Loader","list","index","stop_by_error","next","resource","item_loaded","finished","do_error","onerror","do_progress","onprogress","load_func","test_chain_loader","cl","texture_loader","TextureLoader","get_async","load_list","resource_list","on_load","on_progress","on_resource_loaded","load_list_textures","load_list_json","loader","free","Package_Manager","state","defaults","parse_package_description","pack","load_resources","loaded","textures","data_loaded","Scene_Serializer","__WEBPACK_IMPORTED_MODULE_1__particles_particles_manager_js__","animation_library","anims","collect_animations","create_animations","animations","anim","bind_animations","animdata","bindings","copy_animations","bind","anim_uuid","add_animation","load_from_json","ObjectLoader","myanimations","scene_loaded","Mix_It","elements","Object3D_Animation_Mixin","remove_animation","children","old_toJson","Object3D_Serialization_Mixin","standard_serialization","stringify","userData","castShadow","receiveShadow","visible","toArray","materials","geometries","collect_materials","collect_geometry","toJSON1","extractFromCache","cache","values","metadata","isRootObject","output","images","version","generator","collect_animations_recursive","source","up","quaternion","scale","matrixAutoUpdate","matrixWorldNeedsUpdate","frustumCulled","renderOrder","Custom_Affector","__WEBPACK_IMPORTED_MODULE_1__particle_affector_js__","custom_func","dummy","test_func","set_affect_function","Function","source_code","set_affect_func","Custom_Emitter","set_emit_function","test","Particle_Forces","Force","Constant_Force","create_clone_object","Cone_Emitter","Star_Dust_Emitter","Sphere_Emitter","Star_Dust_Affector","__WEBPACK_IMPORTED_MODULE_1__point_generators_js__","__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__","__WEBPACK_IMPORTED_MODULE_3__particle_affector_js__","origin","dispersion","speed","Color","clone_field_list_one_level_recursion","set_dispersion","set_speed","emit_color","start_position","end_position","set_velocity","set_position_range","end","get_position","get_velocity","localToWorld","__WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__","__WEBPACK_IMPORTED_MODULE_1__base_my_lib_js__","__WEBPACK_IMPORTED_MODULE_2__base_animations_js__","__WEBPACK_IMPORTED_MODULE_3__base_mouse_intersector_js__","__WEBPACK_IMPORTED_MODULE_4__base_loading_manager_js__","__WEBPACK_IMPORTED_MODULE_5__base_package_manager_js__","__WEBPACK_IMPORTED_MODULE_6__particles_particles_points_js__","__WEBPACK_IMPORTED_MODULE_7__particles_particle_emitter_js__","__WEBPACK_IMPORTED_MODULE_8__particles_forces_js__","__WEBPACK_IMPORTED_MODULE_9__particles_particle_affector_js__","__WEBPACK_IMPORTED_MODULE_10__particles_point_generators_js__","__WEBPACK_IMPORTED_MODULE_11__particles_custom_emitter_js__","__WEBPACK_IMPORTED_MODULE_12__particles_custom_affector_js__","__WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__","__WEBPACK_IMPORTED_MODULE_14__particles_particle_shaders_js__","__WEBPACK_IMPORTED_MODULE_15__particles_particles_js__","__WEBPACK_IMPORTED_MODULE_16__particles_particles_manager_js__","__WEBPACK_IMPORTED_MODULE_17__base_scene_serializer_js__","__WEBPACK_IMPORTED_MODULE_18__base_threejs_mixins_js__","__WEBPACK_IMPORTED_MODULE_19__app_application_js__"],"mappings":"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","file":"prod.build.js","sourcesContent":["var Engine =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 20);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return My_Lib; });\n/*\r\n*/\n\nvar My_Lib = {};\n\nMy_Lib.Viewport = {};\n\nMy_Lib.Object_Animation = function (object, animation) {\n\tthis.object = object;\n\tthis.animation = animation;\n};\n\nMy_Lib.Object_Animation.prototype.update = function (dt) {\n\tthis.animation(this.object, dt);\n};\n\nMy_Lib.create_text_image = function (width, height, text, npot, background) {\n\t// create a canvas element\n\tvar canvas = document.createElement('canvas');\n\tcanvas.width = width;\n\tcanvas.height = height;\n\tvar context = canvas.getContext('2d');\n\tif (background) {\n\t\tcontext.fillStyle = background;\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\n\t}\n\tcontext.font = \"Bold 40px Arial\";\n\tcontext.fillStyle = \"rgba(0,255,0,0.95)\";\n\tcontext.fillText('Hello, world!', 0, 50);\n\n\t// canvas contents will be used for a texture\n\tvar texture = new THREE.Texture(canvas);\n\tif (npot) {\n\t\ttexture.wrapS = texture.wrapT = THREE.TextureWrapping.ClampToEdgeWrapping;\n\t\ttexture.minFilter = THREE.LinearFilter;\n\t}\n\ttexture.needsUpdate = true;\n\treturn texture;\n};\n\nMy_Lib.Create_Quad = function (width, height, vertex_shader, fragment_shader) {\n\t//plane created turn away from camera\n\tvar plane = new THREE.PlaneBufferGeometry(width, height);\n\n\tvar material = new THREE.ShaderMaterial({\n\t\tvertexShader: vertex_shader,\n\t\tfragmentShader: fragment_shader\n\t});\n\n\tvar quad = new THREE.Mesh(plane, material);\n\tquad.rotation.y = Math.PI;\n\treturn quad;\n};\n\nMy_Lib.Render_Target = function (width, height) {\n\tthis.target = new THREE.WebGLRenderTarget(width, height, {\n\t\tminFilter: THREE.LinearFilter,\n\t\tmagFilter: THREE.NearestFilter,\n\t\tformat: THREE.RGBFormat\n\t});\n\n\tthis.camera = new THREE.PerspectiveCamera(80, width / height, 0.1, 1000);\n};\n\nMy_Lib.Render_Target.prototype.render = function (scene, renderer) {\n\trenderer.render(scene, this.camera, this.target, true //forceClear\n\t);\n};\n\nMy_Lib.create_overlay_camera = function (width, height) {\n\tvar camera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, -10000, 10000);\n\treturn camera;\n};\n\nMy_Lib.Overlay = function (width, height) {\n\tthis.camera = My_Lib.create_overlay_camera(width, height);\n};\n\nMy_Lib.Overlay.prototype.render = function (renderer) {\n\tif (!this.scene) {\n\t\treturn;\n\t}\n\n\trenderer.autoClear = false;\n\trenderer.render(this.scene, this.camera);\n\trenderer.autoClear = true;\n};\n\nMy_Lib.Mouse_Controller = function (root, over, click, callback) {\n\tthis.root = root;\n\tthis.over = over;\n\tthis.click = !!click;\n\tthis.callback = callback;\n};\n\n/*\r\nugly hack\r\n*/\n\nMy_Lib.event_hub = new Event_Hub();\n\nfunction Event_Hub() {\n\tthis.events = {};\n}\n\nEvent_Hub.prototype.add_event_listener = function (name, func, obj) {\n\tif (!this.events[name]) {\n\t\tthis.events[name] = [];\n\t}\n\tthis.events[name].push({ name: name, func: func, obj: obj });\n};\n\nEvent_Hub.prototype.on = Event_Hub.prototype.add_event_listener;\n\nEvent_Hub.prototype.emit = function (name, obj) {\n\tvar listeners = this.events[name];\n\tif (listeners) {\n\t\tfor (var i = 0; i < listeners.length; i++) {\n\t\t\tvar t = listeners[i];\n\t\t\tt.func.call(t.obj, obj);\n\t\t}\n\t}\n};\n\nvar run_function = //window.requestAnimationFrame;\nfunction (callback) {\n\twindow.setTimeout(callback, 1000 / 60);\n};\n\nMy_Lib.create_run_function = function (app) {\n\tMy_Lib.run = function () {\n\t\trun_function(function () {\n\t\t\tapp.loop();\n\t\t});\n\t};\n};\n\nMy_Lib.Euler_Controller = function (obj, x, y, z) {\n\tthis.obj = obj;\n\tthis.xspeed = x * Math.PI / 180;;\n\tthis.yspeed = y * Math.PI / 180;;\n\tthis.zspeed = z * Math.PI / 180;;\n};\n\nMy_Lib.Euler_Controller.prototype.update = function (dt) {\n\tthis.obj.rotation.x += this.xspeed * dt;\n\tthis.obj.rotation.y += this.yspeed * dt;\n\tthis.obj.rotation.z += this.zspeed * dt;\n};\n\n//Class Library\nMy_Lib.Registered_Classes = {};\n\nMy_Lib.Register_Class = function (name, func) {\n\tif (My_Lib.Registered_Classes[name]) {\n\t\tconsole.log(\"Register Class ERROR! Class with this name already exists!\", name);\n\t}\n\tMy_Lib.Registered_Classes[name] = func;\n};\n\nMy_Lib.Get_Class = function (name) {\n\treturn My_Lib.Registered_Classes[name];\n};\n\nMy_Lib.create_class = function (parent, child, props, name) {\n\tif (parent) {\n\t\tchild.prototype = Object.create(parent.prototype);\n\t}\n\t_.copy_object(child.prototype, props);\n\tchild.prototype.contructor = child;\n\tMy_Lib.Register_Class(child, name);\n};\n\nMy_Lib.Abstract_Fabric = function (data) {\n\tvar constructor = My_Lib.Get_Class(data.type);\n\tif (constructor) {\n\t\tvar object = new constructor();\n\t\tobject.parse(data);\n\t\treturn object;\n\t}\n\treturn undefined;\n};\n\nMy_Lib.Print_Classes = function () {\n\tfor (var key in this.Registered_Classes) {\n\t\tconsole.log(\"class registered :\", key, this.Registered_Classes[key]);\n\t}\n};\n\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Affector; });\n/* unused harmony export Force_Affector */\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\n//base class for particle affector\nfunction Particle_Affector() {\n\tthis.id = _.generateUUID();\n}\n\nParticle_Affector.prototype.affect = function (dt, pdata, vert, color) {\n\treturn true;\n};\n\nParticle_Affector.prototype.toJSON = function (child) {\n\tif (child) {\n\t\treturn {};\n\t}\n\tvar data = {\n\t\tid: this.id,\n\t\t\"name\": \"Particle_Affector\",\n\t\tparams: {}\n\t};\n\tif (child) {\n\t\treturn params;\n\t}\n\treturn data;\n};\n\nParticle_Affector.prototype.parse = function (json) {};\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Particle_Affector\", Particle_Affector);\n\nfunction Force_Affector() {\n\tParticle_Affector.call(this);\n\tthis.forces = new Array();\n}\n\nForce_Affector.prototype = Object.create(Particle_Affector.prototype);\n\n_.copy_object(Force_Affector.prototype, {\n\tconstructor: Force_Affector,\n\tadd_force: function (force) {\n\t\tthis.forces.push(force);\n\t},\n\tapply_forces: function (dt, particle, vert, color) {\n\t\tvar acceleration = { x: 0, y: 0, z: 0 };\n\t\tfor (var i = 0; i < this.forces.length; i++) {\n\t\t\tthis.forces[i].calc(dt, particle, acceleration);\n\t\t}\n\t\t//integrate\n\t\tparticle.velocity.x += acceleration.x * dt;\n\t\tparticle.velocity.y += acceleration.y * dt;\n\t\tparticle.velocity.z += acceleration.z * dt;\n\t},\n\taffect: function (dt, particle, vert, color) {\n\t\tthis.apply_forces(dt, particle, vert, color);\n\t\treturn true;\n\t},\n\ttoJSON: function (child) {\n\t\tvar data = {};\n\t\tdata.name = \"Force_Affector\";\n\t\tdata.uuid = this.uuid;\n\t\tdata.params = Particle_Affector.prototype.toJSON.call(this, this);\n\t\tif (this.forces.length > 0) {\n\t\t\tdata.params.forces = new Array();\n\t\t\tfor (var i = 0; i < this.forces.length; i++) {\n\t\t\t\tdata.params.forces.push(this.forces[i].toJSON());\n\t\t\t}\n\t\t}\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\tvar f, item;\n\t\tif (json.forces) {\n\n\t\t\tfor (var i = 0; i < json.forces.length; i++) {\n\t\t\t\titem = json.forces[i];\n\t\t\t\tf = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Get_Class(item.name);\n\t\t\t\tif (f) {\n\t\t\t\t\tf = new f();\n\t\t\t\t\tf.parse(item);\n\t\t\t\t\tthis.add_force(f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Force_Affector\", Force_Affector);\n\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Emitter; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\n//Base class for Particle Emitters\nfunction Particle_Emitter(emit_per_second) {\n\tthis.uuid = _.generateUUID();\n\tthis.name = '';\n\tthis.emit_delta = 0;\n\tthis.emit_count = 0;\n\tthis.emit_per_second = emit_per_second || 5;\n\t//linear interpolation = min + random * (max-min)\t\n\tthis.lifetime = { \"min\": 0, \"max\": 2.0 };\n}\n\nParticle_Emitter.prototype.emit_life = function () {\n\treturn this.lifetime.min + Math.random() * (this.lifetime.max - this.lifetime.min);\n};\n\nParticle_Emitter.prototype.calc_emitted_particles = function (dt) {\n\t//count particles need emit\n\tthis.emit_delta += this.emit_per_second * dt;\n\tvar need_emit = Math.floor(this.emit_delta);\n\tif (need_emit > 0) {\n\t\tthis.emit_delta -= need_emit;\n\t\t//this.emit_count += need_emit;\n\t\t//need_emit = this.emit_count;\n\t}\n\treturn need_emit;\n};\n\nParticle_Emitter.prototype.emit = function (p, c, matrix) {\n\tp.position.set(0, 0, 0);\n\tp.velocity.set(0, 1, 0);\n\n\tif (matrix) {\n\t\tp.position.applyMatrix4(matrix);\n\t\tp.velocity.applyMatrix4_rotation(matrix);\n\t}\n};\n\nParticle_Emitter.prototype.toJSON = function (child) {\n\tvar params = {\n\t\t\"uuid\": this.uuid,\n\t\t\"emit_per_second\": this.emit_per_second,\n\t\t\"lifetime\": {\n\t\t\t\"min\": this.lifetime.min,\n\t\t\t\"max\": this.lifetime.max\n\t\t}\n\t};\n\tif (this.name) {\n\t\tparams.name = this.name;\n\t}\n\tif (child) {\n\t\treturn params;\n\t}\n\tvar data = {};\n\tdata.name = \"Particle_Emitter\";\n\tdata.params = params;\n\treturn data;\n};\n\nParticle_Emitter.prototype.parse = function (data) {\n\tthis.emit_per_second = data.emit_per_second;\n\tthis.name = data.name;\n\tthis.uuid = data.uuid || _.generateUUID();\n\t_.copy_object(this.lifetime, data.lifetime);\n};\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Particle_Emitter\", Particle_Emitter);\n\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particles_Points; });\n\nfunction Particles_Points(geometry, material) {\n    THREE.Points.call(this, geometry, material);\n    this.type = 'particles_points';\n\n    this.boundingSphere = new THREE.Sphere();\n    this.boundingSphere.radius = 10.0;\n}\n\nParticles_Points.prototype = Object.create(THREE.Points.prototype);\n\nParticles_Points.prototype.constructor = Particles_Points;\n\nParticles_Points.prototype.toJSON = function (meta) {\n    var mat = this.material;\n    var geom = this.geometry;\n    this.material = undefined;\n    this.geometry = undefined;\n    var object = THREE.Object3D.prototype.toJSON.call(this, meta);\n    this.material = mat;\n    this.geometry = geom;\n    return object;\n};\n\nParticles_Points.prototype.raycast = function (raycaster, intersects) {\n    var sphere = new THREE.Sphere();\n    sphere.copy(this.boundingSphere);\n    sphere.applyMatrix4(this.matrixWorld);\n    var r = raycaster.ray.intersectsSphere(sphere);\n    if (r === false) return;\n    console.log(\"INTERSECTION1\", this.name, sphere);\n    return;\n\n    var shit = new THREE.Vector3();\n    shit.copy(this.position);\n    var tr = new THREE.Ray(new THREE.Vector3(0, 0, 20), shit);\n    console.log(\"test \", tr.intersectsSphere(sphere), sphere);\n    console.log(\"hit sphere \" + this.name, sphere, raycaster.ray);\n    return raycaster.ray.intersectsSphere(sphere);\n\n    console.log(\"hit sphere \" + this.type, \"shpere is \", sphere, \"ray is \", r);\n    if (r) {\n        var tmp = new THREE.Vector3(this.position);\n        tmp.sub(r);\n        intersects.push({\n            distance: Math.sqrt(tmp.dot(tmp)),\n            point: this.position,\n            object: this\n        });\n    }\n};\n\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return main_event_hub; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Event_Hub; });\nfunction Event_Hub() {\n    this.events = {};\n}\n\nEvent_Hub.prototype.add_event_listener = function (name, func, obj) {\n    if (!this.events[name]) {\n        this.events[name] = [];\n    }\n    this.events[name].push({ name: name, func: func, obj: obj });\n};\n\nEvent_Hub.prototype.on = Event_Hub.prototype.add_event_listener;\n\nEvent_Hub.prototype.emit = function (name, obj) {\n    var listeners = this.events[name];\n    if (listeners) {\n        for (var i = 0; i < listeners.length; i++) {\n            var t = listeners[i];\n            t.func.call(t.obj, obj);\n        }\n    }\n};\n\nvar main_event_hub = new Event_Hub();\n\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Mouse_Intersector; });\nvar Mouse_Intersector = {};\n\nMouse_Intersector.mouse_coords_to_vector = function (canvas, event) {\n\tvar offset = canvas.getBoundingClientRect();\n\tvar width = canvas.clientWidth;\n\tvar height = canvas.clientHeight;\n\t//normalize coordinates\n\tvar x = (event.clientX - offset.left) / width;\n\tvar y = (event.clientY - offset.top) / height;\n\tvar x = x * 2 - 1;\n\tvar y = -(y * 2 - 1);\n\t//console.log(\"mouse coords\",  x,y, );    \n\tvar vector = new THREE.Vector3(x, y, 1);\n\treturn vector;\n};\n\nMouse_Intersector.unproject = function (vector, camera) {\n\tvar r = new THREE.Vector3();\n\tr.copy(vector);\n\tr.z = 1;\n\tr.unproject(camera);\n\tr.applyMatrix4(camera.matrixWorldInverse);\n\treturn r;\n};\n\nMouse_Intersector.mouse_coords_to_ray = function (canvas, event, camera) {\n\tvar offset = canvas.getBoundingClientRect();\n\tvar width = canvas.clientWidth;\n\tvar height = canvas.clientHeight;\n\tvar x = (event.clientX - offset.left) / width * 2 - 1;\n\tvar y = -((event.clientY - offset.top) / height * 2 - 1);\n\tvar vector = new THREE.Vector3(x, y, 1);\n\n\tvector.unproject(camera);\n\tvar ray = new THREE.Raycaster(camera.position, vector.sub(camera.position).normalize());\n\treturn ray;\n};\n\nMouse_Intersector.find_intersection_with_mouse_vector = function (vector, camera, scene) {\n\tvector.unproject(camera);\n\tvar ray = new THREE.Raycaster(camera.position, vector.sub(camera.position).normalize());\n\t// create an array containing all objects in the scene with which the ray intersects\n\t//var intersects = ray.intersectObjects( [grid_text.root], true ); \n\t//console.log(fake_plane.root.children[0].geometry);\n\tvar intersects = ray.intersectObjects([scene], true);\n\treturn intersects;\n};\n\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Shaders; });\nvar Particle_Shaders = {};\n\n(function () {\n\n\t//particle attributes:\n\t//position\n\t//color\n\t//left, size\n\tvar vertex_shader = [\n\t//'attribute vec4 position;',\n\t'attribute vec4 color;', 'attribute float params;', 'varying vec4 vcolor;', 'uniform float lifetime;', 'uniform float point_size;', 'uniform vec2 screen_size;', '#ifndef DYNAMIC_COLORS', 'uniform vec3 particle_color;', '#endif', 'void main () {', 'gl_Position = projectionMatrix * viewMatrix * vec4( position, 1.0 );', '#ifdef DYNAMIC_COLORS', 'vcolor.rgb = color.rgb;', '#else', 'vcolor.rgb = particle_color.rgb;', '#endif', '#ifdef NO_FADE_COLOR', 'vcolor.a = 1.0;', '#else',\n\t//params contains life length which decreased by time\n\t'float tmp = params / lifetime;', 'tmp = min(tmp, 1.0);', 'vcolor.a = tmp;', '#endif', 'float t =  screen_size.y* projectionMatrix[1][1] / gl_Position.w;', 't = t * point_size;', 'if (params > 0.0) {', 'gl_PointSize = t;', '}', 'else {',\n\t//'vcolor.a = 0.0;',\n\t'gl_PointSize = 0.0;', '}', '}'];\n\n\tvar fragment_shader = ['varying vec4 vcolor;', '#ifdef PARTICLE_TEXTURE', 'uniform sampler2D sprite;', '#endif', 'void main() {', '#ifdef PARTICLE_TEXTURE', 'vec4 tex = texture2D( sprite, gl_PointCoord );', 'vec3 fragment_color = tex.rgb;', 'fragment_color.rgb *= vcolor.rgb;', 'float alpha = tex.a;', '#else', 'vec3 fragment_color = vcolor.rgb;', 'float alpha = 1.0;', '#endif', '#ifdef PRE_ALPHA', 'fragment_color.rgb *= alpha;', '#endif', '#ifndef NO_FADE_COLOR', 'float fragment_alpha = alpha * vcolor.a;', '#else', 'float fragment_alpha = alpha;', '#endif', 'gl_FragColor = vec4(fragment_color.rgb, fragment_alpha);', '}'];\n\n\tParticle_Shaders.vertex = vertex_shader.join('\\n');\n\tParticle_Shaders.fragment = fragment_shader.join('\\n');\n})();\n\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_System; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__particles_points_js__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__ = __webpack_require__(6);\n\n\n\n\n\n\nfunction Particle_System(params) {\n\t\t\t\tthis.uuid = _.generateUUID();\n\n\t\t\t\t//restricted params\n\t\t\t\tif (!params.emitter) {\n\t\t\t\t\t\t\t\tparams.emitter = new __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */](1);\n\t\t\t\t}\n\t\t\t\tif (!params.affector) {\n\t\t\t\t\t\t\t\tparams.affector = new __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__[\"a\" /* Particle_Affector */]();\n\t\t\t\t}\n\t\t\t\tparams.no_fade_color = !!params.no_fade_color;\n\t\t\t\tparams.particle_lifetime = params.particle_lifetime || 3.0;\n\n\t\t\t\tif (typeof params.pre_alpha === 'undefined') {\n\t\t\t\t\t\t\t\tparams.pre_alpha = true;\n\t\t\t\t}\n\n\t\t\t\tif (typeof params.depth_test === 'undefined') {\n\t\t\t\t\t\t\t\tparams.depth_test = true;\n\t\t\t\t}\n\n\t\t\t\tif (params[\"depth_write\"] === undefined) {\n\t\t\t\t\t\t\t\tparams.depth_write = false;\n\t\t\t\t}\n\n\t\t\t\tif (!params.color) {\n\t\t\t\t\t\t\t\tparams.color = { \"r\": 1, \"g\": 1, \"b\": 1 };\n\t\t\t\t}\n\n\t\t\t\tif (!params.blending) {\n\t\t\t\t\t\t\t\tparams.blending = \"one_alpha\";\n\t\t\t\t}\n\n\t\t\t\tparams.size = params.size || 1;\n\n\t\t\t\tif (!params.count) params.count = 100;\n\n\t\t\t\tthis.emitter = params.emitter;\n\t\t\t\tthis.affector = params.affector;\n\t\t\t\tthis.name = params.name || '';\n\t\t\t\tthis.particle_lifetime = params.particle_lifetime;\n\t\t\t\tthis.params = params;\n\n\t\t\t\tthis.texture = params.texture;\n\n\t\t\t\tthis.dynamic_color = !!params.end_color || !!params.random_color;\n\n\t\t\t\tvar count = params.count;\n\n\t\t\t\tthis.material = this.create_particle_material();\n\t\t\t\tthis.node = new __WEBPACK_IMPORTED_MODULE_3__particles_points_js__[\"a\" /* Particles_Points */](this.create_particle_geometry(count), this.material);\n\t\t\t\tthis.node.name = this.name;\n\n\t\t\t\tif (typeof this.params.bounding_sphere !== 'undefined') {\n\t\t\t\t\t\t\t\tthis.node.boundingSphere.radius = params.bounding_sphere;\n\t\t\t\t}\n}\n\nParticle_System.prototype.set_name = function (name) {\n\t\t\t\tthis.name = name;\n\t\t\t\tthis.node.name = name;\n};\n\nParticle_System.prototype.suicide = function () {\n\t\t\t\tthis.node.parent.remove(this.node);\n\t\t\t\tmain_event_hub.emit(\"kill_me\", this);\n};\n\nParticle_System.prototype.create_particle_data = function (count) {\n\t\t\t\tvar particle_data = new Array(count);\n\t\t\t\tvar p;\n\t\t\t\tfor (var i = 0; i < count; i++) {\n\t\t\t\t\t\t\t\tp = {};\n\t\t\t\t\t\t\t\tp.position = new THREE.Vector3(0, 0, 0);\n\t\t\t\t\t\t\t\tp.velocity = new THREE.Vector3(0, 0, 0);\n\t\t\t\t\t\t\t\tp.lifetime = 0;\n\t\t\t\t\t\t\t\tparticle_data[i] = p;\n\t\t\t\t}\n\t\t\t\tthis.particle_data = particle_data;\n};\n\nParticle_System.prototype.create_particle_geometry = function (count) {\n\t\t\t\tthis.create_particle_data(count);\n\n\t\t\t\tvar vertices = new Float32Array(count * 3); // position\n\t\t\t\tvar colors = new Float32Array(count * 3);\n\t\t\t\tvar params = new Float32Array(count);\n\n\t\t\t\tfor (var i = 0; i < count; i++) {\n\t\t\t\t\t\t\t\t//create particle\n\t\t\t\t\t\t\t\tvertices[i * 3] = 0;\n\t\t\t\t\t\t\t\tvertices[i * 3 + 1] = 0;\n\t\t\t\t\t\t\t\tvertices[i * 3 + 2] = 0;\n\n\t\t\t\t\t\t\t\tparams[i] = 0.0;\n\n\t\t\t\t\t\t\t\tcolors[i * 3] = this.params.color.r;\n\t\t\t\t\t\t\t\tcolors[i * 3 + 1] = this.params.color.g;\n\t\t\t\t\t\t\t\tcolors[i * 3 + 2] = this.params.color.b;\n\t\t\t\t}\n\n\t\t\t\tthis.geometry = {};\n\t\t\t\tthis.geometry.vertices = new THREE.BufferAttribute(vertices, 3).setDynamic(true);\n\t\t\t\tthis.geometry.colors = new THREE.BufferAttribute(colors, 3);\n\t\t\t\tif (this.dynamic_color) {\n\t\t\t\t\t\t\t\tthis.geometry.colors.setDynamic(true);\n\t\t\t\t}\n\t\t\t\tthis.geometry.params = new THREE.BufferAttribute(params, 1).setDynamic(true);\n\t\t\t\tvar geom = new THREE.BufferGeometry();\n\t\t\t\tthis.geometry.buffer = geom;\n\t\t\t\tgeom.addAttribute('position', this.geometry.vertices);\n\t\t\t\tgeom.addAttribute('color', this.geometry.colors);\n\t\t\t\tgeom.addAttribute('params', this.geometry.params);\n\n\t\t\t\treturn geom;\n};\n\nParticle_System.prototype.generate_material_name = function () {\n\t\t\t\tvar my_name = \"MY_PARTICLE_MATERIAL\";\n\t\t\t\tif (!!this.texture) {\n\t\t\t\t\t\t\t\tmy_name += \"_WITH_TEXTURE\";\n\t\t\t\t}\n\t\t\t\tif (this.params.no_fade_color) {\n\t\t\t\t\t\t\t\tmy_name += \"_NO_FADE_COLOR\";\n\t\t\t\t}\n\t\t\t\treturn my_name;\n};\n\nParticle_System.prototype.blending_mode = {\n\t\t\t\t\"additive\": {\n\t\t\t\t\t\t\t\t\"blendSrc\": THREE.OneFactor,\n\t\t\t\t\t\t\t\t\"blendDst\": THREE.OneFactor\n\t\t\t\t},\n\t\t\t\t\"alpha\": {\n\t\t\t\t\t\t\t\t\"blendSrc\": THREE.SrcAlphaFactor,\n\t\t\t\t\t\t\t\t\"blendDst\": THREE.OneMinusSrcAlphaFactor\n\t\t\t\t},\n\t\t\t\t\"one_alpha\": {\n\t\t\t\t\t\t\t\t\"blendSrc\": THREE.OneFactor,\n\t\t\t\t\t\t\t\t\"blendDst\": THREE.OneMinusSrcAlphaFactor\n\t\t\t\t},\n\t\t\t\t\"alpha_one\": {\n\t\t\t\t\t\t\t\t\"blendSrc\": THREE.SrcAlphaFactor,\n\t\t\t\t\t\t\t\t\"blendDst\": THREE.OneFactor\n\t\t\t\t}\n};\n\nParticle_System.prototype.convert_blending_mode = function (blending) {\n\t\t\t\tvar three_blending;\n\t\t\t\tvar factors = this.blending_mode[\"one_alpha\"];\n\t\t\t\tif (blending === 'no') {\n\t\t\t\t\t\t\t\tthree_blending = THREE.NoBlending;\n\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthree_blending = THREE.CustomBlending;\n\t\t\t\t\t\t\t\tif (this.blending_mode[blending]) {\n\t\t\t\t\t\t\t\t\t\t\t\tfactors = this.blending_mode[blending];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { \"blending\": three_blending, \"factors\": factors };\n};\n\nParticle_System.prototype.set_texture = function (texture) {\n\t\t\t\tif (typeof texture === 'string') {\n\t\t\t\t\t\t\t\tif (this.params.texture === texture) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.params.texture = texture;\n\t\t\t\t\t\t\t\tthis.texture = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.get(texture);\n\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.error(\"Oh Shit! texture in set_texture is not string! it's object or undefined!\", texture);\n\t\t\t\t}\n\n\t\t\t\tif (this.material.uniforms.sprite) {\n\t\t\t\t\t\t\t\tthis.material.uniforms.sprite.value = this.texture;\n\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//this.material.uniforms.sprite = {value: texture};\n\t\t\t\t\t\t\t\tthis.recreate_material();\n\t\t\t\t\t\t\t\tconsole.error(\"Oh Shit! Our shader has not texture! Need create shader with texture!\");\n\t\t\t\t}\n};\n\nParticle_System.prototype.create_uniforms = function () {\n\t\t\t\tvar uniforms = {\n\t\t\t\t\t\t\t\t\"lifetime\": {\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: this.particle_lifetime\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"point_size\": {\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: this.params.size\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"screen_size\": {\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: new THREE.Vector2(__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.width, __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.height)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (!!this.texture) {\n\t\t\t\t\t\t\t\tuniforms[\"sprite\"] = {\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: this.texture\n\t\t\t\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tif (!this.dynamic_color) {\n\t\t\t\t\t\t\t\tuniforms[\"particle_color\"] = { value: this.params.color };\n\t\t\t\t}\n\t\t\t\treturn uniforms;\n};\n\nParticle_System.prototype.calc_defines = function () {\n\t\t\t\tvar defines = {};\n\t\t\t\tif (this.params.pre_alpha) {\n\t\t\t\t\t\t\t\tdefines[\"PRE_ALPHA\"] = true;\n\t\t\t\t}\n\t\t\t\tif (!!this.texture) {\n\t\t\t\t\t\t\t\tdefines[\"PARTICLE_TEXTURE\"] = true;\n\t\t\t\t}\n\t\t\t\tif (this.params.no_fade_color) {\n\t\t\t\t\t\t\t\tdefines[\"NO_FADE_COLOR\"] = true;\n\t\t\t\t}\n\t\t\t\treturn defines;\n};\n\nParticle_System.prototype.select_texture = function (texture) {\n\t\t\t\tif (typeof this.texture === 'string') {\n\t\t\t\t\t\t\t\tthis.texture = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.get(this.texture);\n\t\t\t\t\t\t\t\tconsole.log(__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.resources);\n\t\t\t\t\t\t\t\tif (!this.texture) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error(\"Oh, not found texture <\" + this.params.texture + \"> in create particle material! Instead get \" + this.texture);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n};\n\nParticle_System.prototype.create_particle_material = function () {\n\n\t\t\t\tthis.select_texture(this.texture);\n\n\t\t\t\tvar blend_obj = this.convert_blending_mode(this.params.blending);\n\n\t\t\t\tvar uniforms = this.create_uniforms();\n\t\t\t\tvar defines = this.calc_defines();\n\n\t\t\t\tvar mat = new THREE.ShaderMaterial({\n\t\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\t\tdepthWrite: this.params.depth_write,\n\t\t\t\t\t\t\t\tdepthTest: this.params.depth_test,\n\t\t\t\t\t\t\t\tblending: blend_obj.blending,\n\t\t\t\t\t\t\t\tblendSrc: blend_obj.factors.blendSrc,\n\t\t\t\t\t\t\t\tblendDst: blend_obj.factors.blendDst,\n\t\t\t\t\t\t\t\tdefines: defines,\n\t\t\t\t\t\t\t\tuniforms: uniforms,\n\t\t\t\t\t\t\t\tvertexShader: __WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__[\"a\" /* Particle_Shaders */].vertex,\n\t\t\t\t\t\t\t\tfragmentShader: __WEBPACK_IMPORTED_MODULE_4__particle_shaders_js__[\"a\" /* Particle_Shaders */].fragment\n\t\t\t\t});\n\t\t\t\treturn mat;\n};\n\nParticle_System.prototype.recreate_material = function () {\n\t\t\t\tthis.node.material = this.material = this.create_particle_material();\n};\n\nParticle_System.prototype.set_pre_alpha = function (pre_alpha) {\n\t\t\t\tif (this.params.pre_alpha !== !!pre_alpha) {\n\t\t\t\t\t\t\t\tthis.params.pre_alpha = pre_alpha;\n\t\t\t\t\t\t\t\tthis.recreate_material();\n\t\t\t\t}\n};\n\nParticle_System.prototype.set_point_size = function (size) {\n\t\t\t\tif (this.params.size != size) {\n\t\t\t\t\t\t\t\tthis.params.size = size;\n\t\t\t\t\t\t\t\tthis.node.material.uniforms[\"point_size\"].value = size;\n\t\t\t\t}\n};\n\nParticle_System.prototype.set_blending = function (blending) {\n\t\t\t\tthis.params.blending = blending;\n\t\t\t\tvar b = this.convert_blending_mode(blending);\n\t\t\t\tthis.material.blending = b.blending;\n\t\t\t\tthis.material.blendSrc = b.factors.blendSrc;\n\t\t\t\tthis.material.blendDst = b.factors.blendDst;\n};\n\nParticle_System.prototype.emit_particles = function (dt, need_emit) {\n\t\t\t\t//emit particles\n\t\t\t\tvar p;\n\t\t\t\tvar verts = this.geometry.vertices.array;\n\t\t\t\tvar params = this.geometry.params.array;\n\t\t\t\t//var colors = this.geometry.colors.array;\n\t\t\t\t//var dummy_color = new THREE.Color(1,1,1);\n\n\t\t\t\tthis.node.updateMatrixWorld(true);\n\t\t\t\tvar matrix = this.node.matrixWorld;\n\t\t\t\tfor (var i = 0; i < this.particle_data.length && need_emit > 0; i++) {\n\t\t\t\t\t\t\t\tif (!(params[i] > 0)) {\n\t\t\t\t\t\t\t\t\t\t\t\tp = this.particle_data[i];\n\t\t\t\t\t\t\t\t\t\t\t\tthis.emitter.emit(p, null, matrix);\n\t\t\t\t\t\t\t\t\t\t\t\tp.lifetime = this.particle_lifetime;\n\t\t\t\t\t\t\t\t\t\t\t\tverts[i * 3] = p.position.x;\n\t\t\t\t\t\t\t\t\t\t\t\tverts[i * 3 + 1] = p.position.y;\n\t\t\t\t\t\t\t\t\t\t\t\tverts[i * 3 + 2] = p.position.z;\n\t\t\t\t\t\t\t\t\t\t\t\tparams[i] = p.lifetime;\n\t\t\t\t\t\t\t\t\t\t\t\tneed_emit--;\n\t\t\t\t\t\t\t\t\t\t\t\t//colors[i*3] = this.params.color.r\n\t\t\t\t\t\t\t\t\t\t\t\t//colors[i*3+1] = this.params.color.g;\n\t\t\t\t\t\t\t\t\t\t\t\t//colors[i*3+2] = this.params.color.b;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n};\n\nParticle_System.prototype.update_particle_geometry = function (dt) {\n\t\t\t\tvar verts = this.geometry.vertices.array;\n\t\t\t\tvar params = this.geometry.params.array;\n\t\t\t\tvar p;\n\t\t\t\tvar vert = new THREE.Vector3(0, 0, 0);\n\t\t\t\tvar dummy_color = { \"r\": 1, \"b\": 1, \"g\": 1 };\n\t\t\t\tfor (var i = 0; i < this.particle_data.length; i++) {\n\n\t\t\t\t\t\t\t\tif (params[i] > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tp = this.particle_data[i];\n\n\t\t\t\t\t\t\t\t\t\t\t\t//integrate\n\t\t\t\t\t\t\t\t\t\t\t\tp.position.x += p.velocity.x * dt;\n\t\t\t\t\t\t\t\t\t\t\t\tp.position.y += p.velocity.y * dt;\n\t\t\t\t\t\t\t\t\t\t\t\tp.position.z += p.velocity.z * dt;\n\t\t\t\t\t\t\t\t\t\t\t\tp.lifetime -= dt;\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (p.lifetime <= 0 || !this.affector.affect(dt, p, vert, dummy_color)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tp.lifetime = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tparams[i] = p.lifetime;\n\t\t\t\t\t\t\t\t\t\t\t\tverts[i * 3] = p.position.x;\n\t\t\t\t\t\t\t\t\t\t\t\tverts[i * 3 + 1] = p.position.y;\n\t\t\t\t\t\t\t\t\t\t\t\tverts[i * 3 + 2] = p.position.z;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar need_emit = this.emitter.calc_emitted_particles(dt);\n\t\t\t\tthis.emit_particles(dt, need_emit);\n\n\t\t\t\tthis.geometry.vertices.needsUpdate = true;\n\t\t\t\tthis.geometry.params.needsUpdate = true;\n\t\t\t\tthis.geometry.colors.needsUpdate = true;\n};\n\nParticle_System.prototype.update = function (dt) {\n\t\t\t\tthis.update_particle_geometry(dt);\n};\n\nParticle_System.prototype.toJSON = function () {\n\t\t\t\tvar data = {};\n\t\t\t\tdata.uuid = this.uuid;\n\t\t\t\tdata.node = this.node.uuid;\n\t\t\t\tif (this.name || this.node.name) {\n\t\t\t\t\t\t\t\tdata.name = this.name || this.node.name;\n\t\t\t\t}\n\t\t\t\tdata.params = {};\n\t\t\t\tif (this.params) {\n\t\t\t\t\t\t\t\t_.copy_object(data.params, this.params);\n\t\t\t\t}\n\t\t\t\tdata.params.emitter = this.emitter.toJSON();\n\t\t\t\tdata.params.affector = this.affector.toJSON();\n\t\t\t\treturn data;\n};\n\nParticle_System.prototype.set_emitter = function (emitter) {\n\t\t\t\tthis.emitter = this.params.emitter = emitter;\n};\n\nParticle_System.prototype.set_particle_life_length = function (val) {\n\t\t\t\tif (val !== this.params.particle_lifetime) {\n\t\t\t\t\t\t\t\tthis.params.particle_lifetime = this.particle_lifetime = val;\n\t\t\t\t\t\t\t\tthis.material.uniforms['lifetime'].value = val;\n\t\t\t\t}\n};\n\nParticle_System.prototype.set_emission_per_second = function (val) {\n\t\t\t\tthis.emitter.emit_per_second = val;\n};\n\nParticle_System.prototype.set_particle_count = function (count) {\n\t\t\t\tif (count !== this.particle_data.length) {\n\t\t\t\t\t\t\t\tthis.params.count = count;\n\t\t\t\t\t\t\t\tthis.node.geometry = this.create_particle_geometry(count);\n\t\t\t\t}\n};\n\nParticle_System.prototype.set_color = function (color) {\n\t\t\t\tthis.params.color.r = color.r;\n\t\t\t\tthis.params.color.g = color.g;\n\t\t\t\tthis.params.color.b = color.b;\n};\n\nParticle_System.prototype.set_bounding_sphere_radius = function (radius) {\n\t\t\t\tthis.node.boundingSphere.radius = radius;\n};\n\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Manager; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__particles_points_js__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__particles_js__ = __webpack_require__(7);\n\n\n\n\n\n\nfunction Particle_Manager() {\n    this.particles = {};\n    this.particles_array = [];\n}\n\n_.copy_object(Particle_Manager.prototype, {\n    constructor: Particle_Manager,\n    add: function (ps, name) {\n        if (!this.particles[name]) {\n            this.particles[name] = ps;\n            this.particles_array.push(ps);\n        }\n    },\n    remove_particles: function (name) {\n        var ps = this.particles[name];\n        var i = this.particles_array.indexOf(ps);\n        if (i >= 0) {\n            this.particles_array.splice(i, 1);\n        }\n        if (ps) {\n            ps.suicide();\n            delete this.particles[name];\n        }\n    },\n    get_particle_names: function () {\n        var names = [];\n        for (var key in this.particles) {\n            names.push(key);\n        }\n        return names;\n    },\n\n    update: function (dt) {\n        for (var i = 0; i < this.particles_array.length; i++) {\n            this.particles_array[i].update(dt);\n        }\n    },\n\n    toJSON: function () {\n        var arr = [];\n\n        var data;\n        var p;\n        for (var key in this.particles) {\n            p = this.particles[key];\n            if (p.uuid) {\n                data = p.toJSON();\n                arr.push(data);\n            }\n        }\n\n        return arr;\n    },\n\n    emitter_fabric: function (params) {\n        if (params.emitter) {\n            var emitter = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Get_Class(params.emitter.name);\n            if (emitter) {\n                emitter = new emitter();\n            } else {\n                emitter = new __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */]();\n            }\n            emitter.parse(params.emitter.params);\n            return emitter;\n        }\n        return undefined;\n    },\n\n    affector_fabric: function (params) {\n        if (params.affector) {\n            var affector = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Get_Class(params.affector.name);\n            if (affector) {\n                affector = new affector();\n            } else {\n                affector = new __WEBPACK_IMPORTED_MODULE_2__particle_affector_js__[\"a\" /* Particle_Affector */]();\n            }\n            affector.parse(params.affector.params);\n            return affector;\n        }\n        return undefined;\n    },\n\n    fromJSON: function (json, callback, root, name) {\n        if (this.particles[name]) {\n            console.log(\"WARNING Particle Manager! Particle System with this name already exists\", name);\n        }\n\n        try {\n            var data = JSON.parse(json);\n        } catch (e) {\n            console.log(\"error parsing json on \", name, json);\n            throw e;\n        }\n\n        return this.parse(data, root, name);\n    },\n\n    parse: function (data, root, name) {\n        var emitter = this.emitter_fabric(data.params);\n        var affector = this.affector_fabric(data.params);\n        data.params.emitter = emitter;\n        data.params.affector = affector;\n\n        var ps = new __WEBPACK_IMPORTED_MODULE_4__particles_js__[\"a\" /* Particle_System */](data.params);\n        ps.set_name(data.name);\n\n        //add to scene graph\n        if (data.params.parent) {\n            var parent = root.getObjectByName(data.params.parent);\n            //console.log(data.params.parent, \"parent particles\", name, root);\n            parent.add(ps.node);\n        } else {\n            root.add(ps.node);\n        }\n\n        //ugly fucking hack\n        //copy node properties\n        this.add(ps, name);\n        return ps;\n    },\n\n    load_particles: function (json, root) {\n        var particles = json.particles;\n        for (var i = 0; i < particles.length; i++) {\n            var p = particles[i];\n            var ps = this.parse(p, root, p.name);\n            ps.node.uuid = p.node;\n            ps.node.name = p.name;\n            var obj = root.getObjectByProperty(\"uuid\", p.node);\n            if (obj) {\n                ps.node.replace_object_with_this(obj);\n            }\n        }\n    },\n\n    create_name: function () {\n        var number = this.particles_array.length + 1;\n        var begin_name = 'Particle_System_';\n        var testing = true;\n        while (testing) {\n            name = begin_name + number;\n            if (this.particles[name] !== undefined) {\n                number++;\n            } else {\n                return name;\n            }\n        }\n    },\n\n    create_new: function () {\n        var name = this.create_name();\n\n        var params = {};\n        var ps = new __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_System(params);\n        ps.set_name(name);\n        this.add(ps, name);\n        return ps;\n    }\n});\n\nif (__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].particle_manager === undefined) {\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].particle_manager = new Particle_Manager();\n}\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particles_Config = {\n    \"box_size\": 10\n};\n\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Point_Generators; });\nvar Point_Generators = {};\n\nPoint_Generators.Random_Direction = function () {};\n\nPoint_Generators.Random_Direction.prototype.get_direction = function (vector) {\n\tvector.x = Math.random();\n\tvector.y = Math.random();\n\tvector.z = Math.random();\n};\n\nPoint_Generators.Sphere = function (radius) {\n\tthis.radius = radius;\n};\n\nPoint_Generators.Sphere.prototype.get_inner_point = function (vector) {\n\tvar alpha = Math.random() * Math.PI * 2;\n\tvar beta = Math.random() * Math.PI;\n\tvector.x = Math.cos(alpha) * Math.sin(beta);\n\tvector.y = Math.cos(beta);\n\tvector.z = Math.sin(alpha) * Math.sin(beta);\n};\n\nPoint_Generators.Sphere.prototype.get_normal = function (vector) {\n\tvector.x = Math.random() * 2 - 1;\n\tvector.y = Math.random() * 2 - 1;\n\tvector.z = Math.random() * 2 - 1;\n\tvector.normalize();\n};\n\nPoint_Generators.Sphere.prototype.get_point = function (vector) {\n\tthis.get_normal(vector);\n\tvector.multiplyScalar(this.radius);\n};\n\n\n\n/***/ }),\n/* 10 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Application; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__base_event_hub_js__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__base_mouse_intersector_js__ = __webpack_require__(5);\n/*\r\nmain class\r\nthis has abstract virtual methods\r\nstart - which create renderer and conduct start initializations\r\nupdate - updated scene objects, animations, phisics\r\nrender - control scene rendering\r\nthis methods must rewrite on derived classes\r\nneed set \r\nPROPERTIES\r\nmain_camera - camera which point of view render whole scene and user interacts\r\ndom_screen - dom element which contain canvas and display scene\r\nrenderer - three.js renderer\r\ncanvas - is created by three.js renderer, it have to append to dom_screen children, fuck it\r\ncanvas width and height defining on creating it by renderer, fuck it\r\n\r\n\r\n\r\n*/\n\n\n\n\n\nfunction Application(config) {\n\n    this._lifecycle_event(\"before_created\");\n\n    this._init_timer();\n    this._create_loop_function();\n\n    this.mouse_controllers = [];\n\n    __WEBPACK_IMPORTED_MODULE_1__base_event_hub_js__[\"a\" /* main_event_hub */].add_event_listener(\"kill_me\", function (obj) {\n        this.remove_animated_object(obj);\n    }, this);\n}\n\nApplication.prototype.start = function (config) {\n    console.log(\"start application...\");\n    this._set_configuration(config);\n};\n\nApplication.prototype._lifecycle_event = function (name, event) {\n    if (this[name]) {\n        return this[name](event);\n    }\n    return false;\n};\n\nApplication.prototype._init_timer = function () {\n    this.clock = new THREE.Clock();\n    this.delta_time = 0;\n    this.animated_objects = [];\n};\n\nvar run_function = //window.requestAnimationFrame;\nfunction (callback) {\n    window.setTimeout(callback, 1000 / 60);\n};\n\nApplication.prototype._create_loop_function = function () {\n    var self = this;\n    this.run = function () {\n        run_function(function () {\n            self.loop();\n            //main_event_hub.emit(\"new_frame\");\n        });\n    };\n\n    //My_Lib.create_run_function(this);\n\n    //main_even_hub.add_event_listener(\"new_frame\", this.loop, this);    \n};\n\nApplication.prototype.get_default_configuration = function () {\n    return {\n        \"dom_element\": \"screen\",\n        \"render_params\": {\n            \"premultipliedAlpha\": true,\n            \"alpha\": true\n        },\n        \"viewport\": {\n            \"width\": 800,\n            \"height\": 600\n        },\n        \"clear_color\": 0x0000FF,\n        \"main_camera\": {\n            \"fov\": 80,\n            \"near\": 0.1,\n            \"far\": 1000,\n            \"aspect_ratio\": 1.3333333333333333,\n            \"position\": {\n                \"x\": 0,\n                \"y\": 0,\n                \"z\": 0\n            }\n        }\n    };\n};\n\nApplication.prototype._create_render = function (json) {\n    if (this.dom_screen || this.renderer) {\n        alert(\"Create render alert! Something strange happenes!\");\n    }\n    if (!this.dom_screen) {\n        this.dom_screen = document.getElementById(json.dom_element);\n    }\n    if (!this.renderer) {\n        this.renderer = new THREE.WebGLRenderer(json.render_params);\n    }\n    if (!!!this.dom_screen || typeof this.dom_screen === 'undefined') {\n        console.error(\"Some terrorous happens! dom element for screen not found! element id is \" + json.dom_element);\n    }\n    //console.log(\"found dome element \" + json.dom_element);\n    this.dom_screen.appendChild(this.renderer.domElement);\n    this.canvas = this.renderer.domElement;\n\n    this.renderer.setSize(json.viewport.width, json.viewport.height);\n    this.set_viewport(json.viewport.width, json.viewport.height);\n    this.renderer.setClearColor(json.clear_color);\n\n    this._lifecycle_event(\"render_created\");\n};\n\nApplication.prototype._create_main_scene = function (json) {\n    var event = { prevent: false };\n    this._lifecycle_event(\"before_create_main_scene\", event);\n    /*\r\n    if (event.prevent) {\r\n        return;\r\n    }\r\n    */\n    if (!this.main_scene) {\n        this.main_scene = new THREE.Scene();\n    }\n\n    var camera = json.main_camera;\n    if (!this.main_camera) {\n        this.main_camera = new THREE.PerspectiveCamera(camera.fov, camera.aspect_ratio, camera.near, camera.far);\n        this.main_scene.add(this.main_camera);\n        this.main_camera.name = \"main_camera\";\n    } else {\n        this.main_camera.fov = camera.fov;\n        this.main_camera.near = camera.near;\n        this.main_camera.far = camera.far;\n        this.main_camera.aspect = camera.aspect_ratio;\n        this.main_camera.updateProjectionMatrix();\n    }\n\n    this.main_camera.position.set(camera.position.x, camera.position.y, camera.position.z);\n};\n\nApplication.prototype.apply_configuration = function (json) {\n    this.configuration = json;\n    this._create_render(json);\n    this._create_main_scene(json);\n    this._lifecycle_event(\"created\");\n};\n\nApplication.prototype.load_configuration = function (url) {\n    var xhr = new THREE.XHRLoader();\n\n    var self = this;\n\n    var config = self.get_default_configuration();\n\n    var configuration_is_applied = false;\n\n    function onload(data) {\n        console.log(\"configuration loaded from url <<\" + url + \">>\");\n        var obj = JSON.parse(data);\n        //user config append to default config and may rewrite them, \n        //though user naven't to rewrite ALL config to change some params\n        _.copy_object(config, obj);\n        self.apply_configuration(config);\n        console.log(configuration_is_applied, \"onload\");\n        configuration_is_applied = true;\n    }\n    function progress() {}\n    function error(event) {\n        console.error(\"Error on loading config!\", event.target.status);\n        console.log(\"Setting default configuration\");\n        console.log(configuration_is_applied, \"error\");\n        configuration_is_applied = true;\n        self.apply_configuration(config);\n    }\n    xhr.load(url, onload, progress, error);\n};\n\nApplication.prototype._set_configuration = function (config) {\n    var default_config = this.get_default_configuration();\n\n    //this is url of configuration file\n    if (typeof config === 'string') {\n        console.log(\"get configuration from url >> \" + config);\n        this.load_configuration(config);\n\n        //this is object filled with data\n    } else if (typeof config === 'object') {\n        console.log(\"get configuration from user object\");\n        _.copy_object(default_config, config);\n        this.apply_configuration(default_config);\n        //configuration not given, use default\n    } else {\n        console.log(\"_set_configuration: set default configration\");\n        this.apply_configuration(default_config);\n    }\n};\n\nApplication.extend = function (methods, child_func) {\n\n    var Child;\n    if (typeof child_func === 'undefined') {\n        Child = function () {\n            Application.apply(this, arguments);\n        };\n    } else {\n        Child = child_func;\n    }\n\n    //create new object and set prototype chain\n    Child.prototype = Object.create(Application.prototype);\n    //copy methods to new object\n    _.copy_object(Child.prototype, methods);\n    Child.prototype.constructor = Child;\n\n    return Child;\n};\n\nApplication.extend_proto = function (proto, methods) {\n    var obj = Object.create(proto);\n    _.copy_object(obj, methods);\n    Application.call(obj);\n    return obj;\n};\n\nApplication.prototype.loop = function () {\n    var delta = this.clock.getDelta();\n    //fix this - add options to control min frame rate\n    if (delta > 0.1) {\n        delta = 0.1;\n    }\n    this.delta_time = delta;\n    this.update(delta);\n    this.render(delta);\n    this.run();\n    //My_Lib.run();\n};\n\nApplication.prototype.add_animated_object = function (obj) {\n    //fix probably duplicates\n    this.animated_objects.push(obj);\n};\n\nApplication.prototype.remove_animated_object = function (obj) {\n    for (var i = 0; i < this.animated_objects.length; i++) {\n        if (this.animated_objects[i] === obj) {\n            this.animated_objects.splice(i, 1);\n            break;\n        }\n    }\n};\n\nApplication.prototype.update_all = function (delta) {\n    var obj;\n    for (var i = 0, len = this.animated_objects.length; i < len; i++) {\n        obj = this.animated_objects[i];\n        if (obj[\"update\"]) {\n            obj.update(delta);\n        }\n    }\n};\n\nApplication.prototype.update = function (delta) {\n    this.update_all(delta);\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].particle_manager.update(delta);\n};\n\nApplication.prototype.create_mouse_move_listener = function () {\n    if (this[\"mouse_move_listener\"]) {\n        return;\n    }\n    var self = this;\n    this.mouse_move_listener = true;\n    function mouse_move_listener(event) {\n        var vector = __WEBPACK_IMPORTED_MODULE_2__base_mouse_intersector_js__[\"a\" /* Mouse_Intersector */].mouse_coords_to_vector(self.dom_screen, event);\n        self.find_mouse_over_intersections(vector);\n    };\n    document.addEventListener(\"mousemove\", mouse_move_listener);\n};\n\nApplication.prototype.find_mouse_over_intersections = function (vector) {\n    vector.unproject(this.main_camera);\n    var ray = new THREE.Raycaster(this.main_camera.position, vector.sub(this.main_camera.position).normalize());\n    var obj;\n    for (var i = 0, len = this.mouse_controllers.length; i < len; i++) {\n        obj = this.mouse_controllers[i];\n        if (obj.over) {\n            // create an array containing all objects in the scene with which the ray intersects\n            //var intersects = ray.intersectObjects( [grid_text.root], true ); \n            //console.log(fake_plane.root.children[0].geometry);\n            var intersects = ray.intersectObjects([obj.root], true);\n            obj.callback(intersects);\n        }\n    }\n};\n\nApplication.prototype.add_mouse_controller = function (root, over, click, callback) {\n    var tmp = new __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Mouse_Controller(root, over, click, callback);\n    this.mouse_controllers.push(tmp);\n    if (over) {\n        this.create_mouse_move_listener();\n    }\n    return tmp;\n};\n\nApplication.prototype.set_viewport = function (width, height) {\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.width = width;\n    __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Viewport.height = height;\n};\n\nApplication.prototype.render = function (delta) {\n    this.renderer.setClearColor(this.configuration.clear_color);\n    this.renderer.autoClear = true;\n    this.renderer.render(this.main_scene, this.main_camera);\n};\n\n\n\n/***/ }),\n/* 11 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Base_Animation; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Euler_Animation; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n\n\nfunction Base_Animation() {\n    this.time = 0;\n    this.time_scale = 1.0;\n    this.type = \"Base_Animation\";\n}\n\nBase_Animation.prototype.update = function (dt) {\n    var scaled_dt = dt * this.time_scale;\n    this.time += scaled_dt;\n    this.calc_animation(dt);\n};\n\nBase_Animation.prototype.calc_animation = function (dt) {};\n\nBase_Animation.prototype.apply = function (obj) {};\n\nBase_Animation.prototype.toJSON = function (data) {\n    var data = {};\n    data.uuid = this.uuid;\n    data.type = this.type;\n    if (this.name !== '') {\n        data.name = this.name;\n    }\n    data.time_scale = this.time_scale;\n    return data;\n};\n\nBase_Animation.prototype.parse = function (param) {\n    this.type = param.type;\n    this.uuid = param.uuid;\n    this.name = param.name ? param.name : '';\n    this.time_scale = param.time_scale === undefined ? 1.0 : param.time_scale;\n};\n\nfunction Euler_Animation(x, y, z) {\n    Base_Animation.call(this);\n    this.type = \"Euler_Animation\";\n    this.xspeed = x;\n    this.yspeed = y;\n    this.zspeed = z;\n    this.x = 0;\n    this.y = 0;\n    this.z = 0;\n    this.name = '';\n    this.uuid = _.generateUUID();\n}\n\nEuler_Animation.prototype = Object.create(Base_Animation.prototype);\n\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Base_Animation\", Base_Animation);\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Euler_Animation\", Euler_Animation);\n\nEuler_Animation.prototype.constructor = Euler_Animation;\n\nEuler_Animation.prototype.calc_animation = function (dt) {\n    dt *= this.time_scale;\n    this.x += this.xspeed * dt;\n    this.y += this.yspeed * dt;\n    this.z += this.zspeed * dt;\n};\n\nEuler_Animation.prototype.apply = function (obj) {\n    obj.rotation.x = this.x;\n    obj.rotation.y = this.y;\n    obj.rotation.z = this.z;\n};\n\nEuler_Animation.prototype.toJSON = function (json) {\n    var data = Base_Animation.prototype.toJSON.call(this);\n    data.xspeed = this.xspeed;\n    data.yspeed = this.yspeed;\n    data.zspeed = this.zspeed;\n    return data;\n};\n\nEuler_Animation.prototype.parse = function (param) {\n    Base_Animation.prototype.parse.call(this, param);\n    this.xspeed = param.xspeed;\n    this.yspeed = param.yspeed;\n    this.zspeed = param.zspeed;\n    this.x = this.y = this.z = 0;\n};\n\n\n\n/***/ }),\n/* 12 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Loading_Manager; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n\n\n//events: \n//item_loaded\n//onerror\n//onprogress\n//finished\nfunction Chain_Loader() {}\n\nChain_Loader.prototype = {\n\tconstructor: Chain_Loader,\n\tstart: function (list) {\n\t\tthis.list = list;\n\t\tthis.index = 0;\n\t\tthis.load(this.list[0]);\n\t\tthis.stop_by_error = false;\n\t},\n\n\tnext: function (resource) {\n\t\tif (this.item_loaded && resource) {\n\t\t\tthis.item_loaded(resource, this.list[this.index]);\n\t\t}\n\t\tthis.index++;\n\t\tif (this.index < this.list.length) {\n\t\t\tthis.load(this.list[this.index]);\n\t\t} else {\n\t\t\tif (this.finished) {\n\t\t\t\tthis.finished();\n\t\t\t}\n\t\t}\n\t},\n\n\tdo_error: function (error) {\n\t\tif (this.onerror) {\n\t\t\tthis.onerror(error);\n\t\t} else {\n\t\t\tconsole.error(\"Error!\", error);\n\t\t}\n\t\tif (!this.stop_by_error) {\n\t\t\tthis.next();\n\t\t}\n\t},\n\n\tdo_progress: function () {\n\t\tif (this.onprogress) {\n\t\t\tthis.onprogress.apply(this, arguments);\n\t\t}\n\t},\n\n\tload: function (item) {\n\t\tvar self = this;\n\t\tif (this.load_func) {\n\t\t\tthis.load_func(item, function (item) {\n\t\t\t\tself.next.apply(self, arguments);\n\t\t\t}, function (item) {\n\t\t\t\tself.do_error.apply(self, arguments);\n\t\t\t}, function (item) {\n\t\t\t\tself.do_progress.apply(self, arguments);\n\t\t\t});\n\t\t}\n\t}\n};\n\nfunction test_chain_loader() {\n\tvar cl = new Chain_Loader();\n\tcl.item_loaded = function (item) {\n\t\tconsole.log(\"load item \", item);\n\t};\n\tcl.finished = function (item) {\n\t\tconsole.log(\"loader manager - job done\");\n\t};\n\tcl.load_func = function (item, next, error, progress) {\n\t\tif (item) {\n\t\t\tnext(item);\n\t\t} else {\n\t\t\terror(item);\n\t\t}\n\t};\n\tcl.start([\"first\", \"second\", null, \"tree\"]);\n}\n//test_chain_loader();\n\n\nfunction Loading_Manager() {\n\tthis.resources = {};\n\tthis.texture_loader = new THREE.TextureLoader();\n}\n\nLoading_Manager.prototype = {\n\tconstructor: Loading_Manager,\n\tget: function (name) {\n\t\treturn this.resources[name];\n\t},\n\n\tget_async: function (name, callback) {\n\t\t//already loaded?\n\t\tvar texture = this.get(name);\n\t\tif (texture) {\n\t\t\tif (callback) {\n\t\t\t\tcallback(texture);\n\t\t\t}\n\t\t\treturn texture;\n\t\t}\n\n\t\t//if not load this async\n\t\tvar self = this;\n\t\ttexture = this.texture_loader.load(name, function (texture) {\n\t\t\tif (callback) {\n\t\t\t\tcallback(texture);\n\t\t\t}\n\t\t});\n\t\tthis.resources[name] = texture;\n\t\treturn texture;\n\t},\n\n\tload_list: function (resource_list, on_load, load_func, on_progress) {\n\t\tvar self = this;\n\n\t\tvar cl = new Chain_Loader();\n\t\tvar self = this;\n\t\tcl.onerror = function (error) {\n\t\t\tconsole.error(\"ERROR loading texture\", error, cl.list[cl.index]);\n\t\t};\n\t\tcl.item_loaded = function (resource, name) {\n\t\t\tself.resources[name] = resource;\n\t\t\tif (self.on_resource_loaded) {\n\t\t\t\tself.on_resource_loaded(resource);\n\t\t\t}\n\t\t};\n\t\tcl.on_progress = function () {\n\t\t\tif (on_progress) {\n\t\t\t\ton_progress();\n\t\t\t}\n\t\t};\n\t\tcl.load_func = function () {\n\t\t\tload_func.apply(this, arguments);\n\t\t};\n\t\tcl.finished = function () {\n\t\t\tif (on_load) {\n\t\t\t\ton_load();\n\t\t\t}\n\t\t};\n\t\tcl.start(resource_list);\n\t},\n\n\tload_list_textures: function (resource_list, on_load) {\n\t\tvar self = this;\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress) {\n\t\t\tvar texture = self.texture_loader.load(url, next, progress, error);\n\t\t});\n\t},\n\n\tload_list_json: function (resource_list, on_load, progress) {\n\t\tvar self = this;\n\t\tvar loader = new THREE.XHRLoader();\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress) {\n\t\t\tvar texture = loader.load(url, next, progress, error);\n\t\t}, progress);\n\t},\n\n\tfree: function () {\n\t\tthis.resources = {};\n\t}\n};\n\n__WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Texture_Manager = new Loading_Manager();\n\n\n\n/***/ }),\n/* 13 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Package_Manager; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n//TODO: remove this ugly crap and replace something reasonable\n\n\n\n//this ugly class loading texture list in json format, parse it, and loading textures\n//then it call event data_loaded, when give texture list in json format\n\nfunction Package_Manager() {\n    this.state = {};\n}\n\n//load json file with descriptions of package: texture list, particles list, scene objects list\nPackage_Manager.prototype.load = function (url, defaults) {\n    this.defaults = defaults;\n    var self = this;\n    this.state = {\n        \"type\": \"start\"\n    };\n\n    var self = this;\n    function onload(data) {\n        self.state[\"type\"] = \"done\";\n        self.state[\"data\"] = data;\n\n        self.parse_package_description(data);\n    }\n    function error(event) {\n        self.state[\"type\"] = \"error\";\n        self.state[\"error\"] = event;\n        console.error(\"ERror! Failed loading resources with url \" + url, event.target);\n        if (self.error) {\n            self.error(event.target);\n        }\n        self.pack = self.defaults;\n        self.load_resources(self.defaults);\n    }\n    function progress() {}\n    var xhr = new THREE.XHRLoader();\n    xhr.load(url, onload, progress, error);\n};\n\n//parse loaded json file \nPackage_Manager.prototype.parse_package_description = function (data) {\n    console.log(\"packaged description loaded, begin parsing...\");\n    try {\n        var pack = JSON.parse(data);\n        this.pack = pack;\n        if (this.loaded) {\n            this.loaded(pack);\n        }\n    } catch (e) {\n        console.error(\"error parsing resources \", e);\n        if (this.error) {\n            this.error(event);\n        }\n        return;\n    }\n    this.load_resources(pack);\n};\n\nPackage_Manager.prototype.load_resources = function (pack) {\n    var self = this;\n    //load textures\n    console.log(\"Package Manager: begin loading textures...\");\n    __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Texture_Manager.load_list_textures(pack.textures, function () {\n        //load json descriptions files\n        if (self.data_loaded) {\n            self.data_loaded(pack);\n        }\n    });\n};\n\n\n\n/***/ }),\n/* 14 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Scene_Serializer; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particles_particles_manager_js__ = __webpack_require__(8);\n\n\n\nfunction Scene_Serializer(root) {\n    this.animation_library = {};\n}\n\nScene_Serializer.prototype.toJSON = function (root) {\n    this.json = root.toJSON();\n    console.log(\"my lib particle manager\", __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].particle_manager);\n    this.json[\"particles\"] = __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].particle_manager.toJSON();\n    var anims = root.collect_animations(root);\n    if (anims.count > 0) {\n        this.json[\"myanimations\"] = anims;\n    }\n\n    return this.json;\n};\n\nScene_Serializer.prototype.create_animations = function (animations) {\n    for (var key in animations) {\n        if (this.animation_library[key] === undefined && Object.prototype.hasOwnProperty.call(animations, key)) {\n            var data = animations[key];\n            //console.log(\"create animations \", data.uuid);            \n            var anim = __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].Abstract_Fabric(data);\n            if (anim) {\n                this.animation_library[key] = anim;\n            }\n        }\n    }\n};\n\nScene_Serializer.prototype.bind_animations = function (animdata) {\n    if (!animdata) return;\n\n    var bindings = animdata.bindings;\n\n    var self = this;\n    function copy_animations(obj, bind) {\n        for (var i = 0; i < bind.animations.length; i++) {\n            var anim_uuid = bind.animations[i];\n            obj.add_animation(self.animation_library[anim_uuid]);\n        }\n    }\n\n    for (var i = 0; i < bindings.length; i++) {\n        var bind = bindings[i];\n        var uuid = bind.uuid;\n        var obj = this.root.getObjectByProperty(\"uuid\", uuid);\n        if (obj) {\n            copy_animations(obj, bind);\n        }\n    }\n};\n\nScene_Serializer.prototype.load_from_json = function (url) {\n    var self = this;\n    function onload(json) {\n        try {\n            var data = JSON.parse(json);\n        } catch (e) {\n            console.error(\"Failed to parse scene \", e);\n            throw e;\n        }\n        if (data === undefined) {\n            console.error(\"Something fucking happened, failed to load scene \", url);\n            return;\n        }\n        self.load(data);\n    }\n    function progress() {}\n    function error(e) {\n        console.error(e.target);\n        throw e;\n    }\n    var xhr = new THREE.XHRLoader();\n    xhr.load(url, onload, progress, error);\n};\n\nScene_Serializer.prototype.load = function (json) {\n    this.animation_library = {};\n    var o = new THREE.ObjectLoader();\n    if (json !== undefined) {\n        this.json = json;\n    }\n    var root = o.parse(this.json, function () {\n        console.log(\"onload\");\n    });\n    this.root = root;\n\n    __WEBPACK_IMPORTED_MODULE_0__my_lib_js__[\"a\" /* My_Lib */].particle_manager.load_particles(this.json, root);\n\n    this.create_animations(this.json.myanimations.animations);\n    this.bind_animations(this.json.myanimations);\n    this.main_camera = root.getObjectByName(\"main_camera\");\n\n    if (this.scene_loaded) {\n        this.scene_loaded(root);\n    }\n    return root;\n};\n\n\n\n/***/ }),\n/* 15 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export Mix_It */\nfunction Mix_It() {\n\n    //FIX\n    THREE.Vector3.prototype.applyMatrix4_rotation = function (m) {\n        // input: THREE.Matrix4 affine matrix\n\n        var x = this.x,\n            y = this.y,\n            z = this.z;\n        var e = m.elements;\n\n        this.x = e[0] * x + e[4] * y + e[8] * z;\n        this.y = e[1] * x + e[5] * y + e[9] * z;\n        this.z = e[2] * x + e[6] * y + e[10] * z;\n\n        return this;\n    };\n\n    var Object3D_Animation_Mixin = {\n\n        add_animation: function (anim) {\n            if (!this.animations) {\n                this.animations = [];\n            }\n            if (this.animations.indexOf(anim) < 0) {\n                this.animations.push(anim);\n            }\n        },\n\n        remove_animation: function (anim) {\n            if (this.animations) {\n                var i = this.animations.indexOf(anim);\n                if (i > -1) {\n                    this.animations.splice(i, 1);\n                }\n            }\n        },\n\n        update: function (dt) {\n            if (this.animations !== undefined) {\n                for (var i = 0; i < this.animations.length; i++) {\n                    var anim = this.animations[i];\n                    anim.update(dt);\n                    anim.apply(this);\n                }\n            }\n\n            for (var i = 0; i < this.children.length; i++) {\n                var obj = this.children[i];\n                if (obj.update) {\n                    obj.update(dt);\n                }\n            }\n        }\n\n    };\n    _.copy_object(THREE.Object3D.prototype, Object3D_Animation_Mixin);\n\n    THREE.Object3D.prototype.old_toJson = THREE.Object3D.toJSON;\n\n    var Object3D_Serialization_Mixin = {\n        standard_serialization: function (meta) {\n            // standard Object3D serialization\n            var object = {};\n\n            object.uuid = this.uuid;\n            object.type = this.type;\n            if (this.name !== '') object.name = this.name;\n            if (JSON.stringify(this.userData) !== '{}') object.userData = this.userData;\n            if (this.castShadow === true) object.castShadow = true;\n            if (this.receiveShadow === true) object.receiveShadow = true;\n            if (this.visible === false) object.visible = false;\n\n            object.matrix = this.matrix.toArray();\n\n            if (this.type !== \"particles_points\") {\n                if (this.geometry !== undefined) {\n                    object.geometry = this.geometry.uuid;\n                }\n                if (this.material !== undefined) {\n                    object.material = this.material.uuid;\n                }\n\n                if (this.material !== undefined && meta.materials[this.material.uuid] === undefined) {\n                    meta.materials[this.material.uuid] = this.material.toJSON(meta);\n                }\n\n                if (this.geometry !== undefined && meta.geometries[this.geometry.uuid] === undefined) {\n                    meta.geometries[this.geometry.uuid] = this.geometry.toJSON(meta);\n                }\n            }\n\n            if (this.animations) {\n                object.animations = [];\n                for (var i = 0; i < this.animations.length; i++) {\n                    object.animations.push(this.animations[i].uuid);\n                }\n            }\n\n            if (this.children.length > 0) {\n                object.children = [];\n                for (var i = 0; i < this.children.length; i++) {\n                    var child = this.children[i];\n                    //object.children.push( child.standard_serialization( meta ) );\n                    object.children.push(child.toJSON(meta));\n                }\n            }\n            return object;\n        },\n\n        collect_materials: function (meta) {\n            if (this.material !== undefined && meta.materials[this.material.uuid] === undefined) {\n                meta.materials[this.material.uuid] = this.material.toJSON(meta);\n            }\n\n            for (var i = 0; i < this.children.length; i++) {\n                this.children[i].collect_materials(meta);\n            }\n        },\n\n        collect_geometry: function (meta) {\n            if (this.geometry !== undefined && meta.geometries[this.geometry.uuid] === undefined) {\n                meta.geometries[this.geometry.uuid] = this.geometry.toJSON(meta);\n            }\n\n            for (var i = 0; i < this.children.length; i++) {\n                this.children[i].collect_geometry(meta);\n            }\n        },\n\n        toJSON1: function (meta) {\n\n            // extract data from the cache hash\n            // remove metadata on each item\n            // and return as array\n            function extractFromCache(cache, t) {\n                var values = [];\n                for (var key in cache) {\n                    var data = cache[key];\n                    delete data.metadata;\n                    values.push(data);\n                }\n                return values;\n            }\n\n            this.updateMatrixWorld(true);\n\n            // meta is '' when called from JSON.stringify\n            var isRootObject = meta === undefined || meta === '';\n\n            var output = {};\n\n            if (isRootObject) {\n\n                meta = {\n                    geometries: {},\n                    materials: {},\n                    textures: {},\n                    images: {}\n                };\n\n                //this.collect_materials(meta);\n                //this.collect_geometry(meta);\n                var object = this.standard_serialization(meta);\n\n                output.metadata = {\n                    version: 4.4,\n                    type: 'Object',\n                    generator: 'Object3D.toJSON'\n                };\n\n                var geometries = extractFromCache(meta.geometries, \"geoim\");\n                var materials = extractFromCache(meta.materials, \"materials\");\n                var textures = extractFromCache(meta.textures, \"textures\");\n                var images = extractFromCache(meta.images, \"images\");\n\n                if (geometries.length > 0) output.geometries = geometries;\n                if (materials.length > 0) output.materials = materials;\n                if (textures.length > 0) output.textures = textures;\n                if (images.length > 0) output.images = images;\n\n                var anims = this.collect_animations(this);\n                if (anims.count > 0) {\n                    output[\"myanimations\"] = anims;\n                }\n\n                output.object = object;\n            } else {\n                output.object = this.standard_serialization(meta);\n                output.type = this.type;\n                if (output.object === undefined) {\n                    console.log(\"i am undefined\", this);\n                }\n            }\n\n            return output;\n        },\n\n        collect_animations: function (scene) {\n            var data = {\n                animations: {},\n                bindings: [],\n                count: 0\n            };\n\n            function collect_animations_recursive(root) {\n                if (root.animations) {\n                    for (var i = 0; i < root.animations.length; i++) {\n                        var anim = root.animations[i];\n                        if (data.animations[anim.uuid] === undefined) {\n                            data.animations[anim.uuid] = anim.toJSON();\n                            data.count++;\n                        }\n                    }\n\n                    var bind = {};\n                    bind.uuid = root.uuid;\n                    bind.animations = [];\n                    for (var i = 0; i < root.animations.length; i++) {\n                        bind.animations.push(root.animations[i].uuid);\n                    }\n                    data.bindings.push(bind);\n                }\n\n                if (root.children) {\n                    for (var i = 0; i < root.children.length; i++) {\n                        collect_animations_recursive(root.children[i]);\n                    }\n                }\n            }\n            collect_animations_recursive(scene);\n            return data;\n        }\n\n    };\n\n    _.copy_object(THREE.Object3D.prototype, Object3D_Serialization_Mixin);\n\n    //replace source with this\n    THREE.Object3D.prototype.replace_object_with_this = function (source) {\n\n        this.uuid = source.uuid;\n        this.name = source.name;\n\n        this.up.copy(source.up);\n        this.position.copy(source.position);\n        this.quaternion.copy(source.quaternion);\n        this.scale.copy(source.scale);\n\n        this.matrix.copy(source.matrix);\n        this.matrixWorld.copy(source.matrixWorld);\n\n        this.matrixAutoUpdate = source.matrixAutoUpdate;\n        this.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\n\n        this.visible = source.visible;\n\n        this.castShadow = source.castShadow;\n        this.receiveShadow = source.receiveShadow;\n\n        this.frustumCulled = source.frustumCulled;\n        this.renderOrder = source.renderOrder;\n\n        this.userData = JSON.parse(JSON.stringify(source.userData));\n\n        //copy array of children, not clone\n        for (var i = 0; i < source.children.length; i++) {\n            this.add(source.children[i]);\n        }\n        source.parent.add(this);\n        source.parent.remove(source);\n\n        this.animations = source.animations;\n    };\n}\n\nMix_It();\n\n\n\n/***/ }),\n/* 16 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Custom_Affector; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_affector_js__ = __webpack_require__(1);\n\n\n\nfunction Custom_Affector() {\n    __WEBPACK_IMPORTED_MODULE_1__particle_affector_js__[\"a\" /* Particle_Affector */].apply(this, arguments);\n    this.custom_func = function dummy() {\n        return true;\n    };\n}\n\nCustom_Affector.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_1__particle_affector_js__[\"a\" /* Particle_Affector */].prototype);\n\n_.copy_object(Custom_Affector.prototype, {\n    constructor: Custom_Affector,\n    affect: function (dt, pdata, vert) {\n        return this.custom_func(dt, p, vert);\n    },\n    test_func: function () {\n        var p = {\n            position: { x: 0, y: 0, z: 0 },\n            velocity: { x: 0, y: 0, z: 0 }\n        };\n        var color = { r: 0, g: 0, b: 0 };\n        this.custom_func(p, color);\n    },\n    set_affect_function: function (source) {\n        if (typeof source === 'function') {\n            this.custom_func = source;\n        } else if (typeof source === 'string') {\n            try {\n                this.custom_func = new Function('dt,p,vert', source);\n                this.test_func();\n            } catch (e) {\n                alert(e);\n                this.custom_func = undefined;\n            }\n            this.source_code = source;\n        }\n    },\n\n    toJSON: function () {\n        var data = {\n            name: \"Custom_Affector\"\n        };\n        data.params = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Affector.prototype.toJSON.call(this, this);\n        params[\"source_code\"] = this.source_code;\n        return data;\n    },\n    parse: function (json) {\n        __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Affector.prototype.parse(this, json);\n        this.set_affect_func(json.source_code);\n    }\n\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Custom_Affector\", Custom_Affector);\n\n\n\n/***/ }),\n/* 17 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Custom_Emitter; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__ = __webpack_require__(2);\n\n\n\nfunction Custom_Emitter() {\n    __WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */].apply(this, arguments);\n}\n\nCustom_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_1__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\n\nvar methods = {\n    emit: function (p, color) {\n        if (this.custom_func) {\n            this.custom_func(p, color);\n        }\n    },\n    test_func: function () {\n        var p = {\n            position: { x: 0, y: 0, z: 0 },\n            velocity: { x: 0, y: 0, z: 0 }\n        };\n        var color = { r: 0, g: 0, b: 0 };\n        this.custom_func(p, color);\n    },\n    set_emit_function: function (source) {\n        if (typeof source === 'function') {\n            this.custom_func = source;\n        } else if (typeof source === 'string') {\n            try {\n                this.custom_func = new Function('p', 'color', source);\n                this.test_func();\n            } catch (e) {\n                alert(e);\n                this.custom_func = undefined;\n            }\n            this.source_code = source;\n        }\n    },\n    toJSON: function () {\n        var data = {};\n        data.name = \"Custom_Emitter\";\n        data.params = __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Emitter.prototype.toJSON.call(this, this);\n        if (this.source_code) {\n            data.params.source_code = this.source_code;\n        }\n        return data;\n    },\n    parse: function (data) {\n        __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Particle_Emitter.prototype.parse.call(this, data);\n        this.set_emit_function(data.source_code);\n    },\n    constructor: Custom_Emitter\n};\n\n_.copy_object(Custom_Emitter.prototype, methods);\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Custom_Emitter\", Custom_Emitter);\n\nfunction test() {\n    var t = new Custom_Emitter();\n    var source = 'p.position.z = -100; p.velocity.y = 100;';\n    t.set_emit_function(source);\n    var p = {\n        velocity: { x: 0, y: 0, z: 0 },\n        position: { x: 0, y: 0, z: 0 }\n    };\n    t.custom_func(p);\n    console.log(p);\n    var json = t.toJSON();\n    console.log(json);\n\n    t = new Custom_Emitter();\n    t.parse(json.params);\n    //console.log(t.custom_func);    \n}\n\n//test();\n\n/*\r\nCustom_Emitter.prototype = Object.create(My_Lib.Particle_Emitter.prototype);\r\nCustom_Emitter.prototype.constructor = Cone_Emitter;\r\nMy_Lib.Register_Class(\"Custom_Emitter\", Cone_Emitter);\r\n*/\n\n\n\n/***/ }),\n/* 18 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Particle_Forces; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n\n\nvar Particle_Forces = {};\n\n//base class\nParticle_Forces.Force = function () {};\n\n_.copy_object(Particle_Forces.Force.prototype, {\n\tcalc: function (dt, particle, acceleration) {},\n\ttoJSON: function (child) {\n\t\treturn {};\n\t},\n\tparse: function (json) {}\n});\n\n//constant force\nParticle_Forces.Constant_Force = function (force) {\n\tif (typeof force !== 'undefined') {\n\t\tthis.force = force;\n\t} else {\n\t\tthis.force = { x: 0, y: 0, z: 0 };\n\t}\n};\n\nParticle_Forces.Constant_Force.prototype = Object.create(Particle_Forces.Force.prototype);\n_.copy_object(Particle_Forces.Constant_Force.prototype, {\n\tconstructor: Particle_Forces.Constant_Force,\n\tcalc: function (dt, p, acceleration) {\n\t\tacceleration.x += this.force.x;\n\t\tacceleration.y += this.force.y;\n\t\tacceleration.z += this.force.z;\n\t},\n\ttoJSON: function (child) {\n\t\tvar data = {};\n\t\tdata.name = \"Constant_Force\";\n\t\tdata.force = _.create_clone_object(this.force);\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\tif (json.force) {\n\t\t\t_.copy_object(this.force, json.force);\n\t\t}\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Constant_Force\", Particle_Forces.Constant_Force);\n\n\n\n/***/ }),\n/* 19 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Cone_Emitter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return Star_Dust_Emitter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"c\", function() { return Sphere_Emitter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"d\", function() { return Star_Dust_Affector; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__point_generators_js__ = __webpack_require__(9);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__particle_affector_js__ = __webpack_require__(1);\n\n\n\n\n\nfunction Cone_Emitter() {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].apply(this, arguments);\n\tthis.generator = new __WEBPACK_IMPORTED_MODULE_1__point_generators_js__[\"a\" /* Point_Generators */].Random_Direction();\n\tthis.origin = new THREE.Vector3(1, 1, 0);\n\tthis.velocity = new THREE.Vector3(0, 1, 0);\n\tthis.dispersion = { \"min\": 5, \"max\": 10 };\n\tthis.dispersion.delta = 5;\n\tthis.speed = { min: 5, max: 10, delta: 5 };\n\tthis.color = new THREE.Color(1, 1, 1);\n}\n\nCone_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\nCone_Emitter.prototype.constructor = Cone_Emitter;\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Cone_Emitter\", Cone_Emitter);\n\nCone_Emitter.prototype.toJSON = function () {\n\tvar data = {};\n\tdata.name = \"Cone_Emitter\";\n\tdata.params = __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.toJSON.call(this, this);\n\t_.clone_field_list_one_level_recursion(this, data.params, [\"origin\", \"velocity\", \"dispersion\", \"speed\"]);\n\n\treturn data;\n};\n\nCone_Emitter.prototype.parse = function (data) {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.parse.call(this, data);\n\tthis.origin.copy(data.origin);\n\tthis.velocity.copy(data.velocity);\n\tthis.set_dispersion(data.dispersion.min, data.dispersion.max);\n\tthis.set_speed(data.speed.min, data.speed.max);\n};\n\nCone_Emitter.prototype.set_speed = function (min, max) {\n\tthis.speed.min = min;\n\tthis.speed.max = max;\n\tthis.speed.delta = max - min;\n};\n\nCone_Emitter.prototype.set_dispersion = function (min, max) {\n\tthis.dispersion.min = min;\n\tthis.dispersion.max = max;\n\tthis.dispersion.delta = max - min;\n};\n\nCone_Emitter.prototype.emit = function (p, color, matrix) {\n\tp.position.copy(this.origin);\n\n\tthis.generator.get_direction(p.velocity);\n\tp.velocity.multiplyScalar(Math.random() * this.dispersion.delta + this.dispersion.min);\n\tp.velocity.add(this.velocity).normalize();\n\n\tif (matrix) {\n\t\tp.position.applyMatrix4(matrix);\n\t\tp.velocity.applyMatrix4_rotation(matrix);\n\t}\n\n\tp.velocity.multiplyScalar(Math.random() * this.speed.delta + this.speed.min);\n\n\tif (color) {\n\t\tthis.emit_color(color);\n\t}\n};\n\nCone_Emitter.prototype.emit_color = function (color) {\n\tcolor.copy(this.color);\n};\n\nfunction Sphere_Emitter(radius) {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].call(this);\n\tthis.radius = radius;\n\tthis.generator = new __WEBPACK_IMPORTED_MODULE_1__point_generators_js__[\"a\" /* Point_Generators */].Sphere(radius);\n}\n\nSphere_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\nSphere_Emitter.prototype.constructor = Sphere_Emitter;\n\nSphere_Emitter.prototype.emit = function (p) {\n\tthis.generator.get_point(p.position);\n\tthis.generator.get_normal(p.velocity);\n\tp.velocity.multiplyScalar(10);\n};\n\nfunction Star_Dust_Emitter() {\n\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].apply(this, arguments);\n\tthis.start_position = new THREE.Vector3(0, 0, 0);\n\tthis.end_position = new THREE.Vector3(1, 1, 1);\n\tthis.delta = new THREE.Vector3(1, 1, 1);\n\tthis.velocity = new THREE.Vector3(0, 0, 1);\n}\n\nStar_Dust_Emitter.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype);\nStar_Dust_Emitter.prototype.constructor = Star_Dust_Emitter;\n_.copy_object(Star_Dust_Emitter.prototype, {\n\tset_velocity: function (x, y, z) {\n\t\tthis.velocity.set(x, y, z);\n\t},\n\tset_position_range: function (start, end) {\n\t\tthis.start_position.copy(start);\n\t\tthis.end_position.copy(end);\n\t\tthis.delta.set(end.x - start.x, end.y - start.y, end.z - start.z);\n\t},\n\tget_position: function (vector) {\n\t\tvector.x = Math.random() * this.delta.x + this.start_position.x;\n\t\tvector.y = Math.random() * this.delta.y + this.start_position.y;\n\t\tvector.z = Math.random() * this.delta.z + this.start_position.z;\n\t},\n\tget_velocity: function (vector) {\n\t\tvector.x = this.velocity.x;\n\t\tvector.y = this.velocity.y;\n\t\tvector.z = this.velocity.z;\n\t},\n\temit: function (p) {\n\t\tthis.get_position(p.position);\n\t\tif (this.parent) {\n\t\t\tthis.parent.localToWorld(p.position);\n\t\t}\n\t\tthis.get_velocity(p.velocity);\n\t},\n\ttoJSON: function () {\n\t\tvar params = __WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.toJSON.call(this, this);\n\t\t_.clone_field_list_one_level_recursion(this, params, [\"velocity\", \"start_position\", \"end_position\"]);\n\t\tvar data = {\n\t\t\t\"name\": \"Star_Dust_Emitter\",\n\t\t\t\"params\": params\n\t\t};\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\t__WEBPACK_IMPORTED_MODULE_2__particle_emitter_js__[\"a\" /* Particle_Emitter */].prototype.parse.call(this, json);\n\t\tthis.set_position_range(json.start_position, json.end_position);\n\t\tthis.velocity.copy(json.velocity);\n\t}\n\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Star_Dust_Emitter\", Star_Dust_Emitter);\n\nfunction Star_Dust_Affector(end) {\n\tthis.end = end || 0;\n}\n\nStar_Dust_Affector.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_3__particle_affector_js__[\"a\" /* Particle_Affector */].prototype);\nStar_Dust_Affector.prototype.constructor = Star_Dust_Affector;\n\n_.copy_object(Star_Dust_Affector.prototype, {\n\taffect: function (dt, pdata, vert) {\n\t\tif (pdata.position.z > this.end) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\ttoJSON: function () {\n\t\tvar params = __WEBPACK_IMPORTED_MODULE_3__particle_affector_js__[\"a\" /* Particle_Affector */].prototype.toJSON.call(this, this);\n\t\tparams[\"end\"] = this.end;\n\t\tvar data = {\n\t\t\t\"name\": \"Star_Dust_Affector\",\n\t\t\t\"params\": params\n\n\t\t};\n\t\treturn data;\n\t},\n\tparse: function (json) {\n\t\t__WEBPACK_IMPORTED_MODULE_3__particle_affector_js__[\"a\" /* Particle_Affector */].prototype.parse(this, json);\n\t\tthis.end = json.end;\n\t}\n});\n\n__WEBPACK_IMPORTED_MODULE_0__base_my_lib_js__[\"a\" /* My_Lib */].Register_Class(\"Star_Dust_Affector\", Star_Dust_Affector);\n\n\n\n/***/ }),\n/* 20 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__ = __webpack_require__(4);\n/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, \"main_event_hub\", function() { return __WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__[\"a\"]; });\n/* harmony namespace reexport (by provided) */ __webpack_require__.d(__webpack_exports__, \"Event_Hub\", function() { return __WEBPACK_IMPORTED_MODULE_0__base_event_hub_js__[\"b\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__base_my_lib_js__ = __webpack_require__(0);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"My_Lib\", function() { return __WEBPACK_IMPORTED_MODULE_1__base_my_lib_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__base_animations_js__ = __webpack_require__(11);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Base_Animation\", function() { return __WEBPACK_IMPORTED_MODULE_2__base_animations_js__[\"a\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Euler_Animation\", function() { return __WEBPACK_IMPORTED_MODULE_2__base_animations_js__[\"b\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__base_mouse_intersector_js__ = __webpack_require__(5);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Mouse_Intersector\", function() { return __WEBPACK_IMPORTED_MODULE_3__base_mouse_intersector_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__base_loading_manager_js__ = __webpack_require__(12);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Loading_Manager\", function() { return __WEBPACK_IMPORTED_MODULE_4__base_loading_manager_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__base_package_manager_js__ = __webpack_require__(13);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Package_Manager\", function() { return __WEBPACK_IMPORTED_MODULE_5__base_package_manager_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__particles_particles_points_js__ = __webpack_require__(3);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particles_Points\", function() { return __WEBPACK_IMPORTED_MODULE_6__particles_particles_points_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__particles_particle_emitter_js__ = __webpack_require__(2);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_7__particles_particle_emitter_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__particles_forces_js__ = __webpack_require__(18);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Forces\", function() { return __WEBPACK_IMPORTED_MODULE_8__particles_forces_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__particles_particle_affector_js__ = __webpack_require__(1);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Affector\", function() { return __WEBPACK_IMPORTED_MODULE_9__particles_particle_affector_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__particles_point_generators_js__ = __webpack_require__(9);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Point_Generators\", function() { return __WEBPACK_IMPORTED_MODULE_10__particles_point_generators_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__particles_custom_emitter_js__ = __webpack_require__(17);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Custom_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_11__particles_custom_emitter_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__particles_custom_affector_js__ = __webpack_require__(16);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Custom_Affector\", function() { return __WEBPACK_IMPORTED_MODULE_12__particles_custom_affector_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__ = __webpack_require__(19);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Cone_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"a\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Star_Dust_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"b\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Sphere_Emitter\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"c\"]; });\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Star_Dust_Affector\", function() { return __WEBPACK_IMPORTED_MODULE_13__particles_test_emitters_js__[\"d\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_14__particles_particle_shaders_js__ = __webpack_require__(6);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Shaders\", function() { return __WEBPACK_IMPORTED_MODULE_14__particles_particle_shaders_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15__particles_particles_js__ = __webpack_require__(7);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_System\", function() { return __WEBPACK_IMPORTED_MODULE_15__particles_particles_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_16__particles_particles_manager_js__ = __webpack_require__(8);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle_Manager\", function() { return __WEBPACK_IMPORTED_MODULE_16__particles_particles_manager_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_17__base_scene_serializer_js__ = __webpack_require__(14);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Scene_Serializer\", function() { return __WEBPACK_IMPORTED_MODULE_17__base_scene_serializer_js__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_18__base_threejs_mixins_js__ = __webpack_require__(15);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_19__app_application_js__ = __webpack_require__(10);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Application\", function() { return __WEBPACK_IMPORTED_MODULE_19__app_application_js__[\"a\"]; });\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// prod.build.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f0d2e7d815244ec10fd6","/*\r\n*/\r\n\r\n\r\nvar My_Lib = {};\r\n\r\nMy_Lib.Viewport = {};\r\n\r\n\r\nMy_Lib.Object_Animation = function (object, animation)\r\n{\r\n\tthis.object = object;\r\n\tthis.animation = animation;\r\n}\r\n\r\nMy_Lib.Object_Animation.prototype.update = function (dt)\r\n{\r\n\tthis.animation(this.object, dt);\r\n}\r\n\r\nMy_Lib.create_text_image = function (width, height, text, npot, background) \r\n{\r\n\t// create a canvas element\r\n\tvar canvas = document.createElement('canvas');\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tvar context = canvas.getContext('2d');\r\n\tif (background) \r\n\t{\r\n\t\tcontext.fillStyle = background;\r\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\r\n\t}\r\n\tcontext.font = \"Bold 40px Arial\";\r\n\tcontext.fillStyle = \"rgba(0,255,0,0.95)\";\r\n    context.fillText('Hello, world!', 0, 50);\r\n    \r\n\t// canvas contents will be used for a texture\r\n\tvar texture = new THREE.Texture(canvas) \r\n\tif (npot) {\r\n\t\ttexture.wrapS = texture.wrapT = THREE.TextureWrapping.ClampToEdgeWrapping;\r\n\t\ttexture.minFilter = THREE.LinearFilter;\r\n\t}\r\n\ttexture.needsUpdate = true; \t\r\n\treturn texture;\r\n}\r\n\r\n\r\nMy_Lib.Create_Quad = function (width, height, vertex_shader, fragment_shader)\r\n{\r\n\t//plane created turn away from camera\r\n\tvar plane = new THREE.PlaneBufferGeometry( width, height);\r\n\t\r\n\tvar material = new THREE.ShaderMaterial( {\r\n\t\tvertexShader: vertex_shader,\r\n\t\tfragmentShader: fragment_shader\r\n\t} ); \r\n\r\n\tvar quad = new THREE.Mesh( plane, material );\r\n\tquad.rotation.y = Math.PI;\r\n\treturn quad;\r\n}\r\n\r\n\r\nMy_Lib.Render_Target = function (width, height)\r\n{\r\n\tthis.target = new THREE.WebGLRenderTarget( \r\n\twidth, \r\n\theight, \r\n\t{ \r\n\t\tminFilter: THREE.LinearFilter, \r\n\t\tmagFilter: THREE.NearestFilter, \r\n\t\tformat: THREE.RGBFormat \r\n\t} ); \r\n\t\r\n\tthis.camera = new THREE.PerspectiveCamera(80, width/height, 0.1, 1000);\r\n}\r\n\r\nMy_Lib.Render_Target.prototype.render = function (scene, renderer)\r\n{\r\n\trenderer.render( scene, \r\n\t\tthis.camera, \r\n\t\tthis.target, \r\n\t\ttrue  //forceClear\r\n\t\t);\r\n}\r\n\r\n\r\nMy_Lib.create_overlay_camera = function (width, height)\r\n{\r\n\tvar camera =  new THREE.OrthographicCamera( \r\n\t\twidth / - 2, \r\n\t\twidth / 2, \r\n\t\theight / 2, \r\n\t\theight /- 2, -10000, 10000 );\r\n\treturn camera;\r\n}\r\n\r\nMy_Lib.Overlay = function (width, height)\r\n{\r\n\tthis.camera = My_Lib.create_overlay_camera(width, height);\r\n}\r\n\r\nMy_Lib.Overlay.prototype.render = function (renderer)\r\n{\r\n\tif (!this.scene) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\trenderer.autoClear = false;\r\n\trenderer.render(this.scene, this.camera);\r\n\trenderer.autoClear = true;\r\n}\r\n\r\n\r\nMy_Lib.Mouse_Controller = function (root, over, click, callback)\r\n{\r\n\tthis.root = root;\r\n\tthis.over = over;\r\n\tthis.click = !!click;\r\n\tthis.callback = callback;\r\n}\r\n\r\n\r\n\r\n/*\r\nugly hack\r\n*/\r\n\r\nMy_Lib.event_hub = new Event_Hub();\r\n\r\nfunction Event_Hub() {\r\n    this.events = {};\r\n}\r\n\r\n\r\n\r\nEvent_Hub.prototype.add_event_listener = function (name, func, obj)\r\n{\r\n    if (!this.events[name]) {\r\n        this.events[name] = [];\r\n    }\r\n    this.events[name].push( {name: name, func: func, obj: obj} );\r\n}\r\n\r\nEvent_Hub.prototype.on  = Event_Hub.prototype.add_event_listener;\r\n\r\nEvent_Hub.prototype.emit = function(name, obj)\r\n{\r\n    var listeners = this.events[name];\r\n    if (listeners) {\r\n        for(var i = 0; i < listeners.length; i++) {\r\n            var t = listeners[i];\r\n            t.func.call(t.obj, obj);            \r\n        }\r\n    }\r\n}\r\n\r\n\r\nvar run_function = //window.requestAnimationFrame;\r\n\tfunction(callback){\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t}\r\n\r\n\r\nMy_Lib.create_run_function = function (app) \r\n{\r\n    My_Lib.run = function () { run_function( function () { app.loop(); }); }\r\n}\r\n\r\n\r\n\r\n\r\nMy_Lib.Euler_Controller = function (obj, x, y, z)\r\n{\r\n\tthis.obj = obj;\r\n\tthis.xspeed = x * Math.PI / 180;;\r\n\tthis.yspeed = y * Math.PI / 180;;\r\n\tthis.zspeed = z * Math.PI / 180;;\r\n}\r\n\r\nMy_Lib.Euler_Controller.prototype.update = function (dt)\r\n{\r\n\tthis.obj.rotation.x += this.xspeed * dt;\r\n\tthis.obj.rotation.y += this.yspeed * dt;\r\n\tthis.obj.rotation.z += this.zspeed * dt;\r\n}\r\n\r\n//Class Library\r\nMy_Lib.Registered_Classes = {};\r\n\r\nMy_Lib.Register_Class = function (name, func)\r\n{\r\n\tif (My_Lib.Registered_Classes[name]){\r\n\t\tconsole.log(\"Register Class ERROR! Class with this name already exists!\", name);\r\n\t}\r\n\tMy_Lib.Registered_Classes[name] = func;\r\n}\r\n\r\nMy_Lib.Get_Class = function (name)\r\n{\r\n\treturn My_Lib.Registered_Classes[name];\r\n}\r\n\r\n\r\nMy_Lib.create_class = function(parent, child, props, name)\r\n{\r\n    if (parent) {\r\n        child.prototype = Object.create(parent.prototype);\r\n    } \r\n    _.copy_object(child.prototype, props);\r\n    child.prototype.contructor = child;                \r\n    My_Lib.Register_Class(child, name);\r\n}\r\n\r\nMy_Lib.Abstract_Fabric = function (data)\r\n{\r\n    var constructor = My_Lib.Get_Class(data.type);\r\n    if (constructor) {\r\n        var object = new constructor();\r\n        object.parse(data);\r\n        return object;\r\n    }\r\n    return undefined;\r\n}\r\n\r\nMy_Lib.Print_Classes = function ()\r\n{\r\n    for(var key in this.Registered_Classes) {\r\n        console.log(\"class registered :\", key, this.Registered_Classes[key]);\r\n    }\r\n}\r\n\r\n\r\nexport { My_Lib };\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/base/my_lib.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\n//base class for particle affector\r\nfunction Particle_Affector()\r\n{\r\n    this.id = _.generateUUID();\r\n}\r\n\r\n\r\nParticle_Affector.prototype.affect = function (dt, pdata, vert, color)\r\n{\r\n\treturn true;\r\n}\r\n\r\nParticle_Affector.prototype.toJSON = function (child)\r\n{\r\n\tif (child) {\r\n\t\treturn {};\r\n\t}\r\n\tvar data = {\r\n        id: this.id,\r\n\t\t\"name\": \"Particle_Affector\",\r\n\t\tparams : {}\r\n\t};\r\n    if (child) {\r\n        return params;\r\n    }\r\n\treturn data;\r\n}\r\n\r\nParticle_Affector.prototype.parse = function (json)\r\n{\r\n}\r\n\r\nMy_Lib.Register_Class(\"Particle_Affector\", Particle_Affector);\r\n\r\nfunction Force_Affector()\r\n{\r\n    Particle_Affector.call(this);\r\n\tthis.forces = new Array();\r\n}\r\n\r\nForce_Affector.prototype = Object.create(Particle_Affector.prototype);\r\n\r\n_.copy_object(Force_Affector.prototype, {\r\n\tconstructor: Force_Affector,\r\n\tadd_force: function (force)\r\n\t{\r\n\t\tthis.forces.push(force);\r\n\t},\r\n\tapply_forces: function (dt, particle, vert, color)\r\n\t{\r\n\t\tvar acceleration = {x:0, y:0, z:0};\r\n\t\tfor(var i = 0; i < this.forces.length; i++) {\r\n\t\t\tthis.forces[i].calc(dt, particle, acceleration);\r\n\t\t}\r\n\t\t//integrate\r\n\t\tparticle.velocity.x += acceleration.x * dt;\r\n\t\tparticle.velocity.y += acceleration.y * dt;\r\n\t\tparticle.velocity.z += acceleration.z * dt;\r\n\t},\r\n\taffect: function (dt, particle, vert, color)\r\n\t{\r\n\t\tthis.apply_forces(dt, particle, vert, color);\r\n\t\treturn true;\r\n\t},\r\n\ttoJSON: function (child)\r\n\t{\r\n\t\tvar data = {};\r\n\t\tdata.name = \"Force_Affector\";\t\t\r\n        data.uuid = this.uuid;\r\n\t\tdata.params = Particle_Affector.prototype.toJSON.call(this, this);\r\n\t\tif (this.forces.length > 0) {\r\n\t\t\tdata.params.forces = new Array();\r\n\t\t\tfor(var i = 0; i < this.forces.length; i++) {\r\n\t\t\t\tdata.params.forces.push( this.forces[i].toJSON() );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tvar f, item;\r\n\t\tif (json.forces) {\r\n\t\t\t\t\r\n\t\t\tfor(var i =0; i < json.forces.length; i++) {\r\n\t\t\t\titem = json.forces[i];\r\n\t\t\t\tf = My_Lib.Get_Class(item.name);\r\n\t\t\t\tif (f) {\r\n\t\t\t\t\tf = new f();\r\n\t\t\t\t\tf.parse(item);\r\n\t\t\t\t\tthis.add_force(f);\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nMy_Lib.Register_Class(\"Force_Affector\", Force_Affector);\r\n\r\nexport { Particle_Affector, Force_Affector };\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particle_affector.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\n//Base class for Particle Emitters\r\nfunction Particle_Emitter(emit_per_second)\r\n{\r\n    this.uuid = _.generateUUID();\r\n    this.name = '';\r\n\tthis.emit_delta = 0;\r\n\tthis.emit_count = 0;\r\n\tthis.emit_per_second = emit_per_second || 5;\r\n\t//linear interpolation = min + random * (max-min)\t\r\n\tthis.lifetime = {\"min\": 0, \"max\":2.0};\r\n}\r\n\r\nParticle_Emitter.prototype.emit_life = function ()\r\n{\r\n\treturn this.lifetime.min + Math.random() * (this.lifetime.max - this.lifetime.min);\r\n}\r\n\r\nParticle_Emitter.prototype.calc_emitted_particles = function (dt)\r\n{\r\n\t//count particles need emit\r\n\tthis.emit_delta += this.emit_per_second*dt;\r\n\tvar need_emit = Math.floor(this.emit_delta);\r\n\tif (need_emit > 0) {\r\n\t\tthis.emit_delta -= need_emit;\r\n\t\t//this.emit_count += need_emit;\r\n\t\t//need_emit = this.emit_count;\r\n\t}\r\n\treturn need_emit;\r\n}\r\n\r\n\r\nParticle_Emitter.prototype.emit = function (p, c, matrix)\r\n{\r\n    p.position.set(0, 0, 0);\r\n    p.velocity.set(0, 1, 0);\r\n    \r\n    if (matrix) {\r\n        p.position.applyMatrix4(matrix);\r\n        p.velocity.applyMatrix4_rotation(matrix);\r\n    }\r\n}\r\n\r\n\r\nParticle_Emitter.prototype.toJSON = function (child)\r\n{\r\n\tvar params = {\r\n        \"uuid\": this.uuid,\r\n\t\t\"emit_per_second\": this.emit_per_second,\r\n\t\t\"lifetime\": {\r\n\t\t\t\"min\": this.lifetime.min,\r\n\t\t\t\"max\": this.lifetime.max\r\n\t\t},\r\n\t};\r\n    if (this.name) {\r\n        params.name = this.name;\r\n    }\r\n\tif (child) {\r\n\t\treturn params;\r\n\t}\r\n\tvar data = {};\r\n\tdata.name = \"Particle_Emitter\";\r\n\tdata.params = params;\t\r\n\treturn data;\r\n}\r\n\r\nParticle_Emitter.prototype.parse = function (data)\r\n{\r\n\tthis.emit_per_second = data.emit_per_second;\r\n    this.name = data.name;\r\n    this.uuid = data.uuid || _.generateUUID();\r\n\t_.copy_object(this.lifetime, data.lifetime);\r\n}\r\n\r\nMy_Lib.Register_Class(\"Particle_Emitter\", Particle_Emitter);\r\n\r\nexport { Particle_Emitter };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particle_emitter.js","    \r\nfunction Particles_Points (geometry, material)\r\n{\r\n    THREE.Points.call(this, geometry, material);\r\n    this.type = 'particles_points';\r\n    \r\n    this.boundingSphere = new THREE.Sphere();\r\n    this.boundingSphere.radius = 10.0;\r\n}\r\n\r\nParticles_Points.prototype = Object.create( THREE.Points.prototype )\r\n\r\nParticles_Points.prototype.constructor = Particles_Points;\r\n\r\nParticles_Points.prototype.toJSON = function (meta)\r\n{\r\n    var mat = this.material;\r\n    var geom = this.geometry;\r\n    this.material = undefined;\r\n    this.geometry = undefined;\r\n    var object =  THREE.Object3D.prototype.toJSON.call(this, meta);\r\n    this.material = mat;\r\n    this.geometry = geom;\r\n    return object;\r\n}\r\n\r\nParticles_Points.prototype.raycast = function (raycaster, intersects)\r\n{\r\n    var sphere = new THREE.Sphere()\r\n    sphere.copy( this.boundingSphere );\r\n    sphere.applyMatrix4( this.matrixWorld ); \r\n    var r = raycaster.ray.intersectsSphere( sphere );\r\n    if ( r === false ) return;\r\n    console.log(\"INTERSECTION1\", this.name, sphere);\r\n    return;\r\n    \r\n    var shit  = new THREE.Vector3();\r\n    shit.copy(this.position);\r\n    var tr = new THREE.Ray( new THREE.Vector3(0, 0, 20), shit);\r\n    console.log(\"test \", tr.intersectsSphere(sphere), sphere);\r\n    console.log(\"hit sphere \"  + this.name, sphere, raycaster.ray);\r\n    return raycaster.ray.intersectsSphere( sphere );\r\n    \r\n    \r\n    console.log(\"hit sphere \" + this.type, \"shpere is \", sphere, \"ray is \", r);\r\n    if (r) {\r\n            var tmp = new THREE.Vector3(this.position);\r\n            tmp.sub(r);\r\n   \t\t\tintersects.push( {\r\n\t\t\t\tdistance: Math.sqrt( tmp.dot(tmp) ),\r\n\t\t\t\tpoint: this.position,\r\n\t\t\t\tobject: this\r\n\t\t\t} ); \r\n    }\r\n}\r\n\r\n\r\nexport {Particles_Points};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particles_points.js","function Event_Hub() {\r\n    this.events = {};\r\n}\r\n\r\n\r\n\r\nEvent_Hub.prototype.add_event_listener = function (name, func, obj)\r\n{\r\n    if (!this.events[name]) {\r\n        this.events[name] = [];\r\n    }\r\n    this.events[name].push( {name: name, func: func, obj: obj} );\r\n}\r\n\r\nEvent_Hub.prototype.on  = Event_Hub.prototype.add_event_listener;\r\n\r\nEvent_Hub.prototype.emit = function(name, obj)\r\n{\r\n    var listeners = this.events[name];\r\n    if (listeners) {\r\n        for(var i = 0; i < listeners.length; i++) {\r\n            var t = listeners[i];\r\n            t.func.call(t.obj, obj);            \r\n        }\r\n    }\r\n}\r\n\r\nvar main_event_hub = new Event_Hub();\r\n\r\nexport {main_event_hub, Event_Hub};\n\n\n// WEBPACK FOOTER //\n// ./src/base/event_hub.js","var Mouse_Intersector = {};\r\n\r\nMouse_Intersector.mouse_coords_to_vector = function (canvas, event) \r\n{\r\n\tvar offset = canvas.getBoundingClientRect();\r\n\tvar width = canvas.clientWidth;\r\n\tvar height = canvas.clientHeight;\r\n    //normalize coordinates\r\n    var x = (event.clientX - offset.left) / width;\r\n    var y = (event.clientY - offset.top) / height;\r\n\tvar x = x * 2 - 1;\r\n\tvar y = -(y * 2 - 1);\r\n    //console.log(\"mouse coords\",  x,y, );    \r\n\tvar vector = new THREE.Vector3( x, y, 1 );\r\n\treturn vector;\r\n}\r\n\r\n\r\nMouse_Intersector.unproject = function(vector, camera)\r\n{\r\n    var r = new THREE.Vector3();\r\n    r.copy(vector);\r\n    r.z = 1;\r\n\tr.unproject(camera);\r\n    r.applyMatrix4(camera.matrixWorldInverse);    \r\n    return r;\r\n}\r\n\r\nMouse_Intersector.mouse_coords_to_ray = function (canvas, event, camera) \r\n{\r\n\tvar offset = canvas.getBoundingClientRect();\r\n\tvar width = canvas.clientWidth;\r\n\tvar height = canvas.clientHeight;\r\n\tvar x = ((event.clientX - offset.left) / width) * 2 - 1;\r\n\tvar y = -(((event.clientY - offset.top) / height) * 2 - 1);\r\n\tvar vector = new THREE.Vector3( x, y, 1 );\r\n\r\n\tvector.unproject(camera);\r\n\tvar ray = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );\r\n\treturn ray;\r\n}\r\n\r\n\r\n\r\nMouse_Intersector.find_intersection_with_mouse_vector = function(vector, camera, scene)\r\n{\r\n\tvector.unproject(camera);\r\n\tvar ray = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );\r\n\t// create an array containing all objects in the scene with which the ray intersects\r\n\t//var intersects = ray.intersectObjects( [grid_text.root], true ); \r\n\t//console.log(fake_plane.root.children[0].geometry);\r\n\tvar intersects = ray.intersectObjects( [scene], true ); \r\n\treturn intersects;\r\n}\r\n\r\n\r\nexport { Mouse_Intersector };\n\n\n// WEBPACK FOOTER //\n// ./src/base/mouse_intersector.js","var Particle_Shaders = {};\r\n\r\n(function () \r\n{\r\n\r\n//particle attributes:\r\n//position\r\n//color\r\n//left, size\r\nvar vertex_shader = [\r\n//'attribute vec4 position;',\r\n'attribute vec4 color;',\r\n'attribute float params;',\r\n'varying vec4 vcolor;',\r\n'uniform float lifetime;',\r\n'uniform float point_size;',\r\n'uniform vec2 screen_size;',\r\n'#ifndef DYNAMIC_COLORS',\r\n    'uniform vec3 particle_color;',\r\n'#endif',\r\n'void main () {',\r\n\t'gl_Position = projectionMatrix * viewMatrix * vec4( position, 1.0 );',\r\n'#ifdef DYNAMIC_COLORS',\r\n\t'vcolor.rgb = color.rgb;',\r\n'#else',\r\n    'vcolor.rgb = particle_color.rgb;',\r\n'#endif',\r\n'#ifdef NO_FADE_COLOR',\r\n\t'vcolor.a = 1.0;',\r\n'#else',\r\n\t//params contains life length which decreased by time\r\n\t'float tmp = params / lifetime;',\r\n\t'tmp = min(tmp, 1.0);',\t\r\n\t'vcolor.a = tmp;',\r\n'#endif',\r\n\t'float t =  screen_size.y* projectionMatrix[1][1] / gl_Position.w;',\r\n\t't = t * point_size;',\r\n\t'if (params > 0.0) {',\r\n\t\t'gl_PointSize = t;',\r\n\t'}',\r\n\t'else {',\r\n\t\t//'vcolor.a = 0.0;',\r\n\t\t'gl_PointSize = 0.0;',\r\n\t'}',\r\n'}'\r\n];\r\n\r\nvar fragment_shader = [\r\n\t'varying vec4 vcolor;',\r\n\t'#ifdef PARTICLE_TEXTURE',\r\n\t\t'uniform sampler2D sprite;',\r\n\t'#endif',\r\n\t'void main() {',\r\n\t'#ifdef PARTICLE_TEXTURE',\r\n\t\t'vec4 tex = texture2D( sprite, gl_PointCoord );',\r\n\t\t'vec3 fragment_color = tex.rgb;',\r\n\t\t'fragment_color.rgb *= vcolor.rgb;',\r\n\t\t'float alpha = tex.a;',\t\r\n\t'#else',\r\n\t\t'vec3 fragment_color = vcolor.rgb;',\r\n\t\t'float alpha = 1.0;',\r\n\t'#endif',\r\n\t'#ifdef PRE_ALPHA',\r\n\t\t'fragment_color.rgb *= alpha;',\r\n\t'#endif',\r\n\t'#ifndef NO_FADE_COLOR',\r\n\t\t'float fragment_alpha = alpha * vcolor.a;',\r\n\t'#else',\r\n\t\t'float fragment_alpha = alpha;',\r\n\t'#endif',\r\n\t\t'gl_FragColor = vec4(fragment_color.rgb, fragment_alpha);',\r\n\t'}',\r\n];\r\n\r\nParticle_Shaders.vertex = vertex_shader.join( '\\n' );\r\nParticle_Shaders.fragment = fragment_shader.join( '\\n' );\r\n})();\r\n\r\nexport {Particle_Shaders};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particle_shaders.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\nimport {Particles_Points} from './particles_points.js';\r\nimport {Particle_Shaders} from './particle_shaders.js';\r\n\r\n\r\nfunction Particle_System(params)\r\n{\r\n    this.uuid = _.generateUUID();    \r\n\r\n    //restricted params\r\n\tif (!params.emitter) {\r\n\t\tparams.emitter = new Particle_Emitter(1);\r\n\t}\r\n\tif (!params.affector) {\r\n\t\tparams.affector = new Particle_Affector();\r\n\t}\r\n    params.no_fade_color = !!params.no_fade_color;    \r\n    params.particle_lifetime = params.particle_lifetime || 3.0;\r\n    \r\n\tif (typeof params.pre_alpha === 'undefined') {\r\n\t\tparams.pre_alpha = true;\r\n\t}\r\n\t\r\n\tif (typeof params.depth_test === 'undefined') {\r\n\t\tparams.depth_test = true;\r\n\t}\r\n\t\r\n\tif (params[\"depth_write\"] === undefined){\r\n\t\tparams.depth_write = false;\r\n\t}\r\n\r\n\tif (!params.color) {\r\n\t\tparams.color  = {\"r\":1, \"g\":1, \"b\":1};\r\n\t}\r\n    \r\n    if (!params.blending) {\r\n        params.blending = \"one_alpha\";\r\n    }\r\n\r\n    params.size = params.size || 1;\r\n    \r\n    if (!params.count) params.count = 100;\r\n\r\n    \r\n\tthis.emitter = params.emitter;\r\n\tthis.affector = params.affector;    \r\n    this.name = params.name || '';\r\n    this.particle_lifetime = params.particle_lifetime;\r\n\tthis.params = params;\r\n\r\n    \r\n    this.texture = params.texture;\r\n\t\r\n\tthis.dynamic_color = (!!params.end_color || !!params.random_color);\r\n\r\n\r\n\tvar count = params.count;\r\n\t\r\n\tthis.material = this.create_particle_material();\r\n\tthis.node = new Particles_Points(this.create_particle_geometry(count), this.material);\r\n    this.node.name = this.name;\r\n\r\n    if (typeof this.params.bounding_sphere !== 'undefined') {\r\n        this.node.boundingSphere.radius = params.bounding_sphere;\r\n    }\r\n}\r\n\r\nParticle_System.prototype.set_name = function (name)\r\n{\r\n    this.name = name;\r\n    this.node.name = name;\r\n}\r\n\r\nParticle_System.prototype.suicide = function ()\r\n{\r\n\tthis.node.parent.remove(this.node);\r\n    main_event_hub.emit(\"kill_me\", this);\r\n}\r\n\r\n\r\nParticle_System.prototype.create_particle_data = function (count)\r\n{\r\n    var particle_data = new Array(count);\r\n    var p;\r\n    for(var i =0;i < count; i++) {\r\n\t\tp = {};\r\n\t\tp.position = new THREE.Vector3(0,0,0);\r\n\t\tp.velocity = new THREE.Vector3(0,0,0);\r\n\t\tp.lifetime = 0;        \r\n\t\tparticle_data[i] = p;\r\n    }\r\n    this.particle_data = particle_data;\r\n}\r\n\r\nParticle_System.prototype.create_particle_geometry = function(count)\r\n{\r\n    this.create_particle_data(count);\r\n    \r\n\tvar vertices = new Float32Array(count * 3); // position\r\n\tvar colors = new Float32Array(count * 3);\r\n\tvar params = new Float32Array(count);\r\n\t\r\n    for (var i = 0; i < count; i++) {\r\n\t\t//create particle\r\n\t\tvertices[i*3] = 0;\r\n\t\tvertices[i*3+1] = 0;\r\n\t\tvertices[i*3+2] = 0;\r\n\r\n\t\tparams[i] = 0.0;\r\n\r\n\t\tcolors[i*3] = this.params.color.r;\r\n\t\tcolors[i*3+1] = this.params.color.g;\r\n\t\tcolors[i*3+2] = this.params.color.b;\r\n\t}\r\n\r\n\tthis.geometry = {};\r\n\tthis.geometry.vertices = new THREE.BufferAttribute(vertices, 3).setDynamic(true);\r\n\tthis.geometry.colors = new THREE.BufferAttribute(colors, 3)\r\n\tif (this.dynamic_color) {\r\n\t\tthis.geometry.colors.setDynamic(true);\r\n\t}\r\n\tthis.geometry.params = new THREE.BufferAttribute(params, 1).setDynamic(true);\r\n\tvar geom = new THREE.BufferGeometry(); \t\r\n\tthis.geometry.buffer = geom;\t\r\n\tgeom.addAttribute('position', this.geometry.vertices);\r\n\tgeom.addAttribute('color', this.geometry.colors);\r\n\tgeom.addAttribute('params', this.geometry.params);\t\r\n\r\n    return geom;\r\n}\r\n\r\n\r\nParticle_System.prototype.generate_material_name = function ()\r\n{\r\n\tvar my_name = \"MY_PARTICLE_MATERIAL\";\r\n\tif (!!this.texture) {\r\n\t\tmy_name +=  \"_WITH_TEXTURE\";\r\n\t}\r\n\tif (this.params.no_fade_color) {\r\n\t\tmy_name += \"_NO_FADE_COLOR\";\r\n\t}\r\n\treturn my_name;\r\n}\r\n\r\nParticle_System.prototype.blending_mode = \r\n{\r\n\t\"additive\": {\r\n\t\t\"blendSrc\": THREE.OneFactor,\r\n\t\t\"blendDst\": THREE.OneFactor\r\n\t},\r\n\t\"alpha\": {\r\n\t\t\"blendSrc\": THREE.SrcAlphaFactor,\r\n\t\t\"blendDst\": THREE.OneMinusSrcAlphaFactor\r\n\t},\r\n\t\"one_alpha\": {\r\n\t\t\"blendSrc\": THREE.OneFactor,\r\n\t\t\"blendDst\": THREE.OneMinusSrcAlphaFactor\r\n\t},\r\n\t\"alpha_one\": {\r\n\t\t\"blendSrc\": THREE.SrcAlphaFactor,\r\n\t\t\"blendDst\": THREE.OneFactor\r\n\t}\r\n};\r\n\r\nParticle_System.prototype.convert_blending_mode = function (blending)\r\n{\r\n    var three_blending;\r\n\tvar factors = this.blending_mode[\"one_alpha\"];\r\n    if (blending === 'no') {\r\n        three_blending = THREE.NoBlending;\r\n    } else {\r\n        three_blending = THREE.CustomBlending;    \r\n        if (this.blending_mode[blending]) {\r\n            factors = this.blending_mode[blending];\r\n        }\r\n    }\r\n    return {\"blending\": three_blending, \"factors\":factors};\r\n}\r\n\r\nParticle_System.prototype.set_texture = function (texture)\r\n{\r\n\tif (typeof texture === 'string') {\r\n        if (this.params.texture === texture) {\r\n            return;\r\n        }\r\n        this.params.texture = texture;\r\n\t\tthis.texture = My_Lib.Texture_Manager.get(texture);\r\n\t} else {\r\n        console.error(\"Oh Shit! texture in set_texture is not string! it's object or undefined!\", texture);\r\n    }\r\n\r\n    if (this.material.uniforms.sprite) {\r\n        this.material.uniforms.sprite.value = this.texture;\r\n    } else {\r\n        //this.material.uniforms.sprite = {value: texture};\r\n        this.recreate_material();\r\n        console.error(\"Oh Shit! Our shader has not texture! Need create shader with texture!\");\r\n    }\r\n}\r\n\r\n\r\nParticle_System.prototype.create_uniforms = function ()\r\n{\r\n    var uniforms = \r\n    {\r\n        \"lifetime\": {\r\n            value: this.particle_lifetime\r\n        },\r\n        \"point_size\": {\r\n            value: this.params.size\r\n        },\r\n        \"screen_size\": {\r\n            value: new THREE.Vector2(My_Lib.Viewport.width, My_Lib.Viewport.height)\r\n        }\r\n    };\r\n    if (!!this.texture) {\r\n        uniforms[\"sprite\"] = {\r\n            value: this.texture\r\n        }\r\n    };\r\n    if (!this.dynamic_color) {\r\n        uniforms[\"particle_color\"] = {value: this.params.color};\r\n    }\r\n    return uniforms;\r\n}\r\n\r\nParticle_System.prototype.calc_defines = function ()\r\n{\r\n    var defines = {};\r\n    if (this.params.pre_alpha) {\r\n        defines[\"PRE_ALPHA\"] = true;\r\n    }\r\n\tif (!!this.texture) {\r\n        defines[\"PARTICLE_TEXTURE\"] = true;\r\n    }\r\n    if (this.params.no_fade_color) {\r\n        defines[\"NO_FADE_COLOR\"] = true;\r\n    }\r\n    return defines;\r\n}\r\n\r\n\r\nParticle_System.prototype.select_texture = function (texture)\r\n{\r\n\tif (typeof this.texture === 'string') {\r\n\t\tthis.texture = My_Lib.Texture_Manager.get(this.texture);\r\n        console.log(My_Lib.Texture_Manager.resources);\r\n        if (!this.texture) {\r\n            console.error(\"Oh, not found texture <\" + this.params.texture + \"> in create particle material! Instead get \"+this.texture);\r\n        }\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.create_particle_material = function()\r\n{\r\n\t\r\n    this.select_texture(this.texture);\r\n    \r\n    var blend_obj = this.convert_blending_mode(this.params.blending);\r\n    \r\n    \r\n    var uniforms = this.create_uniforms();\r\n    var defines = this.calc_defines();\r\n    \r\n\tvar mat = new THREE.ShaderMaterial({\r\n\t\ttransparent: true,\r\n\t\tdepthWrite: this.params.depth_write,\r\n\t\tdepthTest: this.params.depth_test,\r\n        blending: blend_obj.blending,\r\n        blendSrc: blend_obj.factors.blendSrc,\r\n        blendDst: blend_obj.factors.blendDst,\r\n\t\tdefines: defines,\r\n\t\tuniforms: uniforms,\r\n\t\tvertexShader: Particle_Shaders.vertex,\r\n\t\tfragmentShader: Particle_Shaders.fragment\r\n\t});\r\n\treturn mat;\r\n}\r\n\r\nParticle_System.prototype.recreate_material = function ()\r\n{\r\n    this.node.material = this.material = this.create_particle_material();\r\n}\r\n\r\n\r\nParticle_System.prototype.set_pre_alpha = function (pre_alpha)\r\n{\r\n    if (this.params.pre_alpha !== !!pre_alpha) {\r\n        this.params.pre_alpha = pre_alpha;\r\n        this.recreate_material();\r\n    }\r\n}\r\n\r\nParticle_System.prototype.set_point_size = function (size)\r\n{\r\n    if (this.params.size != size) {\r\n        this.params.size = size;\r\n        this.node.material.uniforms[\"point_size\"].value = size;\r\n    }\r\n}\r\n\r\nParticle_System.prototype.set_blending = function (blending)\r\n{\r\n    this.params.blending = blending;\r\n    var b = this.convert_blending_mode(blending);\r\n    this.material.blending = b.blending;\r\n    this.material.blendSrc = b.factors.blendSrc;\r\n    this.material.blendDst = b.factors.blendDst;\r\n}\r\n\r\n\r\n\r\nParticle_System.prototype.emit_particles = function (dt, need_emit)\r\n{\r\n\t//emit particles\r\n\tvar p;\r\n\tvar verts = this.geometry.vertices.array;\r\n\tvar params = this.geometry.params.array;\r\n\t//var colors = this.geometry.colors.array;\r\n\t//var dummy_color = new THREE.Color(1,1,1);\r\n\t\r\n    this.node.updateMatrixWorld(true);\r\n    var matrix = this.node.matrixWorld;\r\n\tfor(var i =0; i < this.particle_data.length && need_emit > 0; i++) {\r\n\t\tif (!(params[i] > 0)) {\r\n\t\t\tp = this.particle_data[i];\r\n\t\t\tthis.emitter.emit(p, null, matrix);\r\n\t\t\tp.lifetime = this.particle_lifetime;\r\n\t\t\tverts[i*3] = p.position.x;\r\n\t\t\tverts[i*3+1] = p.position.y;\r\n\t\t\tverts[i*3+2] = p.position.z;\r\n\t\t\tparams[i] = p.lifetime;\r\n\t\t\tneed_emit--;\r\n\t\t\t//colors[i*3] = this.params.color.r\r\n\t\t\t//colors[i*3+1] = this.params.color.g;\r\n\t\t\t//colors[i*3+2] = this.params.color.b;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.update_particle_geometry = function (dt)\r\n{\r\n\tvar verts = this.geometry.vertices.array;\r\n\tvar params = this.geometry.params.array;\r\n\tvar p;\r\n\tvar vert = new THREE.Vector3(0,0,0);\r\n\tvar dummy_color = {\"r\":1, \"b\":1, \"g\":1};\r\n\tfor(var i = 0; i < this.particle_data.length; i++) {\r\n\t\r\n\t\tif (params[i] > 0) {\r\n\t\t\tp = this.particle_data[i];\r\n\t\t\t\r\n\t\t\t//integrate\r\n\t\t\tp.position.x += p.velocity.x * dt;\r\n\t\t\tp.position.y += p.velocity.y * dt;\r\n\t\t\tp.position.z += p.velocity.z * dt;\r\n\t\t\tp.lifetime -= dt;\r\n\t\t\t\r\n\t\t\tif (p.lifetime <= 0 || !this.affector.affect(dt, p, vert, dummy_color)) {\r\n\t\t\t\tp.lifetime = 0;\r\n\t\t\t}\r\n\t\t\tparams[i] = p.lifetime;\t\t\t\r\n\t\t\tverts[i*3] = p.position.x;\r\n\t\t\tverts[i*3+1] = p.position.y;\r\n\t\t\tverts[i*3+2] = p.position.z;\r\n\t\t}\r\n\t}\r\n\r\n\tvar need_emit = this.emitter.calc_emitted_particles(dt);\r\n\tthis.emit_particles(dt, need_emit);\r\n\t\r\n\tthis.geometry.vertices.needsUpdate = true;\r\n\tthis.geometry.params.needsUpdate = true;\r\n\tthis.geometry.colors.needsUpdate = true;\r\n}\r\n\r\n\r\nParticle_System.prototype.update = function (dt)\r\n{\r\n\tthis.update_particle_geometry(dt);\r\n}\r\n\r\n\r\nParticle_System.prototype.toJSON = function ()\r\n{\r\n\tvar data = {};\r\n    data.uuid = this.uuid;\r\n    data.node = this.node.uuid;\r\n    if (this.name || this.node.name) {\r\n        data.name = this.name || this.node.name;\r\n    }\r\n\tdata.params = {};\r\n\tif (this.params) {\r\n\t\t_.copy_object(data.params, this.params);\r\n\t}\r\n\tdata.params.emitter = this.emitter.toJSON();\r\n\tdata.params.affector = this.affector.toJSON();\r\n\treturn data;\r\n}\r\n\r\n\r\nParticle_System.prototype.set_emitter = function (emitter)\r\n{\r\n    this.emitter = this.params.emitter = emitter;\r\n}\r\n\r\nParticle_System.prototype.set_particle_life_length = function (val)\r\n{\r\n\tif (val !== this.params.particle_lifetime) {\r\n\t\tthis.params.particle_lifetime = this.particle_lifetime = val;\r\n\t\tthis.material.uniforms['lifetime'].value = val;\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.set_emission_per_second = function (val)\r\n{\r\n\tthis.emitter.emit_per_second = val;\r\n}\r\n\r\nParticle_System.prototype.set_particle_count = function (count)\r\n{\r\n\tif (count !== this.particle_data.length) {\r\n\t\tthis.params.count = count;\r\n\t\tthis.node.geometry = this.create_particle_geometry(count);\r\n\t}\r\n}\r\n\r\nParticle_System.prototype.set_color = function (color)\r\n{\r\n    this.params.color.r = color.r;\r\n    this.params.color.g = color.g;\r\n    this.params.color.b = color.b;\r\n}\r\n\r\nParticle_System.prototype.set_bounding_sphere_radius = function (radius)\r\n{\r\n    this.node.boundingSphere.radius = radius;\r\n}\r\n\r\n\r\nexport {Particle_System};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particles.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\nimport {Particles_Points} from './particles_points.js';\r\nimport {Particle_System} from './particles.js';\r\n\r\n\r\n function Particle_Manager ()\r\n{\r\n\tthis.particles = {};\r\n    this.particles_array = [];\r\n}\r\n\r\n_.copy_object(Particle_Manager.prototype, \r\n    {\r\n    constructor: Particle_Manager,\r\n    add:  function (ps,name)\r\n    {\r\n        if (!this.particles[name]) {\r\n            this.particles[name] = ps;\r\n            this.particles_array.push(ps);\r\n        }\r\n    },\r\n    remove_particles:  function (name)\r\n    {\r\n        var ps = this.particles[name];\r\n        var i = this.particles_array.indexOf(ps);\r\n        if (i >= 0) {\r\n            this.particles_array.splice(i, 1);\r\n        }\r\n        if (ps) {\r\n            ps.suicide();\r\n            delete this.particles[name];\r\n        }\r\n    },\r\n    get_particle_names:  function ()\r\n    {\r\n        var names = [];\r\n        for(var key in this.particles) {\r\n            names.push(key);\r\n        }\r\n        return names;\r\n    },\r\n\r\n    update : function (dt)\r\n    {\r\n        for(var i = 0; i < this.particles_array.length; i++) {\r\n            this.particles_array[i].update(dt);\r\n        }\r\n    },\r\n\r\n\r\n    toJSON : function ()\r\n    {\r\n        var arr = []\r\n        \r\n        var data;\r\n        var p;\r\n        for(var key in this.particles){\r\n            p = this.particles[key];\r\n            if (p.uuid) {\r\n                data = p.toJSON();\r\n                arr.push(data);\r\n            }\r\n        }\r\n\r\n        return arr;\r\n    },\r\n\r\n    emitter_fabric:  function (params)\r\n    {\r\n        if (params.emitter) {\r\n            var emitter = My_Lib.Get_Class(params.emitter.name);\r\n            if (emitter) {\r\n                emitter = new emitter();\r\n            } else {\r\n                emitter = new Particle_Emitter();\r\n            }\r\n            emitter.parse(params.emitter.params);\r\n            return emitter;        \r\n        } \r\n        return undefined;\r\n    },\r\n\r\n    affector_fabric:  function (params)\r\n    {\r\n        if (params.affector) {\r\n            var affector = My_Lib.Get_Class(params.affector.name);\r\n            if (affector) {\r\n                affector = new affector();\r\n            } else {\r\n                affector = new Particle_Affector();\r\n            }\r\n            affector.parse(params.affector.params);\r\n            return affector;\r\n        }\r\n        return undefined;\r\n    },\r\n\r\n    fromJSON: function (json, callback, root, name)\r\n    {\r\n        if (this.particles[name]) {\r\n            console.log(\"WARNING Particle Manager! Particle System with this name already exists\", name);\r\n        }\r\n        \r\n        try\r\n        {\r\n            var data = JSON.parse(json);\r\n        }\r\n        catch (e)\r\n        {\r\n            console.log(\"error parsing json on \", name, json);\r\n            throw e;\r\n        }\r\n        \r\n        return this.parse(data, root, name);\r\n    },\r\n\r\n\r\n    parse: function (data, root, name)\r\n    {\r\n        var emitter = this.emitter_fabric(data.params);\r\n        var affector = this.affector_fabric(data.params);\r\n        data.params.emitter = emitter;\r\n        data.params.affector = affector;\r\n        \r\n        var ps = new Particle_System(data.params);\r\n        ps.set_name(data.name);\r\n\r\n            //add to scene graph\r\n        if (data.params.parent) {\r\n            var parent = root.getObjectByName(data.params.parent);\r\n            //console.log(data.params.parent, \"parent particles\", name, root);\r\n            parent.add(ps.node);\r\n        } else {\r\n           root.add(ps.node);\r\n        }\r\n\r\n        //ugly fucking hack\r\n        //copy node properties\r\n        this.add(ps, name);    \r\n        return ps;\r\n    },\r\n\r\n    load_particles:  function (json, root)\r\n    {\r\n        var particles = json.particles;\r\n        for(var i =0; i < particles.length; i++)\r\n        {\r\n            var p = particles[i];\r\n            var ps = this.parse(p, root, p.name);\r\n            ps.node.uuid = p.node;\r\n            ps.node.name = p.name;\r\n            var obj = root.getObjectByProperty(\"uuid\", p.node);\r\n            if (obj) {\r\n                ps.node.replace_object_with_this(obj);\r\n            }\r\n        }\r\n    },\r\n\r\n    create_name:  function ()\r\n    {\r\n        var number = this.particles_array.length + 1;\r\n        var begin_name = 'Particle_System_';\r\n        var testing = true;\r\n        while (testing) {\r\n            name = begin_name + number;\r\n            if (this.particles[name] !== undefined) {\r\n                number ++;\r\n            } else {\r\n                return name;\r\n            }\r\n        }\r\n    },\r\n\r\n    create_new : function ()\r\n    {\r\n        var name = this.create_name();\r\n        \r\n        var params = {};\r\n        var ps = new My_Lib.Particle_System(params);\r\n        ps.set_name(name);\r\n        this.add(ps, name);\r\n        return ps;\r\n    }\r\n});\r\n\r\n\r\nif (My_Lib.particle_manager === undefined) \r\n{\r\n    My_Lib.particle_manager = new Particle_Manager();\r\n}\r\n\r\nMy_Lib.Particles_Config = {\r\n\"box_size\": 10\r\n};\r\n\r\n\r\nexport {Particle_Manager};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/particles_manager.js","var Point_Generators = {};\r\n\r\n\r\nPoint_Generators.Random_Direction = function ()\r\n{\r\n}\r\n\r\nPoint_Generators.Random_Direction.prototype.get_direction = function (vector)\r\n{\r\n\tvector.x = Math.random(); \r\n\tvector.y = Math.random(); \r\n\tvector.z = Math.random();\r\n}\r\n\r\nPoint_Generators.Sphere = function (radius)\r\n{\r\n\tthis.radius = radius;\r\n}\r\n\r\nPoint_Generators.Sphere.prototype.get_inner_point = function (vector)\r\n{\r\n\tvar alpha = Math.random() * Math.PI * 2;\r\n\tvar beta = Math.random() * Math.PI;\r\n\tvector.x = Math.cos(alpha) * Math.sin(beta);\r\n\tvector.y = Math.cos(beta);\r\n\tvector.z = Math.sin(alpha) * Math.sin(beta);\r\n}\r\n\r\nPoint_Generators.Sphere.prototype.get_normal = function (vector)\r\n{\r\n\tvector.x = Math.random() * 2 - 1;\r\n\tvector.y = Math.random() * 2 - 1;\r\n\tvector.z = Math.random() * 2 - 1;\r\n\tvector.normalize();\r\n}\r\n\r\nPoint_Generators.Sphere.prototype.get_point = function (vector) \r\n{\r\n\tthis.get_normal(vector);\r\n\tvector.multiplyScalar(this.radius);\r\n}\r\n\r\n\r\nexport {Point_Generators};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/point_generators.js","/*\r\nmain class\r\nthis has abstract virtual methods\r\nstart - which create renderer and conduct start initializations\r\nupdate - updated scene objects, animations, phisics\r\nrender - control scene rendering\r\nthis methods must rewrite on derived classes\r\nneed set \r\nPROPERTIES\r\nmain_camera - camera which point of view render whole scene and user interacts\r\ndom_screen - dom element which contain canvas and display scene\r\nrenderer - three.js renderer\r\ncanvas - is created by three.js renderer, it have to append to dom_screen children, fuck it\r\ncanvas width and height defining on creating it by renderer, fuck it\r\n\r\n\r\n\r\n*/\r\n\r\nimport {My_Lib} from '../base/my_lib.js';\r\nimport {main_event_hub, Event_Hub} from '../base/event_hub.js';\r\nimport {Mouse_Intersector} from '../base/mouse_intersector.js';\r\n\r\n\r\nfunction Application (config)\r\n{\r\n\r\n    this._lifecycle_event(\"before_created\");\r\n   \r\n    this._init_timer();\r\n    this._create_loop_function();\r\n    \r\n\tthis.mouse_controllers = [];\r\n    \r\n    main_event_hub.add_event_listener(\"kill_me\", function (obj) {\r\n        this.remove_animated_object(obj);\r\n    }, this);\r\n}\r\n\r\nApplication.prototype.start = function (config)\r\n{\r\n    console.log(\"start application...\");\r\n   this._set_configuration(config);\r\n}\r\n\r\nApplication.prototype._lifecycle_event = function (name, event)\r\n{\r\n    if (this[name]) {\r\n        return this[name](event);\r\n    }\r\n    return false;\r\n}\r\n\r\n\r\nApplication.prototype._init_timer = function ()\r\n{\r\n\tthis.clock = new THREE.Clock();\t\r\n\tthis.delta_time = 0;\r\n\tthis.animated_objects = [];\r\n}\r\n\r\n\r\nvar run_function = //window.requestAnimationFrame;\r\n\tfunction(callback){\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t}\r\n\t\r\n\r\n\r\nApplication.prototype._create_loop_function = function ()\r\n{\r\n    var self = this;\r\n\tthis.run = function ()\r\n\t{\r\n\t\trun_function(function () \r\n\t\t{ \r\n\t\t\tself.loop();\r\n            //main_event_hub.emit(\"new_frame\");\r\n\t\t});\r\n\t}\r\n\t\r\n    //My_Lib.create_run_function(this);\r\n    \r\n    //main_even_hub.add_event_listener(\"new_frame\", this.loop, this);    \r\n}\r\n\r\n\r\nApplication.prototype.get_default_configuration = function ()\r\n{\r\n    return {\r\n        \"dom_element\": \"screen\",\r\n        \"render_params\": {\r\n            \"premultipliedAlpha\": true,\r\n            \"alpha\": true\r\n        },\r\n        \"viewport\": {\r\n            \"width\": 800,\r\n            \"height\": 600\r\n         },\r\n         \"clear_color\": 0x0000FF,\r\n        \"main_camera\": {\r\n            \"fov\": 80,\r\n            \"near\": 0.1,\r\n            \"far\": 1000,\r\n            \"aspect_ratio\": 1.3333333333333333,\r\n            \"position\": {\r\n                \"x\": 0,\r\n                \"y\": 0,\r\n                \"z\": 0\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\nApplication.prototype._create_render = function (json)\r\n{\r\n    if (this.dom_screen || this.renderer) {\r\n        alert(\"Create render alert! Something strange happenes!\");\r\n    }\r\n    if (!this.dom_screen) {\r\n        this.dom_screen = document.getElementById(json.dom_element);\r\n    }\r\n    if (!this.renderer) {\r\n        this.renderer = new THREE.WebGLRenderer(json.render_params);\r\n    }\r\n    if (!!!this.dom_screen || typeof this.dom_screen === 'undefined') {\r\n        console.error(\"Some terrorous happens! dom element for screen not found! element id is \" + json.dom_element);\r\n    }\r\n    //console.log(\"found dome element \" + json.dom_element);\r\n    this.dom_screen.appendChild(this.renderer.domElement);\r\n    this.canvas = this.renderer.domElement;\r\n    \r\n    \r\n    this.renderer.setSize(json.viewport.width, json.viewport.height);\r\n    this.set_viewport(json.viewport.width, json.viewport.height);\r\n    this.renderer.setClearColor(json.clear_color);\r\n    \r\n    this._lifecycle_event(\"render_created\");\r\n}\r\n\r\nApplication.prototype._create_main_scene = function (json)\r\n{\r\n    var event = {prevent: false};\r\n    this._lifecycle_event(\"before_create_main_scene\", event);\r\n    /*\r\n    if (event.prevent) {\r\n        return;\r\n    }\r\n    */\r\n    if (!this.main_scene) {\r\n        this.main_scene = new THREE.Scene();\r\n    }\r\n    \r\n    var camera = json.main_camera;    \r\n    if (!this.main_camera) {\r\n        this.main_camera = new THREE.PerspectiveCamera(camera.fov, camera.aspect_ratio, camera.near, camera.far);\r\n        this.main_scene.add(this.main_camera);\r\n        this.main_camera.name = \"main_camera\";\r\n    } else {\r\n        this.main_camera.fov = camera.fov;\r\n        this.main_camera.near = camera.near;\r\n        this.main_camera.far = camera.far;\r\n        this.main_camera.aspect = camera.aspect_ratio;\r\n        this.main_camera.updateProjectionMatrix();\r\n    }\r\n    \r\n    this.main_camera.position.set(camera.position.x, camera.position.y, camera.position.z);\r\n}\r\n\r\nApplication.prototype.apply_configuration = function (json)\r\n{\r\n    this.configuration = json;\r\n    this._create_render(json);\r\n    this._create_main_scene(json);\r\n    this._lifecycle_event(\"created\");\r\n}\r\n\r\nApplication.prototype.load_configuration = function (url)\r\n{\r\n    var xhr = new THREE.XHRLoader();\r\n    \r\n    var self = this;\r\n    \r\n    var config = self.get_default_configuration();\r\n    \r\n    var configuration_is_applied = false;\r\n    \r\n    function onload (data) {\r\n        console.log(\"configuration loaded from url <<\" + url + \">>\");\r\n        var obj = JSON.parse(data);\r\n        //user config append to default config and may rewrite them, \r\n        //though user naven't to rewrite ALL config to change some params\r\n        _.copy_object(config, obj);\r\n        self.apply_configuration(config);\r\n        console.log(configuration_is_applied, \"onload\");        \r\n        configuration_is_applied = true;\r\n    }\r\n    function progress() {}\r\n    function error(event) {\r\n        console.error(\"Error on loading config!\", event.target.status);\r\n        console.log(\"Setting default configuration\");\r\n        console.log(configuration_is_applied, \"error\");        \r\n        configuration_is_applied = true;        \r\n        self.apply_configuration(config);\r\n    }\r\n    xhr.load(url, onload, progress, error);\r\n}\r\n\r\n\r\nApplication.prototype._set_configuration = function (config)\r\n{\r\n    var default_config = this.get_default_configuration();\r\n    \r\n    //this is url of configuration file\r\n    if (typeof config === 'string') {\r\n        console.log(\"get configuration from url >> \" + config);\r\n        this.load_configuration(config);\r\n        \r\n        //this is object filled with data\r\n    } else if (typeof config === 'object') {\r\n        console.log(\"get configuration from user object\");\r\n        _.copy_object(default_config,config);\r\n        this.apply_configuration(default_config);\r\n    //configuration not given, use default\r\n    } else {\r\n        console.log(\"_set_configuration: set default configration\");\r\n       this.apply_configuration(default_config);\r\n    }\r\n}\r\n\r\nApplication.extend = function (methods, child_func)\r\n{\r\n\r\n    var Child;\r\n    if (typeof child_func === 'undefined') {\r\n        Child = function ()\r\n        {\r\n            Application.apply(this, arguments);\r\n        }\r\n    } else {\r\n        Child = child_func;\r\n    }\r\n\r\n    //create new object and set prototype chain\r\n\tChild.prototype = Object.create(Application.prototype);\r\n    //copy methods to new object\r\n\t_.copy_object(Child.prototype, methods);\r\n    Child.prototype.constructor = Child;\r\n   \r\n    return Child;\r\n}\r\n\r\nApplication.extend_proto = function (proto, methods)\r\n{\r\n\tvar obj = Object.create(proto);\r\n\t_.copy_object(obj, methods);\r\n\tApplication.call(obj);\r\n\treturn obj;\r\n}\r\n\r\n\r\nApplication.prototype.loop = function () \r\n{\r\n\tvar delta = this.clock.getDelta();\r\n\t//fix this - add options to control min frame rate\r\n\tif (delta > 0.1) {\r\n\t\tdelta = 0.1;\r\n\t}\r\n\tthis.delta_time = delta;\r\n\tthis.update(delta);\r\n\tthis.render(delta);\r\n\tthis.run();\r\n    //My_Lib.run();\r\n}\r\n\r\n\r\n\r\nApplication.prototype.add_animated_object = function (obj)\r\n{\r\n\t//fix probably duplicates\r\n\tthis.animated_objects.push(obj);\r\n}\r\n\r\nApplication.prototype.remove_animated_object = function (obj)\r\n{\r\n\tfor(var i = 0; i < this.animated_objects.length; i++) {\r\n\t\tif (this.animated_objects[i] === obj) {\r\n\t\t\tthis.animated_objects.splice(i, 1);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nApplication.prototype.update_all = function (delta)\r\n{\r\n\tvar obj;\r\n\tfor(var i = 0, len = this.animated_objects.length; i < len; i++) {\r\n\t\tobj = this.animated_objects[i];\r\n\t\tif (obj[\"update\"]) {\r\n\t\t\tobj.update(delta);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nApplication.prototype.update = function (delta)\r\n{\r\n\tthis.update_all(delta);\r\n    My_Lib.particle_manager.update(delta);\r\n}\r\n\r\n\r\nApplication.prototype.create_mouse_move_listener = function ()\r\n{\r\n\tif (this[\"mouse_move_listener\"]) {\r\n\t\treturn;\r\n\t}\r\n\tvar self = this;\r\n\tthis.mouse_move_listener = true;\r\n\tfunction mouse_move_listener(event) {\r\n\t\tvar vector = Mouse_Intersector.mouse_coords_to_vector(self.dom_screen, event);\t\t\r\n\t\tself.find_mouse_over_intersections(vector);\r\n\t};\r\n\tdocument.addEventListener(\"mousemove\", mouse_move_listener);\r\n}\r\n\r\nApplication.prototype.find_mouse_over_intersections = function(vector)\r\n{\r\n\tvector.unproject(this.main_camera);\r\n\tvar ray = new THREE.Raycaster( this.main_camera.position, vector.sub( this.main_camera.position ).normalize() );\r\n\tvar obj;\r\n\tfor(var i =0, len = this.mouse_controllers.length; i < len; i++){\r\n\t\tobj = this.mouse_controllers[i];\r\n\t\tif (obj.over) {\r\n\t\t\t// create an array containing all objects in the scene with which the ray intersects\r\n\t\t\t//var intersects = ray.intersectObjects( [grid_text.root], true ); \r\n\t\t\t//console.log(fake_plane.root.children[0].geometry);\r\n\t\t\tvar intersects = ray.intersectObjects( [obj.root], true ); \r\n\t\t\tobj.callback(intersects);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nApplication.prototype.add_mouse_controller = function (root, over, click, callback)\r\n{\r\n\tvar tmp = new My_Lib.Mouse_Controller(root, over, click, callback)\r\n\tthis.mouse_controllers.push( tmp );\r\n\tif (over) {\r\n\t\tthis.create_mouse_move_listener();\r\n\t}\r\n\treturn tmp;\r\n}\r\n\r\n\r\n\r\nApplication.prototype.set_viewport = function (width, height)\r\n{\r\n\tMy_Lib.Viewport.width = width;\r\n\tMy_Lib.Viewport.height = height;\r\n}\r\n\r\nApplication.prototype.render = function (delta) \r\n{\r\n\tthis.renderer.setClearColor(this.configuration.clear_color);\r\n\tthis.renderer.autoClear = true;\r\n\tthis.renderer.render(this.main_scene, this.main_camera);\r\n}\r\n\r\n\r\n\r\nexport {Application};\n\n\n// WEBPACK FOOTER //\n// ./src/app/application.js","import {My_Lib} from './my_lib.js';\r\n\r\n    function Base_Animation ()\r\n    {\r\n        this.time = 0;\r\n        this.time_scale = 1.0;\r\n        this.type = \"Base_Animation\";        \r\n    }\r\n    \r\n    Base_Animation.prototype.update = function (dt)\r\n    {\r\n        var scaled_dt = dt * this.time_scale;\r\n        this.time += scaled_dt;\r\n        this.calc_animation(dt);\r\n    }\r\n    \r\n    Base_Animation.prototype.calc_animation = function (dt)\r\n    {\r\n        \r\n    }\r\n    \r\n    Base_Animation.prototype.apply = function(obj)\r\n    {\r\n    }\r\n    \r\n    Base_Animation.prototype.toJSON = function (data)\r\n    {\r\n        var data = {};\r\n        data.uuid = this.uuid;\r\n        data.type = this.type;\r\n        if (this.name !== '') {\r\n            data.name = this.name;\r\n        }\r\n        data.time_scale = this.time_scale;\r\n        return data;\r\n    }\r\n    \r\n    Base_Animation.prototype.parse = function (param)\r\n    {\r\n        this.type = param.type;\r\n        this.uuid = param.uuid;\r\n        this.name = param.name ? param.name : '';\r\n        this.time_scale = (param.time_scale === undefined) ? 1.0 : param.time_scale;\r\n    }\r\n    \r\n\r\n    \r\n    \r\n        \r\nfunction Euler_Animation (x, y, z)\r\n{\r\n    Base_Animation.call(this);\r\n    this.type = \"Euler_Animation\";\r\n\tthis.xspeed = x;\r\n\tthis.yspeed = y;\r\n\tthis.zspeed = z;\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.z = 0;\r\n    this.name = '';\r\n    this.uuid = _.generateUUID();\r\n}\r\n\r\nEuler_Animation.prototype = Object.create(Base_Animation.prototype);\r\n\r\nMy_Lib.Register_Class(\"Base_Animation\", Base_Animation);\r\nMy_Lib.Register_Class(\"Euler_Animation\", Euler_Animation);\r\n\r\nEuler_Animation.prototype.constructor = Euler_Animation;\r\n\r\nEuler_Animation.prototype.calc_animation = function (dt)\r\n{\r\n    dt *= this.time_scale;\r\n\tthis.x += this.xspeed * dt;\r\n\tthis.y += this.yspeed * dt;\r\n\tthis.z += this.zspeed * dt;\r\n}\r\n    \r\nEuler_Animation.prototype.apply = function (obj)\r\n{\r\n    obj.rotation.x = this.x;\r\n    obj.rotation.y = this.y;\r\n    obj.rotation.z = this.z;\r\n}\r\n\r\nEuler_Animation.prototype.toJSON = function (json)\r\n{\r\n   var data = Base_Animation.prototype.toJSON.call(this);\r\n   data.xspeed = this.xspeed;\r\n   data.yspeed = this.yspeed;\r\n   data.zspeed = this.zspeed;\r\n   return data;\r\n}\r\n\r\nEuler_Animation.prototype.parse = function (param)\r\n{\r\n    Base_Animation.prototype.parse.call(this, param);\r\n    this.xspeed = param.xspeed;\r\n    this.yspeed = param.yspeed;\r\n    this.zspeed = param.zspeed;\r\n    this.x = this.y = this.z = 0;    \r\n}\r\n\r\nexport { Base_Animation, Euler_Animation };\n\n\n// WEBPACK FOOTER //\n// ./src/base/animations.js","import {My_Lib} from './my_lib.js';\r\n\r\n//events: \r\n//item_loaded\r\n//onerror\r\n//onprogress\r\n//finished\r\nfunction Chain_Loader()\r\n{\r\n}\r\n\r\nChain_Loader.prototype = {\r\n\tconstructor: Chain_Loader,\r\n\tstart: function (list) \r\n\t{\r\n\t\tthis.list = list;\r\n\t\tthis.index = 0;\r\n\t\tthis.load(this.list[0]);\r\n\t\tthis.stop_by_error = false;\r\n\t},\r\n\t\r\n\tnext: function(resource)\r\n\t{\r\n\t\tif (this.item_loaded && resource) {\r\n\t\t\tthis.item_loaded(resource,this.list[this.index]);\r\n\t\t}\r\n\t\tthis.index++;\r\n\t\tif (this.index < this.list.length) {\r\n\t\t\tthis.load(this.list[this.index]);\r\n\t\t} else {\r\n\t\t\tif (this.finished) {\r\n\t\t\t\tthis.finished();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdo_error: function (error)\r\n\t{\r\n\t\tif (this.onerror) {\r\n\t\t\tthis.onerror(error);\r\n\t\t} else {\r\n\t\t\tconsole.error(\"Error!\", error);\t\t\r\n\t\t}\r\n\t\tif (!this.stop_by_error) {\r\n\t\t\tthis.next();\r\n\t\t}\r\n\t},\r\n\t\r\n\tdo_progress: function ()\r\n\t{\r\n\t\tif (this.onprogress) {\r\n\t\t\tthis.onprogress.apply(this, arguments);\r\n\t\t}\r\n\t},\r\n\t\t\r\n\tload: function (item)\r\n\t{\r\n\t\tvar self = this;\r\n\t\tif (this.load_func) {\r\n\t\t\tthis.load_func(item, \r\n\t\t\tfunction (item) { self.next.apply(self, arguments); },\r\n\t\t\tfunction (item) { self.do_error.apply(self, arguments); },\r\n\t\t\tfunction (item) { self.do_progress.apply(self, arguments); });\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\nfunction test_chain_loader() \r\n{\r\n\tvar cl = new Chain_Loader();\r\n\tcl.item_loaded = function (item) {console.log(\"load item \", item);}\r\n\tcl.finished = function (item) {console.log(\"loader manager - job done\");}\r\n\tcl.load_func = function (item, next, error, progress) { \r\n\t\tif (item) {\r\n\t\t\tnext(item);\r\n\t\t} else {\r\n\t\t\terror(item);\r\n\t\t}\r\n\t}\r\n\tcl.start([\"first\", \"second\", null, \"tree\"]);\r\n}\r\n//test_chain_loader();\r\n\r\n\r\n\r\n\r\nfunction Loading_Manager ()\r\n{\r\n\tthis.resources = {};\r\n\tthis.texture_loader = new THREE.TextureLoader();\r\n}\r\n\r\nLoading_Manager.prototype = {\r\n\tconstructor: Loading_Manager,\r\n\tget: function (name)\r\n\t{\r\n\t\treturn this.resources[name];\r\n\t},\r\n\t\r\n\tget_async: function (name, callback)\r\n\t{\r\n\t\t//already loaded?\r\n\t\tvar texture = this.get(name);\r\n\t\tif (texture) {\r\n\t\t\tif (callback) {\r\n\t\t\t\tcallback(texture);\r\n\t\t\t}\r\n\t\t\treturn texture;\r\n\t\t}\r\n\r\n\t\t//if not load this async\r\n\t\tvar self = this;\r\n\t\ttexture = this.texture_loader.load(name, function (texture)\r\n\t\t{\r\n\t\t\tif (callback) {\r\n\t\t\t\tcallback(texture);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.resources[name] = texture;\t\r\n\t\treturn texture;\r\n\t},\r\n\t\r\n\r\n\tload_list: function (resource_list, on_load, load_func, on_progress)\r\n\t{\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar cl = new Chain_Loader();\r\n\t\tvar self = this;\r\n\t\tcl.onerror = function (error) {\r\n\t\t\tconsole.error(\"ERROR loading texture\", error, cl.list[cl.index]);\t\r\n\t\t}\r\n\t\tcl.item_loaded = function (resource, name) {\r\n\t\t\tself.resources[name] = resource;\r\n\t\t\tif (self.on_resource_loaded) {\r\n\t\t\t\tself.on_resource_loaded(resource);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcl.on_progress = function () {\r\n\t\t\tif (on_progress) {\r\n\t\t\t\ton_progress();\r\n\t\t\t}\r\n\t\t}\r\n\t\tcl.load_func = function () {\r\n\t\t\tload_func.apply(this, arguments);\r\n\t\t}\r\n\t\tcl.finished = function ()\r\n\t\t{\r\n\t\t\tif (on_load) {\r\n\t\t\t\ton_load();\r\n\t\t\t}\r\n\t\t}\r\n\t\tcl.start(resource_list);\r\n\t\t\r\n\t},\r\n\r\n\tload_list_textures: function (resource_list, on_load)\r\n\t{\r\n\t\tvar self = this;\r\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress ) \r\n\t\t{\r\n\t\t\tvar texture = self.texture_loader.load(url, next, progress, error);\r\n\t\t});\r\n\t},\r\n\r\n\tload_list_json: function (resource_list, on_load, progress)\r\n\t{\r\n\t\tvar self = this;\r\n\t\tvar loader = new THREE.XHRLoader();\t\r\n\t\tthis.load_list(resource_list, on_load, function (url, next, error, progress) \r\n\t\t{\r\n\t\t\tvar texture = loader.load(url, next, progress, error);\r\n\t\t}, progress);\r\n\t},\r\n\t\r\n\tfree: function ()\r\n\t{\r\n\t\tthis.resources = {};\r\n\t}\r\n};\r\n\r\n\r\nMy_Lib.Texture_Manager = new Loading_Manager();\t\r\n\r\nexport { Loading_Manager };\n\n\n// WEBPACK FOOTER //\n// ./src/base/loading_manager.js","//TODO: remove this ugly crap and replace something reasonable\r\n\r\nimport {My_Lib} from './my_lib.js';\r\n\r\n//this ugly class loading texture list in json format, parse it, and loading textures\r\n//then it call event data_loaded, when give texture list in json format\r\n\r\nfunction Package_Manager()\r\n{\r\n    this.state = {};\r\n}\r\n\r\n//load json file with descriptions of package: texture list, particles list, scene objects list\r\nPackage_Manager.prototype.load = function (url, defaults)\r\n{\r\n    this.defaults = defaults;\r\n    var self = this;\r\n    this.state = {\r\n        \"type\": \"start\"\r\n    };\r\n    \r\n    var self = this;\r\n    function onload (data) {\r\n        self.state[\"type\"] = \"done\";\r\n        self.state[\"data\"] = data;\r\n        \r\n        self.parse_package_description(data);        \r\n    }    \r\n    function error(event) {\r\n        self.state[\"type\"] = \"error\";\r\n        self.state[\"error\"] = event;\r\n        console.error(\"ERror! Failed loading resources with url \"+url, event.target);        \r\n        if (self.error){\r\n            self.error(event.target);\r\n        }\r\n        self.pack = self.defaults\r\n        self.load_resources(self.defaults);\r\n\r\n    }\r\n    function progress()\r\n    {\r\n    }\r\n    var xhr = new THREE.XHRLoader();\r\n    xhr.load(url, onload, progress, error);\r\n}\r\n\r\n//parse loaded json file \r\nPackage_Manager.prototype.parse_package_description = function (data)\r\n{\r\n    console.log(\"packaged description loaded, begin parsing...\");\r\n  try {\r\n        var pack = JSON.parse(data);\r\n        this.pack = pack;\r\n        if (this.loaded) {\r\n            this.loaded(pack);\r\n        }\r\n        \r\n   } \r\n   catch(e) {\r\n        console.error(\"error parsing resources \", e);\r\n        if (this.error){\r\n            this.error(event);\r\n        }\r\n        return;        \r\n   }\r\n   this.load_resources(pack);\r\n}\r\n\r\n\r\nPackage_Manager.prototype.load_resources = function (pack)\r\n{\r\n    var self = this;\r\n    //load textures\r\n   console.log(\"Package Manager: begin loading textures...\");    \r\n    My_Lib.Texture_Manager.load_list_textures(pack.textures, function (){\r\n        //load json descriptions files\r\n                if (self.data_loaded) {\r\n                    self.data_loaded(pack);\r\n                }\r\n    })\r\n}\r\n\r\n\r\nexport { Package_Manager };\n\n\n// WEBPACK FOOTER //\n// ./src/base/package_manager.js","import {My_Lib} from './my_lib.js';\r\nimport {Particle_Manager} from '../particles/particles_manager.js'\r\n\r\nfunction Scene_Serializer(root)\r\n{\r\n    this.animation_library = {};\r\n}\r\n\r\nScene_Serializer.prototype.toJSON = function (root)\r\n{\r\n    this.json = root.toJSON();\r\n    console.log(\"my lib particle manager\", My_Lib.particle_manager);\r\n    this.json[\"particles\"] = My_Lib.particle_manager.toJSON();\r\n    var anims = root.collect_animations(root);\r\n    if (anims.count > 0) {\r\n        this.json[\"myanimations\"] = anims;\r\n    }\r\n    \r\n    return this.json;\r\n}\r\n\r\n\r\n\r\nScene_Serializer.prototype.create_animations = function (animations) {\r\n    for(var key in animations) {\r\n        if ( this.animation_library[key] === undefined && Object.prototype.hasOwnProperty.call(animations, key)) {\r\n            var data = animations[key];\r\n            //console.log(\"create animations \", data.uuid);            \r\n            var anim =  My_Lib.Abstract_Fabric(data);\r\n            if (anim) {\r\n                this.animation_library[key] = anim;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nScene_Serializer.prototype.bind_animations = function (animdata)\r\n{\r\n    if (!animdata) return;\r\n    \r\n    var bindings = animdata.bindings;\r\n    \r\n    \r\n    var self = this;\r\n    function copy_animations(obj, bind)\r\n    {\r\n        for(var i = 0; i < bind.animations.length; i++){\r\n            var anim_uuid = bind.animations[i];\r\n            obj.add_animation( self.animation_library[anim_uuid] );\r\n        }\r\n    }\r\n    \r\n     for(var i =0; i < bindings.length; i++) {\r\n        var bind = bindings[i];\r\n        var uuid = bind.uuid;\r\n        var obj = this.root.getObjectByProperty(\"uuid\", uuid);\r\n        if (obj) {\r\n            copy_animations(obj, bind);\r\n        }\r\n    }\r\n}\r\n\r\n\r\nScene_Serializer.prototype.load_from_json = function (url)\r\n{\r\n    var self = this;\r\n    function onload(json)\r\n    {\r\n        try {\r\n            var data = JSON.parse(json);\r\n        }\r\n        catch(e) {\r\n            console.error(\"Failed to parse scene \", e);\r\n            throw e;\r\n        }\r\n        if (data === undefined) {\r\n            console.error(\"Something fucking happened, failed to load scene \", url);\r\n            return;\r\n        }\r\n        self.load(data);\r\n    }\r\n    function progress()\r\n    {\r\n    }\r\n    function error(e)\r\n    {\r\n        console.error(e.target);\r\n        throw e;\r\n    }\r\n    var xhr = new THREE.XHRLoader();\r\n    xhr.load(url, onload, progress, error);\r\n}\r\n\r\nScene_Serializer.prototype.load = function (json)\r\n{\r\n    this.animation_library = {};\r\n    var o = new THREE.ObjectLoader();\r\n    if (json !== undefined) {\r\n        this.json = json;\r\n    }\r\n    var root = o.parse(this.json, function () {console.log(\"onload\")});\r\n    this.root = root;    \r\n\r\n    My_Lib.particle_manager.load_particles(this.json, root);\r\n    \r\n    this.create_animations(this.json.myanimations.animations);\r\n    this.bind_animations(this.json.myanimations);\r\n    this.main_camera = root.getObjectByName(\"main_camera\");\r\n    \r\n    if (this.scene_loaded) {\r\n        this.scene_loaded(root);\r\n    }\r\n    return root;\r\n}\r\n\r\nexport { Scene_Serializer };\n\n\n// WEBPACK FOOTER //\n// ./src/base/scene_serializer.js","function Mix_It()\r\n{\r\n\r\n\t//FIX\r\n\tTHREE.Vector3.prototype.applyMatrix4_rotation = function ( m ) \r\n\t{\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;\r\n\r\n\t\treturn this;\r\n \t}\r\n\r\nvar Object3D_Animation_Mixin = {\r\n    \r\n    add_animation: function (anim)\r\n    {\r\n        if (!this.animations) {\r\n            this.animations = [];\r\n        }\r\n        if (this.animations.indexOf(anim) < 0) {\r\n            this.animations.push(anim);\r\n        }\r\n    },\r\n    \r\n    remove_animation: function (anim)\r\n    {\r\n        if (this.animations) {\r\n            var i = this.animations.indexOf(anim);\r\n            if (i > -1) {\r\n                this.animations.splice(i, 1);\r\n            }\r\n        }\r\n    },\r\n    \r\n    update:  function (dt)\r\n    {\r\n        if (this.animations !== undefined) {\r\n            for(var i =0; i < this.animations.length; i++) {\r\n                var anim = this.animations[i];\r\n                anim.update(dt);\r\n                anim.apply(this);\r\n            }\r\n        }\r\n    \r\n        for(var i = 0; i < this.children.length; i++) {\r\n            var obj = this.children[i];\r\n            if (obj.update) {\r\n                obj.update(dt);\r\n            }\r\n        }\r\n    },\r\n    \r\n    \r\n};\r\n_.copy_object(THREE.Object3D.prototype, Object3D_Animation_Mixin);\r\n\r\n\r\nTHREE.Object3D.prototype.old_toJson = THREE.Object3D.toJSON;\r\n\r\nvar Object3D_Serialization_Mixin = \r\n{\r\n    standard_serialization: function (meta) \r\n    {\r\n\t\t// standard Object3D serialization\r\n\t\tvar object = {};\r\n\r\n\t\tobject.uuid = this.uuid;\r\n\t\tobject.type = this.type;\r\n\t\tif ( this.name !== '' ) object.name = this.name;\r\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) object.userData = this.userData;\r\n\t\tif ( this.castShadow === true ) object.castShadow = true;\r\n\t\tif ( this.receiveShadow === true ) object.receiveShadow = true;\r\n\t\tif ( this.visible === false ) object.visible = false;\r\n\r\n\t\tobject.matrix = this.matrix.toArray();\r\n        \r\n\r\n        if (this.type !== \"particles_points\")\r\n        {\r\n            if (this.geometry !== undefined) {\r\n                object.geometry = this.geometry.uuid;\r\n            }\r\n            if ( this.material !== undefined ) {\r\n                object.material = this.material.uuid;\r\n            }\r\n            \r\n            if ( this.material !== undefined  &&  meta.materials[ this.material.uuid ] === undefined ) {\r\n                    meta.materials[ this.material.uuid ] = this.material.toJSON( meta);\r\n            }\r\n\r\n            if ( this.geometry !== undefined && meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n                    meta.geometries[ this.geometry.uuid ] = this.geometry.toJSON( meta );\r\n            }\r\n        }\r\n        \r\n        if (this.animations) {\r\n            object.animations = [];\r\n            for(var i =0; i < this.animations.length; i++) {\r\n                object.animations.push ( this.animations[i].uuid );\r\n            }\r\n        }\r\n        \r\n\t\tif ( this.children.length > 0 ) {\r\n\t\t\tobject.children = [];\r\n\t\t\tfor ( var i = 0; i < this.children.length; i ++ ) \r\n            {\r\n                var child = this.children[ i ];\r\n\t\t\t\t//object.children.push( child.standard_serialization( meta ) );\r\n                object.children.push( child.toJSON( meta ) );\r\n\t\t\t}\r\n\t\t}\r\n        return object;\r\n    },\r\n    \r\n    collect_materials: function (meta) \r\n    {\r\n\t\tif ( this.material !== undefined  &&  meta.materials[ this.material.uuid ] === undefined ) {\r\n                meta.materials[ this.material.uuid ] = this.material.toJSON( meta);\r\n\t\t}\r\n        \r\n\t\tfor ( var i = 0; i < this.children.length; i ++ ) {\r\n\t\t\tthis.children[ i ].collect_materials(meta);\r\n\t\t}\r\n    },\r\n    \r\n    collect_geometry: function (meta)\r\n    {\r\n\t\tif ( this.geometry !== undefined && meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n\t\t\t\tmeta.geometries[ this.geometry.uuid ] = this.geometry.toJSON( meta );\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < this.children.length; i ++ ) {\r\n\t\t\tthis.children[ i ].collect_geometry(meta);\r\n\t\t}\r\n    },\r\n    \r\n\ttoJSON1: function ( meta ) {\r\n    \r\n\t\t// extract data from the cache hash\r\n\t\t// remove metadata on each item\r\n\t\t// and return as array\r\n\t\tfunction extractFromCache( cache, t ) {\r\n\t\t\tvar values = [];\r\n\t\t\tfor ( var key in cache ) {\r\n\t\t\t\tvar data = cache[ key ];\r\n\t\t\t\tdelete data.metadata;\r\n\t\t\t\tvalues.push( data );\r\n\t\t\t}\r\n\t\t\treturn values;\r\n\t\t}\r\n    \r\n\r\n        this.updateMatrixWorld(true);\r\n        \r\n\t\t// meta is '' when called from JSON.stringify\r\n\t\tvar isRootObject = ( meta === undefined || meta === '' );\r\n\r\n\t\tvar output = {};\r\n\r\n\t\tif ( isRootObject ) {\r\n\r\n            meta = {\r\n\t\t\t\tgeometries: {},\r\n\t\t\t\tmaterials: {},\r\n\t\t\t\ttextures: {},\r\n\t\t\t\timages: {}\r\n\t\t\t};\r\n            \r\n            \r\n            //this.collect_materials(meta);\r\n            //this.collect_geometry(meta);\r\n            var object = this.standard_serialization(meta);\r\n            \r\n            \r\n\t\t\toutput.metadata = {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'Object',\r\n\t\t\t\tgenerator: 'Object3D.toJSON'\r\n\t\t\t};\r\n\r\n\t\t\tvar geometries = extractFromCache( meta.geometries, \"geoim\" );\r\n\t\t\tvar materials = extractFromCache( meta.materials, \"materials\" );\r\n\t\t\tvar textures = extractFromCache( meta.textures, \"textures\" );\r\n\t\t\tvar images = extractFromCache( meta.images, \"images\" );\r\n\r\n\t\t\tif ( geometries.length > 0 ) output.geometries = geometries;\r\n\t\t\tif ( materials.length > 0 ) output.materials = materials;\r\n\t\t\tif ( textures.length > 0 ) output.textures = textures;\r\n\t\t\tif ( images.length > 0 ) output.images = images;\r\n\r\n            var anims = this.collect_animations(this);\r\n            if (anims.count > 0) {\r\n                output[\"myanimations\"] = anims;\r\n            }\r\n           \r\n            output.object = object;\r\n\t\t} else {\r\n            output.object = this.standard_serialization(meta);\r\n            output.type = this.type;\r\n            if (output.object === undefined) {\r\n                console.log(\"i am undefined\", this);\r\n            }\r\n        }\r\n\r\n\t\treturn output;\r\n\r\n\r\n\t},\r\n    \r\n    collect_animations: function (scene)\r\n    {\r\n        var data = {\r\n            animations : {},\r\n            bindings : [],\r\n            count: 0\r\n        };\r\n        \r\n        function collect_animations_recursive(root)\r\n        {\r\n            if (root.animations) {\r\n                for(var i =0; i < root.animations.length; i++) {\r\n                    var anim = root.animations[i];\r\n                    if (data.animations[ anim.uuid ] === undefined) {\r\n                        data.animations[ anim.uuid] = anim.toJSON() ;\r\n                        data.count++;\r\n                    }\r\n                }\r\n                \r\n                var bind = {};\r\n                bind.uuid = root.uuid\r\n                bind.animations = [];\r\n                for(var i =0; i < root.animations.length; i++) {\r\n                    bind.animations.push( root.animations[i].uuid);\r\n                }\r\n                data.bindings.push(bind);\r\n            }\r\n            \r\n            if (root.children) {\r\n                for(var i = 0; i < root.children.length; i++) {\r\n                    collect_animations_recursive( root.children[i] );\r\n                }\r\n            }\r\n        }\r\n        collect_animations_recursive(scene);\r\n        return data;\r\n    },\r\n    \r\n \r\n};\r\n\r\n\r\n  _.copy_object(THREE.Object3D.prototype, Object3D_Serialization_Mixin);\r\n  \r\n    \r\n\r\n//replace source with this\r\nTHREE.Object3D.prototype.replace_object_with_this = function ( source ) {\r\n\r\n    this.uuid = source.uuid;\r\n    this.name = source.name;\r\n\r\n    this.up.copy( source.up );\r\n    this.position.copy( source.position );\r\n    this.quaternion.copy( source.quaternion );\r\n    this.scale.copy( source.scale );\r\n\r\n    this.matrix.copy( source.matrix );\r\n    this.matrixWorld.copy( source.matrixWorld );\r\n\r\n    this.matrixAutoUpdate = source.matrixAutoUpdate;\r\n    this.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\r\n\r\n    this.visible = source.visible;\r\n\r\n    this.castShadow = source.castShadow;\r\n    this.receiveShadow = source.receiveShadow;\r\n\r\n    this.frustumCulled = source.frustumCulled;\r\n    this.renderOrder = source.renderOrder;\r\n\r\n    this.userData = JSON.parse( JSON.stringify( source.userData ) );\r\n\r\n    //copy array of children, not clone\r\n    for ( var i = 0; i < source.children.length; i ++ ) {\r\n        this.add( source.children[ i ] );\r\n    }\r\n    source.parent.add(this);\r\n    source.parent.remove(source);\r\n    \r\n    this.animations = source.animations;\r\n}\r\n\r\n\r\n}\r\n\r\nMix_It();\r\n\r\nexport {Mix_It};\n\n\n// WEBPACK FOOTER //\n// ./src/base/threejs_mixins.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\n\r\nfunction Custom_Affector()\r\n{\r\n\tParticle_Affector.apply(this, arguments);\r\n    this.custom_func = function dummy () {return true;};\r\n}\r\n\r\n\r\nCustom_Affector.prototype = Object.create(Particle_Affector.prototype);\r\n\r\n_.copy_object(Custom_Affector.prototype, \r\n    {\r\n    constructor: Custom_Affector,\r\n   \taffect: function (dt, pdata, vert)\r\n\t{\r\n        return this.custom_func(dt, p, vert);\r\n\t},\r\n    test_func: function () {\r\n        var p = {\r\n            position: {x: 0, y: 0, z: 0},\r\n            velocity: {x: 0, y: 0, z: 0}\r\n        };\r\n        var color = {r: 0, g: 0, b: 0};\r\n        this.custom_func(p, color);\r\n    },\r\n    set_affect_function: function (source) {    \r\n        if (typeof source === 'function') {\r\n            this.custom_func = source;\r\n        } else if (typeof source  === 'string') {\r\n            try {\r\n                this.custom_func = new Function ('dt,p,vert', source);\r\n                this.test_func();\r\n            }\r\n            catch (e) {\r\n                alert(e);\r\n                this.custom_func = undefined;\r\n            }\r\n            this.source_code = source;\r\n        }\r\n    },\r\n    \r\n\ttoJSON: function ()\r\n\t{\r\n        var data = {\r\n            name: \"Custom_Affector\"\r\n        };\r\n\t\tdata.params = My_Lib.Particle_Affector.prototype.toJSON.call(this, this);\r\n\t\tparams[\"source_code\"] = this.source_code;\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tMy_Lib.Particle_Affector.prototype.parse(this, json);\r\n\t\tthis.set_affect_func(json.source_code);\r\n\t}\r\n\r\n});\r\n\r\nMy_Lib.Register_Class(\"Custom_Affector\", Custom_Affector);\r\n\r\nexport {Custom_Affector};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/custom_affector.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\n\r\n\r\nfunction Custom_Emitter()\r\n{\r\n\tParticle_Emitter.apply(this, arguments);\r\n}\r\n\r\n\r\nCustom_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\n\r\nvar methods = {\r\n    emit: function (p, color) {\r\n        if (this.custom_func) {\r\n            this.custom_func(p, color);\r\n        }\r\n    },\r\n    test_func: function () {\r\n        var p = {\r\n            position: {x: 0, y: 0, z: 0},\r\n            velocity: {x: 0, y: 0, z: 0}\r\n        };\r\n        var color = {r: 0, g: 0, b: 0};\r\n        this.custom_func(p, color);\r\n    },\r\n    set_emit_function: function (source) {\r\n        if (typeof source === 'function') {\r\n            this.custom_func = source;\r\n        } else if (typeof source  === 'string') {\r\n            try {\r\n                this.custom_func = new Function ('p', 'color', source);\r\n                this.test_func();\r\n            }\r\n            catch (e) {\r\n                alert(e);\r\n                this.custom_func = undefined;\r\n            }\r\n            this.source_code = source;\r\n        }\r\n    },\r\n    toJSON: function () {\r\n        var data = {};\r\n        data.name = \"Custom_Emitter\";\r\n        data.params = My_Lib.Particle_Emitter.prototype.toJSON.call(this, this);\r\n        if (this.source_code) {\r\n            data.params.source_code = this.source_code;\r\n        }\r\n        return data;\r\n    },\r\n    parse: function (data) {\r\n        My_Lib.Particle_Emitter.prototype.parse.call(this, data);        \r\n        this.set_emit_function (data.source_code);\r\n    },\r\n    constructor: Custom_Emitter,\r\n};\r\n\r\n_.copy_object(Custom_Emitter.prototype, methods);\r\nMy_Lib.Register_Class(\"Custom_Emitter\", Custom_Emitter);\r\n\r\n\r\nfunction test()\r\n{\r\n    var t = new Custom_Emitter();\r\n    var source = 'p.position.z = -100; p.velocity.y = 100;';\r\n    t.set_emit_function(source);\r\n    var p = {\r\n        velocity: {x: 0, y: 0, z: 0},\r\n        position: {x: 0, y: 0, z: 0}\r\n    };\r\n    t.custom_func(p);\r\n    console.log(p);\r\n    var json = t.toJSON();\r\n    console.log(json);\r\n    \r\n    t = new Custom_Emitter();\r\n    t.parse(json.params);\r\n    //console.log(t.custom_func);    \r\n}\r\n\r\n//test();\r\n\r\n/*\r\nCustom_Emitter.prototype = Object.create(My_Lib.Particle_Emitter.prototype);\r\nCustom_Emitter.prototype.constructor = Cone_Emitter;\r\nMy_Lib.Register_Class(\"Custom_Emitter\", Cone_Emitter);\r\n*/\r\n\r\nexport {Custom_Emitter};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/custom_emitter.js","import {My_Lib} from '../base/my_lib.js';\r\n\r\nvar Particle_Forces = {};\r\n\r\n//base class\r\nParticle_Forces.Force = function ()\r\n{\r\n}\r\n\r\n\r\n_.copy_object(Particle_Forces.Force.prototype,{\r\n\t\tcalc: function (dt, particle, acceleration) \r\n\t\t{\r\n\t\t},\r\n\t\ttoJSON: function (child) \r\n\t\t{\r\n\t\t\treturn {};\r\n\t\t},\r\n\t\tparse: function (json) \r\n\t\t{\r\n\t\t},\r\n});\r\n\r\n//constant force\r\nParticle_Forces.Constant_Force = function (force)\r\n{\r\n\tif (typeof force !== 'undefined') {\r\n\t\tthis.force = force;\r\n\t} else {\r\n\t\tthis.force = {x:0, y:0, z:0};\r\n\t}\r\n}\r\n\r\nParticle_Forces.Constant_Force.prototype = Object.create(Particle_Forces.Force.prototype);\r\n_.copy_object(Particle_Forces.Constant_Force.prototype, {\r\n\tconstructor: Particle_Forces.Constant_Force,\r\n\tcalc: function (dt, p, acceleration) \r\n\t{\r\n\t\tacceleration.x += this.force.x;\r\n\t\tacceleration.y += this.force.y;\r\n\t\tacceleration.z += this.force.z;\r\n\t},\r\n\ttoJSON: function (child)\r\n\t{\r\n\t\tvar data = {};\r\n\t\tdata.name = \"Constant_Force\";\r\n\t\tdata.force = _.create_clone_object(this.force);\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\t\r\n\t\tif (json.force) {\r\n\t\t\t_.copy_object(this.force, json.force);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nMy_Lib.Register_Class(\"Constant_Force\", Particle_Forces.Constant_Force);\r\n\r\nexport {Particle_Forces};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/forces.js","import {My_Lib} from '../base/my_lib.js';\r\nimport {Point_Generators} from './point_generators.js';\r\nimport {Particle_Emitter} from './particle_emitter.js';\r\nimport {Particle_Affector} from './particle_affector.js';\r\n\r\nfunction  Cone_Emitter()\r\n{\r\n\tParticle_Emitter.apply(this, arguments);\r\n\tthis.generator = new Point_Generators.Random_Direction();\r\n\tthis.origin = new THREE.Vector3(1, 1, 0);\r\n\tthis.velocity = new THREE.Vector3(0, 1, 0);\r\n\tthis.dispersion = {\"min\": 5, \"max\": 10};\r\n\tthis.dispersion.delta = 5;\r\n\tthis.speed = {min: 5, max: 10, delta:5};\r\n\tthis.color = new THREE.Color(1, 1, 1);\r\n}\r\n\r\nCone_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\nCone_Emitter.prototype.constructor = Cone_Emitter;\r\nMy_Lib.Register_Class(\"Cone_Emitter\", Cone_Emitter);\r\n\r\nCone_Emitter.prototype.toJSON = function ()\r\n{\r\n\tvar data = {};\r\n\tdata.name = \"Cone_Emitter\";\r\n\tdata.params = Particle_Emitter.prototype.toJSON.call(this, this);\r\n\t_.clone_field_list_one_level_recursion(this, data.params, \r\n\t[\"origin\", \r\n\t\"velocity\", \r\n\t\"dispersion\",\r\n\t\"speed\"]);\r\n\t\r\n\treturn data;\r\n}\r\n\r\nCone_Emitter.prototype.parse = function (data)\r\n{\r\n\tParticle_Emitter.prototype.parse.call(this, data);\r\n\tthis.origin.copy(data.origin);\r\n\tthis.velocity.copy(data.velocity);\r\n\tthis.set_dispersion(data.dispersion.min, data.dispersion.max);\r\n\tthis.set_speed(data.speed.min, data.speed.max);\r\n}\r\n\r\nCone_Emitter.prototype.set_speed = function (min, max)\r\n{\r\n\tthis.speed.min = min;\r\n\tthis.speed.max = max;\r\n\tthis.speed.delta = max - min;\r\n}\r\n\r\n\r\nCone_Emitter.prototype.set_dispersion = function (min, max)\r\n{\r\n\tthis.dispersion.min = min;\r\n\tthis.dispersion.max = max;\r\n\tthis.dispersion.delta = max - min;\r\n}\r\n\r\n\r\n\r\n\r\nCone_Emitter.prototype.emit = function (p, color, matrix)\r\n{\r\n\tp.position.copy(this.origin);\r\n\t\r\n\tthis.generator.get_direction(p.velocity);\r\n\tp.velocity.multiplyScalar(Math.random()*this.dispersion.delta + this.dispersion.min);\t\r\n\tp.velocity.add(this.velocity).normalize();\r\n\t\r\n    if (matrix) {\r\n        p.position.applyMatrix4(matrix);\r\n        p.velocity.applyMatrix4_rotation(matrix);\r\n    }\r\n        \r\n\tp.velocity.multiplyScalar(Math.random()*this.speed.delta + this.speed.min);\t\r\n\t\r\n    \r\n\tif (color) {\r\n\t\tthis.emit_color(color);\r\n\t}\r\n    \r\n}\r\n\r\nCone_Emitter.prototype.emit_color = function (color) \r\n{\r\n\tcolor.copy(this.color);\r\n}\r\n\r\nfunction Sphere_Emitter(radius)\r\n{\r\n\tParticle_Emitter.call(this);\r\n\tthis.radius = radius;\r\n\tthis.generator = new Point_Generators.Sphere(radius);\r\n}\r\n\r\nSphere_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\nSphere_Emitter.prototype.constructor = Sphere_Emitter;\r\n\r\n\r\nSphere_Emitter.prototype.emit = function (p)\r\n{\r\n\tthis.generator.get_point(p.position);\r\n\tthis.generator.get_normal(p.velocity);\r\n\tp.velocity.multiplyScalar(10);\r\n}\r\n\r\n\r\n\r\nfunction Star_Dust_Emitter ()\r\n{\r\n\tParticle_Emitter.apply(this, arguments);\r\n\tthis.start_position = new THREE.Vector3(0, 0, 0);\r\n\tthis.end_position = new THREE.Vector3(1, 1, 1);\r\n\tthis.delta = new THREE.Vector3(1, 1, 1);\t\r\n\tthis.velocity = new THREE.Vector3(0, 0, 1);\r\n}\r\n\r\nStar_Dust_Emitter.prototype = Object.create(Particle_Emitter.prototype);\r\nStar_Dust_Emitter.prototype.constructor = Star_Dust_Emitter;\r\n_.copy_object( Star_Dust_Emitter.prototype,{\r\n\tset_velocity: function (x,y, z) \r\n\t{\r\n\t\tthis.velocity.set(x, y, z);\r\n\t},\r\n\tset_position_range : function (start, end)\r\n\t{\r\n\t\tthis.start_position.copy(start);\r\n\t\tthis.end_position.copy(end);\r\n\t\tthis.delta.set(end.x - start.x, end.y-start.y, end.z-start.z);\r\n\t\t\r\n\t},\r\n\tget_position: function (vector)\r\n\t{\r\n\t\tvector.x = Math.random() * this.delta.x + this.start_position.x;\r\n\t\tvector.y = Math.random() * this.delta.y + this.start_position.y;\r\n\t\tvector.z = Math.random() * this.delta.z + this.start_position.z;\r\n\t},\r\n\tget_velocity: function (vector)\r\n\t{\r\n\t\tvector.x = this.velocity.x;\r\n\t\tvector.y = this.velocity.y;\r\n\t\tvector.z = this.velocity.z;\r\n\t},\r\n\temit: function (p)\r\n\t{\r\n\t\tthis.get_position(p.position);\r\n\t\tif (this.parent) {\r\n\t\t\tthis.parent.localToWorld(p.position);\r\n\t\t}\r\n\t\tthis.get_velocity(p.velocity);\r\n\t},\r\n\ttoJSON: function ()\r\n\t{\r\n\t\tvar params = Particle_Emitter.prototype.toJSON.call(this, this);\r\n\t\t_.clone_field_list_one_level_recursion(this, params, [\"velocity\", \r\n\t\t\"start_position\",\r\n\t\t\"end_position\"])\r\n\t\tvar data = {\r\n\t\t\t\"name\": \"Star_Dust_Emitter\",\r\n\t\t\t\"params\": params,\r\n\t\t};\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tParticle_Emitter.prototype.parse.call(this, json);\r\n\t\tthis.set_position_range(json.start_position, json.end_position);\r\n\t\tthis.velocity.copy(json.velocity);\r\n\t}\r\n\t\r\n});\r\n\r\nMy_Lib.Register_Class(\"Star_Dust_Emitter\", Star_Dust_Emitter);\r\n\r\n\r\nfunction Star_Dust_Affector (end)\r\n{\r\n\tthis.end = end || 0;\r\n}\r\n\r\n\r\nStar_Dust_Affector.prototype = Object.create(Particle_Affector.prototype);\r\nStar_Dust_Affector.prototype.constructor = Star_Dust_Affector;\r\n\r\n_.copy_object(Star_Dust_Affector.prototype,{\r\n\taffect: function (dt, pdata, vert)\r\n\t{\r\n\t\tif (pdata.position.z > this.end) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\ttoJSON: function ()\r\n\t{\r\n\t\tvar params = Particle_Affector.prototype.toJSON.call(this, this);\r\n\t\tparams[\"end\"] = this.end;\r\n\t\tvar data = {\r\n\t\t\t\"name\": \"Star_Dust_Affector\",\r\n\t\t\t\"params\": params,\r\n\r\n\t\t};\r\n\t\treturn data;\r\n\t},\r\n\tparse: function (json)\r\n\t{\r\n\t\tParticle_Affector.prototype.parse(this, json);\r\n\t\tthis.end = json.end;\r\n\t}\r\n});\r\n\r\nMy_Lib.Register_Class(\"Star_Dust_Affector\", Star_Dust_Affector);\r\n\r\nexport {Cone_Emitter, Star_Dust_Emitter, Sphere_Emitter, Star_Dust_Affector};\n\n\n// WEBPACK FOOTER //\n// ./src/particles/test_emitters.js"],"sourceRoot":""}